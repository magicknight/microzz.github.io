[{"title":"å¼‚æ­¥æ“ä½œå’ŒAsyncå‡½æ•°","date":"2017-01-15T06:58:52.000Z","path":"2017/01/15/async/","text":"å¼‚æ­¥æ“ä½œå’ŒAsyncå‡½æ•°å¼‚æ­¥ç¼–ç¨‹å¯¹ JavaScript è¯­è¨€å¤ªé‡è¦ã€‚Javascript è¯­è¨€çš„æ‰§è¡Œç¯å¢ƒæ˜¯â€œå•çº¿ç¨‹â€çš„ï¼Œå¦‚æœæ²¡æœ‰å¼‚æ­¥ç¼–ç¨‹ï¼Œæ ¹æœ¬æ²¡æ³•ç”¨ï¼Œéå¡æ­»ä¸å¯ã€‚æœ¬ç« ä¸»è¦ä»‹ç»å¦‚ä½• Generator å‡½æ•°å®Œæˆå¼‚æ­¥æ“ä½œã€‚ ES6è¯ç”Ÿä»¥å‰ï¼Œå¼‚æ­¥ç¼–ç¨‹çš„æ–¹æ³•ï¼Œå¤§æ¦‚æœ‰ä¸‹é¢å››ç§ã€‚ å›è°ƒå‡½æ•° äº‹ä»¶ç›‘å¬ å‘å¸ƒ/è®¢é˜… Promise å¯¹è±¡ Generator å‡½æ•°å°† JavaScript å¼‚æ­¥ç¼–ç¨‹å¸¦å…¥äº†ä¸€ä¸ªå…¨æ–°çš„é˜¶æ®µã€‚ åŸºæœ¬æ¦‚å¿µå¼‚æ­¥æ‰€è°“â€å¼‚æ­¥â€ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªä»»åŠ¡ä¸æ˜¯è¿ç»­å®Œæˆçš„ï¼Œå¯ä»¥ç†è§£æˆè¯¥ä»»åŠ¡è¢«äººä¸ºåˆ†æˆä¸¤æ®µï¼Œå…ˆæ‰§è¡Œç¬¬ä¸€æ®µï¼Œç„¶åè½¬è€Œæ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œç­‰åšå¥½äº†å‡†å¤‡ï¼Œå†å›è¿‡å¤´æ‰§è¡Œç¬¬äºŒæ®µã€‚ æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªä»»åŠ¡æ˜¯è¯»å–æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œä»»åŠ¡çš„ç¬¬ä¸€æ®µæ˜¯å‘æ“ä½œç³»ç»Ÿå‘å‡ºè¯·æ±‚ï¼Œè¦æ±‚è¯»å–æ–‡ä»¶ã€‚ç„¶åï¼Œç¨‹åºæ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œç­‰åˆ°æ“ä½œç³»ç»Ÿè¿”å›æ–‡ä»¶ï¼Œå†æ¥ç€æ‰§è¡Œä»»åŠ¡çš„ç¬¬äºŒæ®µï¼ˆå¤„ç†æ–‡ä»¶ï¼‰ã€‚è¿™ç§ä¸è¿ç»­çš„æ‰§è¡Œï¼Œå°±å«åšå¼‚æ­¥ã€‚ ç›¸åº”åœ°ï¼Œè¿ç»­çš„æ‰§è¡Œå°±å«åšåŒæ­¥ã€‚ç”±äºæ˜¯è¿ç»­æ‰§è¡Œï¼Œä¸èƒ½æ’å…¥å…¶ä»–ä»»åŠ¡ï¼Œæ‰€ä»¥æ“ä½œç³»ç»Ÿä»ç¡¬ç›˜è¯»å–æ–‡ä»¶çš„è¿™æ®µæ—¶é—´ï¼Œç¨‹åºåªèƒ½å¹²ç­‰ç€ã€‚ å›è°ƒå‡½æ•°JavaScript è¯­è¨€å¯¹å¼‚æ­¥ç¼–ç¨‹çš„å®ç°ï¼Œå°±æ˜¯å›è°ƒå‡½æ•°ã€‚æ‰€è°“å›è°ƒå‡½æ•°ï¼Œå°±æ˜¯æŠŠä»»åŠ¡çš„ç¬¬äºŒæ®µå•ç‹¬å†™åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œç­‰åˆ°é‡æ–°æ‰§è¡Œè¿™ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œå°±ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚å›è°ƒå‡½æ•°çš„è‹±è¯­åå­—callbackï¼Œç›´è¯‘è¿‡æ¥å°±æ˜¯â€é‡æ–°è°ƒç”¨â€ã€‚ è¯»å–æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ˜¯è¿™æ ·å†™çš„ã€‚ 1234fs.readFile('/etc/passwd', 'utf-8', function (err, data) &#123; if (err) throw err; console.log(data);&#125;); ä¸Šé¢ä»£ç ä¸­ï¼ŒreadFileå‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå°±æ˜¯å›è°ƒå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä»»åŠ¡çš„ç¬¬äºŒæ®µã€‚ç­‰åˆ°æ“ä½œç³»ç»Ÿè¿”å›äº†/etc/passwdè¿™ä¸ªæ–‡ä»¶ä»¥åï¼Œå›è°ƒå‡½æ•°æ‰ä¼šæ‰§è¡Œã€‚ ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜æ˜¯ï¼Œä¸ºä»€ä¹ˆ Node çº¦å®šï¼Œå›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¿…é¡»æ˜¯é”™è¯¯å¯¹è±¡errï¼ˆå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œè¯¥å‚æ•°å°±æ˜¯nullï¼‰ï¼Ÿ åŸå› æ˜¯æ‰§è¡Œåˆ†æˆä¸¤æ®µï¼Œç¬¬ä¸€æ®µæ‰§è¡Œå®Œä»¥åï¼Œä»»åŠ¡æ‰€åœ¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒå°±å·²ç»ç»“æŸäº†ã€‚åœ¨è¿™ä»¥åæŠ›å‡ºçš„é”™è¯¯ï¼ŒåŸæ¥çš„ä¸Šä¸‹æ–‡ç¯å¢ƒå·²ç»æ— æ³•æ•æ‰ï¼Œåªèƒ½å½“ä½œå‚æ•°ï¼Œä¼ å…¥ç¬¬äºŒæ®µã€‚ Promiseå›è°ƒå‡½æ•°æœ¬èº«å¹¶æ²¡æœ‰é—®é¢˜ï¼Œå®ƒçš„é—®é¢˜å‡ºç°åœ¨å¤šä¸ªå›è°ƒå‡½æ•°åµŒå¥—ã€‚å‡å®šè¯»å–Aæ–‡ä»¶ä¹‹åï¼Œå†è¯»å–Bæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ã€‚ 12345fs.readFile(fileA, 'utf-8', function (err, data) &#123; fs.readFile(fileB, 'utf-8', function (err, data) &#123; // ... &#125;);&#125;); ä¸éš¾æƒ³è±¡ï¼Œå¦‚æœä¾æ¬¡è¯»å–ä¸¤ä¸ªä»¥ä¸Šçš„æ–‡ä»¶ï¼Œå°±ä¼šå‡ºç°å¤šé‡åµŒå¥—ã€‚ä»£ç ä¸æ˜¯çºµå‘å‘å±•ï¼Œè€Œæ˜¯æ¨ªå‘å‘å±•ï¼Œå¾ˆå¿«å°±ä¼šä¹±æˆä¸€å›¢ï¼Œæ— æ³•ç®¡ç†ã€‚å› ä¸ºå¤šä¸ªå¼‚æ­¥æ“ä½œå½¢æˆäº†å¼ºè€¦åˆï¼Œåªè¦æœ‰ä¸€ä¸ªæ“ä½œéœ€è¦ä¿®æ”¹ï¼Œå®ƒçš„ä¸Šå±‚å›è°ƒå‡½æ•°å’Œä¸‹å±‚å›è°ƒå‡½æ•°ï¼Œå¯èƒ½éƒ½è¦è·Ÿç€ä¿®æ”¹ã€‚è¿™ç§æƒ…å†µå°±ç§°ä¸ºâ€å›è°ƒå‡½æ•°åœ°ç‹±â€ï¼ˆcallback hellï¼‰ã€‚ Promise å¯¹è±¡å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œæå‡ºçš„ã€‚å®ƒä¸æ˜¯æ–°çš„è¯­æ³•åŠŸèƒ½ï¼Œè€Œæ˜¯ä¸€ç§æ–°çš„å†™æ³•ï¼Œå…è®¸å°†å›è°ƒå‡½æ•°çš„åµŒå¥—ï¼Œæ”¹æˆé“¾å¼è°ƒç”¨ã€‚é‡‡ç”¨ Promiseï¼Œè¿ç»­è¯»å–å¤šä¸ªæ–‡ä»¶ï¼Œå†™æ³•å¦‚ä¸‹ã€‚ 123456789101112131415var readFile = require('fs-readfile-promise');readFile(fileA).then(function (data) &#123; console.log(data.toString());&#125;).then(function () &#123; return readFile(fileB);&#125;).then(function (data) &#123; console.log(data.toString());&#125;).catch(function (err) &#123; console.log(err);&#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†fs-readfile-promiseæ¨¡å—ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯è¿”å›ä¸€ä¸ª Promise ç‰ˆæœ¬çš„readFileå‡½æ•°ã€‚Promise æä¾›thenæ–¹æ³•åŠ è½½å›è°ƒå‡½æ•°ï¼Œcatchæ–¹æ³•æ•æ‰æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºçš„é”™è¯¯ã€‚ å¯ä»¥çœ‹åˆ°ï¼ŒPromise çš„å†™æ³•åªæ˜¯å›è°ƒå‡½æ•°çš„æ”¹è¿›ï¼Œä½¿ç”¨thenæ–¹æ³•ä»¥åï¼Œå¼‚æ­¥ä»»åŠ¡çš„ä¸¤æ®µæ‰§è¡Œçœ‹å¾—æ›´æ¸…æ¥šäº†ï¼Œé™¤æ­¤ä»¥å¤–ï¼Œå¹¶æ— æ–°æ„ã€‚ Promise çš„æœ€å¤§é—®é¢˜æ˜¯ä»£ç å†—ä½™ï¼ŒåŸæ¥çš„ä»»åŠ¡è¢« Promise åŒ…è£…äº†ä¸€ä¸‹ï¼Œä¸ç®¡ä»€ä¹ˆæ“ä½œï¼Œä¸€çœ¼çœ‹å»éƒ½æ˜¯ä¸€å †thenï¼ŒåŸæ¥çš„è¯­ä¹‰å˜å¾—å¾ˆä¸æ¸…æ¥šã€‚ é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„å†™æ³•å‘¢ï¼Ÿ Generatorå‡½æ•°åç¨‹ä¼ ç»Ÿçš„ç¼–ç¨‹è¯­è¨€ï¼Œæ—©æœ‰å¼‚æ­¥ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆï¼ˆå…¶å®æ˜¯å¤šä»»åŠ¡çš„è§£å†³æ–¹æ¡ˆï¼‰ã€‚å…¶ä¸­æœ‰ä¸€ç§å«åšâ€åç¨‹â€ï¼ˆcoroutineï¼‰ï¼Œæ„æ€æ˜¯å¤šä¸ªçº¿ç¨‹äº’ç›¸åä½œï¼Œå®Œæˆå¼‚æ­¥ä»»åŠ¡ã€‚ åç¨‹æœ‰ç‚¹åƒå‡½æ•°ï¼Œåˆæœ‰ç‚¹åƒçº¿ç¨‹ã€‚å®ƒçš„è¿è¡Œæµç¨‹å¤§è‡´å¦‚ä¸‹ã€‚ ç¬¬ä¸€æ­¥ï¼Œåç¨‹Aå¼€å§‹æ‰§è¡Œã€‚ ç¬¬äºŒæ­¥ï¼Œåç¨‹Aæ‰§è¡Œåˆ°ä¸€åŠï¼Œè¿›å…¥æš‚åœï¼Œæ‰§è¡Œæƒè½¬ç§»åˆ°åç¨‹Bã€‚ ç¬¬ä¸‰æ­¥ï¼Œï¼ˆä¸€æ®µæ—¶é—´åï¼‰åç¨‹Bäº¤è¿˜æ‰§è¡Œæƒã€‚ ç¬¬å››æ­¥ï¼Œåç¨‹Aæ¢å¤æ‰§è¡Œã€‚ ä¸Šé¢æµç¨‹çš„åç¨‹Aï¼Œå°±æ˜¯å¼‚æ­¥ä»»åŠ¡ï¼Œå› ä¸ºå®ƒåˆ†æˆä¸¤æ®µï¼ˆæˆ–å¤šæ®µï¼‰æ‰§è¡Œã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œè¯»å–æ–‡ä»¶çš„åç¨‹å†™æ³•å¦‚ä¸‹ã€‚ 12345function *asyncJob() &#123; // ...å…¶ä»–ä»£ç  var f = yield readFile(fileA); // ...å…¶ä»–ä»£ç &#125; ä¸Šé¢ä»£ç çš„å‡½æ•°asyncJobæ˜¯ä¸€ä¸ªåç¨‹ï¼Œå®ƒçš„å¥¥å¦™å°±åœ¨å…¶ä¸­çš„yieldå‘½ä»¤ã€‚å®ƒè¡¨ç¤ºæ‰§è¡Œåˆ°æ­¤å¤„ï¼Œæ‰§è¡Œæƒå°†äº¤ç»™å…¶ä»–åç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œyieldå‘½ä»¤æ˜¯å¼‚æ­¥ä¸¤ä¸ªé˜¶æ®µçš„åˆ†ç•Œçº¿ã€‚ åç¨‹é‡åˆ°yieldå‘½ä»¤å°±æš‚åœï¼Œç­‰åˆ°æ‰§è¡Œæƒè¿”å›ï¼Œå†ä»æš‚åœçš„åœ°æ–¹ç»§ç»­å¾€åæ‰§è¡Œã€‚å®ƒçš„æœ€å¤§ä¼˜ç‚¹ï¼Œå°±æ˜¯ä»£ç çš„å†™æ³•éå¸¸åƒåŒæ­¥æ“ä½œï¼Œå¦‚æœå»é™¤yieldå‘½ä»¤ï¼Œç®€ç›´ä¸€æ¨¡ä¸€æ ·ã€‚ Generator å‡½æ•°çš„æ¦‚å¿µGenerator å‡½æ•°æ˜¯åç¨‹åœ¨ ES6 çš„å®ç°ï¼Œæœ€å¤§ç‰¹ç‚¹å°±æ˜¯å¯ä»¥äº¤å‡ºå‡½æ•°çš„æ‰§è¡Œæƒï¼ˆå³æš‚åœæ‰§è¡Œï¼‰ã€‚ æ•´ä¸ª Generator å‡½æ•°å°±æ˜¯ä¸€ä¸ªå°è£…çš„å¼‚æ­¥ä»»åŠ¡ï¼Œæˆ–è€…è¯´æ˜¯å¼‚æ­¥ä»»åŠ¡çš„å®¹å™¨ã€‚å¼‚æ­¥æ“ä½œéœ€è¦æš‚åœçš„åœ°æ–¹ï¼Œéƒ½ç”¨yieldè¯­å¥æ³¨æ˜ã€‚Generator å‡½æ•°çš„æ‰§è¡Œæ–¹æ³•å¦‚ä¸‹ã€‚ 12345678function* gen(x) &#123; var y = yield x + 2; return y;&#125;var g = gen(1);g.next() // &#123; value: 3, done: false &#125;g.next() // &#123; value: undefined, done: true &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œè°ƒç”¨ Generator å‡½æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ªå†…éƒ¨æŒ‡é’ˆï¼ˆå³éå†å™¨ï¼‰gã€‚è¿™æ˜¯ Generator å‡½æ•°ä¸åŒäºæ™®é€šå‡½æ•°çš„å¦ä¸€ä¸ªåœ°æ–¹ï¼Œå³æ‰§è¡Œå®ƒä¸ä¼šè¿”å›ç»“æœï¼Œè¿”å›çš„æ˜¯æŒ‡é’ˆå¯¹è±¡ã€‚è°ƒç”¨æŒ‡é’ˆgçš„nextæ–¹æ³•ï¼Œä¼šç§»åŠ¨å†…éƒ¨æŒ‡é’ˆï¼ˆå³æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„ç¬¬ä¸€æ®µï¼‰ï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªé‡åˆ°çš„yieldè¯­å¥ï¼Œä¸Šä¾‹æ˜¯æ‰§è¡Œåˆ°x + 2ä¸ºæ­¢ã€‚ æ¢è¨€ä¹‹ï¼Œnextæ–¹æ³•çš„ä½œç”¨æ˜¯åˆ†é˜¶æ®µæ‰§è¡ŒGeneratorå‡½æ•°ã€‚æ¯æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºå½“å‰é˜¶æ®µçš„ä¿¡æ¯ï¼ˆvalueå±æ€§å’Œdoneå±æ€§ï¼‰ã€‚valueå±æ€§æ˜¯yieldè¯­å¥åé¢è¡¨è¾¾å¼çš„å€¼ï¼Œè¡¨ç¤ºå½“å‰é˜¶æ®µçš„å€¼ï¼›doneå±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤º Generator å‡½æ•°æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œå³æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚ Generator å‡½æ•°çš„æ•°æ®äº¤æ¢å’Œé”™è¯¯å¤„ç†Generatorå‡½æ•°å¯ä»¥æš‚åœæ‰§è¡Œå’Œæ¢å¤æ‰§è¡Œï¼Œè¿™æ˜¯å®ƒèƒ½å°è£…å¼‚æ­¥ä»»åŠ¡çš„æ ¹æœ¬åŸå› ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸¤ä¸ªç‰¹æ€§ï¼Œä½¿å®ƒå¯ä»¥ä½œä¸ºå¼‚æ­¥ç¼–ç¨‹çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼šå‡½æ•°ä½“å†…å¤–çš„æ•°æ®äº¤æ¢å’Œé”™è¯¯å¤„ç†æœºåˆ¶ã€‚ nextæ–¹æ³•è¿”å›å€¼çš„valueå±æ€§ï¼Œæ˜¯Generatorå‡½æ•°å‘å¤–è¾“å‡ºæ•°æ®ï¼›nextæ–¹æ³•è¿˜å¯ä»¥æ¥å—å‚æ•°ï¼Œè¿™æ˜¯å‘Generatorå‡½æ•°ä½“å†…è¾“å…¥æ•°æ®ã€‚ 12345678function* gen(x)&#123; var y = yield x + 2; return y;&#125;var g = gen(1);g.next() // &#123; value: 3, done: false &#125;g.next(2) // &#123; value: 2, done: true &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬ä¸€ä¸ªnextæ–¹æ³•çš„valueå±æ€§ï¼Œè¿”å›è¡¨è¾¾å¼x + 2çš„å€¼ï¼ˆ3ï¼‰ã€‚ç¬¬äºŒä¸ªnextæ–¹æ³•å¸¦æœ‰å‚æ•°2ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥ä¼ å…¥ Generator å‡½æ•°ï¼Œä½œä¸ºä¸Šä¸ªé˜¶æ®µå¼‚æ­¥ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œè¢«å‡½æ•°ä½“å†…çš„å˜é‡yæ¥æ”¶ã€‚å› æ­¤ï¼Œè¿™ä¸€æ­¥çš„ value å±æ€§ï¼Œè¿”å›çš„å°±æ˜¯2ï¼ˆå˜é‡yçš„å€¼ï¼‰ã€‚ Generator å‡½æ•°å†…éƒ¨è¿˜å¯ä»¥éƒ¨ç½²é”™è¯¯å¤„ç†ä»£ç ï¼Œæ•è·å‡½æ•°ä½“å¤–æŠ›å‡ºçš„é”™è¯¯ã€‚ 12345678910111213function* gen(x)&#123; try &#123; var y = yield x + 2; &#125; catch (e)&#123; console.log(e); &#125; return y;&#125;var g = gen(1);g.next();g.throw('å‡ºé”™äº†');// å‡ºé”™äº† ä¸Šé¢ä»£ç çš„æœ€åä¸€è¡Œï¼ŒGeneratorå‡½æ•°ä½“å¤–ï¼Œä½¿ç”¨æŒ‡é’ˆå¯¹è±¡çš„throwæ–¹æ³•æŠ›å‡ºçš„é”™è¯¯ï¼Œå¯ä»¥è¢«å‡½æ•°ä½“å†…çš„try â€¦catchä»£ç å—æ•è·ã€‚è¿™æ„å‘³ç€ï¼Œå‡ºé”™çš„ä»£ç ä¸å¤„ç†é”™è¯¯çš„ä»£ç ï¼Œå®ç°äº†æ—¶é—´å’Œç©ºé—´ä¸Šçš„åˆ†ç¦»ï¼Œè¿™å¯¹äºå¼‚æ­¥ç¼–ç¨‹æ— ç–‘æ˜¯å¾ˆé‡è¦çš„ã€‚ å¼‚æ­¥ä»»åŠ¡çš„å°è£…ä¸‹é¢çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Generator å‡½æ•°ï¼Œæ‰§è¡Œä¸€ä¸ªçœŸå®çš„å¼‚æ­¥ä»»åŠ¡ã€‚ 1234567var fetch = require('node-fetch');function* gen()&#123; var url = 'https://api.github.com/users/github'; var result = yield fetch(url); console.log(result.bio);&#125; ä¸Šé¢ä»£ç ä¸­ï¼ŒGeneratorå‡½æ•°å°è£…äº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œè¯¥æ“ä½œå…ˆè¯»å–ä¸€ä¸ªè¿œç¨‹æ¥å£ï¼Œç„¶åä»JSONæ ¼å¼çš„æ•°æ®è§£æä¿¡æ¯ã€‚å°±åƒå‰é¢è¯´è¿‡çš„ï¼Œè¿™æ®µä»£ç éå¸¸åƒåŒæ­¥æ“ä½œï¼Œé™¤äº†åŠ ä¸Šäº†yieldå‘½ä»¤ã€‚ æ‰§è¡Œè¿™æ®µä»£ç çš„æ–¹æ³•å¦‚ä¸‹ã€‚ 12345678var g = gen();var result = g.next();result.value.then(function(data)&#123; return data.json();&#125;).then(function(data)&#123; g.next(data);&#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œé¦–å…ˆæ‰§è¡ŒGeneratorå‡½æ•°ï¼Œè·å–éå†å™¨å¯¹è±¡ï¼Œç„¶åä½¿ç”¨next æ–¹æ³•ï¼ˆç¬¬äºŒè¡Œï¼‰ï¼Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„ç¬¬ä¸€é˜¶æ®µã€‚ç”±äºFetchæ¨¡å—è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå› æ­¤è¦ç”¨thenæ–¹æ³•è°ƒç”¨ä¸‹ä¸€ä¸ªnext æ–¹æ³•ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶ Generator å‡½æ•°å°†å¼‚æ­¥æ“ä½œè¡¨ç¤ºå¾—å¾ˆç®€æ´ï¼Œä½†æ˜¯æµç¨‹ç®¡ç†å´ä¸æ–¹ä¾¿ï¼ˆå³ä½•æ—¶æ‰§è¡Œç¬¬ä¸€é˜¶æ®µã€ä½•æ—¶æ‰§è¡Œç¬¬äºŒé˜¶æ®µï¼‰ã€‚ Thunkå‡½æ•°å‚æ•°çš„æ±‚å€¼ç­–ç•¥Thunkå‡½æ•°æ—©åœ¨ä¸Šä¸ªä¸–çºª60å¹´ä»£å°±è¯ç”Ÿäº†ã€‚ é‚£æ—¶ï¼Œç¼–ç¨‹è¯­è¨€åˆšåˆšèµ·æ­¥ï¼Œè®¡ç®—æœºå­¦å®¶è¿˜åœ¨ç ”ç©¶ï¼Œç¼–è¯‘å™¨æ€ä¹ˆå†™æ¯”è¾ƒå¥½ã€‚ä¸€ä¸ªäº‰è®ºçš„ç„¦ç‚¹æ˜¯â€æ±‚å€¼ç­–ç•¥â€ï¼Œå³å‡½æ•°çš„å‚æ•°åˆ°åº•åº”è¯¥ä½•æ—¶æ±‚å€¼ã€‚ 1234567var x = 1;function f(m)&#123; return m * 2;&#125;f(x + 5) ä¸Šé¢ä»£ç å…ˆå®šä¹‰å‡½æ•°fï¼Œç„¶åå‘å®ƒä¼ å…¥è¡¨è¾¾å¼x + 5ã€‚è¯·é—®ï¼Œè¿™ä¸ªè¡¨è¾¾å¼åº”è¯¥ä½•æ—¶æ±‚å€¼ï¼Ÿ ä¸€ç§æ„è§æ˜¯â€ä¼ å€¼è°ƒç”¨â€ï¼ˆcall by valueï¼‰ï¼Œå³åœ¨è¿›å…¥å‡½æ•°ä½“ä¹‹å‰ï¼Œå°±è®¡ç®—x + 5çš„å€¼ï¼ˆç­‰äº6ï¼‰ï¼Œå†å°†è¿™ä¸ªå€¼ä¼ å…¥å‡½æ•°f ã€‚Cè¯­è¨€å°±é‡‡ç”¨è¿™ç§ç­–ç•¥ã€‚ 123f(x + 5)// ä¼ å€¼è°ƒç”¨æ—¶ï¼Œç­‰åŒäºf(6) å¦ä¸€ç§æ„è§æ˜¯â€ä¼ åè°ƒç”¨â€ï¼ˆcall by nameï¼‰ï¼Œå³ç›´æ¥å°†è¡¨è¾¾å¼x + 5ä¼ å…¥å‡½æ•°ä½“ï¼Œåªåœ¨ç”¨åˆ°å®ƒçš„æ—¶å€™æ±‚å€¼ã€‚Haskellè¯­è¨€é‡‡ç”¨è¿™ç§ç­–ç•¥ã€‚ 123f(x + 5)// ä¼ åè°ƒç”¨æ—¶ï¼Œç­‰åŒäº(x + 5) * 2 ä¼ å€¼è°ƒç”¨å’Œä¼ åè°ƒç”¨ï¼Œå“ªä¸€ç§æ¯”è¾ƒå¥½ï¼Ÿå›ç­”æ˜¯å„æœ‰åˆ©å¼Šã€‚ä¼ å€¼è°ƒç”¨æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å¯¹å‚æ•°æ±‚å€¼çš„æ—¶å€™ï¼Œå®é™…ä¸Šè¿˜æ²¡ç”¨åˆ°è¿™ä¸ªå‚æ•°ï¼Œæœ‰å¯èƒ½é€ æˆæ€§èƒ½æŸå¤±ã€‚ 12345function f(a, b)&#123; return b;&#125;f(3 * x * x - 2 * x - 1, x); ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°fçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¤æ‚çš„è¡¨è¾¾å¼ï¼Œä½†æ˜¯å‡½æ•°ä½“å†…æ ¹æœ¬æ²¡ç”¨åˆ°ã€‚å¯¹è¿™ä¸ªå‚æ•°æ±‚å€¼ï¼Œå®é™…ä¸Šæ˜¯ä¸å¿…è¦çš„ã€‚å› æ­¤ï¼Œæœ‰ä¸€äº›è®¡ç®—æœºå­¦å®¶å€¾å‘äºâ€ä¼ åè°ƒç”¨â€ï¼Œå³åªåœ¨æ‰§è¡Œæ—¶æ±‚å€¼ã€‚ Thunkå‡½æ•°çš„å«ä¹‰ç¼–è¯‘å™¨çš„â€ä¼ åè°ƒç”¨â€å®ç°ï¼Œå¾€å¾€æ˜¯å°†å‚æ•°æ”¾åˆ°ä¸€ä¸ªä¸´æ—¶å‡½æ•°ä¹‹ä¸­ï¼Œå†å°†è¿™ä¸ªä¸´æ—¶å‡½æ•°ä¼ å…¥å‡½æ•°ä½“ã€‚è¿™ä¸ªä¸´æ—¶å‡½æ•°å°±å«åšThunkå‡½æ•°ã€‚ 123456789101112131415function f(m)&#123; return m * 2;&#125;f(x + 5);// ç­‰åŒäºvar thunk = function () &#123; return x + 5;&#125;;function f(thunk)&#123; return thunk() * 2;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°fçš„å‚æ•°x + 5è¢«ä¸€ä¸ªå‡½æ•°æ›¿æ¢äº†ã€‚å‡¡æ˜¯ç”¨åˆ°åŸå‚æ•°çš„åœ°æ–¹ï¼Œå¯¹Thunkå‡½æ•°æ±‚å€¼å³å¯ã€‚ è¿™å°±æ˜¯Thunkå‡½æ•°çš„å®šä¹‰ï¼Œå®ƒæ˜¯â€ä¼ åè°ƒç”¨â€çš„ä¸€ç§å®ç°ç­–ç•¥ï¼Œç”¨æ¥æ›¿æ¢æŸä¸ªè¡¨è¾¾å¼ã€‚ JavaScriptè¯­è¨€çš„Thunkå‡½æ•°JavaScriptè¯­è¨€æ˜¯ä¼ å€¼è°ƒç”¨ï¼Œå®ƒçš„Thunkå‡½æ•°å«ä¹‰æœ‰æ‰€ä¸åŒã€‚åœ¨JavaScriptè¯­è¨€ä¸­ï¼ŒThunkå‡½æ•°æ›¿æ¢çš„ä¸æ˜¯è¡¨è¾¾å¼ï¼Œè€Œæ˜¯å¤šå‚æ•°å‡½æ•°ï¼Œå°†å…¶æ›¿æ¢æˆå•å‚æ•°çš„ç‰ˆæœ¬ï¼Œä¸”åªæ¥å—å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚ 123456789101112// æ­£å¸¸ç‰ˆæœ¬çš„readFileï¼ˆå¤šå‚æ•°ç‰ˆæœ¬ï¼‰fs.readFile(fileName, callback);// Thunkç‰ˆæœ¬çš„readFileï¼ˆå•å‚æ•°ç‰ˆæœ¬ï¼‰var Thunk = function (fileName)&#123; return function (callback)&#123; return fs.readFile(fileName, callback); &#125;;&#125;;var readFileThunk = Thunk(fileName);readFileThunk(callback); ä¸Šé¢ä»£ç ä¸­ï¼Œfsæ¨¡å—çš„readFileæ–¹æ³•æ˜¯ä¸€ä¸ªå¤šå‚æ•°å‡½æ•°ï¼Œä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸ºæ–‡ä»¶åå’Œå›è°ƒå‡½æ•°ã€‚ç»è¿‡è½¬æ¢å™¨å¤„ç†ï¼Œå®ƒå˜æˆäº†ä¸€ä¸ªå•å‚æ•°å‡½æ•°ï¼Œåªæ¥å—å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå•å‚æ•°ç‰ˆæœ¬ï¼Œå°±å«åšThunkå‡½æ•°ã€‚ ä»»ä½•å‡½æ•°ï¼Œåªè¦å‚æ•°æœ‰å›è°ƒå‡½æ•°ï¼Œå°±èƒ½å†™æˆThunkå‡½æ•°çš„å½¢å¼ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Thunkå‡½æ•°è½¬æ¢å™¨ã€‚ 12345678910111213141516171819// ES5ç‰ˆæœ¬var Thunk = function(fn)&#123; return function ()&#123; var args = Array.prototype.slice.call(arguments); return function (callback)&#123; args.push(callback); return fn.apply(this, args); &#125; &#125;;&#125;;// ES6ç‰ˆæœ¬var Thunk = function(fn) &#123; return function (...args) &#123; return function (callback) &#123; return fn.call(this, ...args, callback); &#125; &#125;;&#125;; ä½¿ç”¨ä¸Šé¢çš„è½¬æ¢å™¨ï¼Œç”Ÿæˆfs.readFileçš„Thunkå‡½æ•°ã€‚ 12var readFileThunk = Thunk(fs.readFile);readFileThunk(fileA)(callback); ä¸‹é¢æ˜¯å¦ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ã€‚ 1234567function f(a, cb) &#123; cb(a);&#125;let ft = Thunk(f);let log = console.log.bind(console);ft(1)(log) // 1 Thunkifyæ¨¡å—ç”Ÿäº§ç¯å¢ƒçš„è½¬æ¢å™¨ï¼Œå»ºè®®ä½¿ç”¨Thunkifyæ¨¡å—ã€‚ é¦–å…ˆæ˜¯å®‰è£…ã€‚ 1$ npm install thunkify ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ã€‚ 1234567var thunkify = require('thunkify');var fs = require('fs');var read = thunkify(fs.readFile);read('package.json')(function(err, str)&#123; // ...&#125;); Thunkifyçš„æºç ä¸ä¸Šä¸€èŠ‚é‚£ä¸ªç®€å•çš„è½¬æ¢å™¨éå¸¸åƒã€‚ 1234567891011121314151617181920212223242526function thunkify(fn)&#123; return function()&#123; var args = new Array(arguments.length); var ctx = this; for(var i = 0; i &lt; args.length; ++i) &#123; args[i] = arguments[i]; &#125; return function(done)&#123; var called; args.push(function()&#123; if (called) return; called = true; done.apply(null, arguments); &#125;); try &#123; fn.apply(ctx, args); &#125; catch (err) &#123; done(err); &#125; &#125; &#125;&#125;; å®ƒçš„æºç ä¸»è¦å¤šäº†ä¸€ä¸ªæ£€æŸ¥æœºåˆ¶ï¼Œå˜é‡calledç¡®ä¿å›è°ƒå‡½æ•°åªè¿è¡Œä¸€æ¬¡ã€‚è¿™æ ·çš„è®¾è®¡ä¸ä¸‹æ–‡çš„Generatorå‡½æ•°ç›¸å…³ã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚ 12345678910function f(a, b, callback)&#123; var sum = a + b; callback(sum); callback(sum);&#125;var ft = thunkify(f);var print = console.log.bind(console);ft(1, 2)(print);// 3 ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºthunkifyåªå…è®¸å›è°ƒå‡½æ•°æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥åªè¾“å‡ºä¸€è¡Œç»“æœã€‚ Generator å‡½æ•°çš„æµç¨‹ç®¡ç†ä½ å¯èƒ½ä¼šé—®ï¼Œ Thunkå‡½æ•°æœ‰ä»€ä¹ˆç”¨ï¼Ÿå›ç­”æ˜¯ä»¥å‰ç¡®å®æ²¡ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯ES6æœ‰äº†Generatorå‡½æ•°ï¼ŒThunkå‡½æ•°ç°åœ¨å¯ä»¥ç”¨äºGeneratorå‡½æ•°çš„è‡ªåŠ¨æµç¨‹ç®¡ç†ã€‚ Generatorå‡½æ•°å¯ä»¥è‡ªåŠ¨æ‰§è¡Œã€‚ 1234567891011function* gen() &#123; // ...&#125;var g = gen();var res = g.next();while(!res.done)&#123; console.log(res.value); res = g.next();&#125; ä¸Šé¢ä»£ç ä¸­ï¼ŒGeneratorå‡½æ•°genä¼šè‡ªåŠ¨æ‰§è¡Œå®Œæ‰€æœ‰æ­¥éª¤ã€‚ ä½†æ˜¯ï¼Œè¿™ä¸é€‚åˆå¼‚æ­¥æ“ä½œã€‚å¦‚æœå¿…é¡»ä¿è¯å‰ä¸€æ­¥æ‰§è¡Œå®Œï¼Œæ‰èƒ½æ‰§è¡Œåä¸€æ­¥ï¼Œä¸Šé¢çš„è‡ªåŠ¨æ‰§è¡Œå°±ä¸å¯è¡Œã€‚è¿™æ—¶ï¼ŒThunkå‡½æ•°å°±èƒ½æ´¾ä¸Šç”¨å¤„ã€‚ä»¥è¯»å–æ–‡ä»¶ä¸ºä¾‹ã€‚ä¸‹é¢çš„Generatorå‡½æ•°å°è£…äº†ä¸¤ä¸ªå¼‚æ­¥æ“ä½œã€‚ 12345678910var fs = require('fs');var thunkify = require('thunkify');var readFile = thunkify(fs.readFile);var gen = function* ()&#123; var r1 = yield readFile('/etc/fstab'); console.log(r1.toString()); var r2 = yield readFile('/etc/shells'); console.log(r2.toString());&#125;; ä¸Šé¢ä»£ç ä¸­ï¼Œyieldå‘½ä»¤ç”¨äºå°†ç¨‹åºçš„æ‰§è¡Œæƒç§»å‡ºGeneratorå‡½æ•°ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€ç§æ–¹æ³•ï¼Œå°†æ‰§è¡Œæƒå†äº¤è¿˜ç»™Generatorå‡½æ•°ã€‚ è¿™ç§æ–¹æ³•å°±æ˜¯Thunkå‡½æ•°ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨å›è°ƒå‡½æ•°é‡Œï¼Œå°†æ‰§è¡Œæƒäº¤è¿˜ç»™Generatorå‡½æ•°ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å…ˆçœ‹å¦‚ä½•æ‰‹åŠ¨æ‰§è¡Œä¸Šé¢è¿™ä¸ªGeneratorå‡½æ•°ã€‚ 1234567891011var g = gen();var r1 = g.next();r1.value(function(err, data)&#123; if (err) throw err; var r2 = g.next(data); r2.value(function(err, data)&#123; if (err) throw err; g.next(data); &#125;);&#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡gæ˜¯Generatorå‡½æ•°çš„å†…éƒ¨æŒ‡é’ˆï¼Œè¡¨ç¤ºç›®å‰æ‰§è¡Œåˆ°å“ªä¸€æ­¥ã€‚nextæ–¹æ³•è´Ÿè´£å°†æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€æ­¥ï¼Œå¹¶è¿”å›è¯¥æ­¥çš„ä¿¡æ¯ï¼ˆvalueå±æ€§å’Œdoneå±æ€§ï¼‰ã€‚ ä»”ç»†æŸ¥çœ‹ä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥å‘ç°Generatorå‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå…¶å®æ˜¯å°†åŒä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåå¤ä¼ å…¥nextæ–¹æ³•çš„valueå±æ€§ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç”¨é€’å½’æ¥è‡ªåŠ¨å®Œæˆè¿™ä¸ªè¿‡ç¨‹ã€‚ Thunkå‡½æ•°çš„è‡ªåŠ¨æµç¨‹ç®¡ç†Thunkå‡½æ•°çœŸæ­£çš„å¨åŠ›ï¼Œåœ¨äºå¯ä»¥è‡ªåŠ¨æ‰§è¡ŒGeneratorå‡½æ•°ã€‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªåŸºäºThunkå‡½æ•°çš„Generatoræ‰§è¡Œå™¨ã€‚ 1234567891011121314151617function run(fn) &#123; var gen = fn(); function next(err, data) &#123; var result = gen.next(data); if (result.done) return; result.value(next); &#125; next();&#125;function* g() &#123; // ...&#125;run(g); ä¸Šé¢ä»£ç çš„runå‡½æ•°ï¼Œå°±æ˜¯ä¸€ä¸ªGeneratorå‡½æ•°çš„è‡ªåŠ¨æ‰§è¡Œå™¨ã€‚å†…éƒ¨çš„nextå‡½æ•°å°±æ˜¯Thunkçš„å›è°ƒå‡½æ•°ã€‚nextå‡½æ•°å…ˆå°†æŒ‡é’ˆç§»åˆ°Generatorå‡½æ•°çš„ä¸‹ä¸€æ­¥ï¼ˆgen.nextæ–¹æ³•ï¼‰ï¼Œç„¶ååˆ¤æ–­Generatorå‡½æ•°æ˜¯å¦ç»“æŸï¼ˆresult.doneå±æ€§ï¼‰ï¼Œå¦‚æœæ²¡ç»“æŸï¼Œå°±å°†nextå‡½æ•°å†ä¼ å…¥Thunkå‡½æ•°ï¼ˆresult.valueå±æ€§ï¼‰ï¼Œå¦åˆ™å°±ç›´æ¥é€€å‡ºã€‚ æœ‰äº†è¿™ä¸ªæ‰§è¡Œå™¨ï¼Œæ‰§è¡ŒGeneratorå‡½æ•°æ–¹ä¾¿å¤šäº†ã€‚ä¸ç®¡å†…éƒ¨æœ‰å¤šå°‘ä¸ªå¼‚æ­¥æ“ä½œï¼Œç›´æ¥æŠŠGeneratorå‡½æ•°ä¼ å…¥runå‡½æ•°å³å¯ã€‚å½“ç„¶ï¼Œå‰ææ˜¯æ¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œéƒ½è¦æ˜¯Thunkå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè·Ÿåœ¨yieldå‘½ä»¤åé¢çš„å¿…é¡»æ˜¯Thunkå‡½æ•°ã€‚ 12345678var g = function* ()&#123; var f1 = yield readFile('fileA'); var f2 = yield readFile('fileB'); // ... var fn = yield readFile('fileN');&#125;;run(g); ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°gå°è£…äº†nä¸ªå¼‚æ­¥çš„è¯»å–æ–‡ä»¶æ“ä½œï¼Œåªè¦æ‰§è¡Œrunå‡½æ•°ï¼Œè¿™äº›æ“ä½œå°±ä¼šè‡ªåŠ¨å®Œæˆã€‚è¿™æ ·ä¸€æ¥ï¼Œå¼‚æ­¥æ“ä½œä¸ä»…å¯ä»¥å†™å¾—åƒåŒæ­¥æ“ä½œï¼Œè€Œä¸”ä¸€è¡Œä»£ç å°±å¯ä»¥æ‰§è¡Œã€‚ Thunkå‡½æ•°å¹¶ä¸æ˜¯Generatorå‡½æ•°è‡ªåŠ¨æ‰§è¡Œçš„å”¯ä¸€æ–¹æ¡ˆã€‚å› ä¸ºè‡ªåŠ¨æ‰§è¡Œçš„å…³é”®æ˜¯ï¼Œå¿…é¡»æœ‰ä¸€ç§æœºåˆ¶ï¼Œè‡ªåŠ¨æ§åˆ¶Generatorå‡½æ•°çš„æµç¨‹ï¼Œæ¥æ”¶å’Œäº¤è¿˜ç¨‹åºçš„æ‰§è¡Œæƒã€‚å›è°ƒå‡½æ•°å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼ŒPromise å¯¹è±¡ä¹Ÿå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ coæ¨¡å—åŸºæœ¬ç”¨æ³•coæ¨¡å—æ˜¯è‘—åç¨‹åºå‘˜TJ Holowaychukäº2013å¹´6æœˆå‘å¸ƒçš„ä¸€ä¸ªå°å·¥å…·ï¼Œç”¨äºGeneratorå‡½æ•°çš„è‡ªåŠ¨æ‰§è¡Œã€‚ æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªGeneratorå‡½æ•°ï¼Œç”¨äºä¾æ¬¡è¯»å–ä¸¤ä¸ªæ–‡ä»¶ã€‚ 123456var gen = function* ()&#123; var f1 = yield readFile('/etc/fstab'); var f2 = yield readFile('/etc/shells'); console.log(f1.toString()); console.log(f2.toString());&#125;; coæ¨¡å—å¯ä»¥è®©ä½ ä¸ç”¨ç¼–å†™Generatorå‡½æ•°çš„æ‰§è¡Œå™¨ã€‚ 12var co = require('co');co(gen); ä¸Šé¢ä»£ç ä¸­ï¼ŒGeneratorå‡½æ•°åªè¦ä¼ å…¥coå‡½æ•°ï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚ coå‡½æ•°è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå› æ­¤å¯ä»¥ç”¨thenæ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚ 123co(gen).then(function ()&#123; console.log('Generator å‡½æ•°æ‰§è¡Œå®Œæˆ');&#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œç­‰åˆ°Generatorå‡½æ•°æ‰§è¡Œç»“æŸï¼Œå°±ä¼šè¾“å‡ºä¸€è¡Œæç¤ºã€‚ coæ¨¡å—çš„åŸç†ä¸ºä»€ä¹ˆ co å¯ä»¥è‡ªåŠ¨æ‰§è¡Œ Generator å‡½æ•°ï¼Ÿ å‰é¢è¯´è¿‡ï¼ŒGenerator å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„å®¹å™¨ã€‚å®ƒçš„è‡ªåŠ¨æ‰§è¡Œéœ€è¦ä¸€ç§æœºåˆ¶ï¼Œå½“å¼‚æ­¥æ“ä½œæœ‰äº†ç»“æœï¼Œèƒ½å¤Ÿè‡ªåŠ¨äº¤å›æ‰§è¡Œæƒã€‚ ä¸¤ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ ï¼ˆ1ï¼‰å›è°ƒå‡½æ•°ã€‚å°†å¼‚æ­¥æ“ä½œåŒ…è£…æˆ Thunk å‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°é‡Œé¢äº¤å›æ‰§è¡Œæƒã€‚ ï¼ˆ2ï¼‰Promise å¯¹è±¡ã€‚å°†å¼‚æ­¥æ“ä½œåŒ…è£…æˆ Promise å¯¹è±¡ï¼Œç”¨thenæ–¹æ³•äº¤å›æ‰§è¡Œæƒã€‚ co æ¨¡å—å…¶å®å°±æ˜¯å°†ä¸¤ç§è‡ªåŠ¨æ‰§è¡Œå™¨ï¼ˆThunk å‡½æ•°å’Œ Promise å¯¹è±¡ï¼‰ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ¨¡å—ã€‚ä½¿ç”¨ co çš„å‰ææ¡ä»¶æ˜¯ï¼ŒGenerator å‡½æ•°çš„yieldå‘½ä»¤åé¢ï¼Œåªèƒ½æ˜¯ Thunk å‡½æ•°æˆ– Promise å¯¹è±¡ã€‚ ä¸Šä¸€èŠ‚å·²ç»ä»‹ç»äº†åŸºäº Thunk å‡½æ•°çš„è‡ªåŠ¨æ‰§è¡Œå™¨ã€‚ä¸‹é¢æ¥çœ‹ï¼ŒåŸºäº Promise å¯¹è±¡çš„è‡ªåŠ¨æ‰§è¡Œå™¨ã€‚è¿™æ˜¯ç†è§£ co æ¨¡å—å¿…é¡»çš„ã€‚ åŸºäº Promise å¯¹è±¡çš„è‡ªåŠ¨æ‰§è¡Œè¿˜æ˜¯æ²¿ç”¨ä¸Šé¢çš„ä¾‹å­ã€‚é¦–å…ˆï¼ŒæŠŠfsæ¨¡å—çš„readFileæ–¹æ³•åŒ…è£…æˆä¸€ä¸ª Promise å¯¹è±¡ã€‚ 1234567891011121314151617var fs = require('fs');var readFile = function (fileName)&#123; return new Promise(function (resolve, reject)&#123; fs.readFile(fileName, function(error, data)&#123; if (error) return reject(error); resolve(data); &#125;); &#125;);&#125;;var gen = function* ()&#123; var f1 = yield readFile('/etc/fstab'); var f2 = yield readFile('/etc/shells'); console.log(f1.toString()); console.log(f2.toString());&#125;; ç„¶åï¼Œæ‰‹åŠ¨æ‰§è¡Œä¸Šé¢çš„ Generator å‡½æ•°ã€‚ 1234567var g = gen();g.next().value.then(function(data)&#123; g.next(data).value.then(function(data)&#123; g.next(data); &#125;);&#125;); æ‰‹åŠ¨æ‰§è¡Œå…¶å®å°±æ˜¯ç”¨thenæ–¹æ³•ï¼Œå±‚å±‚æ·»åŠ å›è°ƒå‡½æ•°ã€‚ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œå°±å¯ä»¥å†™å‡ºä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œå™¨ã€‚ 123456789101112131415function run(gen)&#123; var g = gen(); function next(data)&#123; var result = g.next(data); if (result.done) return result.value; result.value.then(function(data)&#123; next(data); &#125;); &#125; next();&#125;run(gen); ä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦ Generator å‡½æ•°è¿˜æ²¡æ‰§è¡Œåˆ°æœ€åä¸€æ­¥ï¼Œnextå‡½æ•°å°±è°ƒç”¨è‡ªèº«ï¼Œä»¥æ­¤å®ç°è‡ªåŠ¨æ‰§è¡Œã€‚ co æ¨¡å—çš„æºç co å°±æ˜¯ä¸Šé¢é‚£ä¸ªè‡ªåŠ¨æ‰§è¡Œå™¨çš„æ‰©å±•ï¼Œå®ƒçš„æºç åªæœ‰å‡ åè¡Œï¼Œéå¸¸ç®€å•ã€‚ é¦–å…ˆï¼Œco å‡½æ•°æ¥å— Generator å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ã€‚ 123456function co(gen) &#123; var ctx = this; return new Promise(function(resolve, reject) &#123; &#125;);&#125; åœ¨è¿”å›çš„ Promise å¯¹è±¡é‡Œé¢ï¼Œco å…ˆæ£€æŸ¥å‚æ•°genæ˜¯å¦ä¸º Generator å‡½æ•°ã€‚å¦‚æœæ˜¯ï¼Œå°±æ‰§è¡Œè¯¥å‡½æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªå†…éƒ¨æŒ‡é’ˆå¯¹è±¡ï¼›å¦‚æœä¸æ˜¯å°±è¿”å›ï¼Œå¹¶å°† Promise å¯¹è±¡çš„çŠ¶æ€æ”¹ä¸ºresolvedã€‚ 12345678function co(gen) &#123; var ctx = this; return new Promise(function(resolve, reject) &#123; if (typeof gen === 'function') gen = gen.call(ctx); if (!gen || typeof gen.next !== 'function') return resolve(gen); &#125;);&#125; æ¥ç€ï¼Œco å°† Generator å‡½æ•°çš„å†…éƒ¨æŒ‡é’ˆå¯¹è±¡çš„nextæ–¹æ³•ï¼ŒåŒ…è£…æˆonFulfilledå‡½æ•°ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†èƒ½å¤Ÿæ•æ‰æŠ›å‡ºçš„é”™è¯¯ã€‚ 12345678910111213141516171819function co(gen) &#123; var ctx = this; return new Promise(function(resolve, reject) &#123; if (typeof gen === 'function') gen = gen.call(ctx); if (!gen || typeof gen.next !== 'function') return resolve(gen); onFulfilled(); function onFulfilled(res) &#123; var ret; try &#123; ret = gen.next(res); &#125; catch (e) &#123; return reject(e); &#125; next(ret); &#125; &#125;);&#125; æœ€åï¼Œå°±æ˜¯å…³é”®çš„nextå‡½æ•°ï¼Œå®ƒä¼šåå¤è°ƒç”¨è‡ªèº«ã€‚ 12345678910111213function next(ret) &#123; if (ret.done) return resolve(ret.value); var value = toPromise.call(ctx, ret.value); if (value &amp;&amp; isPromise(value)) return value.then(onFulfilled, onRejected); return onRejected( new TypeError( 'You may only yield a function, promise, generator, array, or object, ' + 'but the following object was passed: \"' + String(ret.value) + '\"' ) );&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œnextå‡½æ•°çš„å†…éƒ¨ä»£ç ï¼Œä¸€å…±åªæœ‰å››è¡Œå‘½ä»¤ã€‚ ç¬¬ä¸€è¡Œï¼Œæ£€æŸ¥å½“å‰æ˜¯å¦ä¸º Generator å‡½æ•°çš„æœ€åä¸€æ­¥ï¼Œå¦‚æœæ˜¯å°±è¿”å›ã€‚ ç¬¬äºŒè¡Œï¼Œç¡®ä¿æ¯ä¸€æ­¥çš„è¿”å›å€¼ï¼Œæ˜¯ Promise å¯¹è±¡ã€‚ ç¬¬ä¸‰è¡Œï¼Œä½¿ç”¨thenæ–¹æ³•ï¼Œä¸ºè¿”å›å€¼åŠ ä¸Šå›è°ƒå‡½æ•°ï¼Œç„¶åé€šè¿‡onFulfilledå‡½æ•°å†æ¬¡è°ƒç”¨nextå‡½æ•°ã€‚ ç¬¬å››è¡Œï¼Œåœ¨å‚æ•°ä¸ç¬¦åˆè¦æ±‚çš„æƒ…å†µä¸‹ï¼ˆå‚æ•°é Thunk å‡½æ•°å’Œ Promise å¯¹è±¡ï¼‰ï¼Œå°† Promise å¯¹è±¡çš„çŠ¶æ€æ”¹ä¸ºrejectedï¼Œä»è€Œç»ˆæ­¢æ‰§è¡Œã€‚ å¤„ç†å¹¶å‘çš„å¼‚æ­¥æ“ä½œco æ”¯æŒå¹¶å‘çš„å¼‚æ­¥æ“ä½œï¼Œå³å…è®¸æŸäº›æ“ä½œåŒæ—¶è¿›è¡Œï¼Œç­‰åˆ°å®ƒä»¬å…¨éƒ¨å®Œæˆï¼Œæ‰è¿›è¡Œä¸‹ä¸€æ­¥ã€‚ è¿™æ—¶ï¼Œè¦æŠŠå¹¶å‘çš„æ“ä½œéƒ½æ”¾åœ¨æ•°ç»„æˆ–å¯¹è±¡é‡Œé¢ï¼Œè·Ÿåœ¨yieldè¯­å¥åé¢ã€‚ 1234567891011121314151617// æ•°ç»„çš„å†™æ³•co(function* () &#123; var res = yield [ Promise.resolve(1), Promise.resolve(2) ]; console.log(res);&#125;).catch(onerror);// å¯¹è±¡çš„å†™æ³•co(function* () &#123; var res = yield &#123; 1: Promise.resolve(1), 2: Promise.resolve(2), &#125;; console.log(res);&#125;).catch(onerror); ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚ 123456789co(function* () &#123; var values = [n1, n2, n3]; yield values.map(somethingAsync);&#125;);function* somethingAsync(x) &#123; // do something async return y&#125; ä¸Šé¢çš„ä»£ç å…è®¸å¹¶å‘ä¸‰ä¸ªsomethingAsyncå¼‚æ­¥æ“ä½œï¼Œç­‰åˆ°å®ƒä»¬å…¨éƒ¨å®Œæˆï¼Œæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ­¥ã€‚ITæŠ€æœ¯åˆ†äº«å°½åœ¨ğŸ”— æ¶µæœˆå¤©-microzz.comhttps://microzz.com asyncå‡½æ•°å«ä¹‰ES2017 æ ‡å‡†æä¾›äº†asyncå‡½æ•°ï¼Œä½¿å¾—å¼‚æ­¥æ“ä½œå˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚ asyncå‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿä¸€å¥è¯ï¼Œasyncå‡½æ•°å°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚å‰æ–‡æœ‰ä¸€ä¸ª Generator å‡½æ•°ï¼Œä¾æ¬¡è¯»å–ä¸¤ä¸ªæ–‡ä»¶ã€‚ 1234567891011121314151617var fs = require('fs');var readFile = function (fileName) &#123; return new Promise(function (resolve, reject) &#123; fs.readFile(fileName, function(error, data) &#123; if (error) reject(error); resolve(data); &#125;); &#125;);&#125;;var gen = function* ()&#123; var f1 = yield readFile('/etc/fstab'); var f2 = yield readFile('/etc/shells'); console.log(f1.toString()); console.log(f2.toString());&#125;; å†™æˆasyncå‡½æ•°ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·ã€‚ 123456var asyncReadFile = async function ()&#123; var f1 = await readFile('/etc/fstab'); var f2 = await readFile('/etc/shells'); console.log(f1.toString()); console.log(f2.toString());&#125;; ä¸€æ¯”è¾ƒå°±ä¼šå‘ç°ï¼Œasyncå‡½æ•°å°±æ˜¯å°† Generator å‡½æ•°çš„æ˜Ÿå·ï¼ˆ*ï¼‰æ›¿æ¢æˆasyncï¼Œå°†yieldæ›¿æ¢æˆawaitï¼Œä»…æ­¤è€Œå·²ã€‚ asyncå‡½æ•°å¯¹ Generator å‡½æ•°çš„æ”¹è¿›ï¼Œä½“ç°åœ¨ä»¥ä¸‹å››ç‚¹ã€‚ ï¼ˆ1ï¼‰å†…ç½®æ‰§è¡Œå™¨ã€‚Generator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»é æ‰§è¡Œå™¨ï¼Œæ‰€ä»¥æ‰æœ‰äº†coæ¨¡å—ï¼Œè€Œasyncå‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œasyncå‡½æ•°çš„æ‰§è¡Œï¼Œä¸æ™®é€šå‡½æ•°ä¸€æ¨¡ä¸€æ ·ï¼Œåªè¦ä¸€è¡Œã€‚ 1var result = asyncReadFile(); ä¸Šé¢çš„ä»£ç è°ƒç”¨äº†asyncReadFileå‡½æ•°ï¼Œç„¶åå®ƒå°±ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œè¾“å‡ºæœ€åç»“æœã€‚è¿™å®Œå…¨ä¸åƒ Generator å‡½æ•°ï¼Œéœ€è¦è°ƒç”¨nextæ–¹æ³•ï¼Œæˆ–è€…ç”¨coæ¨¡å—ï¼Œæ‰èƒ½å¾—åˆ°çœŸæ­£æ‰§è¡Œï¼Œå¾—åˆ°æœ€åç»“æœã€‚ ï¼ˆ2ï¼‰æ›´å¥½çš„è¯­ä¹‰ã€‚asyncå’Œawaitï¼Œæ¯”èµ·æ˜Ÿå·å’Œyieldï¼Œè¯­ä¹‰æ›´æ¸…æ¥šäº†ã€‚asyncè¡¨ç¤ºå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œï¼Œawaitè¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœã€‚ ï¼ˆ3ï¼‰æ›´å¹¿çš„é€‚ç”¨æ€§ã€‚ coæ¨¡å—çº¦å®šï¼Œyieldå‘½ä»¤åé¢åªèƒ½æ˜¯ Thunk å‡½æ•°æˆ– Promise å¯¹è±¡ï¼Œè€Œasyncå‡½æ•°çš„awaitå‘½ä»¤åé¢ï¼Œå¯ä»¥æ˜¯Promise å¯¹è±¡å’ŒåŸå§‹ç±»å‹çš„å€¼ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œä½†è¿™æ—¶ç­‰åŒäºåŒæ­¥æ“ä½œï¼‰ã€‚ ï¼ˆ4ï¼‰è¿”å›å€¼æ˜¯ Promiseã€‚asyncå‡½æ•°çš„è¿”å›å€¼æ˜¯ Promise å¯¹è±¡ï¼Œè¿™æ¯” Generator å‡½æ•°çš„è¿”å›å€¼æ˜¯ Iterator å¯¹è±¡æ–¹ä¾¿å¤šäº†ã€‚ä½ å¯ä»¥ç”¨thenæ–¹æ³•æŒ‡å®šä¸‹ä¸€æ­¥çš„æ“ä½œã€‚ è¿›ä¸€æ­¥è¯´ï¼Œasyncå‡½æ•°å®Œå…¨å¯ä»¥çœ‹ä½œå¤šä¸ªå¼‚æ­¥æ“ä½œï¼ŒåŒ…è£…æˆçš„ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè€Œawaitå‘½ä»¤å°±æ˜¯å†…éƒ¨thenå‘½ä»¤çš„è¯­æ³•ç³–ã€‚ è¯­æ³•asyncå‡½æ•°çš„è¯­æ³•è§„åˆ™æ€»ä½“ä¸Šæ¯”è¾ƒç®€å•ï¼Œéš¾ç‚¹æ˜¯é”™è¯¯å¤„ç†æœºåˆ¶ã€‚ ï¼ˆ1ï¼‰asyncå‡½æ•°è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ã€‚ asyncå‡½æ•°å†…éƒ¨returnè¯­å¥è¿”å›çš„å€¼ï¼Œä¼šæˆä¸ºthenæ–¹æ³•å›è°ƒå‡½æ•°çš„å‚æ•°ã€‚ 123456async function f() &#123; return 'hello world';&#125;f().then(v =&gt; console.log(v))// \"hello world\" ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°få†…éƒ¨returnå‘½ä»¤è¿”å›çš„å€¼ï¼Œä¼šè¢«thenæ–¹æ³•å›è°ƒå‡½æ•°æ¥æ”¶åˆ°ã€‚ asyncå‡½æ•°å†…éƒ¨æŠ›å‡ºé”™è¯¯ï¼Œä¼šå¯¼è‡´è¿”å›çš„ Promise å¯¹è±¡å˜ä¸ºrejectçŠ¶æ€ã€‚æŠ›å‡ºçš„é”™è¯¯å¯¹è±¡ä¼šè¢«catchæ–¹æ³•å›è°ƒå‡½æ•°æ¥æ”¶åˆ°ã€‚ 123456789async function f() &#123; throw new Error('å‡ºé”™äº†');&#125;f().then( v =&gt; console.log(v), e =&gt; console.log(e))// Error: å‡ºé”™äº† ï¼ˆ2ï¼‰asyncå‡½æ•°è¿”å›çš„ Promise å¯¹è±¡ï¼Œå¿…é¡»ç­‰åˆ°å†…éƒ¨æ‰€æœ‰awaitå‘½ä»¤çš„ Promise å¯¹è±¡æ‰§è¡Œå®Œï¼Œæ‰ä¼šå‘ç”ŸçŠ¶æ€æ”¹å˜ï¼Œé™¤éé‡åˆ°returnè¯­å¥æˆ–è€…æŠ›å‡ºé”™è¯¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰asyncå‡½æ•°å†…éƒ¨çš„å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œï¼Œæ‰ä¼šæ‰§è¡Œthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 1234567async function getTitle(url) &#123; let response = await fetch(url); let html = await response.text(); return html.match(/&lt;title&gt;([\\s\\S]+)&lt;\\/title&gt;/i)[1];&#125;getTitle('https://tc39.github.io/ecma262/').then(console.log)// \"ECMAScript 2017 Language Specification\" ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°getTitleå†…éƒ¨æœ‰ä¸‰ä¸ªæ“ä½œï¼šæŠ“å–ç½‘é¡µã€å–å‡ºæ–‡æœ¬ã€åŒ¹é…é¡µé¢æ ‡é¢˜ã€‚åªæœ‰è¿™ä¸‰ä¸ªæ“ä½œå…¨éƒ¨å®Œæˆï¼Œæ‰ä¼šæ‰§è¡Œthenæ–¹æ³•é‡Œé¢çš„console.logã€‚ ï¼ˆ3ï¼‰æ­£å¸¸æƒ…å†µä¸‹ï¼Œawaitå‘½ä»¤åé¢æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚å¦‚æœä¸æ˜¯ï¼Œä¼šè¢«è½¬æˆä¸€ä¸ªç«‹å³resolveçš„ Promise å¯¹è±¡ã€‚ 123456async function f() &#123; return await 123;&#125;f().then(v =&gt; console.log(v))// 123 ä¸Šé¢ä»£ç ä¸­ï¼Œawaitå‘½ä»¤çš„å‚æ•°æ˜¯æ•°å€¼123ï¼Œå®ƒè¢«è½¬æˆPromiseå¯¹è±¡ï¼Œå¹¶ç«‹å³resolveã€‚ awaitå‘½ä»¤åé¢çš„Promiseå¯¹è±¡å¦‚æœå˜ä¸ºrejectçŠ¶æ€ï¼Œåˆ™rejectçš„å‚æ•°ä¼šè¢«catchæ–¹æ³•çš„å›è°ƒå‡½æ•°æ¥æ”¶åˆ°ã€‚ 12345678async function f() &#123; await Promise.reject('å‡ºé”™äº†');&#125;f().then(v =&gt; console.log(v)).catch(e =&gt; console.log(e))// å‡ºé”™äº† æ³¨æ„ï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œawaitè¯­å¥å‰é¢æ²¡æœ‰returnï¼Œä½†æ˜¯rejectæ–¹æ³•çš„å‚æ•°ä¾ç„¶ä¼ å…¥äº†catchæ–¹æ³•çš„å›è°ƒå‡½æ•°ã€‚è¿™é‡Œå¦‚æœåœ¨awaitå‰é¢åŠ ä¸Šreturnï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ åªè¦ä¸€ä¸ªawaitè¯­å¥åé¢çš„Promiseå˜ä¸ºrejectï¼Œé‚£ä¹ˆæ•´ä¸ªasyncå‡½æ•°éƒ½ä¼šä¸­æ–­æ‰§è¡Œã€‚ 1234async function f() &#123; await Promise.reject('å‡ºé”™äº†'); await Promise.resolve('hello world'); // ä¸ä¼šæ‰§è¡Œ&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬äºŒä¸ªawaitè¯­å¥æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªawaitè¯­å¥çŠ¶æ€å˜æˆäº†rejectã€‚ ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å°†ç¬¬ä¸€ä¸ªawaitæ”¾åœ¨try...catchç»“æ„é‡Œé¢ï¼Œè¿™æ ·ç¬¬äºŒä¸ªawaitå°±ä¼šæ‰§è¡Œã€‚ 1234567891011async function f() &#123; try &#123; await Promise.reject('å‡ºé”™äº†'); &#125; catch(e) &#123; &#125; return await Promise.resolve('hello world');&#125;f().then(v =&gt; console.log(v))// hello world å¦ä¸€ç§æ–¹æ³•æ˜¯awaitåé¢çš„Promiseå¯¹è±¡å†è·Ÿä¸€ä¸ªcatchæ–¹æ³•ï¼Œå¤„ç†å‰é¢å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚ 12345678910async function f() &#123; await Promise.reject('å‡ºé”™äº†') .catch(e =&gt; console.log(e)); return await Promise.resolve('hello world');&#125;f().then(v =&gt; console.log(v))// å‡ºé”™äº†// hello world å¦‚æœæœ‰å¤šä¸ªawaitå‘½ä»¤ï¼Œå¯ä»¥ç»Ÿä¸€æ”¾åœ¨try...catchç»“æ„ä¸­ã€‚ 123456789101112async function main() &#123; try &#123; var val1 = await firstStep(); var val2 = await secondStep(val1); var val3 = await thirdStep(val1, val2); console.log('Final: ', val3); &#125; catch (err) &#123; console.error(err); &#125;&#125; ï¼ˆ4ï¼‰å¦‚æœawaitåé¢çš„å¼‚æ­¥æ“ä½œå‡ºé”™ï¼Œé‚£ä¹ˆç­‰åŒäºasyncå‡½æ•°è¿”å›çš„Promiseå¯¹è±¡è¢«rejectã€‚ 12345678910async function f() &#123; await new Promise(function (resolve, reject) &#123; throw new Error('å‡ºé”™äº†'); &#125;);&#125;f().then(v =&gt; console.log(v)).catch(e =&gt; console.log(e))// Errorï¼šå‡ºé”™äº† ä¸Šé¢ä»£ç ä¸­ï¼Œasyncå‡½æ•°fæ‰§è¡Œåï¼Œawaitåé¢çš„Promiseå¯¹è±¡ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼Œå¯¼è‡´catchæ–¹æ³•çš„å›è°ƒå‡½æ•°è¢«è°ƒç”¨ï¼Œå®ƒçš„å‚æ•°å°±æ˜¯æŠ›å‡ºçš„é”™è¯¯å¯¹è±¡ã€‚å…·ä½“çš„æ‰§è¡Œæœºåˆ¶ï¼Œå¯ä»¥å‚è€ƒåæ–‡çš„â€œasyncå‡½æ•°çš„å®ç°â€ã€‚ é˜²æ­¢å‡ºé”™çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯å°†å…¶æ”¾åœ¨try...catchä»£ç å—ä¹‹ä¸­ã€‚ 123456789async function f() &#123; try &#123; await new Promise(function (resolve, reject) &#123; throw new Error('å‡ºé”™äº†'); &#125;); &#125; catch(e) &#123; &#125; return await('hello world');&#125; asyncå‡½æ•°çš„å®ç°async å‡½æ•°çš„å®ç°ï¼Œå°±æ˜¯å°† Generator å‡½æ•°å’Œè‡ªåŠ¨æ‰§è¡Œå™¨ï¼ŒåŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œã€‚ 1234567891011async function fn(args)&#123; // ...&#125;// ç­‰åŒäºfunction fn(args)&#123; return spawn(function*() &#123; // ... &#125;);&#125; æ‰€æœ‰çš„asyncå‡½æ•°éƒ½å¯ä»¥å†™æˆä¸Šé¢çš„ç¬¬äºŒç§å½¢å¼ï¼Œå…¶ä¸­çš„ spawn å‡½æ•°å°±æ˜¯è‡ªåŠ¨æ‰§è¡Œå™¨ã€‚ ä¸‹é¢ç»™å‡ºspawnå‡½æ•°çš„å®ç°ï¼ŒåŸºæœ¬å°±æ˜¯å‰æ–‡è‡ªåŠ¨æ‰§è¡Œå™¨çš„ç¿»ç‰ˆã€‚ 123456789101112131415161718192021function spawn(genF) &#123; return new Promise(function(resolve, reject) &#123; var gen = genF(); function step(nextF) &#123; try &#123; var next = nextF(); &#125; catch(e) &#123; return reject(e); &#125; if(next.done) &#123; return resolve(next.value); &#125; Promise.resolve(next.value).then(function(v) &#123; step(function() &#123; return gen.next(v); &#125;); &#125;, function(e) &#123; step(function() &#123; return gen.throw(e); &#125;); &#125;); &#125; step(function() &#123; return gen.next(undefined); &#125;); &#125;);&#125; async å‡½æ•°çš„ç”¨æ³•asyncå‡½æ•°è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨thenæ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚å½“å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€æ—¦é‡åˆ°awaitå°±ä¼šå…ˆè¿”å›ï¼Œç­‰åˆ°è§¦å‘çš„å¼‚æ­¥æ“ä½œå®Œæˆï¼Œå†æ¥ç€æ‰§è¡Œå‡½æ•°ä½“å†…åé¢çš„è¯­å¥ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 123456789async function getStockPriceByName(name) &#123; var symbol = await getStockSymbol(name); var stockPrice = await getStockPrice(symbol); return stockPrice;&#125;getStockPriceByName('goog').then(function (result) &#123; console.log(result);&#125;); ä¸Šé¢ä»£ç æ˜¯ä¸€ä¸ªè·å–è‚¡ç¥¨æŠ¥ä»·çš„å‡½æ•°ï¼Œå‡½æ•°å‰é¢çš„asyncå…³é”®å­—ï¼Œè¡¨æ˜è¯¥å‡½æ•°å†…éƒ¨æœ‰å¼‚æ­¥æ“ä½œã€‚è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œä¼šç«‹å³è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ã€‚ ä¸‹é¢çš„ä¾‹å­ï¼ŒæŒ‡å®šå¤šå°‘æ¯«ç§’åè¾“å‡ºä¸€ä¸ªå€¼ã€‚ 123456789101112function timeout(ms) &#123; return new Promise((resolve) =&gt; &#123; setTimeout(resolve, ms); &#125;);&#125;async function asyncPrint(value, ms) &#123; await timeout(ms); console.log(value)&#125;asyncPrint('hello world', 50); ä¸Šé¢ä»£ç æŒ‡å®š50æ¯«ç§’ä»¥åï¼Œè¾“å‡ºhello worldã€‚ Asyncå‡½æ•°æœ‰å¤šç§ä½¿ç”¨å½¢å¼ã€‚ 123456789101112131415161718192021222324252627// å‡½æ•°å£°æ˜async function foo() &#123;&#125;// å‡½æ•°è¡¨è¾¾å¼const foo = async function () &#123;&#125;;// å¯¹è±¡çš„æ–¹æ³•let obj = &#123; async foo() &#123;&#125; &#125;;obj.foo().then(...)// Class çš„æ–¹æ³•class Storage &#123; constructor() &#123; this.cachePromise = caches.open('avatars'); &#125; async getAvatar(name) &#123; const cache = await this.cachePromise; return cache.match(`/avatars/$&#123;name&#125;.jpg`); &#125;&#125;const storage = new Storage();storage.getAvatar('jake').then(â€¦);// ç®­å¤´å‡½æ•°const foo = async () =&gt; &#123;&#125;; æ³¨æ„ç‚¹ç¬¬ä¸€ç‚¹ï¼Œawaitå‘½ä»¤åé¢çš„Promiseå¯¹è±¡ï¼Œè¿è¡Œç»“æœå¯èƒ½æ˜¯rejectedï¼Œæ‰€ä»¥æœ€å¥½æŠŠawaitå‘½ä»¤æ”¾åœ¨try...catchä»£ç å—ä¸­ã€‚ 12345678910111213141516async function myFunction() &#123; try &#123; await somethingThatReturnsAPromise(); &#125; catch (err) &#123; console.log(err); &#125;&#125;// å¦ä¸€ç§å†™æ³•async function myFunction() &#123; await somethingThatReturnsAPromise() .catch(function (err) &#123; console.log(err); &#125;;&#125; ç¬¬äºŒç‚¹ï¼Œå¤šä¸ªawaitå‘½ä»¤åé¢çš„å¼‚æ­¥æ“ä½œï¼Œå¦‚æœä¸å­˜åœ¨ç»§å‘å…³ç³»ï¼Œæœ€å¥½è®©å®ƒä»¬åŒæ—¶è§¦å‘ã€‚ 12let foo = await getFoo();let bar = await getBar(); ä¸Šé¢ä»£ç ä¸­ï¼ŒgetFooå’ŒgetBaræ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„å¼‚æ­¥æ“ä½œï¼ˆå³äº’ä¸ä¾èµ–ï¼‰ï¼Œè¢«å†™æˆç»§å‘å…³ç³»ã€‚è¿™æ ·æ¯”è¾ƒè€—æ—¶ï¼Œå› ä¸ºåªæœ‰getFooå®Œæˆä»¥åï¼Œæ‰ä¼šæ‰§è¡ŒgetBarï¼Œå®Œå…¨å¯ä»¥è®©å®ƒä»¬åŒæ—¶è§¦å‘ã€‚ 12345678// å†™æ³•ä¸€let [foo, bar] = await Promise.all([getFoo(), getBar()]);// å†™æ³•äºŒlet fooPromise = getFoo();let barPromise = getBar();let foo = await fooPromise;let bar = await barPromise; ä¸Šé¢ä¸¤ç§å†™æ³•ï¼ŒgetFooå’ŒgetBaréƒ½æ˜¯åŒæ—¶è§¦å‘ï¼Œè¿™æ ·å°±ä¼šç¼©çŸ­ç¨‹åºçš„æ‰§è¡Œæ—¶é—´ã€‚ ç¬¬ä¸‰ç‚¹ï¼Œawaitå‘½ä»¤åªèƒ½ç”¨åœ¨asyncå‡½æ•°ä¹‹ä¸­ï¼Œå¦‚æœç”¨åœ¨æ™®é€šå‡½æ•°ï¼Œå°±ä¼šæŠ¥é”™ã€‚ 12345678async function dbFuc(db) &#123; let docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;]; // æŠ¥é”™ docs.forEach(function (doc) &#123; await db.post(doc); &#125;);&#125; ä¸Šé¢ä»£ç ä¼šæŠ¥é”™ï¼Œå› ä¸ºawaitç”¨åœ¨æ™®é€šå‡½æ•°ä¹‹ä¸­äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°†forEachæ–¹æ³•çš„å‚æ•°æ”¹æˆasyncå‡½æ•°ï¼Œä¹Ÿæœ‰é—®é¢˜ã€‚ 12345678async function dbFuc(db) &#123; let docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;]; // å¯èƒ½å¾—åˆ°é”™è¯¯ç»“æœ docs.forEach(async function (doc) &#123; await db.post(doc); &#125;);&#125; ä¸Šé¢ä»£ç å¯èƒ½ä¸ä¼šæ­£å¸¸å·¥ä½œï¼ŒåŸå› æ˜¯è¿™æ—¶ä¸‰ä¸ªdb.postæ“ä½œå°†æ˜¯å¹¶å‘æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯åŒæ—¶æ‰§è¡Œï¼Œè€Œä¸æ˜¯ç»§å‘æ‰§è¡Œã€‚æ­£ç¡®çš„å†™æ³•æ˜¯é‡‡ç”¨forå¾ªç¯ã€‚ 1234567async function dbFuc(db) &#123; let docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;]; for (let doc of docs) &#123; await db.post(doc); &#125;&#125; å¦‚æœç¡®å®å¸Œæœ›å¤šä¸ªè¯·æ±‚å¹¶å‘æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨Promise.allæ–¹æ³•ã€‚ 1234567891011121314151617181920async function dbFuc(db) &#123; let docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;]; let promises = docs.map((doc) =&gt; db.post(doc)); let results = await Promise.all(promises); console.log(results);&#125;// æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„å†™æ³•async function dbFuc(db) &#123; let docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;]; let promises = docs.map((doc) =&gt; db.post(doc)); let results = []; for (let promise of promises) &#123; results.push(await promise); &#125; console.log(results);&#125; ES6å°†awaitå¢åŠ ä¸ºä¿ç•™å­—ã€‚ä½¿ç”¨è¿™ä¸ªè¯ä½œä¸ºæ ‡è¯†ç¬¦ï¼Œåœ¨ES5æ˜¯åˆæ³•çš„ï¼Œåœ¨ES6å°†æŠ›å‡ºSyntaxErrorã€‚ ä¸Promiseã€Generatorçš„æ¯”è¾ƒæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œæ¥çœ‹Asyncå‡½æ•°ä¸Promiseã€Generatorå‡½æ•°çš„åŒºåˆ«ã€‚ å‡å®šæŸä¸ªDOMå…ƒç´ ä¸Šé¢ï¼Œéƒ¨ç½²äº†ä¸€ç³»åˆ—çš„åŠ¨ç”»ï¼Œå‰ä¸€ä¸ªåŠ¨ç”»ç»“æŸï¼Œæ‰èƒ½å¼€å§‹åä¸€ä¸ªã€‚å¦‚æœå½“ä¸­æœ‰ä¸€ä¸ªåŠ¨ç”»å‡ºé”™ï¼Œå°±ä¸å†å¾€ä¸‹æ‰§è¡Œï¼Œè¿”å›ä¸Šä¸€ä¸ªæˆåŠŸæ‰§è¡Œçš„åŠ¨ç”»çš„è¿”å›å€¼ã€‚ é¦–å…ˆæ˜¯Promiseçš„å†™æ³•ã€‚ 123456789101112131415161718192021222324function chainAnimationsPromise(elem, animations) &#123; // å˜é‡retç”¨æ¥ä¿å­˜ä¸Šä¸€ä¸ªåŠ¨ç”»çš„è¿”å›å€¼ var ret = null; // æ–°å»ºä¸€ä¸ªç©ºçš„Promise var p = Promise.resolve(); // ä½¿ç”¨thenæ–¹æ³•ï¼Œæ·»åŠ æ‰€æœ‰åŠ¨ç”» for(var anim of animations) &#123; p = p.then(function(val) &#123; ret = val; return anim(elem); &#125;); &#125; // è¿”å›ä¸€ä¸ªéƒ¨ç½²äº†é”™è¯¯æ•æ‰æœºåˆ¶çš„Promise return p.catch(function(e) &#123; /* å¿½ç•¥é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ */ &#125;).then(function() &#123; return ret; &#125;);&#125; è™½ç„¶Promiseçš„å†™æ³•æ¯”å›è°ƒå‡½æ•°çš„å†™æ³•å¤§å¤§æ”¹è¿›ï¼Œä½†æ˜¯ä¸€çœ¼çœ‹ä¸Šå»ï¼Œä»£ç å®Œå…¨éƒ½æ˜¯Promiseçš„APIï¼ˆthenã€catchç­‰ç­‰ï¼‰ï¼Œæ“ä½œæœ¬èº«çš„è¯­ä¹‰åè€Œä¸å®¹æ˜“çœ‹å‡ºæ¥ã€‚ æ¥ç€æ˜¯Generatorå‡½æ•°çš„å†™æ³•ã€‚ 123456789101112131415function chainAnimationsGenerator(elem, animations) &#123; return spawn(function*() &#123; var ret = null; try &#123; for(var anim of animations) &#123; ret = yield anim(elem); &#125; &#125; catch(e) &#123; /* å¿½ç•¥é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ */ &#125; return ret; &#125;);&#125; ä¸Šé¢ä»£ç ä½¿ç”¨Generatorå‡½æ•°éå†äº†æ¯ä¸ªåŠ¨ç”»ï¼Œè¯­ä¹‰æ¯”Promiseå†™æ³•æ›´æ¸…æ™°ï¼Œç”¨æˆ·å®šä¹‰çš„æ“ä½œå…¨éƒ¨éƒ½å‡ºç°åœ¨spawnå‡½æ•°çš„å†…éƒ¨ã€‚è¿™ä¸ªå†™æ³•çš„é—®é¢˜åœ¨äºï¼Œå¿…é¡»æœ‰ä¸€ä¸ªä»»åŠ¡è¿è¡Œå™¨ï¼Œè‡ªåŠ¨æ‰§è¡ŒGeneratorå‡½æ•°ï¼Œä¸Šé¢ä»£ç çš„spawnå‡½æ•°å°±æ˜¯è‡ªåŠ¨æ‰§è¡Œå™¨ï¼Œå®ƒè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œè€Œä¸”å¿…é¡»ä¿è¯yieldè¯­å¥åé¢çš„è¡¨è¾¾å¼ï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªPromiseã€‚ æœ€åæ˜¯Asyncå‡½æ•°çš„å†™æ³•ã€‚ 1234567891011async function chainAnimationsAsync(elem, animations) &#123; var ret = null; try &#123; for(var anim of animations) &#123; ret = await anim(elem); &#125; &#125; catch(e) &#123; /* å¿½ç•¥é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ */ &#125; return ret;&#125; å¯ä»¥çœ‹åˆ°Asyncå‡½æ•°çš„å®ç°æœ€ç®€æ´ï¼Œæœ€ç¬¦åˆè¯­ä¹‰ï¼Œå‡ ä¹æ²¡æœ‰è¯­ä¹‰ä¸ç›¸å…³çš„ä»£ç ã€‚å®ƒå°†Generatorå†™æ³•ä¸­çš„è‡ªåŠ¨æ‰§è¡Œå™¨ï¼Œæ”¹åœ¨è¯­è¨€å±‚é¢æä¾›ï¼Œä¸æš´éœ²ç»™ç”¨æˆ·ï¼Œå› æ­¤ä»£ç é‡æœ€å°‘ã€‚å¦‚æœä½¿ç”¨Generatorå†™æ³•ï¼Œè‡ªåŠ¨æ‰§è¡Œå™¨éœ€è¦ç”¨æˆ·è‡ªå·±æä¾›ã€‚ å®ä¾‹ï¼šæŒ‰é¡ºåºå®Œæˆå¼‚æ­¥æ“ä½œå®é™…å¼€å‘ä¸­ï¼Œç»å¸¸é‡åˆ°ä¸€ç»„å¼‚æ­¥æ“ä½œï¼Œéœ€è¦æŒ‰ç…§é¡ºåºå®Œæˆã€‚æ¯”å¦‚ï¼Œä¾æ¬¡è¿œç¨‹è¯»å–ä¸€ç»„URLï¼Œç„¶åæŒ‰ç…§è¯»å–çš„é¡ºåºè¾“å‡ºç»“æœã€‚ Promise çš„å†™æ³•å¦‚ä¸‹ã€‚ 123456789101112function logInOrder(urls) &#123; // è¿œç¨‹è¯»å–æ‰€æœ‰URL const textPromises = urls.map(url =&gt; &#123; return fetch(url).then(response =&gt; response.text()); &#125;); // æŒ‰æ¬¡åºè¾“å‡º textPromises.reduce((chain, textPromise) =&gt; &#123; return chain.then(() =&gt; textPromise) .then(text =&gt; console.log(text)); &#125;, Promise.resolve());&#125; ä¸Šé¢ä»£ç ä½¿ç”¨fetchæ–¹æ³•ï¼ŒåŒæ—¶è¿œç¨‹è¯»å–ä¸€ç»„URLã€‚æ¯ä¸ªfetchæ“ä½œéƒ½è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œæ”¾å…¥textPromisesæ•°ç»„ã€‚ç„¶åï¼Œreduceæ–¹æ³•ä¾æ¬¡å¤„ç†æ¯ä¸ªPromiseå¯¹è±¡ï¼Œç„¶åä½¿ç”¨thenï¼Œå°†æ‰€æœ‰Promiseå¯¹è±¡è¿èµ·æ¥ï¼Œå› æ­¤å°±å¯ä»¥ä¾æ¬¡è¾“å‡ºç»“æœã€‚ è¿™ç§å†™æ³•ä¸å¤ªç›´è§‚ï¼Œå¯è¯»æ€§æ¯”è¾ƒå·®ã€‚ä¸‹é¢æ˜¯asyncå‡½æ•°å®ç°ã€‚ 123456async function logInOrder(urls) &#123; for (const url of urls) &#123; const response = await fetch(url); console.log(await response.text()); &#125;&#125; ä¸Šé¢ä»£ç ç¡®å®å¤§å¤§ç®€åŒ–ï¼Œé—®é¢˜æ˜¯æ‰€æœ‰è¿œç¨‹æ“ä½œéƒ½æ˜¯ç»§å‘ã€‚åªæœ‰å‰ä¸€ä¸ªURLè¿”å›ç»“æœï¼Œæ‰ä¼šå»è¯»å–ä¸‹ä¸€ä¸ªURLï¼Œè¿™æ ·åšæ•ˆç‡å¾ˆå·®ï¼Œéå¸¸æµªè´¹æ—¶é—´ã€‚æˆ‘ä»¬éœ€è¦çš„æ˜¯å¹¶å‘å‘å‡ºè¿œç¨‹è¯·æ±‚ã€‚ 123456789101112async function logInOrder(urls) &#123; // å¹¶å‘è¯»å–è¿œç¨‹URL const textPromises = urls.map(async url =&gt; &#123; const response = await fetch(url); return response.text(); &#125;); // æŒ‰æ¬¡åºè¾“å‡º for (const textPromise of textPromises) &#123; console.log(await textPromise); &#125;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œè™½ç„¶mapæ–¹æ³•çš„å‚æ•°æ˜¯asyncå‡½æ•°ï¼Œä½†å®ƒæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œå› ä¸ºåªæœ‰asyncå‡½æ•°å†…éƒ¨æ˜¯ç»§å‘æ‰§è¡Œï¼Œå¤–éƒ¨ä¸å—å½±å“ã€‚åé¢çš„for..ofå¾ªç¯å†…éƒ¨ä½¿ç”¨äº†awaitï¼Œå› æ­¤å®ç°äº†æŒ‰é¡ºåºè¾“å‡ºã€‚ å¼‚æ­¥éå†å™¨ã€Šéå†å™¨ã€‹ä¸€ç« è¯´è¿‡ï¼ŒIterator æ¥å£æ˜¯ä¸€ç§æ•°æ®éå†çš„åè®®ï¼Œåªè¦è°ƒç”¨éå†å™¨å¯¹è±¡çš„nextæ–¹æ³•ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºå½“å‰éå†æŒ‡é’ˆæ‰€åœ¨çš„é‚£ä¸ªä½ç½®çš„ä¿¡æ¯ã€‚nextæ–¹æ³•è¿”å›çš„å¯¹è±¡çš„ç»“æ„æ˜¯{value, done}ï¼Œå…¶ä¸­valueè¡¨ç¤ºå½“å‰çš„æ•°æ®çš„å€¼ï¼Œdoneæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºéå†æ˜¯å¦ç»“æŸã€‚ è¿™é‡Œéšå«ç€ä¸€ä¸ªè§„å®šï¼Œnextæ–¹æ³•å¿…é¡»æ˜¯åŒæ­¥çš„ï¼Œåªè¦è°ƒç”¨å°±å¿…é¡»ç«‹åˆ»è¿”å›å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦æ‰§è¡Œnextæ–¹æ³•ï¼Œå°±å¿…é¡»åŒæ­¥åœ°å¾—åˆ°valueå’Œdoneè¿™ä¸¤ä¸ªå±æ€§ã€‚å¦‚æœéå†æŒ‡é’ˆæ­£å¥½æŒ‡å‘åŒæ­¥æ“ä½œï¼Œå½“ç„¶æ²¡æœ‰é—®é¢˜ï¼Œä½†å¯¹äºå¼‚æ­¥æ“ä½œï¼Œå°±ä¸å¤ªåˆé€‚äº†ã€‚ç›®å‰çš„è§£å†³æ–¹æ³•æ˜¯ï¼ŒGenerator å‡½æ•°é‡Œé¢çš„å¼‚æ­¥æ“ä½œï¼Œè¿”å›ä¸€ä¸ª Thunk å‡½æ•°æˆ–è€… Promise å¯¹è±¡ï¼Œå³valueå±æ€§æ˜¯ä¸€ä¸ª Thunk å‡½æ•°æˆ–è€… Promise å¯¹è±¡ï¼Œç­‰å¾…ä»¥åè¿”å›çœŸæ­£çš„å€¼ï¼Œè€Œdoneå±æ€§åˆ™è¿˜æ˜¯åŒæ­¥äº§ç”Ÿçš„ã€‚ ç›®å‰ï¼Œæœ‰ä¸€ä¸ªææ¡ˆï¼Œä¸ºå¼‚æ­¥æ“ä½œæä¾›åŸç”Ÿçš„éå†å™¨æ¥å£ï¼Œå³valueå’Œdoneè¿™ä¸¤ä¸ªå±æ€§éƒ½æ˜¯å¼‚æ­¥äº§ç”Ÿï¼Œè¿™ç§°ä¸ºâ€å¼‚æ­¥éå†å™¨â€œï¼ˆAsync Iteratorï¼‰ã€‚ å¼‚æ­¥éå†çš„æ¥å£å¼‚æ­¥éå†å™¨çš„æœ€å¤§çš„è¯­æ³•ç‰¹ç‚¹ï¼Œå°±æ˜¯è°ƒç”¨éå†å™¨çš„nextæ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚ 12345asyncIterator .next() .then( (&#123; value, done &#125;) =&gt; /* ... */ ); ä¸Šé¢ä»£ç ä¸­ï¼ŒasyncIteratoræ˜¯ä¸€ä¸ªå¼‚æ­¥éå†å™¨ï¼Œè°ƒç”¨nextæ–¹æ³•ä»¥åï¼Œè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨thenæ–¹æ³•æŒ‡å®šï¼Œè¿™ä¸ª Promise å¯¹è±¡çš„çŠ¶æ€å˜ä¸ºresolveä»¥åçš„å›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°çš„å‚æ•°ï¼Œåˆ™æ˜¯ä¸€ä¸ªå…·æœ‰valueå’Œdoneä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ï¼Œè¿™ä¸ªè·ŸåŒæ­¥éå†å™¨æ˜¯ä¸€æ ·çš„ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥éå†å™¨çš„æ¥å£ï¼Œéƒ¨ç½²åœ¨Symbol.iteratorå±æ€§ä¸Šé¢ã€‚åŒæ ·åœ°ï¼Œå¯¹è±¡çš„å¼‚æ­¥éå†å™¨æ¥å£ï¼Œéƒ¨ç½²åœ¨Symbol.asyncIteratorå±æ€§ä¸Šé¢ã€‚ä¸ç®¡æ˜¯ä»€ä¹ˆæ ·çš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„Symbol.asyncIteratorå±æ€§æœ‰å€¼ï¼Œå°±è¡¨ç¤ºåº”è¯¥å¯¹å®ƒè¿›è¡Œå¼‚æ­¥éå†ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªå¼‚æ­¥éå†å™¨çš„ä¾‹å­ã€‚ 12345678910111213141516const asyncIterable = createAsyncIterable(['a', 'b']);const asyncIterator = asyncIterable[Symbol.asyncIterator]();asyncIterator.next().then(iterResult1 =&gt; &#123; console.log(iterResult1); // &#123; value: 'a', done: false &#125; return asyncIterator.next();&#125;).then(iterResult2 =&gt; &#123; console.log(iterResult2); // &#123; value: 'b', done: false &#125; return asyncIterator.next();&#125;).then(iterResult3 =&gt; &#123; console.log(iterResult3); // &#123; value: undefined, done: true &#125;&#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œå¼‚æ­¥éå†å™¨å…¶å®è¿”å›äº†ä¸¤æ¬¡å€¼ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™ï¼Œè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼›ç­‰åˆ° Promise å¯¹è±¡resolveäº†ï¼Œå†è¿”å›ä¸€ä¸ªè¡¨ç¤ºå½“å‰æ•°æ®æˆå‘˜ä¿¡æ¯çš„å¯¹è±¡ã€‚è¿™å°±æ˜¯è¯´ï¼Œå¼‚æ­¥éå†å™¨ä¸åŒæ­¥éå†å™¨æœ€ç»ˆè¡Œä¸ºæ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯ä¼šå…ˆè¿”å› Promise å¯¹è±¡ï¼Œä½œä¸ºä¸­ä»‹ã€‚ ç”±äºå¼‚æ­¥éå†å™¨çš„nextæ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚å› æ­¤ï¼Œå¯ä»¥æŠŠå®ƒæ”¾åœ¨awaitå‘½ä»¤åé¢ã€‚ 12345678910async function f() &#123; const asyncIterable = createAsyncIterable(['a', 'b']); const asyncIterator = asyncIterable[Symbol.asyncIterator](); console.log(await asyncIterator.next()); // &#123; value: 'a', done: false &#125; console.log(await asyncIterator.next()); // &#123; value: 'b', done: false &#125; console.log(await asyncIterator.next()); // &#123; value: undefined, done: true &#125;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œnextæ–¹æ³•ç”¨awaitå¤„ç†ä»¥åï¼Œå°±ä¸å¿…ä½¿ç”¨thenæ–¹æ³•äº†ã€‚æ•´ä¸ªæµç¨‹å·²ç»å¾ˆæ¥è¿‘åŒæ­¥å¤„ç†äº†ã€‚ æ³¨æ„ï¼Œå¼‚æ­¥éå†å™¨çš„nextæ–¹æ³•æ˜¯å¯ä»¥è¿ç»­è°ƒç”¨çš„ï¼Œä¸å¿…ç­‰åˆ°ä¸Šä¸€æ­¥äº§ç”Ÿçš„Promiseå¯¹è±¡resolveä»¥åå†è°ƒç”¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œnextæ–¹æ³•ä¼šç´¯ç§¯èµ·æ¥ï¼Œè‡ªåŠ¨æŒ‰ç…§æ¯ä¸€æ­¥çš„é¡ºåºè¿è¡Œä¸‹å»ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼ŒæŠŠæ‰€æœ‰çš„nextæ–¹æ³•æ”¾åœ¨Promise.allæ–¹æ³•é‡Œé¢ã€‚ 123456const asyncGenObj = createAsyncIterable(['a', 'b']);const [&#123;value: v1&#125;, &#123;value: v2&#125;] = await Promise.all([ asyncGenObj.next(), asyncGenObj.next()]);console.log(v1, v2); // a b å¦ä¸€ç§ç”¨æ³•æ˜¯ä¸€æ¬¡æ€§è°ƒç”¨æ‰€æœ‰çš„nextæ–¹æ³•ï¼Œç„¶åawaitæœ€åä¸€æ­¥æ“ä½œã€‚ 1234const writer = openFile('someFile.txt');writer.next('hello');writer.next('world');await writer.return(); for awaitâ€¦ofå‰é¢ä»‹ç»è¿‡ï¼Œfor...ofå¾ªç¯ç”¨äºéå†åŒæ­¥çš„ Iterator æ¥å£ã€‚æ–°å¼•å…¥çš„for await...ofå¾ªç¯ï¼Œåˆ™æ˜¯ç”¨äºéå†å¼‚æ­¥çš„ Iterator æ¥å£ã€‚ 1234567async function f() &#123; for await (const x of createAsyncIterable(['a', 'b'])) &#123; console.log(x); &#125;&#125;// a// b ä¸Šé¢ä»£ç ä¸­ï¼ŒcreateAsyncIterable()è¿”å›ä¸€ä¸ªå¼‚æ­¥éå†å™¨ï¼Œfor...ofå¾ªç¯è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªéå†å™¨çš„nextæ–¹æ³•ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªPromiseå¯¹è±¡ã€‚awaitç”¨æ¥å¤„ç†è¿™ä¸ªPromiseå¯¹è±¡ï¼Œä¸€æ—¦resolveï¼Œå°±æŠŠå¾—åˆ°çš„å€¼ï¼ˆxï¼‰ä¼ å…¥for...ofçš„å¾ªç¯ä½“ã€‚ for await...ofå¾ªç¯çš„ä¸€ä¸ªç”¨é€”ï¼Œæ˜¯éƒ¨ç½²äº† asyncIterable æ“ä½œçš„å¼‚æ­¥æ¥å£ï¼Œå¯ä»¥ç›´æ¥æ”¾å…¥è¿™ä¸ªå¾ªç¯ã€‚ 1234let body = '';for await(const data of req) body += data;const parsed = JSON.parse(body);console.log('got', parsed); ä¸Šé¢ä»£ç ä¸­ï¼Œreqæ˜¯ä¸€ä¸ª asyncIterable å¯¹è±¡ï¼Œç”¨æ¥å¼‚æ­¥è¯»å–æ•°æ®ã€‚å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨for await...ofå¾ªç¯ä»¥åï¼Œä»£ç ä¼šéå¸¸ç®€æ´ã€‚ å¦‚æœnextæ–¹æ³•è¿”å›çš„Promiseå¯¹è±¡è¢«rejectï¼Œé‚£ä¹ˆå°±è¦ç”¨try...catchæ•æ‰ã€‚ 123456789async function () &#123; try &#123; for await (const x of createRejectingIterable()) &#123; console.log(x); &#125; &#125; catch (e) &#123; console.error(e); &#125;&#125; æ³¨æ„ï¼Œfor await...ofå¾ªç¯ä¹Ÿå¯ä»¥ç”¨äºåŒæ­¥éå†å™¨ã€‚ 1234567(async function () &#123; for await (const x of ['a', 'b']) &#123; console.log(x); &#125;&#125;)();// a// b å¼‚æ­¥Generatorå‡½æ•°å°±åƒ Generator å‡½æ•°è¿”å›ä¸€ä¸ªåŒæ­¥éå†å™¨å¯¹è±¡ä¸€æ ·ï¼Œå¼‚æ­¥ Generator å‡½æ•°çš„ä½œç”¨ï¼Œæ˜¯è¿”å›ä¸€ä¸ªå¼‚æ­¥éå†å™¨å¯¹è±¡ã€‚ åœ¨è¯­æ³•ä¸Šï¼Œå¼‚æ­¥ Generator å‡½æ•°å°±æ˜¯asyncå‡½æ•°ä¸ Generator å‡½æ•°çš„ç»“åˆã€‚ 1234567891011async function* readLines(path) &#123; let file = await fileOpen(path); try &#123; while (!file.EOF) &#123; yield await file.readLine(); &#125; &#125; finally &#123; await file.close(); &#125;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå¼‚æ­¥æ“ä½œå‰é¢ä½¿ç”¨awaitå…³é”®å­—æ ‡æ˜ï¼Œå³awaitåé¢çš„æ“ä½œï¼Œåº”è¯¥è¿”å›Promiseå¯¹è±¡ã€‚å‡¡æ˜¯ä½¿ç”¨yieldå…³é”®å­—çš„åœ°æ–¹ï¼Œå°±æ˜¯nextæ–¹æ³•çš„åœä¸‹æ¥çš„åœ°æ–¹ï¼Œå®ƒåé¢çš„è¡¨è¾¾å¼çš„å€¼ï¼ˆå³await file.readLine()çš„å€¼ï¼‰ï¼Œä¼šä½œä¸ºnext()è¿”å›å¯¹è±¡çš„valueå±æ€§ï¼Œè¿™ä¸€ç‚¹æ˜¯äºåŒæ­¥Generatorå‡½æ•°ä¸€è‡´çš„ã€‚ å¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼Œä½¿ç”¨ä¸Šé¢ä»£ç å®šä¹‰çš„å¼‚æ­¥Generatorå‡½æ•°ã€‚ 123for await (const line of readLines(filePath)) &#123; console.log(line);&#125; å¼‚æ­¥Generatorå‡½æ•°å¯ä»¥ä¸for await...ofå¾ªç¯ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚ 12345async function* prefixLines(asyncIterable) &#123; for await (const line of asyncIterable) &#123; yield '&gt; ' + line; &#125;&#125; yieldå‘½ä»¤ä¾ç„¶æ˜¯ç«‹åˆ»è¿”å›çš„ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚ 123456async function* asyncGenerator() &#123; console.log('Start'); const result = await doSomethingAsync(); // (A) yield 'Result: '+ result; // (B) console.log('Done');&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œè°ƒç”¨nextæ–¹æ³•ä»¥åï¼Œä¼šåœ¨Bå¤„æš‚åœæ‰§è¡Œï¼Œyieldå‘½ä»¤ç«‹åˆ»è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ã€‚è¿™ä¸ªPromiseå¯¹è±¡ä¸åŒäºAå¤„awaitå‘½ä»¤åé¢çš„é‚£ä¸ªPromiseå¯¹è±¡ã€‚ä¸»è¦æœ‰ä¸¤ç‚¹ä¸åŒï¼Œä¸€æ˜¯Aå¤„çš„Promiseå¯¹è±¡resolveä»¥åäº§ç”Ÿçš„å€¼ï¼Œä¼šæ”¾å…¥resultå˜é‡ï¼›äºŒæ˜¯Bå¤„çš„Promiseå¯¹è±¡resolveä»¥åäº§ç”Ÿçš„å€¼ï¼Œæ˜¯è¡¨è¾¾å¼&#39;Resultï¼š &#39; + resultçš„å€¼ï¼›äºŒæ˜¯Aå¤„çš„Promiseå¯¹è±¡ä¸€å®šå…ˆäºBå¤„çš„Promiseå¯¹è±¡resolveã€‚ å¦‚æœå¼‚æ­¥Generatorå‡½æ•°æŠ›å‡ºé”™è¯¯ï¼Œä¼šè¢«Promiseå¯¹è±¡rejectï¼Œç„¶åæŠ›å‡ºçš„é”™è¯¯è¢«catchæ–¹æ³•æ•è·ã€‚ 1234567async function* asyncGenerator() &#123; throw new Error('Problem!');&#125;asyncGenerator().next().catch(err =&gt; console.log(err)); // Error: Problem! æ³¨æ„ï¼Œæ™®é€šçš„asyncå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œè€Œå¼‚æ­¥Generatorå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªå¼‚æ­¥Iteratorå¯¹è±¡ã€‚åŸºæœ¬ä¸Šï¼Œå¯ä»¥è¿™æ ·ç†è§£ï¼Œasyncå‡½æ•°å’Œå¼‚æ­¥Generatorå‡½æ•°ï¼Œæ˜¯å°è£…å¼‚æ­¥æ“ä½œçš„ä¸¤ç§æ–¹æ³•ï¼Œéƒ½ç”¨æ¥è¾¾åˆ°åŒä¸€ç§ç›®çš„ã€‚åŒºåˆ«åœ¨äºï¼Œå‰è€…è‡ªå¸¦æ‰§è¡Œå™¨ï¼Œåè€…é€šè¿‡for await...ofæ‰§è¡Œï¼Œæˆ–è€…è‡ªå·±ç¼–å†™æ‰§è¡Œå™¨ã€‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥Generatorå‡½æ•°çš„æ‰§è¡Œå™¨ã€‚ 12345678910async function takeAsync(asyncIterable, count=Infinity) &#123; const result = []; const iterator = asyncIterable[Symbol.asyncIterator](); while (result.length &lt; count) &#123; const &#123;value,done&#125; = await iterator.next(); if (done) break; result.push(value); &#125; return result;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå¼‚æ­¥Generatorå‡½æ•°äº§ç”Ÿçš„å¼‚æ­¥éå†å™¨ï¼Œä¼šé€šè¿‡whileå¾ªç¯è‡ªåŠ¨æ‰§è¡Œï¼Œæ¯å½“await iterator.next()å®Œæˆï¼Œå°±ä¼šè¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ã€‚ ä¸‹é¢æ˜¯è¿™ä¸ªè‡ªåŠ¨æ‰§è¡Œå™¨çš„ä¸€ä¸ªä½¿ç”¨å®ä¾‹ã€‚ 12345678910111213async function f() &#123; async function* gen() &#123; yield 'a'; yield 'b'; yield 'c'; &#125; return await takeAsync(gen());&#125;f().then(function (result) &#123; console.log(result); // ['a', 'b', 'c']&#125;) å¼‚æ­¥Generatorå‡½æ•°å‡ºç°ä»¥åï¼ŒJavaScriptå°±æœ‰äº†å››ç§å‡½æ•°å½¢å¼ï¼šæ™®é€šå‡½æ•°ã€asyncå‡½æ•°ã€Generatorå‡½æ•°å’Œå¼‚æ­¥Generatorå‡½æ•°ã€‚è¯·æ³¨æ„åŒºåˆ†æ¯ç§å‡½æ•°çš„ä¸åŒä¹‹å¤„ã€‚ æœ€åï¼ŒåŒæ­¥çš„æ•°æ®ç»“æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¼‚æ­¥Generatorå‡½æ•°ã€‚ 12345async function* createAsyncIterable(syncIterable) &#123; for (const elem of syncIterable) &#123; yield elem; &#125;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºæ²¡æœ‰å¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡æœ‰ä½¿ç”¨awaitå…³é”®å­—ã€‚ yield* è¯­å¥yield*è¯­å¥ä¹Ÿå¯ä»¥è·Ÿä¸€ä¸ªå¼‚æ­¥éå†å™¨ã€‚ 123456789async function* gen1() &#123; yield 'a'; yield 'b'; return 2;&#125;async function* gen2() &#123; const result = yield* gen1();&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œgen2å‡½æ•°é‡Œé¢çš„resultå˜é‡ï¼Œæœ€åçš„å€¼æ˜¯2ã€‚ ä¸åŒæ­¥Generatorå‡½æ•°ä¸€æ ·ï¼Œfor await...ofå¾ªç¯ä¼šå±•å¼€yield*ã€‚ 1234567(async function () &#123; for await (const x of gen2()) &#123; console.log(x); &#125;&#125;)();// a// b","tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"ECMAScript 6","slug":"ECMAScript-6","permalink":"http://microzz.com/tags/ECMAScript-6/"},{"name":"Async","slug":"Async","permalink":"http://microzz.com/tags/Async/"}]},{"title":"Promiseå¯¹è±¡","date":"2017-01-14T06:11:38.000Z","path":"2017/01/14/promise/","text":"Promiseå¯¹è±¡Promiseçš„å«ä¹‰Promiseæ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œæ¯”ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆâ€”â€”å›è°ƒå‡½æ•°å’Œäº‹ä»¶â€”â€”æ›´åˆç†å’Œæ›´å¼ºå¤§ã€‚å®ƒç”±ç¤¾åŒºæœ€æ—©æå‡ºå’Œå®ç°ï¼ŒES6å°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€äº†ç”¨æ³•ï¼ŒåŸç”Ÿæä¾›äº†Promiseå¯¹è±¡ã€‚ æ‰€è°“Promiseï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromiseæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚Promiseæä¾›ç»Ÿä¸€çš„APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚ Promiseå¯¹è±¡æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ã€‚ ï¼ˆ1ï¼‰å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚Promiseå¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼šPendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€Resolvedï¼ˆå·²å®Œæˆï¼Œåˆç§°Fulfilledï¼‰å’ŒRejectedï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™ä¹Ÿæ˜¯Promiseè¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå®ƒçš„è‹±è¯­æ„æ€å°±æ˜¯â€œæ‰¿è¯ºâ€ï¼Œè¡¨ç¤ºå…¶ä»–æ‰‹æ®µæ— æ³•æ”¹å˜ã€‚ ï¼ˆ2ï¼‰ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚Promiseå¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»Pendingå˜ä¸ºResolvedå’Œä»Pendingå˜ä¸ºRejectedã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœã€‚å°±ç®—æ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹Promiseå¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚ æœ‰äº†Promiseå¯¹è±¡ï¼Œå°±å¯ä»¥å°†å¼‚æ­¥æ“ä½œä»¥åŒæ­¥æ“ä½œçš„æµç¨‹è¡¨è¾¾å‡ºæ¥ï¼Œé¿å…äº†å±‚å±‚åµŒå¥—çš„å›è°ƒå‡½æ•°ã€‚æ­¤å¤–ï¼ŒPromiseå¯¹è±¡æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œä½¿å¾—æ§åˆ¶å¼‚æ­¥æ“ä½œæ›´åŠ å®¹æ˜“ã€‚ Promiseä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ã€‚é¦–å…ˆï¼Œæ— æ³•å–æ¶ˆPromiseï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚å…¶æ¬¡ï¼Œå¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼ŒPromiseå†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ã€‚ç¬¬ä¸‰ï¼Œå½“å¤„äºPendingçŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰ã€‚ å¦‚æœæŸäº›äº‹ä»¶ä¸æ–­åœ°åå¤å‘ç”Ÿï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨streamæ¨¡å¼æ˜¯æ¯”éƒ¨ç½²Promiseæ›´å¥½çš„é€‰æ‹©ã€‚ åŸºæœ¬ç”¨æ³•ES6è§„å®šï¼ŒPromiseå¯¹è±¡æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”ŸæˆPromiseå®ä¾‹ã€‚ ä¸‹é¢ä»£ç åˆ›é€ äº†ä¸€ä¸ªPromiseå®ä¾‹ã€‚ 123456789var promise = new Promise(function(resolve, reject) &#123; // ... some code if (/* å¼‚æ­¥æ“ä½œæˆåŠŸ */)&#123; resolve(value); &#125; else &#123; reject(error); &#125;&#125;); Promiseæ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯resolveå’Œrejectã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œç”±JavaScriptå¼•æ“æä¾›ï¼Œä¸ç”¨è‡ªå·±éƒ¨ç½²ã€‚ resolveå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä»Pendingå˜ä¸ºResolvedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼›rejectå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€ï¼ˆå³ä»Pendingå˜ä¸ºRejectedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚ Promiseå®ä¾‹ç”Ÿæˆä»¥åï¼Œå¯ä»¥ç”¨thenæ–¹æ³•åˆ†åˆ«æŒ‡å®šResolvedçŠ¶æ€å’ŒRejectçŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚ 12345promise.then(function(value) &#123; // success&#125;, function(error) &#123; // failure&#125;); thenæ–¹æ³•å¯ä»¥æ¥å—ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°æ˜¯Promiseå¯¹è±¡çš„çŠ¶æ€å˜ä¸ºResolvedæ—¶è°ƒç”¨ï¼Œç¬¬äºŒä¸ªå›è°ƒå‡½æ•°æ˜¯Promiseå¯¹è±¡çš„çŠ¶æ€å˜ä¸ºRejectæ—¶è°ƒç”¨ã€‚å…¶ä¸­ï¼Œç¬¬äºŒä¸ªå‡½æ•°æ˜¯å¯é€‰çš„ï¼Œä¸ä¸€å®šè¦æä¾›ã€‚è¿™ä¸¤ä¸ªå‡½æ•°éƒ½æ¥å—Promiseå¯¹è±¡ä¼ å‡ºçš„å€¼ä½œä¸ºå‚æ•°ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡çš„ç®€å•ä¾‹å­ã€‚ 123456789function timeout(ms) &#123; return new Promise((resolve, reject) =&gt; &#123; setTimeout(resolve, ms, 'done'); &#125;);&#125;timeout(100).then((value) =&gt; &#123; console.log(value);&#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œtimeoutæ–¹æ³•è¿”å›ä¸€ä¸ªPromiseå®ä¾‹ï¼Œè¡¨ç¤ºä¸€æ®µæ—¶é—´ä»¥åæ‰ä¼šå‘ç”Ÿçš„ç»“æœã€‚è¿‡äº†æŒ‡å®šçš„æ—¶é—´ï¼ˆmså‚æ•°ï¼‰ä»¥åï¼ŒPromiseå®ä¾‹çš„çŠ¶æ€å˜ä¸ºResolvedï¼Œå°±ä¼šè§¦å‘thenæ–¹æ³•ç»‘å®šçš„å›è°ƒå‡½æ•°ã€‚ Promiseæ–°å»ºåå°±ä¼šç«‹å³æ‰§è¡Œã€‚ 1234567891011121314let promise = new Promise(function(resolve, reject) &#123; console.log('Promise'); resolve();&#125;);promise.then(function() &#123; console.log('Resolved.');&#125;);console.log('Hi!');// Promise// Hi!// Resolved ä¸Šé¢ä»£ç ä¸­ï¼ŒPromiseæ–°å»ºåç«‹å³æ‰§è¡Œï¼Œæ‰€ä»¥é¦–å…ˆè¾“å‡ºçš„æ˜¯â€œPromiseâ€ã€‚ç„¶åï¼Œthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå°†åœ¨å½“å‰è„šæœ¬æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ‰ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥â€œResolvedâ€æœ€åè¾“å‡ºã€‚ ä¸‹é¢æ˜¯å¼‚æ­¥åŠ è½½å›¾ç‰‡çš„ä¾‹å­ã€‚ 123456789101112131415function loadImageAsync(url) &#123; return new Promise(function(resolve, reject) &#123; var image = new Image(); image.onload = function() &#123; resolve(image); &#125;; image.onerror = function() &#123; reject(new Error('Could not load image at ' + url)); &#125;; image.src = url; &#125;);&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œä½¿ç”¨PromiseåŒ…è£…äº†ä¸€ä¸ªå›¾ç‰‡åŠ è½½çš„å¼‚æ­¥æ“ä½œã€‚å¦‚æœåŠ è½½æˆåŠŸï¼Œå°±è°ƒç”¨resolveæ–¹æ³•ï¼Œå¦åˆ™å°±è°ƒç”¨rejectæ–¹æ³•ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨Promiseå¯¹è±¡å®ç°çš„Ajaxæ“ä½œçš„ä¾‹å­ã€‚ 1234567891011121314151617181920212223242526272829var getJSON = function(url) &#123; var promise = new Promise(function(resolve, reject)&#123; var client = new XMLHttpRequest(); client.open(\"GET\", url); client.onreadystatechange = handler; client.responseType = \"json\"; client.setRequestHeader(\"Accept\", \"application/json\"); client.send(); function handler() &#123; if (this.readyState !== 4) &#123; return; &#125; if (this.status === 200) &#123; resolve(this.response); &#125; else &#123; reject(new Error(this.statusText)); &#125; &#125;; &#125;); return promise;&#125;;getJSON(\"/posts.json\").then(function(json) &#123; console.log('Contents: ' + json);&#125;, function(error) &#123; console.error('å‡ºé”™äº†', error);&#125;); ä¸Šé¢ä»£ç ä¸­ï¼ŒgetJSONæ˜¯å¯¹XMLHttpRequestå¯¹è±¡çš„å°è£…ï¼Œç”¨äºå‘å‡ºä¸€ä¸ªé’ˆå¯¹JSONæ•°æ®çš„HTTPè¯·æ±‚ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨getJSONå†…éƒ¨ï¼Œresolveå‡½æ•°å’Œrejectå‡½æ•°è°ƒç”¨æ—¶ï¼Œéƒ½å¸¦æœ‰å‚æ•°ã€‚ å¦‚æœè°ƒç”¨resolveå‡½æ•°å’Œrejectå‡½æ•°æ—¶å¸¦æœ‰å‚æ•°ï¼Œé‚£ä¹ˆå®ƒä»¬çš„å‚æ•°ä¼šè¢«ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚rejectå‡½æ•°çš„å‚æ•°é€šå¸¸æ˜¯Errorå¯¹è±¡çš„å®ä¾‹ï¼Œè¡¨ç¤ºæŠ›å‡ºçš„é”™è¯¯ï¼›resolveå‡½æ•°çš„å‚æ•°é™¤äº†æ­£å¸¸çš„å€¼ä»¥å¤–ï¼Œè¿˜å¯èƒ½æ˜¯å¦ä¸€ä¸ªPromiseå®ä¾‹ï¼Œè¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å¦ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚åƒä¸‹é¢è¿™æ ·ã€‚ 12345678var p1 = new Promise(function (resolve, reject) &#123; // ...&#125;);var p2 = new Promise(function (resolve, reject) &#123; // ... resolve(p1);&#125;) ä¸Šé¢ä»£ç ä¸­ï¼Œp1å’Œp2éƒ½æ˜¯Promiseçš„å®ä¾‹ï¼Œä½†æ˜¯p2çš„resolveæ–¹æ³•å°†p1ä½œä¸ºå‚æ•°ï¼Œå³ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„ç»“æœæ˜¯è¿”å›å¦ä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚ æ³¨æ„ï¼Œè¿™æ—¶p1çš„çŠ¶æ€å°±ä¼šä¼ é€’ç»™p2ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œp1çš„çŠ¶æ€å†³å®šäº†p2çš„çŠ¶æ€ã€‚å¦‚æœp1çš„çŠ¶æ€æ˜¯Pendingï¼Œé‚£ä¹ˆp2çš„å›è°ƒå‡½æ•°å°±ä¼šç­‰å¾…p1çš„çŠ¶æ€æ”¹å˜ï¼›å¦‚æœp1çš„çŠ¶æ€å·²ç»æ˜¯Resolvedæˆ–è€…Rejectedï¼Œé‚£ä¹ˆp2çš„å›è°ƒå‡½æ•°å°†ä¼šç«‹åˆ»æ‰§è¡Œã€‚ 123456789101112var p1 = new Promise(function (resolve, reject) &#123; setTimeout(() =&gt; reject(new Error('fail')), 3000)&#125;)var p2 = new Promise(function (resolve, reject) &#123; setTimeout(() =&gt; resolve(p1), 1000)&#125;)p2 .then(result =&gt; console.log(result)) .catch(error =&gt; console.log(error))// Error: fail ä¸Šé¢ä»£ç ä¸­ï¼Œp1æ˜¯ä¸€ä¸ªPromiseï¼Œ3ç§’ä¹‹åå˜ä¸ºrejectedã€‚p2çš„çŠ¶æ€åœ¨1ç§’ä¹‹åæ”¹å˜ï¼Œresolveæ–¹æ³•è¿”å›çš„æ˜¯p1ã€‚æ­¤æ—¶ï¼Œç”±äºp2è¿”å›çš„æ˜¯å¦ä¸€ä¸ªPromiseï¼Œæ‰€ä»¥åé¢çš„thenè¯­å¥éƒ½å˜æˆé’ˆå¯¹åè€…ï¼ˆp1ï¼‰ã€‚åˆè¿‡äº†2ç§’ï¼Œp1å˜ä¸ºrejectedï¼Œå¯¼è‡´è§¦å‘catchæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚ Promise.prototype.then()Promiseå®ä¾‹å…·æœ‰thenæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œthenæ–¹æ³•æ˜¯å®šä¹‰åœ¨åŸå‹å¯¹è±¡Promise.prototypeä¸Šçš„ã€‚å®ƒçš„ä½œç”¨æ˜¯ä¸ºPromiseå®ä¾‹æ·»åŠ çŠ¶æ€æ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°ã€‚å‰é¢è¯´è¿‡ï¼Œthenæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ResolvedçŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯é€‰ï¼‰æ˜¯RejectedçŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚ thenæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯åŸæ¥é‚£ä¸ªPromiseå®ä¾‹ï¼‰ã€‚å› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ï¼Œå³thenæ–¹æ³•åé¢å†è°ƒç”¨å¦ä¸€ä¸ªthenæ–¹æ³•ã€‚ 12345getJSON(\"/posts.json\").then(function(json) &#123; return json.post;&#125;).then(function(post) &#123; // ...&#125;); ä¸Šé¢çš„ä»£ç ä½¿ç”¨thenæ–¹æ³•ï¼Œä¾æ¬¡æŒ‡å®šäº†ä¸¤ä¸ªå›è°ƒå‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°å®Œæˆä»¥åï¼Œä¼šå°†è¿”å›ç»“æœä½œä¸ºå‚æ•°ï¼Œä¼ å…¥ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°ã€‚ é‡‡ç”¨é“¾å¼çš„thenï¼Œå¯ä»¥æŒ‡å®šä¸€ç»„æŒ‰ç…§æ¬¡åºè°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚è¿™æ—¶ï¼Œå‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæœ‰å¯èƒ½è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼ˆå³æœ‰å¼‚æ­¥æ“ä½œï¼‰ï¼Œè¿™æ—¶åä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå°±ä¼šç­‰å¾…è¯¥Promiseå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œæ‰ä¼šè¢«è°ƒç”¨ã€‚ 1234567getJSON(\"/post/1.json\").then(function(post) &#123; return getJSON(post.commentURL);&#125;).then(function funcA(comments) &#123; console.log(\"Resolved: \", comments);&#125;, function funcB(err)&#123; console.log(\"Rejected: \", err);&#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬ä¸€ä¸ªthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œè¿”å›çš„æ˜¯å¦ä¸€ä¸ªPromiseå¯¹è±¡ã€‚è¿™æ—¶ï¼Œç¬¬äºŒä¸ªthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå°±ä¼šç­‰å¾…è¿™ä¸ªæ–°çš„Promiseå¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–ã€‚å¦‚æœå˜ä¸ºResolvedï¼Œå°±è°ƒç”¨funcAï¼Œå¦‚æœçŠ¶æ€å˜ä¸ºRejectedï¼Œå°±è°ƒç”¨funcBã€‚ å¦‚æœé‡‡ç”¨ç®­å¤´å‡½æ•°ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥å†™å¾—æ›´ç®€æ´ã€‚ 123456getJSON(\"/post/1.json\").then( post =&gt; getJSON(post.commentURL)).then( comments =&gt; console.log(\"Resolved: \", comments), err =&gt; console.log(\"Rejected: \", err)); Promise.prototype.catch()Promise.prototype.catchæ–¹æ³•æ˜¯.then(null, rejection)çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚ 123456getJSON(\"/posts.json\").then(function(posts) &#123; // ...&#125;).catch(function(error) &#123; // å¤„ç† getJSON å’Œ å‰ä¸€ä¸ªå›è°ƒå‡½æ•°è¿è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯ console.log('å‘ç”Ÿé”™è¯¯ï¼', error);&#125;); ä¸Šé¢ä»£ç ä¸­ï¼ŒgetJSONæ–¹æ³•è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå¦‚æœè¯¥å¯¹è±¡çŠ¶æ€å˜ä¸ºResolvedï¼Œåˆ™ä¼šè°ƒç”¨thenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼›å¦‚æœå¼‚æ­¥æ“ä½œæŠ›å‡ºé”™è¯¯ï¼ŒçŠ¶æ€å°±ä¼šå˜ä¸ºRejectedï¼Œå°±ä¼šè°ƒç”¨catchæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå¤„ç†è¿™ä¸ªé”™è¯¯ã€‚å¦å¤–ï¼Œthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœè¿è¡Œä¸­æŠ›å‡ºé”™è¯¯ï¼Œä¹Ÿä¼šè¢«catchæ–¹æ³•æ•è·ã€‚ 123456p.then((val) =&gt; console.log(\"fulfilled:\", val)) .catch((err) =&gt; console.log(\"rejected:\", err));// ç­‰åŒäºp.then((val) =&gt; console.log(\"fulfilled:\", val)) .then(null, (err) =&gt; console.log(\"rejected:\", err)); ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 1234567var promise = new Promise(function(resolve, reject) &#123; throw new Error('test');&#125;);promise.catch(function(error) &#123; console.log(error);&#125;);// Error: test ä¸Šé¢ä»£ç ä¸­ï¼ŒpromiseæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå°±è¢«catchæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°æ•è·ã€‚æ³¨æ„ï¼Œä¸Šé¢çš„å†™æ³•ä¸ä¸‹é¢ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ã€‚ 12345678910111213141516171819// å†™æ³•ä¸€var promise = new Promise(function(resolve, reject) &#123; try &#123; throw new Error('test'); &#125; catch(e) &#123; reject(e); &#125;&#125;);promise.catch(function(error) &#123; console.log(error);&#125;);// å†™æ³•äºŒvar promise = new Promise(function(resolve, reject) &#123; reject(new Error('test'));&#125;);promise.catch(function(error) &#123; console.log(error);&#125;); æ¯”è¾ƒä¸Šé¢ä¸¤ç§å†™æ³•ï¼Œå¯ä»¥å‘ç°rejectæ–¹æ³•çš„ä½œç”¨ï¼Œç­‰åŒäºæŠ›å‡ºé”™è¯¯ã€‚ å¦‚æœPromiseçŠ¶æ€å·²ç»å˜æˆResolvedï¼Œå†æŠ›å‡ºé”™è¯¯æ˜¯æ— æ•ˆçš„ã€‚ 12345678var promise = new Promise(function(resolve, reject) &#123; resolve('ok'); throw new Error('test');&#125;);promise .then(function(value) &#123; console.log(value) &#125;) .catch(function(error) &#123; console.log(error) &#125;);// ok ä¸Šé¢ä»£ç ä¸­ï¼ŒPromiseåœ¨resolveè¯­å¥åé¢ï¼Œå†æŠ›å‡ºé”™è¯¯ï¼Œä¸ä¼šè¢«æ•è·ï¼Œç­‰äºæ²¡æœ‰æŠ›å‡ºã€‚ Promiseå¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ªcatchè¯­å¥æ•è·ã€‚ 1234567getJSON(\"/post/1.json\").then(function(post) &#123; return getJSON(post.commentURL);&#125;).then(function(comments) &#123; // some code&#125;).catch(function(error) &#123; // å¤„ç†å‰é¢ä¸‰ä¸ªPromiseäº§ç”Ÿçš„é”™è¯¯&#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªPromiseå¯¹è±¡ï¼šä¸€ä¸ªç”±getJSONäº§ç”Ÿï¼Œä¸¤ä¸ªç”±thenäº§ç”Ÿã€‚å®ƒä»¬ä¹‹ä¸­ä»»ä½•ä¸€ä¸ªæŠ›å‡ºçš„é”™è¯¯ï¼Œéƒ½ä¼šè¢«æœ€åä¸€ä¸ªcatchæ•è·ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œä¸è¦åœ¨thenæ–¹æ³•é‡Œé¢å®šä¹‰RejectçŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼ˆå³thençš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰ï¼Œæ€»æ˜¯ä½¿ç”¨catchæ–¹æ³•ã€‚ 12345678910111213141516// badpromise .then(function(data) &#123; // success &#125;, function(err) &#123; // error &#125;);// goodpromise .then(function(data) &#123; //cb // success &#125;) .catch(function(err) &#123; // error &#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬äºŒç§å†™æ³•è¦å¥½äºç¬¬ä¸€ç§å†™æ³•ï¼Œç†ç”±æ˜¯ç¬¬äºŒç§å†™æ³•å¯ä»¥æ•è·å‰é¢thenæ–¹æ³•æ‰§è¡Œä¸­çš„é”™è¯¯ï¼Œä¹Ÿæ›´æ¥è¿‘åŒæ­¥çš„å†™æ³•ï¼ˆtry/catchï¼‰ã€‚å› æ­¤ï¼Œå»ºè®®æ€»æ˜¯ä½¿ç”¨catchæ–¹æ³•ï¼Œè€Œä¸ä½¿ç”¨thenæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚ è·Ÿä¼ ç»Ÿçš„try/catchä»£ç å—ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨catchæ–¹æ³•æŒ‡å®šé”™è¯¯å¤„ç†çš„å›è°ƒå‡½æ•°ï¼ŒPromiseå¯¹è±¡æŠ›å‡ºçš„é”™è¯¯ä¸ä¼šä¼ é€’åˆ°å¤–å±‚ä»£ç ï¼Œå³ä¸ä¼šæœ‰ä»»ä½•ååº”ã€‚ 12345678910var someAsyncThing = function() &#123; return new Promise(function(resolve, reject) &#123; // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºxæ²¡æœ‰å£°æ˜ resolve(x + 2); &#125;);&#125;;someAsyncThing().then(function() &#123; console.log('everything is great');&#125;); ä¸Šé¢ä»£ç ä¸­ï¼ŒsomeAsyncThingå‡½æ•°äº§ç”Ÿçš„Promiseå¯¹è±¡ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰æŒ‡å®šcatchæ–¹æ³•ï¼Œè¿™ä¸ªé”™è¯¯ä¸ä¼šè¢«æ•è·ï¼Œä¹Ÿä¸ä¼šä¼ é€’åˆ°å¤–å±‚ä»£ç ï¼Œå¯¼è‡´è¿è¡Œåæ²¡æœ‰ä»»ä½•è¾“å‡ºã€‚æ³¨æ„ï¼ŒChromeæµè§ˆå™¨ä¸éµå®ˆè¿™æ¡è§„å®šï¼Œå®ƒä¼šæŠ›å‡ºé”™è¯¯â€œReferenceError: x is not definedâ€ã€‚ 1234567var promise = new Promise(function(resolve, reject) &#123; resolve('ok'); setTimeout(function() &#123; throw new Error('test') &#125;, 0)&#125;);promise.then(function(value) &#123; console.log(value) &#125;);// ok// Uncaught Error: test ä¸Šé¢ä»£ç ä¸­ï¼ŒPromise æŒ‡å®šåœ¨ä¸‹ä¸€è½®â€œäº‹ä»¶å¾ªç¯â€å†æŠ›å‡ºé”™è¯¯ï¼Œç»“æœç”±äºæ²¡æœ‰æŒ‡å®šä½¿ç”¨try...catchè¯­å¥ï¼Œå°±å†’æ³¡åˆ°æœ€å¤–å±‚ï¼Œæˆäº†æœªæ•è·çš„é”™è¯¯ã€‚å› ä¸ºæ­¤æ—¶ï¼ŒPromiseçš„å‡½æ•°ä½“å·²ç»è¿è¡Œç»“æŸäº†ï¼Œæ‰€ä»¥è¿™ä¸ªé”™è¯¯æ˜¯åœ¨Promiseå‡½æ•°ä½“å¤–æŠ›å‡ºçš„ã€‚ Node æœ‰ä¸€ä¸ªunhandledRejectionäº‹ä»¶ï¼Œä¸“é—¨ç›‘å¬æœªæ•è·çš„rejecté”™è¯¯ã€‚ 123process.on('unhandledRejection', function (err, p) &#123; console.error(err.stack)&#125;); ä¸Šé¢ä»£ç ä¸­ï¼ŒunhandledRejectionäº‹ä»¶çš„ç›‘å¬å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯é”™è¯¯å¯¹è±¡ï¼Œç¬¬äºŒä¸ªæ˜¯æŠ¥é”™çš„Promiseå®ä¾‹ï¼Œå®ƒå¯ä»¥ç”¨æ¥äº†è§£å‘ç”Ÿé”™è¯¯çš„ç¯å¢ƒä¿¡æ¯ã€‚ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcatchæ–¹æ³•è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå› æ­¤åé¢è¿˜å¯ä»¥æ¥ç€è°ƒç”¨thenæ–¹æ³•ã€‚ 12345678910111213141516var someAsyncThing = function() &#123; return new Promise(function(resolve, reject) &#123; // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºxæ²¡æœ‰å£°æ˜ resolve(x + 2); &#125;);&#125;;someAsyncThing().catch(function(error) &#123; console.log('oh no', error);&#125;).then(function() &#123; console.log('carry on');&#125;);// oh no [ReferenceError: x is not defined]// carry on ä¸Šé¢ä»£ç è¿è¡Œå®Œcatchæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œä¼šæ¥ç€è¿è¡Œåé¢é‚£ä¸ªthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚å¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œåˆ™ä¼šè·³è¿‡catchæ–¹æ³•ã€‚ 12345678Promise.resolve().catch(function(error) &#123; console.log('oh no', error);&#125;).then(function() &#123; console.log('carry on');&#125;);// carry on ä¸Šé¢çš„ä»£ç å› ä¸ºæ²¡æœ‰æŠ¥é”™ï¼Œè·³è¿‡äº†catchæ–¹æ³•ï¼Œç›´æ¥æ‰§è¡Œåé¢çš„thenæ–¹æ³•ã€‚æ­¤æ—¶ï¼Œè¦æ˜¯thenæ–¹æ³•é‡Œé¢æŠ¥é”™ï¼Œå°±ä¸å‰é¢çš„catchæ— å…³äº†ã€‚ catchæ–¹æ³•ä¹‹ä¸­ï¼Œè¿˜èƒ½å†æŠ›å‡ºé”™è¯¯ã€‚ 1234567891011121314151617var someAsyncThing = function() &#123; return new Promise(function(resolve, reject) &#123; // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºxæ²¡æœ‰å£°æ˜ resolve(x + 2); &#125;);&#125;;someAsyncThing().then(function() &#123; return someOtherAsyncThing();&#125;).catch(function(error) &#123; console.log('oh no', error); // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºyæ²¡æœ‰å£°æ˜ y + 2;&#125;).then(function() &#123; console.log('carry on');&#125;);// oh no [ReferenceError: x is not defined] ä¸Šé¢ä»£ç ä¸­ï¼Œcatchæ–¹æ³•æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºåé¢æ²¡æœ‰åˆ«çš„catchæ–¹æ³•äº†ï¼Œå¯¼è‡´è¿™ä¸ªé”™è¯¯ä¸ä¼šè¢«æ•è·ï¼Œä¹Ÿä¸ä¼šä¼ é€’åˆ°å¤–å±‚ã€‚å¦‚æœæ”¹å†™ä¸€ä¸‹ï¼Œç»“æœå°±ä¸ä¸€æ ·äº†ã€‚ 1234567891011someAsyncThing().then(function() &#123; return someOtherAsyncThing();&#125;).catch(function(error) &#123; console.log('oh no', error); // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºyæ²¡æœ‰å£°æ˜ y + 2;&#125;).catch(function(error) &#123; console.log('carry on', error);&#125;);// oh no [ReferenceError: x is not defined]// carry on [ReferenceError: y is not defined] ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬äºŒä¸ªcatchæ–¹æ³•ç”¨æ¥æ•è·ï¼Œå‰ä¸€ä¸ªcatchæ–¹æ³•æŠ›å‡ºçš„é”™è¯¯ã€‚ Promise.all()Promise.allæ–¹æ³•ç”¨äºå°†å¤šä¸ªPromiseå®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ã€‚ 1var p = Promise.all([p1, p2, p3]); ä¸Šé¢ä»£ç ä¸­ï¼ŒPromise.allæ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œp1ã€p2ã€p3éƒ½æ˜¯Promiseå¯¹è±¡çš„å®ä¾‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šå…ˆè°ƒç”¨ä¸‹é¢è®²åˆ°çš„Promise.resolveæ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸ºPromiseå®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚ï¼ˆPromise.allæ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰Iteratoræ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯Promiseå®ä¾‹ã€‚ï¼‰ pçš„çŠ¶æ€ç”±p1ã€p2ã€p3å†³å®šï¼Œåˆ†æˆä¸¤ç§æƒ…å†µã€‚ ï¼ˆ1ï¼‰åªæœ‰p1ã€p2ã€p3çš„çŠ¶æ€éƒ½å˜æˆfulfilledï¼Œpçš„çŠ¶æ€æ‰ä¼šå˜æˆfulfilledï¼Œæ­¤æ—¶p1ã€p2ã€p3çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°ã€‚ ï¼ˆ2ï¼‰åªè¦p1ã€p2ã€p3ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«rejectedï¼Œpçš„çŠ¶æ€å°±å˜æˆrejectedï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«rejectçš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚ 12345678910// ç”Ÿæˆä¸€ä¸ªPromiseå¯¹è±¡çš„æ•°ç»„var promises = [2, 3, 5, 7, 11, 13].map(function (id) &#123; return getJSON(\"/post/\" + id + \".json\");&#125;);Promise.all(promises).then(function (posts) &#123; // ...&#125;).catch(function(reason)&#123; // ...&#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œpromisesæ˜¯åŒ…å«6ä¸ªPromiseå®ä¾‹çš„æ•°ç»„ï¼Œåªæœ‰è¿™6ä¸ªå®ä¾‹çš„çŠ¶æ€éƒ½å˜æˆfulfilledï¼Œæˆ–è€…å…¶ä¸­æœ‰ä¸€ä¸ªå˜ä¸ºrejectedï¼Œæ‰ä¼šè°ƒç”¨Promise.allæ–¹æ³•åé¢çš„å›è°ƒå‡½æ•°ã€‚ ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚ 12345678910111213const databasePromise = connectDatabase();const booksPromise = databaseProimse .then(findAllBooks);const userPromise = databasePromise .then(getCurrentUser);Promise.all([ booksPromise, userPromise]).then(([books, user]) =&gt; pickTopRecommentations(books, user)); ä¸Šé¢ä»£ç ä¸­ï¼ŒbooksPromiseå’ŒuserPromiseæ˜¯ä¸¤ä¸ªå¼‚æ­¥æ“ä½œï¼Œåªæœ‰ç­‰åˆ°å®ƒä»¬çš„ç»“æœéƒ½è¿”å›äº†ï¼Œæ‰ä¼šè§¦å‘pickTopRecommentationsè¿™ä¸ªå›è°ƒå‡½æ•°ã€‚ Promise.race()Promise.raceæ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ªPromiseå®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ã€‚ 1var p = Promise.race([p1, p2, p3]); ä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦p1ã€p2ã€p3ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œpçš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°ã€‚ Promise.raceæ–¹æ³•çš„å‚æ•°ä¸Promise.allæ–¹æ³•ä¸€æ ·ï¼Œå¦‚æœä¸æ˜¯ Promise å®ä¾‹ï¼Œå°±ä¼šå…ˆè°ƒç”¨ä¸‹é¢è®²åˆ°çš„Promise.resolveæ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º Promise å®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœæŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è·å¾—ç»“æœï¼Œå°±å°†Promiseçš„çŠ¶æ€å˜ä¸ºrejectï¼Œå¦åˆ™å˜ä¸ºresolveã€‚ 12345678var p = Promise.race([ fetch('/resource-that-may-take-a-while'), new Promise(function (resolve, reject) &#123; setTimeout(() =&gt; reject(new Error('request timeout')), 5000) &#125;)])p.then(response =&gt; console.log(response))p.catch(error =&gt; console.log(error)) ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœ5ç§’ä¹‹å†…fetchæ–¹æ³•æ— æ³•è¿”å›ç»“æœï¼Œå˜é‡pçš„çŠ¶æ€å°±ä¼šå˜ä¸ºrejectedï¼Œä»è€Œè§¦å‘catchæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚ Promise.resolve()æœ‰æ—¶éœ€è¦å°†ç°æœ‰å¯¹è±¡è½¬ä¸ºPromiseå¯¹è±¡ï¼ŒPromise.resolveæ–¹æ³•å°±èµ·åˆ°è¿™ä¸ªä½œç”¨ã€‚ 1var jsPromise = Promise.resolve($.ajax('/whatever.json')); ä¸Šé¢ä»£ç å°†jQueryç”Ÿæˆçš„deferredå¯¹è±¡ï¼Œè½¬ä¸ºä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ã€‚ Promise.resolveç­‰ä»·äºä¸‹é¢çš„å†™æ³•ã€‚ 123Promise.resolve('foo')// ç­‰ä»·äºnew Promise(resolve =&gt; resolve('foo')) Promise.resolveæ–¹æ³•çš„å‚æ•°åˆ†æˆå››ç§æƒ…å†µã€‚ ï¼ˆ1ï¼‰å‚æ•°æ˜¯ä¸€ä¸ªPromiseå®ä¾‹ å¦‚æœå‚æ•°æ˜¯Promiseå®ä¾‹ï¼Œé‚£ä¹ˆPromise.resolveå°†ä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå®ä¾‹ã€‚ ï¼ˆ2ï¼‰å‚æ•°æ˜¯ä¸€ä¸ªthenableå¯¹è±¡ thenableå¯¹è±¡æŒ‡çš„æ˜¯å…·æœ‰thenæ–¹æ³•çš„å¯¹è±¡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå¯¹è±¡ã€‚ 12345let thenable = &#123; then: function(resolve, reject) &#123; resolve(42); &#125;&#125;; Promise.resolveæ–¹æ³•ä¼šå°†è¿™ä¸ªå¯¹è±¡è½¬ä¸ºPromiseå¯¹è±¡ï¼Œç„¶åå°±ç«‹å³æ‰§è¡Œthenableå¯¹è±¡çš„thenæ–¹æ³•ã€‚ 12345678910let thenable = &#123; then: function(resolve, reject) &#123; resolve(42); &#125;&#125;;let p1 = Promise.resolve(thenable);p1.then(function(value) &#123; console.log(value); // 42&#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œthenableå¯¹è±¡çš„thenæ–¹æ³•æ‰§è¡Œåï¼Œå¯¹è±¡p1çš„çŠ¶æ€å°±å˜ä¸ºresolvedï¼Œä»è€Œç«‹å³æ‰§è¡Œæœ€åé‚£ä¸ªthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œè¾“å‡º42ã€‚ ï¼ˆ3ï¼‰å‚æ•°ä¸æ˜¯å…·æœ‰thenæ–¹æ³•çš„å¯¹è±¡ï¼Œæˆ–æ ¹æœ¬å°±ä¸æ˜¯å¯¹è±¡ å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªä¸å…·æœ‰thenæ–¹æ³•çš„å¯¹è±¡ï¼Œåˆ™Promise.resolveæ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ï¼ŒçŠ¶æ€ä¸ºResolvedã€‚ 123456var p = Promise.resolve('Hello');p.then(function (s)&#123; console.log(s)&#125;);// Hello ä¸Šé¢ä»£ç ç”Ÿæˆä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡çš„å®ä¾‹pã€‚ç”±äºå­—ç¬¦ä¸²Helloä¸å±äºå¼‚æ­¥æ“ä½œï¼ˆåˆ¤æ–­æ–¹æ³•æ˜¯å®ƒä¸æ˜¯å…·æœ‰thenæ–¹æ³•çš„å¯¹è±¡ï¼‰ï¼Œè¿”å›Promiseå®ä¾‹çš„çŠ¶æ€ä»ä¸€ç”Ÿæˆå°±æ˜¯Resolvedï¼Œæ‰€ä»¥å›è°ƒå‡½æ•°ä¼šç«‹å³æ‰§è¡Œã€‚Promise.resolveæ–¹æ³•çš„å‚æ•°ï¼Œä¼šåŒæ—¶ä¼ ç»™å›è°ƒå‡½æ•°ã€‚ ï¼ˆ4ï¼‰ä¸å¸¦æœ‰ä»»ä½•å‚æ•° Promise.resolveæ–¹æ³•å…è®¸è°ƒç”¨æ—¶ä¸å¸¦å‚æ•°ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªResolvedçŠ¶æ€çš„Promiseå¯¹è±¡ã€‚ æ‰€ä»¥ï¼Œå¦‚æœå¸Œæœ›å¾—åˆ°ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œæ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•å°±æ˜¯ç›´æ¥è°ƒç”¨Promise.resolveæ–¹æ³•ã€‚ 12345var p = Promise.resolve();p.then(function () &#123; // ...&#125;); ä¸Šé¢ä»£ç çš„å˜é‡på°±æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç«‹å³resolveçš„Promiseå¯¹è±¡ï¼Œæ˜¯åœ¨æœ¬è½®â€œäº‹ä»¶å¾ªç¯â€ï¼ˆevent loopï¼‰çš„ç»“æŸæ—¶ï¼Œè€Œä¸æ˜¯åœ¨ä¸‹ä¸€è½®â€œäº‹ä»¶å¾ªç¯â€çš„å¼€å§‹æ—¶ã€‚ 12345678910111213setTimeout(function () &#123; console.log('three');&#125;, 0);Promise.resolve().then(function () &#123; console.log('two');&#125;);console.log('one');// one// two// three ä¸Šé¢ä»£ç ä¸­ï¼ŒsetTimeout(fn, 0)åœ¨ä¸‹ä¸€è½®â€œäº‹ä»¶å¾ªç¯â€å¼€å§‹æ—¶æ‰§è¡Œï¼ŒPromise.resolve()åœ¨æœ¬è½®â€œäº‹ä»¶å¾ªç¯â€ç»“æŸæ—¶æ‰§è¡Œï¼Œconsole.log(â€™oneâ€˜)åˆ™æ˜¯ç«‹å³æ‰§è¡Œï¼Œå› æ­¤æœ€å…ˆè¾“å‡ºã€‚ Promise.reject()Promise.reject(reason)æ–¹æ³•ä¹Ÿä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼Œè¯¥å®ä¾‹çš„çŠ¶æ€ä¸ºrejectedã€‚ 12345678var p = Promise.reject('å‡ºé”™äº†');// ç­‰åŒäºvar p = new Promise((resolve, reject) =&gt; reject('å‡ºé”™äº†'))p.then(null, function (s) &#123; console.log(s)&#125;);// å‡ºé”™äº† ä¸Šé¢ä»£ç ç”Ÿæˆä¸€ä¸ªPromiseå¯¹è±¡çš„å®ä¾‹pï¼ŒçŠ¶æ€ä¸ºrejectedï¼Œå›è°ƒå‡½æ•°ä¼šç«‹å³æ‰§è¡Œã€‚ æ³¨æ„ï¼ŒPromise.reject()æ–¹æ³•çš„å‚æ•°ï¼Œä¼šåŸå°ä¸åŠ¨åœ°ä½œä¸ºrejectçš„ç†ç”±ï¼Œå˜æˆåç»­æ–¹æ³•çš„å‚æ•°ã€‚è¿™ä¸€ç‚¹ä¸Promise.resolveæ–¹æ³•ä¸ä¸€è‡´ã€‚ 1234567891011const thenable = &#123; then(resolve, reject) &#123; reject('å‡ºé”™äº†'); &#125;&#125;;Promise.reject(thenable).catch(e =&gt; &#123; console.log(e === thenable)&#125;)// true ä¸Šé¢ä»£ç ä¸­ï¼ŒPromise.rejectæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªthenableå¯¹è±¡ï¼Œæ‰§è¡Œä»¥åï¼Œåé¢catchæ–¹æ³•çš„å‚æ•°ä¸æ˜¯rejectæŠ›å‡ºçš„â€œå‡ºé”™äº†â€è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯thenableå¯¹è±¡ã€‚ ä¸¤ä¸ªæœ‰ç”¨çš„é™„åŠ æ–¹æ³•ES6çš„Promise APIæä¾›çš„æ–¹æ³•ä¸æ˜¯å¾ˆå¤šï¼Œæœ‰äº›æœ‰ç”¨çš„æ–¹æ³•å¯ä»¥è‡ªå·±éƒ¨ç½²ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•éƒ¨ç½²ä¸¤ä¸ªä¸åœ¨ES6ä¹‹ä¸­ã€ä½†å¾ˆæœ‰ç”¨çš„æ–¹æ³•ã€‚ done()Promiseå¯¹è±¡çš„å›è°ƒé“¾ï¼Œä¸ç®¡ä»¥thenæ–¹æ³•æˆ–catchæ–¹æ³•ç»“å°¾ï¼Œè¦æ˜¯æœ€åä¸€ä¸ªæ–¹æ³•æŠ›å‡ºé”™è¯¯ï¼Œéƒ½æœ‰å¯èƒ½æ— æ³•æ•æ‰åˆ°ï¼ˆå› ä¸ºPromiseå†…éƒ¨çš„é”™è¯¯ä¸ä¼šå†’æ³¡åˆ°å…¨å±€ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªdoneæ–¹æ³•ï¼Œæ€»æ˜¯å¤„äºå›è°ƒé“¾çš„å°¾ç«¯ï¼Œä¿è¯æŠ›å‡ºä»»ä½•å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚ 12345asyncFunc() .then(f1) .catch(r1) .then(f2) .done(); å®ƒçš„å®ç°ä»£ç ç›¸å½“ç®€å•ã€‚ 1234567Promise.prototype.done = function (onFulfilled, onRejected) &#123; this.then(onFulfilled, onRejected) .catch(function (reason) &#123; // æŠ›å‡ºä¸€ä¸ªå…¨å±€é”™è¯¯ setTimeout(() =&gt; &#123; throw reason &#125;, 0); &#125;);&#125;; ä»ä¸Šé¢ä»£ç å¯è§ï¼Œdoneæ–¹æ³•çš„ä½¿ç”¨ï¼Œå¯ä»¥åƒthenæ–¹æ³•é‚£æ ·ç”¨ï¼Œæä¾›Fulfilledå’ŒRejectedçŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä¸æä¾›ä»»ä½•å‚æ•°ã€‚ä½†ä¸ç®¡æ€æ ·ï¼Œdoneéƒ½ä¼šæ•æ‰åˆ°ä»»ä½•å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œå¹¶å‘å…¨å±€æŠ›å‡ºã€‚ finally()finallyæ–¹æ³•ç”¨äºæŒ‡å®šä¸ç®¡Promiseå¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚å®ƒä¸doneæ–¹æ³•çš„æœ€å¤§åŒºåˆ«ï¼Œå®ƒæ¥å—ä¸€ä¸ªæ™®é€šçš„å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¸ç®¡æ€æ ·éƒ½å¿…é¡»æ‰§è¡Œã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼ŒæœåŠ¡å™¨ä½¿ç”¨Promiseå¤„ç†è¯·æ±‚ï¼Œç„¶åä½¿ç”¨finallyæ–¹æ³•å…³æ‰æœåŠ¡å™¨ã€‚ 12345server.listen(0) .then(function () &#123; // run test &#125;) .finally(server.stop); å®ƒçš„å®ç°ä¹Ÿå¾ˆç®€å•ã€‚ 1234567Promise.prototype.finally = function (callback) &#123; let P = this.constructor; return this.then( value =&gt; P.resolve(callback()).then(() =&gt; value), reason =&gt; P.resolve(callback()).then(() =&gt; &#123; throw reason &#125;) );&#125;; ä¸Šé¢ä»£ç ä¸­ï¼Œä¸ç®¡å‰é¢çš„Promiseæ˜¯fulfilledè¿˜æ˜¯rejectedï¼Œéƒ½ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°callbackã€‚ æ›´å¤šITæŠ€æœ¯åˆ†äº«å°½åœ¨ ğŸ”—æ¶µæœˆå¤©-microzz.com åº”ç”¨åŠ è½½å›¾ç‰‡æˆ‘ä»¬å¯ä»¥å°†å›¾ç‰‡çš„åŠ è½½å†™æˆä¸€ä¸ªPromiseï¼Œä¸€æ—¦åŠ è½½å®Œæˆï¼ŒPromiseçš„çŠ¶æ€å°±å‘ç”Ÿå˜åŒ–ã€‚ 12345678const preloadImage = function (path) &#123; return new Promise(function (resolve, reject) &#123; var image = new Image(); image.onload = resolve; image.onerror = reject; image.src = path; &#125;);&#125;; Generatorå‡½æ•°ä¸Promiseçš„ç»“åˆä½¿ç”¨Generatorå‡½æ•°ç®¡ç†æµç¨‹ï¼Œé‡åˆ°å¼‚æ­¥æ“ä½œçš„æ—¶å€™ï¼Œé€šå¸¸è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ã€‚ 1234567891011121314151617181920212223242526272829303132function getFoo () &#123; return new Promise(function (resolve, reject)&#123; resolve('foo'); &#125;);&#125;var g = function* () &#123; try &#123; var foo = yield getFoo(); console.log(foo); &#125; catch (e) &#123; console.log(e); &#125;&#125;;function run (generator) &#123; var it = generator(); function go(result) &#123; if (result.done) return result.value; return result.value.then(function (value) &#123; return go(it.next(value)); &#125;, function (error) &#123; return go(it.throw(error)); &#125;); &#125; go(it.next());&#125;run(g); ä¸Šé¢ä»£ç çš„Generatorå‡½æ•°gä¹‹ä¸­ï¼Œæœ‰ä¸€ä¸ªå¼‚æ­¥æ“ä½œgetFooï¼Œå®ƒè¿”å›çš„å°±æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚å‡½æ•°runç”¨æ¥å¤„ç†è¿™ä¸ªPromiseå¯¹è±¡ï¼Œå¹¶è°ƒç”¨ä¸‹ä¸€ä¸ªnextæ–¹æ³•ã€‚ Promise.try()å®é™…å¼€å‘ä¸­ï¼Œç»å¸¸é‡åˆ°ä¸€ç§æƒ…å†µï¼šä¸çŸ¥é“æˆ–è€…ä¸æƒ³åŒºåˆ†ï¼Œå‡½æ•°fæ˜¯åŒæ­¥å‡½æ•°è¿˜æ˜¯å¼‚æ­¥æ“ä½œï¼Œä½†æ˜¯æƒ³ç”¨ Promise æ¥å¤„ç†å®ƒã€‚å› ä¸ºè¿™æ ·å°±å¯ä»¥ä¸ç®¡fæ˜¯å¦åŒ…å«å¼‚æ­¥æ“ä½œï¼Œéƒ½ç”¨thenæ–¹æ³•æŒ‡å®šä¸‹ä¸€æ­¥æµç¨‹ï¼Œç”¨catchæ–¹æ³•å¤„ç†fæŠ›å‡ºçš„é”™è¯¯ã€‚ä¸€èˆ¬å°±ä¼šé‡‡ç”¨ä¸‹é¢çš„å†™æ³•ã€‚ 1Promise.resolve().then(f) ä¸Šé¢çš„å†™æ³•æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å¦‚æœfæ˜¯åŒæ­¥å‡½æ•°ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨æœ¬è½®äº‹ä»¶å¾ªç¯çš„æœ«å°¾æ‰§è¡Œã€‚ 12345const f = () =&gt; console.log('now');Promise.resolve().then(f);console.log('next');// next// now ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°fæ˜¯åŒæ­¥çš„ï¼Œä½†æ˜¯ç”¨ Promise åŒ…è£…äº†ä»¥åï¼Œå°±å˜æˆå¼‚æ­¥æ‰§è¡Œäº†ã€‚ é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•ï¼Œè®©åŒæ­¥å‡½æ•°åŒæ­¥æ‰§è¡Œï¼Œå¼‚æ­¥å‡½æ•°å¼‚æ­¥æ‰§è¡Œï¼Œå¹¶ä¸”è®©å®ƒä»¬å…·æœ‰ç»Ÿä¸€çš„ API å‘¢ï¼Ÿå›ç­”æ˜¯å¯ä»¥çš„ï¼Œå¹¶ä¸”è¿˜æœ‰ä¸¤ç§å†™æ³•ã€‚ç¬¬ä¸€ç§å†™æ³•æ˜¯ç”¨asyncå‡½æ•°æ¥å†™ã€‚ 12345const f = () =&gt; console.log('now');(async () =&gt; f())();console.log('next');// now// next ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬äºŒè¡Œæ˜¯ä¸€ä¸ªç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°ï¼Œä¼šç«‹å³æ‰§è¡Œé‡Œé¢çš„asyncå‡½æ•°ï¼Œå› æ­¤å¦‚æœfæ˜¯åŒæ­¥çš„ï¼Œå°±ä¼šå¾—åˆ°åŒæ­¥çš„ç»“æœï¼›å¦‚æœfæ˜¯å¼‚æ­¥çš„ï¼Œå°±å¯ä»¥ç”¨thenæŒ‡å®šä¸‹ä¸€æ­¥ï¼Œå°±åƒä¸‹é¢çš„å†™æ³•ã€‚ 12(async () =&gt; f())().then(...) éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œasync () =&gt; f()ä¼šåƒæ‰f()æŠ›å‡ºçš„é”™è¯¯ã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³æ•è·é”™è¯¯ï¼Œè¦ä½¿ç”¨promise.catchæ–¹æ³•ã€‚ 123(async () =&gt; f())().then(...).catch(...) ç¬¬äºŒç§å†™æ³•æ˜¯ä½¿ç”¨new Promise()ã€‚ 123456789const f = () =&gt; console.log('now');( () =&gt; new Promise( resolve =&gt; resolve(f()) ))();console.log('next');// now// next ä¸Šé¢ä»£ç ä¹Ÿæ˜¯ä½¿ç”¨ç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°ï¼Œæ‰§è¡Œnew Promise()ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒåŒæ­¥å‡½æ•°ä¹Ÿæ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚ é‰´äºè¿™æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œæ‰€ä»¥ç°åœ¨æœ‰ä¸€ä¸ªææ¡ˆï¼Œæä¾›Promise.tryæ–¹æ³•æ›¿ä»£ä¸Šé¢çš„å†™æ³•ã€‚ 12345const f = () =&gt; console.log('now');Promise.try(f);console.log('next');// now// next äº‹å®ä¸Šï¼ŒPromise.tryå­˜åœ¨å·²ä¹…ï¼ŒPromise åº“Bluebirdã€Qå’Œwhenï¼Œæ—©å°±æä¾›äº†è¿™ä¸ªæ–¹æ³•ã€‚ ç”±äºPromise.tryä¸ºæ‰€æœ‰æ“ä½œæä¾›äº†ç»Ÿä¸€çš„å¤„ç†æœºåˆ¶ï¼Œæ‰€ä»¥å¦‚æœæƒ³ç”¨thenæ–¹æ³•ç®¡ç†æµç¨‹ï¼Œæœ€å¥½éƒ½ç”¨Promise.tryåŒ…è£…ä¸€ä¸‹ã€‚è¿™æ ·æœ‰è®¸å¤šå¥½å¤„ï¼Œå…¶ä¸­ä¸€ç‚¹å°±æ˜¯å¯ä»¥æ›´å¥½åœ°ç®¡ç†å¼‚å¸¸ã€‚ 123456function getUsername(userId) &#123; return database.users.get(&#123;id: userId&#125;) .then(function(user) &#123; return user.name; &#125;);&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œdatabase.users.get()è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¦‚æœæŠ›å‡ºå¼‚æ­¥é”™è¯¯ï¼Œå¯ä»¥ç”¨catchæ–¹æ³•æ•è·ï¼Œå°±åƒä¸‹é¢è¿™æ ·å†™ã€‚ 123database.users.get(&#123;id: userId&#125;).then(...).catch(...) ä½†æ˜¯database.users.get()å¯èƒ½è¿˜ä¼šæŠ›å‡ºåŒæ­¥é”™è¯¯ï¼ˆæ¯”å¦‚æ•°æ®åº“è¿æ¥é”™è¯¯ï¼Œå…·ä½“è¦çœ‹å®ç°æ–¹æ³•ï¼‰ï¼Œè¿™æ—¶ä½ å°±ä¸å¾—ä¸ç”¨try...catchå»æ•è·ã€‚ 1234567try &#123; database.users.get(&#123;id: userId&#125;) .then(...) .catch(...)&#125; catch (e) &#123; // ...&#125; ä¸Šé¢è¿™æ ·çš„å†™æ³•å°±å¾ˆç¬¨æ‹™äº†ï¼Œè¿™æ—¶å°±å¯ä»¥ç»Ÿä¸€ç”¨promise.catch()æ•è·æ‰€æœ‰åŒæ­¥å’Œå¼‚æ­¥çš„é”™è¯¯ã€‚ 123Promise.try(database.users.get(&#123;id: userId&#125;)) .then(...) .catch(...) äº‹å®ä¸Šï¼ŒPromise.tryå°±æ˜¯æ¨¡æ‹Ÿtryä»£ç å—ï¼Œå°±åƒpromise.catchæ¨¡æ‹Ÿçš„æ˜¯catchä»£ç å—ã€‚","tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"ECMAScript","slug":"ECMAScript","permalink":"http://microzz.com/tags/ECMAScript/"},{"name":"Promise","slug":"Promise","permalink":"http://microzz.com/tags/Promise/"}]},{"title":"Generator å‡½æ•°","date":"2017-01-13T06:51:58.000Z","path":"2017/01/13/generator/","text":"Generator å‡½æ•°ç®€ä»‹åŸºæœ¬æ¦‚å¿µGeneratorå‡½æ•°æ˜¯ES6æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œè¯­æ³•è¡Œä¸ºä¸ä¼ ç»Ÿå‡½æ•°å®Œå…¨ä¸åŒã€‚æœ¬ç« è¯¦ç»†ä»‹ç»Generatorå‡½æ•°çš„è¯­æ³•å’ŒAPIï¼Œå®ƒçš„å¼‚æ­¥ç¼–ç¨‹åº”ç”¨è¯·çœ‹ã€Šå¼‚æ­¥æ“ä½œã€‹ä¸€ç« ã€‚ Generatorå‡½æ•°æœ‰å¤šç§ç†è§£è§’åº¦ã€‚ä»è¯­æ³•ä¸Šï¼Œé¦–å…ˆå¯ä»¥æŠŠå®ƒç†è§£æˆï¼ŒGeneratorå‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚ æ‰§è¡ŒGeneratorå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒGeneratorå‡½æ•°é™¤äº†çŠ¶æ€æœºï¼Œè¿˜æ˜¯ä¸€ä¸ªéå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ã€‚è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå†Generatorå‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚ å½¢å¼ä¸Šï¼ŒGeneratorå‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç‰¹å¾ã€‚ä¸€æ˜¯ï¼Œfunctionå…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå·ï¼›äºŒæ˜¯ï¼Œå‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨yieldè¯­å¥ï¼Œå®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€ï¼ˆyieldè¯­å¥åœ¨è‹±è¯­é‡Œçš„æ„æ€å°±æ˜¯â€œäº§å‡ºâ€ï¼‰ã€‚ 1234567function* helloWorldGenerator() &#123; yield 'hello'; yield 'world'; return 'ending';&#125;var hw = helloWorldGenerator(); ä¸Šé¢ä»£ç å®šä¹‰äº†ä¸€ä¸ªGeneratorå‡½æ•°helloWorldGeneratorï¼Œå®ƒå†…éƒ¨æœ‰ä¸¤ä¸ªyieldè¯­å¥â€œhelloâ€å’Œâ€œworldâ€ï¼Œå³è¯¥å‡½æ•°æœ‰ä¸‰ä¸ªçŠ¶æ€ï¼šhelloï¼Œworldå’Œreturnè¯­å¥ï¼ˆç»“æŸæ‰§è¡Œï¼‰ã€‚ ç„¶åï¼ŒGeneratorå‡½æ•°çš„è°ƒç”¨æ–¹æ³•ä¸æ™®é€šå‡½æ•°ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨å‡½æ•°ååé¢åŠ ä¸Šä¸€å¯¹åœ†æ‹¬å·ã€‚ä¸åŒçš„æ˜¯ï¼Œè°ƒç”¨Generatorå‡½æ•°åï¼Œè¯¥å‡½æ•°å¹¶ä¸æ‰§è¡Œï¼Œè¿”å›çš„ä¹Ÿä¸æ˜¯å‡½æ•°è¿è¡Œç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡å‘å†…éƒ¨çŠ¶æ€çš„æŒ‡é’ˆå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€ç« ä»‹ç»çš„éå†å™¨å¯¹è±¡ï¼ˆIterator Objectï¼‰ã€‚ ä¸‹ä¸€æ­¥ï¼Œå¿…é¡»è°ƒç”¨éå†å™¨å¯¹è±¡çš„nextæ–¹æ³•ï¼Œä½¿å¾—æŒ‡é’ˆç§»å‘ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼Œå†…éƒ¨æŒ‡é’ˆå°±ä»å‡½æ•°å¤´éƒ¨æˆ–ä¸Šä¸€æ¬¡åœä¸‹æ¥çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªyieldè¯­å¥ï¼ˆæˆ–returnè¯­å¥ï¼‰ä¸ºæ­¢ã€‚æ¢è¨€ä¹‹ï¼ŒGeneratorå‡½æ•°æ˜¯åˆ†æ®µæ‰§è¡Œçš„ï¼Œyieldè¯­å¥æ˜¯æš‚åœæ‰§è¡Œçš„æ ‡è®°ï¼Œè€Œnextæ–¹æ³•å¯ä»¥æ¢å¤æ‰§è¡Œã€‚ 1234567891011hw.next()// &#123; value: 'hello', done: false &#125;hw.next()// &#123; value: 'world', done: false &#125;hw.next()// &#123; value: 'ending', done: true &#125;hw.next()// &#123; value: undefined, done: true &#125; ä¸Šé¢ä»£ç ä¸€å…±è°ƒç”¨äº†å››æ¬¡nextæ–¹æ³•ã€‚ ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼ŒGeneratorå‡½æ•°å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ªyieldè¯­å¥ä¸ºæ­¢ã€‚nextæ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„valueå±æ€§å°±æ˜¯å½“å‰yieldè¯­å¥çš„å€¼helloï¼Œdoneå±æ€§çš„å€¼falseï¼Œè¡¨ç¤ºéå†è¿˜æ²¡æœ‰ç»“æŸã€‚ ç¬¬äºŒæ¬¡è°ƒç”¨ï¼ŒGeneratorå‡½æ•°ä»ä¸Šæ¬¡yieldè¯­å¥åœä¸‹çš„åœ°æ–¹ï¼Œä¸€ç›´æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªyieldè¯­å¥ã€‚nextæ–¹æ³•è¿”å›çš„å¯¹è±¡çš„valueå±æ€§å°±æ˜¯å½“å‰yieldè¯­å¥çš„å€¼worldï¼Œdoneå±æ€§çš„å€¼falseï¼Œè¡¨ç¤ºéå†è¿˜æ²¡æœ‰ç»“æŸã€‚ ç¬¬ä¸‰æ¬¡è°ƒç”¨ï¼ŒGeneratorå‡½æ•°ä»ä¸Šæ¬¡yieldè¯­å¥åœä¸‹çš„åœ°æ–¹ï¼Œä¸€ç›´æ‰§è¡Œåˆ°returnè¯­å¥ï¼ˆå¦‚æœæ²¡æœ‰returnè¯­å¥ï¼Œå°±æ‰§è¡Œåˆ°å‡½æ•°ç»“æŸï¼‰ã€‚nextæ–¹æ³•è¿”å›çš„å¯¹è±¡çš„valueå±æ€§ï¼Œå°±æ˜¯ç´§è·Ÿåœ¨returnè¯­å¥åé¢çš„è¡¨è¾¾å¼çš„å€¼ï¼ˆå¦‚æœæ²¡æœ‰returnè¯­å¥ï¼Œåˆ™valueå±æ€§çš„å€¼ä¸ºundefinedï¼‰ï¼Œdoneå±æ€§çš„å€¼trueï¼Œè¡¨ç¤ºéå†å·²ç»ç»“æŸã€‚ ç¬¬å››æ¬¡è°ƒç”¨ï¼Œæ­¤æ—¶Generatorå‡½æ•°å·²ç»è¿è¡Œå®Œæ¯•ï¼Œnextæ–¹æ³•è¿”å›å¯¹è±¡çš„valueå±æ€§ä¸ºundefinedï¼Œdoneå±æ€§ä¸ºtrueã€‚ä»¥åå†è°ƒç”¨nextæ–¹æ³•ï¼Œè¿”å›çš„éƒ½æ˜¯è¿™ä¸ªå€¼ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œè°ƒç”¨Generatorå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œä»£è¡¨Generatorå‡½æ•°çš„å†…éƒ¨æŒ‡é’ˆã€‚ä»¥åï¼Œæ¯æ¬¡è°ƒç”¨éå†å™¨å¯¹è±¡çš„nextæ–¹æ³•ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªæœ‰ç€valueå’Œdoneä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ã€‚valueå±æ€§è¡¨ç¤ºå½“å‰çš„å†…éƒ¨çŠ¶æ€çš„å€¼ï¼Œæ˜¯yieldè¯­å¥åé¢é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼›doneå±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éå†ç»“æŸã€‚ ES6æ²¡æœ‰è§„å®šï¼Œfunctionå…³é”®å­—ä¸å‡½æ•°åä¹‹é—´çš„æ˜Ÿå·ï¼Œå†™åœ¨å“ªä¸ªä½ç½®ã€‚è¿™å¯¼è‡´ä¸‹é¢çš„å†™æ³•éƒ½èƒ½é€šè¿‡ã€‚ 1234567function * foo(x, y) &#123; Â·Â·Â· &#125;function *foo(x, y) &#123; Â·Â·Â· &#125;function* foo(x, y) &#123; Â·Â·Â· &#125;function*foo(x, y) &#123; Â·Â·Â· &#125; ç”±äºGeneratorå‡½æ•°ä»ç„¶æ˜¯æ™®é€šå‡½æ•°ï¼Œæ‰€ä»¥ä¸€èˆ¬çš„å†™æ³•æ˜¯ä¸Šé¢çš„ç¬¬ä¸‰ç§ï¼Œå³æ˜Ÿå·ç´§è·Ÿåœ¨functionå…³é”®å­—åé¢ã€‚æœ¬ä¹¦ä¹Ÿé‡‡ç”¨è¿™ç§å†™æ³•ã€‚ yieldè¯­å¥ç”±äºGeneratorå‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œåªæœ‰è°ƒç”¨nextæ–¹æ³•æ‰ä¼šéå†ä¸‹ä¸€ä¸ªå†…éƒ¨çŠ¶æ€ï¼Œæ‰€ä»¥å…¶å®æä¾›äº†ä¸€ç§å¯ä»¥æš‚åœæ‰§è¡Œçš„å‡½æ•°ã€‚yieldè¯­å¥å°±æ˜¯æš‚åœæ ‡å¿—ã€‚ éå†å™¨å¯¹è±¡çš„nextæ–¹æ³•çš„è¿è¡Œé€»è¾‘å¦‚ä¸‹ã€‚ ï¼ˆ1ï¼‰é‡åˆ°yieldè¯­å¥ï¼Œå°±æš‚åœæ‰§è¡Œåé¢çš„æ“ä½œï¼Œå¹¶å°†ç´§è·Ÿåœ¨yieldåé¢çš„é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›çš„å¯¹è±¡çš„valueå±æ€§å€¼ã€‚ ï¼ˆ2ï¼‰ä¸‹ä¸€æ¬¡è°ƒç”¨nextæ–¹æ³•æ—¶ï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªyieldè¯­å¥ã€‚ ï¼ˆ3ï¼‰å¦‚æœæ²¡æœ‰å†é‡åˆ°æ–°çš„yieldè¯­å¥ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°å‡½æ•°ç»“æŸï¼Œç›´åˆ°returnè¯­å¥ä¸ºæ­¢ï¼Œå¹¶å°†returnè¯­å¥åé¢çš„è¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›çš„å¯¹è±¡çš„valueå±æ€§å€¼ã€‚ ï¼ˆ4ï¼‰å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰returnè¯­å¥ï¼Œåˆ™è¿”å›çš„å¯¹è±¡çš„valueå±æ€§å€¼ä¸ºundefinedã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œyieldè¯­å¥åé¢çš„è¡¨è¾¾å¼ï¼Œåªæœ‰å½“è°ƒç”¨nextæ–¹æ³•ã€å†…éƒ¨æŒ‡é’ˆæŒ‡å‘è¯¥è¯­å¥æ—¶æ‰ä¼šæ‰§è¡Œï¼Œå› æ­¤ç­‰äºä¸ºJavaScriptæä¾›äº†æ‰‹åŠ¨çš„â€œæƒ°æ€§æ±‚å€¼â€ï¼ˆLazy Evaluationï¼‰çš„è¯­æ³•åŠŸèƒ½ã€‚ 123function* gen() &#123; yield 123 + 456;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œyieldåé¢çš„è¡¨è¾¾å¼123 + 456ï¼Œä¸ä¼šç«‹å³æ±‚å€¼ï¼Œåªä¼šåœ¨nextæ–¹æ³•å°†æŒ‡é’ˆç§»åˆ°è¿™ä¸€å¥æ—¶ï¼Œæ‰ä¼šæ±‚å€¼ã€‚ yieldè¯­å¥ä¸returnè¯­å¥æ—¢æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä¹Ÿæœ‰åŒºåˆ«ã€‚ç›¸ä¼¼ä¹‹å¤„åœ¨äºï¼Œéƒ½èƒ½è¿”å›ç´§è·Ÿåœ¨è¯­å¥åé¢çš„é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚åŒºåˆ«åœ¨äºæ¯æ¬¡é‡åˆ°yieldï¼Œå‡½æ•°æš‚åœæ‰§è¡Œï¼Œä¸‹ä¸€æ¬¡å†ä»è¯¥ä½ç½®ç»§ç»­å‘åæ‰§è¡Œï¼Œè€Œreturnè¯­å¥ä¸å…·å¤‡ä½ç½®è®°å¿†çš„åŠŸèƒ½ã€‚ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œåªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼ˆæˆ–è€…è¯´ä¸€ä¸ªï¼‰returnè¯­å¥ï¼Œä½†æ˜¯å¯ä»¥æ‰§è¡Œå¤šæ¬¡ï¼ˆæˆ–è€…è¯´å¤šä¸ªï¼‰yieldè¯­å¥ã€‚æ­£å¸¸å‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå› ä¸ºåªèƒ½æ‰§è¡Œä¸€æ¬¡returnï¼›Generatorå‡½æ•°å¯ä»¥è¿”å›ä¸€ç³»åˆ—çš„å€¼ï¼Œå› ä¸ºå¯ä»¥æœ‰ä»»æ„å¤šä¸ªyieldã€‚ä»å¦ä¸€ä¸ªè§’åº¦çœ‹ï¼Œä¹Ÿå¯ä»¥è¯´Generatorç”Ÿæˆäº†ä¸€ç³»åˆ—çš„å€¼ï¼Œè¿™ä¹Ÿå°±æ˜¯å®ƒçš„åç§°çš„æ¥å†ï¼ˆåœ¨è‹±è¯­ä¸­ï¼Œgeneratorè¿™ä¸ªè¯æ˜¯â€œç”Ÿæˆå™¨â€çš„æ„æ€ï¼‰ã€‚ Generatorå‡½æ•°å¯ä»¥ä¸ç”¨yieldè¯­å¥ï¼Œè¿™æ—¶å°±å˜æˆäº†ä¸€ä¸ªå•çº¯çš„æš‚ç¼“æ‰§è¡Œå‡½æ•°ã€‚ 123456789function* f() &#123; console.log('æ‰§è¡Œäº†ï¼')&#125;var generator = f();setTimeout(function () &#123; generator.next()&#125;, 2000); ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°få¦‚æœæ˜¯æ™®é€šå‡½æ•°ï¼Œåœ¨ä¸ºå˜é‡generatorèµ‹å€¼æ—¶å°±ä¼šæ‰§è¡Œã€‚ä½†æ˜¯ï¼Œå‡½æ•°fæ˜¯ä¸€ä¸ªGeneratorå‡½æ•°ï¼Œå°±å˜æˆåªæœ‰è°ƒç”¨nextæ–¹æ³•æ—¶ï¼Œå‡½æ•°fæ‰ä¼šæ‰§è¡Œã€‚ å¦å¤–éœ€è¦æ³¨æ„ï¼Œyieldè¯­å¥ä¸èƒ½ç”¨åœ¨æ™®é€šå‡½æ•°ä¸­ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ 1234(function ()&#123; yield 1;&#125;)()// SyntaxError: Unexpected number ä¸Šé¢ä»£ç åœ¨ä¸€ä¸ªæ™®é€šå‡½æ•°ä¸­ä½¿ç”¨yieldè¯­å¥ï¼Œç»“æœäº§ç”Ÿä¸€ä¸ªå¥æ³•é”™è¯¯ã€‚ ä¸‹é¢æ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ã€‚ 123456789101112131415var arr = [1, [[2, 3], 4], [5, 6]];var flat = function* (a) &#123; a.forEach(function (item) &#123; if (typeof item !== 'number') &#123; yield* flat(item); &#125; else &#123; yield item; &#125; &#125;&#125;;for (var f of flat(arr))&#123; console.log(f);&#125; ä¸Šé¢ä»£ç ä¹Ÿä¼šäº§ç”Ÿå¥æ³•é”™è¯¯ï¼Œå› ä¸ºforEachæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½†æ˜¯åœ¨é‡Œé¢ä½¿ç”¨äº†yieldè¯­å¥ï¼ˆè¿™ä¸ªå‡½æ•°é‡Œé¢è¿˜ä½¿ç”¨äº†yield*è¯­å¥ï¼Œè¿™é‡Œå¯ä»¥ä¸ç”¨ç†ä¼šï¼Œè¯¦ç»†è¯´æ˜è§åæ–‡ï¼‰ã€‚ä¸€ç§ä¿®æ”¹æ–¹æ³•æ˜¯æ”¹ç”¨forå¾ªç¯ã€‚ 123456789101112131415161718var arr = [1, [[2, 3], 4], [5, 6]];var flat = function* (a) &#123; var length = a.length; for (var i = 0; i &lt; length; i++) &#123; var item = a[i]; if (typeof item !== 'number') &#123; yield* flat(item); &#125; else &#123; yield item; &#125; &#125;&#125;;for (var f of flat(arr)) &#123; console.log(f);&#125;// 1, 2, 3, 4, 5, 6 å¦å¤–ï¼Œyieldè¯­å¥å¦‚æœç”¨åœ¨ä¸€ä¸ªè¡¨è¾¾å¼ä¹‹ä¸­ï¼Œå¿…é¡»æ”¾åœ¨åœ†æ‹¬å·é‡Œé¢ã€‚ 12345console.log('Hello' + yield); // SyntaxErrorconsole.log('Hello' + yield 123); // SyntaxErrorconsole.log('Hello' + (yield)); // OKconsole.log('Hello' + (yield 123)); // OK yieldè¯­å¥ç”¨ä½œå‡½æ•°å‚æ•°æˆ–èµ‹å€¼è¡¨è¾¾å¼çš„å³è¾¹ï¼Œå¯ä»¥ä¸åŠ æ‹¬å·ã€‚ 12foo(yield 'a', yield 'b'); // OKlet input = yield; // OK ä¸Iteratoræ¥å£çš„å…³ç³»ä¸Šä¸€ç« è¯´è¿‡ï¼Œä»»æ„ä¸€ä¸ªå¯¹è±¡çš„Symbol.iteratoræ–¹æ³•ï¼Œç­‰äºè¯¥å¯¹è±¡çš„éå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°ä¼šè¿”å›è¯¥å¯¹è±¡çš„ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚ ç”±äºGeneratorå‡½æ•°å°±æ˜¯éå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œå› æ­¤å¯ä»¥æŠŠGeneratorèµ‹å€¼ç»™å¯¹è±¡çš„Symbol.iteratorå±æ€§ï¼Œä»è€Œä½¿å¾—è¯¥å¯¹è±¡å…·æœ‰Iteratoræ¥å£ã€‚ 12345678var myIterable = &#123;&#125;;myIterable[Symbol.iterator] = function* () &#123; yield 1; yield 2; yield 3;&#125;;[...myIterable] // [1, 2, 3] ä¸Šé¢ä»£ç ä¸­ï¼ŒGeneratorå‡½æ•°èµ‹å€¼ç»™Symbol.iteratorå±æ€§ï¼Œä»è€Œä½¿å¾—myIterableå¯¹è±¡å…·æœ‰äº†Iteratoræ¥å£ï¼Œå¯ä»¥è¢«...è¿ç®—ç¬¦éå†äº†ã€‚ Generatorå‡½æ•°æ‰§è¡Œåï¼Œè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚è¯¥å¯¹è±¡æœ¬èº«ä¹Ÿå…·æœ‰Symbol.iteratorå±æ€§ï¼Œæ‰§è¡Œåè¿”å›è‡ªèº«ã€‚ 12345678function* gen()&#123; // some code&#125;var g = gen();g[Symbol.iterator]() === g// true ä¸Šé¢ä»£ç ä¸­ï¼Œgenæ˜¯ä¸€ä¸ªGeneratorå‡½æ•°ï¼Œè°ƒç”¨å®ƒä¼šç”Ÿæˆä¸€ä¸ªéå†å™¨å¯¹è±¡gã€‚å®ƒçš„Symbol.iteratorå±æ€§ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ï¼Œæ‰§è¡Œåè¿”å›å®ƒè‡ªå·±ã€‚ nextæ–¹æ³•çš„å‚æ•°yieldå¥æœ¬èº«æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è€…è¯´æ€»æ˜¯è¿”å›undefinedã€‚nextæ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å°±ä¼šè¢«å½“ä½œä¸Šä¸€ä¸ªyieldè¯­å¥çš„è¿”å›å€¼ã€‚ 123456789101112function* f() &#123; for(var i = 0; true; i++) &#123; var reset = yield i; if(reset) &#123; i = -1; &#125; &#125;&#125;var g = f();g.next() // &#123; value: 0, done: false &#125;g.next() // &#123; value: 1, done: false &#125;g.next(true) // &#123; value: 0, done: false &#125; ä¸Šé¢ä»£ç å…ˆå®šä¹‰äº†ä¸€ä¸ªå¯ä»¥æ— é™è¿è¡Œçš„ Generator å‡½æ•°fï¼Œå¦‚æœnextæ–¹æ³•æ²¡æœ‰å‚æ•°ï¼Œæ¯æ¬¡è¿è¡Œåˆ°yieldè¯­å¥ï¼Œå˜é‡resetçš„å€¼æ€»æ˜¯undefinedã€‚å½“nextæ–¹æ³•å¸¦ä¸€ä¸ªå‚æ•°trueæ—¶ï¼Œå˜é‡resetå°±è¢«é‡ç½®ä¸ºè¿™ä¸ªå‚æ•°ï¼ˆå³trueï¼‰ï¼Œå› æ­¤iä¼šç­‰äº-1ï¼Œä¸‹ä¸€è½®å¾ªç¯å°±ä¼šä»-1å¼€å§‹é€’å¢ã€‚ è¿™ä¸ªåŠŸèƒ½æœ‰å¾ˆé‡è¦çš„è¯­æ³•æ„ä¹‰ã€‚Generator å‡½æ•°ä»æš‚åœçŠ¶æ€åˆ°æ¢å¤è¿è¡Œï¼Œå®ƒçš„ä¸Šä¸‹æ–‡çŠ¶æ€ï¼ˆcontextï¼‰æ˜¯ä¸å˜çš„ã€‚é€šè¿‡nextæ–¹æ³•çš„å‚æ•°ï¼Œå°±æœ‰åŠæ³•åœ¨ Generator å‡½æ•°å¼€å§‹è¿è¡Œä¹‹åï¼Œç»§ç»­å‘å‡½æ•°ä½“å†…éƒ¨æ³¨å…¥å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥åœ¨ Generator å‡½æ•°è¿è¡Œçš„ä¸åŒé˜¶æ®µï¼Œä»å¤–éƒ¨å‘å†…éƒ¨æ³¨å…¥ä¸åŒçš„å€¼ï¼Œä»è€Œè°ƒæ•´å‡½æ•°è¡Œä¸ºã€‚ å†çœ‹ä¸€ä¸ªä¾‹å­ã€‚ 123456789101112131415function* foo(x) &#123; var y = 2 * (yield (x + 1)); var z = yield (y / 3); return (x + y + z);&#125;var a = foo(5);a.next() // Object&#123;value:6, done:false&#125;a.next() // Object&#123;value:NaN, done:false&#125;a.next() // Object&#123;value:NaN, done:true&#125;var b = foo(5);b.next() // &#123; value:6, done:false &#125;b.next(12) // &#123; value:8, done:false &#125;b.next(13) // &#123; value:42, done:true &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬äºŒæ¬¡è¿è¡Œnextæ–¹æ³•çš„æ—¶å€™ä¸å¸¦å‚æ•°ï¼Œå¯¼è‡´yçš„å€¼ç­‰äº2 * undefinedï¼ˆå³NaNï¼‰ï¼Œé™¤ä»¥3ä»¥åè¿˜æ˜¯NaNï¼Œå› æ­¤è¿”å›å¯¹è±¡çš„valueå±æ€§ä¹Ÿç­‰äºNaNã€‚ç¬¬ä¸‰æ¬¡è¿è¡ŒNextæ–¹æ³•çš„æ—¶å€™ä¸å¸¦å‚æ•°ï¼Œæ‰€ä»¥zç­‰äºundefinedï¼Œè¿”å›å¯¹è±¡çš„valueå±æ€§ç­‰äº5 + NaN + undefinedï¼Œå³NaNã€‚ å¦‚æœå‘nextæ–¹æ³•æä¾›å‚æ•°ï¼Œè¿”å›ç»“æœå°±å®Œå…¨ä¸ä¸€æ ·äº†ã€‚ä¸Šé¢ä»£ç ç¬¬ä¸€æ¬¡è°ƒç”¨bçš„nextæ–¹æ³•æ—¶ï¼Œè¿”å›x+1çš„å€¼6ï¼›ç¬¬äºŒæ¬¡è°ƒç”¨nextæ–¹æ³•ï¼Œå°†ä¸Šä¸€æ¬¡yieldè¯­å¥çš„å€¼è®¾ä¸º12ï¼Œå› æ­¤yç­‰äº24ï¼Œè¿”å›y / 3çš„å€¼8ï¼›ç¬¬ä¸‰æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼Œå°†ä¸Šä¸€æ¬¡yieldè¯­å¥çš„å€¼è®¾ä¸º13ï¼Œå› æ­¤zç­‰äº13ï¼Œè¿™æ—¶xç­‰äº5ï¼Œyç­‰äº24ï¼Œæ‰€ä»¥returnè¯­å¥çš„å€¼ç­‰äº42ã€‚ æ³¨æ„ï¼Œç”±äºnextæ–¹æ³•çš„å‚æ•°è¡¨ç¤ºä¸Šä¸€ä¸ªyieldè¯­å¥çš„è¿”å›å€¼ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡ä½¿ç”¨nextæ–¹æ³•æ—¶ï¼Œä¸èƒ½å¸¦æœ‰å‚æ•°ã€‚V8å¼•æ“ç›´æ¥å¿½ç•¥ç¬¬ä¸€æ¬¡ä½¿ç”¨nextæ–¹æ³•æ—¶çš„å‚æ•°ï¼Œåªæœ‰ä»ç¬¬äºŒæ¬¡ä½¿ç”¨nextæ–¹æ³•å¼€å§‹ï¼Œå‚æ•°æ‰æ˜¯æœ‰æ•ˆçš„ã€‚ä»è¯­ä¹‰ä¸Šè®²ï¼Œç¬¬ä¸€ä¸ªnextæ–¹æ³•ç”¨æ¥å¯åŠ¨éå†å™¨å¯¹è±¡ï¼Œæ‰€ä»¥ä¸ç”¨å¸¦æœ‰å‚æ•°ã€‚ å¦‚æœæƒ³è¦ç¬¬ä¸€æ¬¡è°ƒç”¨nextæ–¹æ³•æ—¶ï¼Œå°±èƒ½å¤Ÿè¾“å…¥å€¼ï¼Œå¯ä»¥åœ¨Generatorå‡½æ•°å¤–é¢å†åŒ…ä¸€å±‚ã€‚ 123456789101112131415function wrapper(generatorFunction) &#123; return function (...args) &#123; let generatorObject = generatorFunction(...args); generatorObject.next(); return generatorObject; &#125;;&#125;const wrapped = wrapper(function* () &#123; console.log(`First input: $&#123;yield&#125;`); return 'DONE';&#125;);wrapped().next('hello!')// First input: hello! ä¸Šé¢ä»£ç ä¸­ï¼ŒGeneratorå‡½æ•°å¦‚æœä¸ç”¨wrapperå…ˆåŒ…ä¸€å±‚ï¼Œæ˜¯æ— æ³•ç¬¬ä¸€æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼Œå°±è¾“å…¥å‚æ•°çš„ã€‚ å†çœ‹ä¸€ä¸ªé€šè¿‡nextæ–¹æ³•çš„å‚æ•°ï¼Œå‘Generatorå‡½æ•°å†…éƒ¨è¾“å…¥å€¼çš„ä¾‹å­ã€‚ 1234567891011121314function* dataConsumer() &#123; console.log('Started'); console.log(`1. $&#123;yield&#125;`); console.log(`2. $&#123;yield&#125;`); return 'result';&#125;let genObj = dataConsumer();genObj.next();// StartedgenObj.next('a')// 1. agenObj.next('b')// 2. b ä¸Šé¢ä»£ç æ˜¯ä¸€ä¸ªå¾ˆç›´è§‚çš„ä¾‹å­ï¼Œæ¯æ¬¡é€šè¿‡nextæ–¹æ³•å‘Generatorå‡½æ•°è¾“å…¥å€¼ï¼Œç„¶åæ‰“å°å‡ºæ¥ã€‚ forâ€¦ofå¾ªç¯for...ofå¾ªç¯å¯ä»¥è‡ªåŠ¨éå†Generatorå‡½æ•°æ—¶ç”Ÿæˆçš„Iteratorå¯¹è±¡ï¼Œä¸”æ­¤æ—¶ä¸å†éœ€è¦è°ƒç”¨nextæ–¹æ³•ã€‚ 12345678910111213function *foo() &#123; yield 1; yield 2; yield 3; yield 4; yield 5; return 6;&#125;for (let v of foo()) &#123; console.log(v);&#125;// 1 2 3 4 5 ä¸Šé¢ä»£ç ä½¿ç”¨for...ofå¾ªç¯ï¼Œä¾æ¬¡æ˜¾ç¤º5ä¸ªyieldè¯­å¥çš„å€¼ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œä¸€æ—¦nextæ–¹æ³•çš„è¿”å›å¯¹è±¡çš„doneå±æ€§ä¸ºtrueï¼Œfor...ofå¾ªç¯å°±ä¼šä¸­æ­¢ï¼Œä¸”ä¸åŒ…å«è¯¥è¿”å›å¯¹è±¡ï¼Œæ‰€ä»¥ä¸Šé¢ä»£ç çš„returnè¯­å¥è¿”å›çš„6ï¼Œä¸åŒ…æ‹¬åœ¨for...ofå¾ªç¯ä¹‹ä¸­ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ©ç”¨Generatorå‡½æ•°å’Œfor...ofå¾ªç¯ï¼Œå®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ä¾‹å­ã€‚ 123456789101112function* fibonacci() &#123; let [prev, curr] = [0, 1]; for (;;) &#123; [prev, curr] = [curr, prev + curr]; yield curr; &#125;&#125;for (let n of fibonacci()) &#123; if (n &gt; 1000) break; console.log(n);&#125; ä»ä¸Šé¢ä»£ç å¯è§ï¼Œä½¿ç”¨for...ofè¯­å¥æ—¶ä¸éœ€è¦ä½¿ç”¨nextæ–¹æ³•ã€‚ åˆ©ç”¨for...ofå¾ªç¯ï¼Œå¯ä»¥å†™å‡ºéå†ä»»æ„å¯¹è±¡ï¼ˆobjectï¼‰çš„æ–¹æ³•ã€‚åŸç”Ÿçš„JavaScriptå¯¹è±¡æ²¡æœ‰éå†æ¥å£ï¼Œæ— æ³•ä½¿ç”¨for...ofå¾ªç¯ï¼Œé€šè¿‡Generatorå‡½æ•°ä¸ºå®ƒåŠ ä¸Šè¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥ç”¨äº†ã€‚ 123456789101112131415function* objectEntries(obj) &#123; let propKeys = Reflect.ownKeys(obj); for (let propKey of propKeys) &#123; yield [propKey, obj[propKey]]; &#125;&#125;let jane = &#123; first: 'Jane', last: 'Doe' &#125;;for (let [key, value] of objectEntries(jane)) &#123; console.log(`$&#123;key&#125;: $&#123;value&#125;`);&#125;// first: Jane// last: Doe ä¸Šé¢ä»£ç ä¸­ï¼Œå¯¹è±¡janeåŸç”Ÿä¸å…·å¤‡Iteratoræ¥å£ï¼Œæ— æ³•ç”¨for...oféå†ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡Generatorå‡½æ•°objectEntriesä¸ºå®ƒåŠ ä¸Šéå†å™¨æ¥å£ï¼Œå°±å¯ä»¥ç”¨for...oféå†äº†ã€‚åŠ ä¸Šéå†å™¨æ¥å£çš„å¦ä¸€ç§å†™æ³•æ˜¯ï¼Œå°†Generatorå‡½æ•°åŠ åˆ°å¯¹è±¡çš„Symbol.iteratorå±æ€§ä¸Šé¢ã€‚ 1234567891011121314151617function* objectEntries() &#123; let propKeys = Object.keys(this); for (let propKey of propKeys) &#123; yield [propKey, this[propKey]]; &#125;&#125;let jane = &#123; first: 'Jane', last: 'Doe' &#125;;jane[Symbol.iterator] = objectEntries;for (let [key, value] of jane) &#123; console.log(`$&#123;key&#125;: $&#123;value&#125;`);&#125;// first: Jane// last: Doe é™¤äº†for...ofå¾ªç¯ä»¥å¤–ï¼Œæ‰©å±•è¿ç®—ç¬¦ï¼ˆ...ï¼‰ã€è§£æ„èµ‹å€¼å’ŒArray.fromæ–¹æ³•å†…éƒ¨è°ƒç”¨çš„ï¼Œéƒ½æ˜¯éå†å™¨æ¥å£ã€‚è¿™æ„å‘³ç€ï¼Œå®ƒä»¬éƒ½å¯ä»¥å°†Generatorå‡½æ•°è¿”å›çš„Iteratorå¯¹è±¡ï¼Œä½œä¸ºå‚æ•°ã€‚ 123456789101112131415161718192021222324function* numbers () &#123; yield 1 yield 2 return 3 yield 4&#125;// æ‰©å±•è¿ç®—ç¬¦[...numbers()] // [1, 2]// Array.from æ–¹æ³•Array.from(numbers()) // [1, 2]// è§£æ„èµ‹å€¼let [x, y] = numbers();x // 1y // 2// for...of å¾ªç¯for (let n of numbers()) &#123; console.log(n)&#125;// 1// 2 Generator.prototype.throw()Generatorå‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œéƒ½æœ‰ä¸€ä¸ªthrowæ–¹æ³•ï¼Œå¯ä»¥åœ¨å‡½æ•°ä½“å¤–æŠ›å‡ºé”™è¯¯ï¼Œç„¶ååœ¨Generatorå‡½æ•°ä½“å†…æ•è·ã€‚ 12345678910111213141516171819var g = function* () &#123; try &#123; yield; &#125; catch (e) &#123; console.log('å†…éƒ¨æ•è·', e); &#125;&#125;;var i = g();i.next();try &#123; i.throw('a'); i.throw('b');&#125; catch (e) &#123; console.log('å¤–éƒ¨æ•è·', e);&#125;// å†…éƒ¨æ•è· a// å¤–éƒ¨æ•è· b ä¸Šé¢ä»£ç ä¸­ï¼Œéå†å™¨å¯¹è±¡iè¿ç»­æŠ›å‡ºä¸¤ä¸ªé”™è¯¯ã€‚ç¬¬ä¸€ä¸ªé”™è¯¯è¢«Generatorå‡½æ•°ä½“å†…çš„catchè¯­å¥æ•è·ã€‚iç¬¬äºŒæ¬¡æŠ›å‡ºé”™è¯¯ï¼Œç”±äºGeneratorå‡½æ•°å†…éƒ¨çš„catchè¯­å¥å·²ç»æ‰§è¡Œè¿‡äº†ï¼Œä¸ä¼šå†æ•æ‰åˆ°è¿™ä¸ªé”™è¯¯äº†ï¼Œæ‰€ä»¥è¿™ä¸ªé”™è¯¯å°±è¢«æŠ›å‡ºäº†Generatorå‡½æ•°ä½“ï¼Œè¢«å‡½æ•°ä½“å¤–çš„catchè¯­å¥æ•è·ã€‚ throwæ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°ä¼šè¢«catchè¯­å¥æ¥æ”¶ï¼Œå»ºè®®æŠ›å‡ºErrorå¯¹è±¡çš„å®ä¾‹ã€‚ 123456789101112var g = function* () &#123; try &#123; yield; &#125; catch (e) &#123; console.log(e); &#125;&#125;;var i = g();i.next();i.throw(new Error('å‡ºé”™äº†ï¼'));// Error: å‡ºé”™äº†ï¼(â€¦) æ³¨æ„ï¼Œä¸è¦æ··æ·†éå†å™¨å¯¹è±¡çš„throwæ–¹æ³•å’Œå…¨å±€çš„throwå‘½ä»¤ã€‚ä¸Šé¢ä»£ç çš„é”™è¯¯ï¼Œæ˜¯ç”¨éå†å™¨å¯¹è±¡çš„throwæ–¹æ³•æŠ›å‡ºçš„ï¼Œè€Œä¸æ˜¯ç”¨throwå‘½ä»¤æŠ›å‡ºçš„ã€‚åè€…åªèƒ½è¢«å‡½æ•°ä½“å¤–çš„catchè¯­å¥æ•è·ã€‚ 123456789101112131415161718192021var g = function* () &#123; while (true) &#123; try &#123; yield; &#125; catch (e) &#123; if (e != 'a') throw e; console.log('å†…éƒ¨æ•è·', e); &#125; &#125;&#125;;var i = g();i.next();try &#123; throw new Error('a'); throw new Error('b');&#125; catch (e) &#123; console.log('å¤–éƒ¨æ•è·', e);&#125;// å¤–éƒ¨æ•è· [Error: a] ä¸Šé¢ä»£ç ä¹‹æ‰€ä»¥åªæ•è·äº†aï¼Œæ˜¯å› ä¸ºå‡½æ•°ä½“å¤–çš„catchè¯­å¥å—ï¼Œæ•è·äº†æŠ›å‡ºçš„aé”™è¯¯ä»¥åï¼Œå°±ä¸ä¼šå†ç»§ç»­tryä»£ç å—é‡Œé¢å‰©ä½™çš„è¯­å¥äº†ã€‚ å¦‚æœGeneratorå‡½æ•°å†…éƒ¨æ²¡æœ‰éƒ¨ç½²try...catchä»£ç å—ï¼Œé‚£ä¹ˆthrowæ–¹æ³•æŠ›å‡ºçš„é”™è¯¯ï¼Œå°†è¢«å¤–éƒ¨try...catchä»£ç å—æ•è·ã€‚ 1234567891011121314151617var g = function* () &#123; while (true) &#123; yield; console.log('å†…éƒ¨æ•è·', e); &#125;&#125;;var i = g();i.next();try &#123; i.throw('a'); i.throw('b');&#125; catch (e) &#123; console.log('å¤–éƒ¨æ•è·', e);&#125;// å¤–éƒ¨æ•è· a ä¸Šé¢ä»£ç ä¸­ï¼ŒGeneratorå‡½æ•°gå†…éƒ¨æ²¡æœ‰éƒ¨ç½²try...catchä»£ç å—ï¼Œæ‰€ä»¥æŠ›å‡ºçš„é”™è¯¯ç›´æ¥è¢«å¤–éƒ¨catchä»£ç å—æ•è·ã€‚ å¦‚æœGeneratorå‡½æ•°å†…éƒ¨å’Œå¤–éƒ¨ï¼Œéƒ½æ²¡æœ‰éƒ¨ç½²try...catchä»£ç å—ï¼Œé‚£ä¹ˆç¨‹åºå°†æŠ¥é”™ï¼Œç›´æ¥ä¸­æ–­æ‰§è¡Œã€‚ 12345678910var gen = function* gen()&#123; yield console.log('hello'); yield console.log('world');&#125;var g = gen();g.next();g.throw();// hello// Uncaught undefined ä¸Šé¢ä»£ç ä¸­ï¼Œg.throwæŠ›å‡ºé”™è¯¯ä»¥åï¼Œæ²¡æœ‰ä»»ä½•try...catchä»£ç å—å¯ä»¥æ•è·è¿™ä¸ªé”™è¯¯ï¼Œå¯¼è‡´ç¨‹åºæŠ¥é”™ï¼Œä¸­æ–­æ‰§è¡Œã€‚ throwæ–¹æ³•è¢«æ•è·ä»¥åï¼Œä¼šé™„å¸¦æ‰§è¡Œä¸‹ä¸€æ¡yieldè¯­å¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šé™„å¸¦æ‰§è¡Œä¸€æ¬¡nextæ–¹æ³•ã€‚ 1234567891011121314var gen = function* gen()&#123; try &#123; yield console.log('a'); &#125; catch (e) &#123; // ... &#125; yield console.log('b'); yield console.log('c');&#125;var g = gen();g.next() // ag.throw() // bg.next() // c ä¸Šé¢ä»£ç ä¸­ï¼Œg.throwæ–¹æ³•è¢«æ•è·ä»¥åï¼Œè‡ªåŠ¨æ‰§è¡Œäº†ä¸€æ¬¡nextæ–¹æ³•ï¼Œæ‰€ä»¥ä¼šæ‰“å°bã€‚å¦å¤–ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œåªè¦Generatorå‡½æ•°å†…éƒ¨éƒ¨ç½²äº†try...catchä»£ç å—ï¼Œé‚£ä¹ˆéå†å™¨çš„throwæ–¹æ³•æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸å½±å“ä¸‹ä¸€æ¬¡éå†ã€‚ å¦å¤–ï¼Œthrowå‘½ä»¤ä¸g.throwæ–¹æ³•æ˜¯æ— å…³çš„ï¼Œä¸¤è€…äº’ä¸å½±å“ã€‚ 123456789101112131415var gen = function* gen()&#123; yield console.log('hello'); yield console.log('world');&#125;var g = gen();g.next();try &#123; throw new Error();&#125; catch (e) &#123; g.next();&#125;// hello// world ä¸Šé¢ä»£ç ä¸­ï¼Œthrowå‘½ä»¤æŠ›å‡ºçš„é”™è¯¯ä¸ä¼šå½±å“åˆ°éå†å™¨çš„çŠ¶æ€ï¼Œæ‰€ä»¥ä¸¤æ¬¡æ‰§è¡Œnextæ–¹æ³•ï¼Œéƒ½è¿›è¡Œäº†æ­£ç¡®çš„æ“ä½œã€‚ è¿™ç§å‡½æ•°ä½“å†…æ•è·é”™è¯¯çš„æœºåˆ¶ï¼Œå¤§å¤§æ–¹ä¾¿äº†å¯¹é”™è¯¯çš„å¤„ç†ã€‚å¤šä¸ªyieldè¯­å¥ï¼Œå¯ä»¥åªç”¨ä¸€ä¸ªtry...catchä»£ç å—æ¥æ•è·é”™è¯¯ã€‚å¦‚æœä½¿ç”¨å›è°ƒå‡½æ•°çš„å†™æ³•ï¼Œæƒ³è¦æ•è·å¤šä¸ªé”™è¯¯ï¼Œå°±ä¸å¾—ä¸ä¸ºæ¯ä¸ªå‡½æ•°å†…éƒ¨å†™ä¸€ä¸ªé”™è¯¯å¤„ç†è¯­å¥ï¼Œç°åœ¨åªåœ¨Generatorå‡½æ•°å†…éƒ¨å†™ä¸€æ¬¡catchè¯­å¥å°±å¯ä»¥äº†ã€‚ Generatorå‡½æ•°ä½“å¤–æŠ›å‡ºçš„é”™è¯¯ï¼Œå¯ä»¥åœ¨å‡½æ•°ä½“å†…æ•è·ï¼›åè¿‡æ¥ï¼ŒGeneratorå‡½æ•°ä½“å†…æŠ›å‡ºçš„é”™è¯¯ï¼Œä¹Ÿå¯ä»¥è¢«å‡½æ•°ä½“å¤–çš„catchæ•è·ã€‚ 123456789101112131415function *foo() &#123; var x = yield 3; var y = x.toUpperCase(); yield y;&#125;var it = foo();it.next(); // &#123; value:3, done:false &#125;try &#123; it.next(42);&#125; catch (err) &#123; console.log(err);&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬äºŒä¸ªnextæ–¹æ³•å‘å‡½æ•°ä½“å†…ä¼ å…¥ä¸€ä¸ªå‚æ•°42ï¼Œæ•°å€¼æ˜¯æ²¡æœ‰toUpperCaseæ–¹æ³•çš„ï¼Œæ‰€ä»¥ä¼šæŠ›å‡ºä¸€ä¸ªTypeErroré”™è¯¯ï¼Œè¢«å‡½æ•°ä½“å¤–çš„catchæ•è·ã€‚ ä¸€æ—¦Generatoræ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºé”™è¯¯ï¼Œä¸”æ²¡æœ‰è¢«å†…éƒ¨æ•è·ï¼Œå°±ä¸ä¼šå†æ‰§è¡Œä¸‹å»äº†ã€‚å¦‚æœæ­¤åè¿˜è°ƒç”¨nextæ–¹æ³•ï¼Œå°†è¿”å›ä¸€ä¸ªvalueå±æ€§ç­‰äºundefinedã€doneå±æ€§ç­‰äºtrueçš„å¯¹è±¡ï¼Œå³JavaScriptå¼•æ“è®¤ä¸ºè¿™ä¸ªGeneratorå·²ç»è¿è¡Œç»“æŸäº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839function* g() &#123; yield 1; console.log('throwing an exception'); throw new Error('generator broke!'); yield 2; yield 3;&#125;function log(generator) &#123; var v; console.log('starting generator'); try &#123; v = generator.next(); console.log('ç¬¬ä¸€æ¬¡è¿è¡Œnextæ–¹æ³•', v); &#125; catch (err) &#123; console.log('æ•æ‰é”™è¯¯', v); &#125; try &#123; v = generator.next(); console.log('ç¬¬äºŒæ¬¡è¿è¡Œnextæ–¹æ³•', v); &#125; catch (err) &#123; console.log('æ•æ‰é”™è¯¯', v); &#125; try &#123; v = generator.next(); console.log('ç¬¬ä¸‰æ¬¡è¿è¡Œnextæ–¹æ³•', v); &#125; catch (err) &#123; console.log('æ•æ‰é”™è¯¯', v); &#125; console.log('caller done');&#125;log(g());// starting generator// ç¬¬ä¸€æ¬¡è¿è¡Œnextæ–¹æ³• &#123; value: 1, done: false &#125;// throwing an exception// æ•æ‰é”™è¯¯ &#123; value: 1, done: false &#125;// ç¬¬ä¸‰æ¬¡è¿è¡Œnextæ–¹æ³• &#123; value: undefined, done: true &#125;// caller done ä¸Šé¢ä»£ç ä¸€å…±ä¸‰æ¬¡è¿è¡Œnextæ–¹æ³•ï¼Œç¬¬äºŒæ¬¡è¿è¡Œçš„æ—¶å€™ä¼šæŠ›å‡ºé”™è¯¯ï¼Œç„¶åç¬¬ä¸‰æ¬¡è¿è¡Œçš„æ—¶å€™ï¼ŒGeneratorå‡½æ•°å°±å·²ç»ç»“æŸäº†ï¼Œä¸å†æ‰§è¡Œä¸‹å»äº†ã€‚ Generator.prototype.return()Generatorå‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ä¸ªreturnæ–¹æ³•ï¼Œå¯ä»¥è¿”å›ç»™å®šçš„å€¼ï¼Œå¹¶ä¸”ç»ˆç»“éå†Generatorå‡½æ•°ã€‚ 1234567891011function* gen() &#123; yield 1; yield 2; yield 3;&#125;var g = gen();g.next() // &#123; value: 1, done: false &#125;g.return('foo') // &#123; value: \"foo\", done: true &#125;g.next() // &#123; value: undefined, done: true &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œéå†å™¨å¯¹è±¡gè°ƒç”¨returnæ–¹æ³•åï¼Œè¿”å›å€¼çš„valueå±æ€§å°±æ˜¯returnæ–¹æ³•çš„å‚æ•°fooã€‚å¹¶ä¸”ï¼ŒGeneratorå‡½æ•°çš„éå†å°±ç»ˆæ­¢äº†ï¼Œè¿”å›å€¼çš„doneå±æ€§ä¸ºtrueï¼Œä»¥åå†è°ƒç”¨nextæ–¹æ³•ï¼Œdoneå±æ€§æ€»æ˜¯è¿”å›trueã€‚ å¦‚æœreturnæ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¸æä¾›å‚æ•°ï¼Œåˆ™è¿”å›å€¼çš„valueå±æ€§ä¸ºundefinedã€‚ 12345678910function* gen() &#123; yield 1; yield 2; yield 3;&#125;var g = gen();g.next() // &#123; value: 1, done: false &#125;g.return() // &#123; value: undefined, done: true &#125; å¦‚æœGeneratorå‡½æ•°å†…éƒ¨æœ‰try...finallyä»£ç å—ï¼Œé‚£ä¹ˆreturnæ–¹æ³•ä¼šæ¨è¿Ÿåˆ°finallyä»£ç å—æ‰§è¡Œå®Œå†æ‰§è¡Œã€‚ 1234567891011121314151617function* numbers () &#123; yield 1; try &#123; yield 2; yield 3; &#125; finally &#123; yield 4; yield 5; &#125; yield 6;&#125;var g = numbers()g.next() // &#123; done: false, value: 1 &#125;g.next() // &#123; done: false, value: 2 &#125;g.return(7) // &#123; done: false, value: 4 &#125;g.next() // &#123; done: false, value: 5 &#125;g.next() // &#123; done: true, value: 7 &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œè°ƒç”¨returnæ–¹æ³•åï¼Œå°±å¼€å§‹æ‰§è¡Œfinallyä»£ç å—ï¼Œç„¶åç­‰åˆ°finallyä»£ç å—æ‰§è¡Œå®Œï¼Œå†æ‰§è¡Œreturnæ–¹æ³•ã€‚ yield* è¯­å¥å¦‚æœåœ¨ Generator å‡½æ•°å†…éƒ¨ï¼Œè°ƒç”¨å¦ä¸€ä¸ª Generator å‡½æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰æ•ˆæœçš„ã€‚ 12345678910111213141516function* foo() &#123; yield 'a'; yield 'b';&#125;function* bar() &#123; yield 'x'; foo(); yield 'y';&#125;for (let v of bar())&#123; console.log(v);&#125;// \"x\"// \"y\" ä¸Šé¢ä»£ç ä¸­ï¼Œfooå’Œbaréƒ½æ˜¯ Generator å‡½æ•°ï¼Œåœ¨baré‡Œé¢è°ƒç”¨fooï¼Œæ˜¯ä¸ä¼šæœ‰æ•ˆæœçš„ã€‚ è¿™ä¸ªå°±éœ€è¦ç”¨åˆ°yield*è¯­å¥ï¼Œç”¨æ¥åœ¨ä¸€ä¸ª Generator å‡½æ•°é‡Œé¢æ‰§è¡Œå¦ä¸€ä¸ª Generator å‡½æ•°ã€‚ 123456789101112131415161718192021222324252627282930function* bar() &#123; yield 'x'; yield* foo(); yield 'y';&#125;// ç­‰åŒäºfunction* bar() &#123; yield 'x'; yield 'a'; yield 'b'; yield 'y';&#125;// ç­‰åŒäºfunction* bar() &#123; yield 'x'; for (let v of foo()) &#123; yield v; &#125; yield 'y';&#125;for (let v of bar())&#123; console.log(v);&#125;// \"x\"// \"a\"// \"b\"// \"y\" å†æ¥çœ‹ä¸€ä¸ªå¯¹æ¯”çš„ä¾‹å­ã€‚ 12345678910111213141516171819202122232425function* inner() &#123; yield 'hello!';&#125;function* outer1() &#123; yield 'open'; yield inner(); yield 'close';&#125;var gen = outer1()gen.next().value // \"open\"gen.next().value // è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡gen.next().value // \"close\"function* outer2() &#123; yield 'open' yield* inner() yield 'close'&#125;var gen = outer2()gen.next().value // \"open\"gen.next().value // \"hello!\"gen.next().value // \"close\" ä¸Šé¢ä¾‹å­ä¸­ï¼Œouter2ä½¿ç”¨äº†yield*ï¼Œouter1æ²¡ä½¿ç”¨ã€‚ç»“æœå°±æ˜¯ï¼Œouter1è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œouter2è¿”å›è¯¥éå†å™¨å¯¹è±¡çš„å†…éƒ¨å€¼ã€‚ ä»è¯­æ³•è§’åº¦çœ‹ï¼Œå¦‚æœyieldå‘½ä»¤åé¢è·Ÿçš„æ˜¯ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œéœ€è¦åœ¨yieldå‘½ä»¤åé¢åŠ ä¸Šæ˜Ÿå·ï¼Œè¡¨æ˜å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚è¿™è¢«ç§°ä¸ºyield*è¯­å¥ã€‚ 123456789101112131415161718let delegatedIterator = (function* () &#123; yield 'Hello!'; yield 'Bye!';&#125;());let delegatingIterator = (function* () &#123; yield 'Greetings!'; yield* delegatedIterator; yield 'Ok, bye.';&#125;());for(let value of delegatingIterator) &#123; console.log(value);&#125;// \"Greetings!// \"Hello!\"// \"Bye!\"// \"Ok, bye.\" ä¸Šé¢ä»£ç ä¸­ï¼ŒdelegatingIteratoræ˜¯ä»£ç†è€…ï¼ŒdelegatedIteratoræ˜¯è¢«ä»£ç†è€…ã€‚ç”±äºyield* delegatedIteratorè¯­å¥å¾—åˆ°çš„å€¼ï¼Œæ˜¯ä¸€ä¸ªéå†å™¨ï¼Œæ‰€ä»¥è¦ç”¨æ˜Ÿå·è¡¨ç¤ºã€‚è¿è¡Œç»“æœå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªéå†å™¨ï¼Œéå†äº†å¤šä¸ªGeneratorå‡½æ•°ï¼Œæœ‰é€’å½’çš„æ•ˆæœã€‚ yield*åé¢çš„Generatorå‡½æ•°ï¼ˆæ²¡æœ‰returnè¯­å¥æ—¶ï¼‰ï¼Œç­‰åŒäºåœ¨Generatorå‡½æ•°å†…éƒ¨ï¼Œéƒ¨ç½²ä¸€ä¸ªfor...ofå¾ªç¯ã€‚ 123456789101112131415function* concat(iter1, iter2) &#123; yield* iter1; yield* iter2;&#125;// ç­‰åŒäºfunction* concat(iter1, iter2) &#123; for (var value of iter1) &#123; yield value; &#125; for (var value of iter2) &#123; yield value; &#125;&#125; ä¸Šé¢ä»£ç è¯´æ˜ï¼Œyield*åé¢çš„Generatorå‡½æ•°ï¼ˆæ²¡æœ‰returnè¯­å¥æ—¶ï¼‰ï¼Œä¸è¿‡æ˜¯for...ofçš„ä¸€ç§ç®€å†™å½¢å¼ï¼Œå®Œå…¨å¯ä»¥ç”¨åè€…æ›¿ä»£å‰è€…ã€‚åä¹‹ï¼Œåˆ™éœ€è¦ç”¨var value = yield* iteratorçš„å½¢å¼è·å–returnè¯­å¥çš„å€¼ã€‚ å¦‚æœyield*åé¢è·Ÿç€ä¸€ä¸ªæ•°ç»„ï¼Œç”±äºæ•°ç»„åŸç”Ÿæ”¯æŒéå†å™¨ï¼Œå› æ­¤å°±ä¼šéå†æ•°ç»„æˆå‘˜ã€‚ 12345function* gen()&#123; yield* [\"a\", \"b\", \"c\"];&#125;gen().next() // &#123; value:\"a\", done:false &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œyieldå‘½ä»¤åé¢å¦‚æœä¸åŠ æ˜Ÿå·ï¼Œè¿”å›çš„æ˜¯æ•´ä¸ªæ•°ç»„ï¼ŒåŠ äº†æ˜Ÿå·å°±è¡¨ç¤ºè¿”å›çš„æ˜¯æ•°ç»„çš„éå†å™¨å¯¹è±¡ã€‚ å®é™…ä¸Šï¼Œä»»ä½•æ•°æ®ç»“æ„åªè¦æœ‰Iteratoræ¥å£ï¼Œå°±å¯ä»¥è¢«yield*éå†ã€‚ 1234567let read = (function* () &#123; yield 'hello'; yield* 'hello';&#125;)();read.next().value // \"hello\"read.next().value // \"h\" ä¸Šé¢ä»£ç ä¸­ï¼Œyieldè¯­å¥è¿”å›æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œyield*è¯­å¥è¿”å›å•ä¸ªå­—ç¬¦ã€‚å› ä¸ºå­—ç¬¦ä¸²å…·æœ‰Iteratoræ¥å£ï¼Œæ‰€ä»¥è¢«yield*éå†ã€‚ å¦‚æœè¢«ä»£ç†çš„Generatorå‡½æ•°æœ‰returnè¯­å¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‘ä»£ç†å®ƒçš„Generatorå‡½æ•°è¿”å›æ•°æ®ã€‚ 1234567891011121314151617181920212223242526function *foo() &#123; yield 2; yield 3; return \"foo\";&#125;function *bar() &#123; yield 1; var v = yield *foo(); console.log( \"v: \" + v ); yield 4;&#125;var it = bar();it.next()// &#123;value: 1, done: false&#125;it.next()// &#123;value: 2, done: false&#125;it.next()// &#123;value: 3, done: false&#125;it.next();// \"v: foo\"// &#123;value: 4, done: false&#125;it.next()// &#123;value: undefined, done: true&#125; ä¸Šé¢ä»£ç åœ¨ç¬¬å››æ¬¡è°ƒç”¨nextæ–¹æ³•çš„æ—¶å€™ï¼Œå±å¹•ä¸Šä¼šæœ‰è¾“å‡ºï¼Œè¿™æ˜¯å› ä¸ºå‡½æ•°fooçš„returnè¯­å¥ï¼Œå‘å‡½æ•°baræä¾›äº†è¿”å›å€¼ã€‚ å†çœ‹ä¸€ä¸ªä¾‹å­ã€‚ 12345678910111213function* genFuncWithReturn() &#123; yield 'a'; yield 'b'; return 'The result';&#125;function* logReturned(genObj) &#123; let result = yield* genObj; console.log(result);&#125;[...logReturned(genFuncWithReturn())]// The result// å€¼ä¸º [ 'a', 'b' ] ä¸Šé¢ä»£ç ä¸­ï¼Œå­˜åœ¨ä¸¤æ¬¡éå†ã€‚ç¬¬ä¸€æ¬¡æ˜¯æ‰©å±•è¿ç®—ç¬¦éå†å‡½æ•°logReturnedè¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œç¬¬äºŒæ¬¡æ˜¯yield*è¯­å¥éå†å‡½æ•°genFuncWithReturnè¿”å›çš„éå†å™¨å¯¹è±¡ã€‚è¿™ä¸¤æ¬¡éå†çš„æ•ˆæœæ˜¯å åŠ çš„ï¼Œæœ€ç»ˆè¡¨ç°ä¸ºæ‰©å±•è¿ç®—ç¬¦éå†å‡½æ•°genFuncWithReturnè¿”å›çš„éå†å™¨å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œæœ€åçš„æ•°æ®è¡¨è¾¾å¼å¾—åˆ°çš„å€¼ç­‰äº[ &#39;a&#39;, &#39;b&#39; ]ã€‚ä½†æ˜¯ï¼Œå‡½æ•°genFuncWithReturnçš„returnè¯­å¥çš„è¿”å›å€¼The resultï¼Œä¼šè¿”å›ç»™å‡½æ•°logReturnedå†…éƒ¨çš„resultå˜é‡ï¼Œå› æ­¤ä¼šæœ‰ç»ˆç«¯è¾“å‡ºã€‚ yield*å‘½ä»¤å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å–å‡ºåµŒå¥—æ•°ç»„çš„æ‰€æœ‰æˆå‘˜ã€‚ 1234567891011121314151617181920function* iterTree(tree) &#123; if (Array.isArray(tree)) &#123; for(let i=0; i &lt; tree.length; i++) &#123; yield* iterTree(tree[i]); &#125; &#125; else &#123; yield tree; &#125;&#125;const tree = [ 'a', ['b', 'c'], ['d', 'e'] ];for(let x of iterTree(tree)) &#123; console.log(x);&#125;// a// b// c// d// e ä¸‹é¢æ˜¯ä¸€ä¸ªç¨å¾®å¤æ‚çš„ä¾‹å­ï¼Œä½¿ç”¨yield*è¯­å¥éå†å®Œå…¨äºŒå‰æ ‘ã€‚ 1234567891011121314151617181920212223242526272829303132333435// ä¸‹é¢æ˜¯äºŒå‰æ ‘çš„æ„é€ å‡½æ•°ï¼Œ// ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯å·¦æ ‘ã€å½“å‰èŠ‚ç‚¹å’Œå³æ ‘function Tree(left, label, right) &#123; this.left = left; this.label = label; this.right = right;&#125;// ä¸‹é¢æ˜¯ä¸­åºï¼ˆinorderï¼‰éå†å‡½æ•°ã€‚// ç”±äºè¿”å›çš„æ˜¯ä¸€ä¸ªéå†å™¨ï¼Œæ‰€ä»¥è¦ç”¨generatorå‡½æ•°ã€‚// å‡½æ•°ä½“å†…é‡‡ç”¨é€’å½’ç®—æ³•ï¼Œæ‰€ä»¥å·¦æ ‘å’Œå³æ ‘è¦ç”¨yield*éå†function* inorder(t) &#123; if (t) &#123; yield* inorder(t.left); yield t.label; yield* inorder(t.right); &#125;&#125;// ä¸‹é¢ç”ŸæˆäºŒå‰æ ‘function make(array) &#123; // åˆ¤æ–­æ˜¯å¦ä¸ºå¶èŠ‚ç‚¹ if (array.length == 1) return new Tree(null, array[0], null); return new Tree(make(array[0]), array[1], make(array[2]));&#125;let tree = make([[['a'], 'b', ['c']], 'd', [['e'], 'f', ['g']]]);// éå†äºŒå‰æ ‘var result = [];for (let node of inorder(tree)) &#123; result.push(node);&#125;result// ['a', 'b', 'c', 'd', 'e', 'f', 'g'] ä½œä¸ºå¯¹è±¡å±æ€§çš„Generatorå‡½æ•°å¦‚æœä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ˜¯Generatorå‡½æ•°ï¼Œå¯ä»¥ç®€å†™æˆä¸‹é¢çš„å½¢å¼ã€‚ 12345let obj = &#123; * myGeneratorMethod() &#123; Â·Â·Â· &#125;&#125;; ä¸Šé¢ä»£ç ä¸­ï¼ŒmyGeneratorMethodå±æ€§å‰é¢æœ‰ä¸€ä¸ªæ˜Ÿå·ï¼Œè¡¨ç¤ºè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªGeneratorå‡½æ•°ã€‚ å®ƒçš„å®Œæ•´å½¢å¼å¦‚ä¸‹ï¼Œä¸ä¸Šé¢çš„å†™æ³•æ˜¯ç­‰ä»·çš„ã€‚ 12345let obj = &#123; myGeneratorMethod: function* () &#123; // Â·Â·Â· &#125;&#125;; Generatorå‡½æ•°çš„thisGeneratorå‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ªéå†å™¨ï¼ŒES6è§„å®šè¿™ä¸ªéå†å™¨æ˜¯Generatorå‡½æ•°çš„å®ä¾‹ï¼Œä¹Ÿç»§æ‰¿äº†Generatorå‡½æ•°çš„prototypeå¯¹è±¡ä¸Šçš„æ–¹æ³•ã€‚ 12345678910function* g() &#123;&#125;g.prototype.hello = function () &#123; return 'hi!';&#125;;let obj = g();obj instanceof g // trueobj.hello() // 'hi!' ä¸Šé¢ä»£ç è¡¨æ˜ï¼ŒGeneratorå‡½æ•°gè¿”å›çš„éå†å™¨objï¼Œæ˜¯gçš„å®ä¾‹ï¼Œè€Œä¸”ç»§æ‰¿äº†g.prototypeã€‚ä½†æ˜¯ï¼Œå¦‚æœæŠŠgå½“ä½œæ™®é€šçš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºgè¿”å›çš„æ€»æ˜¯éå†å™¨å¯¹è±¡ï¼Œè€Œä¸æ˜¯thiså¯¹è±¡ã€‚ 123456function* g() &#123; this.a = 11;&#125;let obj = g();obj.a // undefined ä¸Šé¢ä»£ç ä¸­ï¼ŒGeneratorå‡½æ•°gåœ¨thiså¯¹è±¡ä¸Šé¢æ·»åŠ äº†ä¸€ä¸ªå±æ€§aï¼Œä½†æ˜¯objå¯¹è±¡æ‹¿ä¸åˆ°è¿™ä¸ªå±æ€§ã€‚ Generatorå‡½æ•°ä¹Ÿä¸èƒ½è·Ÿnewå‘½ä»¤ä¸€èµ·ç”¨ï¼Œä¼šæŠ¥é”™ã€‚ 1234567function* F() &#123; yield this.x = 2; yield this.y = 3;&#125;new F()// TypeError: F is not a constructor ä¸Šé¢ä»£ç ä¸­ï¼Œnewå‘½ä»¤è·Ÿæ„é€ å‡½æ•°Fä¸€èµ·ä½¿ç”¨ï¼Œç»“æœæŠ¥é”™ï¼Œå› ä¸ºFä¸æ˜¯æ„é€ å‡½æ•°ã€‚ é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰åŠæ³•è®©Generatorå‡½æ•°è¿”å›ä¸€ä¸ªæ­£å¸¸çš„å¯¹è±¡å®ä¾‹ï¼Œæ—¢å¯ä»¥ç”¨nextæ–¹æ³•ï¼Œåˆå¯ä»¥è·å¾—æ­£å¸¸çš„thisï¼Ÿ ä¸‹é¢æ˜¯ä¸€ä¸ªå˜é€šæ–¹æ³•ã€‚é¦–å…ˆï¼Œç”Ÿæˆä¸€ä¸ªç©ºå¯¹è±¡ï¼Œä½¿ç”¨callæ–¹æ³•ç»‘å®šGeneratorå‡½æ•°å†…éƒ¨çš„thisã€‚è¿™æ ·ï¼Œæ„é€ å‡½æ•°è°ƒç”¨ä»¥åï¼Œè¿™ä¸ªç©ºå¯¹è±¡å°±æ˜¯Generatorå‡½æ•°çš„å®ä¾‹å¯¹è±¡äº†ã€‚ 123456789101112131415function* F() &#123; this.a = 1; yield this.b = 2; yield this.c = 3;&#125;var obj = &#123;&#125;;var f = F.call(obj);f.next(); // Object &#123;value: 2, done: false&#125;f.next(); // Object &#123;value: 3, done: false&#125;f.next(); // Object &#123;value: undefined, done: true&#125;obj.a // 1obj.b // 2obj.c // 3 ä¸Šé¢ä»£ç ä¸­ï¼Œé¦–å…ˆæ˜¯Få†…éƒ¨çš„thiså¯¹è±¡ç»‘å®šobjå¯¹è±¡ï¼Œç„¶åè°ƒç”¨å®ƒï¼Œè¿”å›ä¸€ä¸ªIteratorå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡æ‰§è¡Œä¸‰æ¬¡nextæ–¹æ³•ï¼ˆå› ä¸ºFå†…éƒ¨æœ‰ä¸¤ä¸ªyieldè¯­å¥ï¼‰ï¼Œå®ŒæˆFå†…éƒ¨æ‰€æœ‰ä»£ç çš„è¿è¡Œã€‚è¿™æ—¶ï¼Œæ‰€æœ‰å†…éƒ¨å±æ€§éƒ½ç»‘å®šåœ¨objå¯¹è±¡ä¸Šäº†ï¼Œå› æ­¤objå¯¹è±¡ä¹Ÿå°±æˆäº†Fçš„å®ä¾‹ã€‚ ä¸Šé¢ä»£ç ä¸­ï¼Œæ‰§è¡Œçš„æ˜¯éå†å™¨å¯¹è±¡fï¼Œä½†æ˜¯ç”Ÿæˆçš„å¯¹è±¡å®ä¾‹æ˜¯objï¼Œæœ‰æ²¡æœ‰åŠæ³•å°†è¿™ä¸¤ä¸ªå¯¹è±¡ç»Ÿä¸€å‘¢ï¼Ÿ ä¸€ä¸ªåŠæ³•å°±æ˜¯å°†objæ¢æˆF.prototypeã€‚ 1234567891011121314function* F() &#123; this.a = 1; yield this.b = 2; yield this.c = 3;&#125;var f = F.call(F.prototype);f.next(); // Object &#123;value: 2, done: false&#125;f.next(); // Object &#123;value: 3, done: false&#125;f.next(); // Object &#123;value: undefined, done: true&#125;f.a // 1f.b // 2f.c // 3 å†å°†Fæ”¹æˆæ„é€ å‡½æ•°ï¼Œå°±å¯ä»¥å¯¹å®ƒæ‰§è¡Œnewå‘½ä»¤äº†ã€‚ 12345678910111213141516171819function* gen() &#123; this.a = 1; yield this.b = 2; yield this.c = 3;&#125;function F() &#123; return gen.call(gen.prototype);&#125;var f = new F();f.next(); // Object &#123;value: 2, done: false&#125;f.next(); // Object &#123;value: 3, done: false&#125;f.next(); // Object &#123;value: undefined, done: true&#125;f.a // 1f.b // 2f.c // 3 å«ä¹‰Generatorä¸çŠ¶æ€æœºGeneratoræ˜¯å®ç°çŠ¶æ€æœºçš„æœ€ä½³ç»“æ„ã€‚æ¯”å¦‚ï¼Œä¸‹é¢çš„clockå‡½æ•°å°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºã€‚ 12345678var ticking = true;var clock = function() &#123; if (ticking) console.log('Tick!'); else console.log('Tock!'); ticking = !ticking;&#125; ä¸Šé¢ä»£ç çš„clockå‡½æ•°ä¸€å…±æœ‰ä¸¤ç§çŠ¶æ€ï¼ˆTickå’ŒTockï¼‰ï¼Œæ¯è¿è¡Œä¸€æ¬¡ï¼Œå°±æ”¹å˜ä¸€æ¬¡çŠ¶æ€ã€‚è¿™ä¸ªå‡½æ•°å¦‚æœç”¨Generatorå®ç°ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·ã€‚ 12345678var clock = function*() &#123; while (true) &#123; console.log('Tick!'); yield; console.log('Tock!'); yield; &#125;&#125;; ä¸Šé¢çš„Generatorå®ç°ä¸ES5å®ç°å¯¹æ¯”ï¼Œå¯ä»¥çœ‹åˆ°å°‘äº†ç”¨æ¥ä¿å­˜çŠ¶æ€çš„å¤–éƒ¨å˜é‡tickingï¼Œè¿™æ ·å°±æ›´ç®€æ´ï¼Œæ›´å®‰å…¨ï¼ˆçŠ¶æ€ä¸ä¼šè¢«éæ³•ç¯¡æ”¹ï¼‰ã€æ›´ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³ï¼Œåœ¨å†™æ³•ä¸Šä¹Ÿæ›´ä¼˜é›…ã€‚Generatorä¹‹æ‰€ä»¥å¯ä»¥ä¸ç”¨å¤–éƒ¨å˜é‡ä¿å­˜çŠ¶æ€ï¼Œæ˜¯å› ä¸ºå®ƒæœ¬èº«å°±åŒ…å«äº†ä¸€ä¸ªçŠ¶æ€ä¿¡æ¯ï¼Œå³ç›®å‰æ˜¯å¦å¤„äºæš‚åœæ€ã€‚ Generatorä¸åç¨‹åç¨‹ï¼ˆcoroutineï¼‰æ˜¯ä¸€ç§ç¨‹åºè¿è¡Œçš„æ–¹å¼ï¼Œå¯ä»¥ç†è§£æˆâ€œåä½œçš„çº¿ç¨‹â€æˆ–â€œåä½œçš„å‡½æ•°â€ã€‚åç¨‹æ—¢å¯ä»¥ç”¨å•çº¿ç¨‹å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨å¤šçº¿ç¨‹å®ç°ã€‚å‰è€…æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­ä¾‹ç¨‹ï¼Œåè€…æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹ã€‚ ï¼ˆ1ï¼‰åç¨‹ä¸å­ä¾‹ç¨‹çš„å·®å¼‚ ä¼ ç»Ÿçš„â€œå­ä¾‹ç¨‹â€ï¼ˆsubroutineï¼‰é‡‡ç”¨å †æ ˆå¼â€œåè¿›å…ˆå‡ºâ€çš„æ‰§è¡Œæ–¹å¼ï¼Œåªæœ‰å½“è°ƒç”¨çš„å­å‡½æ•°å®Œå…¨æ‰§è¡Œå®Œæ¯•ï¼Œæ‰ä¼šç»“æŸæ‰§è¡Œçˆ¶å‡½æ•°ã€‚åç¨‹ä¸å…¶ä¸åŒï¼Œå¤šä¸ªçº¿ç¨‹ï¼ˆå•çº¿ç¨‹æƒ…å†µä¸‹ï¼Œå³å¤šä¸ªå‡½æ•°ï¼‰å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ˆæˆ–å‡½æ•°ï¼‰å¤„äºæ­£åœ¨è¿è¡Œçš„çŠ¶æ€ï¼Œå…¶ä»–çº¿ç¨‹ï¼ˆæˆ–å‡½æ•°ï¼‰éƒ½å¤„äºæš‚åœæ€ï¼ˆsuspendedï¼‰ï¼Œçº¿ç¨‹ï¼ˆæˆ–å‡½æ•°ï¼‰ä¹‹é—´å¯ä»¥äº¤æ¢æ‰§è¡Œæƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹ï¼ˆæˆ–å‡½æ•°ï¼‰æ‰§è¡Œåˆ°ä¸€åŠï¼Œå¯ä»¥æš‚åœæ‰§è¡Œï¼Œå°†æ‰§è¡Œæƒäº¤ç»™å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆæˆ–å‡½æ•°ï¼‰ï¼Œç­‰åˆ°ç¨åæ”¶å›æ‰§è¡Œæƒçš„æ—¶å€™ï¼Œå†æ¢å¤æ‰§è¡Œã€‚è¿™ç§å¯ä»¥å¹¶è¡Œæ‰§è¡Œã€äº¤æ¢æ‰§è¡Œæƒçš„çº¿ç¨‹ï¼ˆæˆ–å‡½æ•°ï¼‰ï¼Œå°±ç§°ä¸ºåç¨‹ã€‚ ä»å®ç°ä¸Šçœ‹ï¼Œåœ¨å†…å­˜ä¸­ï¼Œå­ä¾‹ç¨‹åªä½¿ç”¨ä¸€ä¸ªæ ˆï¼ˆstackï¼‰ï¼Œè€Œåç¨‹æ˜¯åŒæ—¶å­˜åœ¨å¤šä¸ªæ ˆï¼Œä½†åªæœ‰ä¸€ä¸ªæ ˆæ˜¯åœ¨è¿è¡ŒçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåç¨‹æ˜¯ä»¥å¤šå ç”¨å†…å­˜ä¸ºä»£ä»·ï¼Œå®ç°å¤šä»»åŠ¡çš„å¹¶è¡Œã€‚ ï¼ˆ2ï¼‰åç¨‹ä¸æ™®é€šçº¿ç¨‹çš„å·®å¼‚ ä¸éš¾çœ‹å‡ºï¼Œåç¨‹é€‚åˆç”¨äºå¤šä»»åŠ¡è¿è¡Œçš„ç¯å¢ƒã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œå®ƒä¸æ™®é€šçš„çº¿ç¨‹å¾ˆç›¸ä¼¼ï¼Œéƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€å¯ä»¥åˆ†äº«å…¨å±€å˜é‡ã€‚å®ƒä»¬çš„ä¸åŒä¹‹å¤„åœ¨äºï¼ŒåŒä¸€æ—¶é—´å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä½†æ˜¯è¿è¡Œçš„åç¨‹åªèƒ½æœ‰ä¸€ä¸ªï¼Œå…¶ä»–åç¨‹éƒ½å¤„äºæš‚åœçŠ¶æ€ã€‚æ­¤å¤–ï¼Œæ™®é€šçš„çº¿ç¨‹æ˜¯æŠ¢å…ˆå¼çš„ï¼Œåˆ°åº•å“ªä¸ªçº¿ç¨‹ä¼˜å…ˆå¾—åˆ°èµ„æºï¼Œå¿…é¡»ç”±è¿è¡Œç¯å¢ƒå†³å®šï¼Œä½†æ˜¯åç¨‹æ˜¯åˆä½œå¼çš„ï¼Œæ‰§è¡Œæƒç”±åç¨‹è‡ªå·±åˆ†é…ã€‚ ç”±äºECMAScriptæ˜¯å•çº¿ç¨‹è¯­è¨€ï¼Œåªèƒ½ä¿æŒä¸€ä¸ªè°ƒç”¨æ ˆã€‚å¼•å…¥åç¨‹ä»¥åï¼Œæ¯ä¸ªä»»åŠ¡å¯ä»¥ä¿æŒè‡ªå·±çš„è°ƒç”¨æ ˆã€‚è¿™æ ·åšçš„æœ€å¤§å¥½å¤„ï¼Œå°±æ˜¯æŠ›å‡ºé”™è¯¯çš„æ—¶å€™ï¼Œå¯ä»¥æ‰¾åˆ°åŸå§‹çš„è°ƒç”¨æ ˆã€‚ä¸è‡³äºåƒå¼‚æ­¥æ“ä½œçš„å›è°ƒå‡½æ•°é‚£æ ·ï¼Œä¸€æ—¦å‡ºé”™ï¼ŒåŸå§‹çš„è°ƒç”¨æ ˆæ—©å°±ç»“æŸã€‚ Generatorå‡½æ•°æ˜¯ECMAScript 6å¯¹åç¨‹çš„å®ç°ï¼Œä½†å±äºä¸å®Œå…¨å®ç°ã€‚Generatorå‡½æ•°è¢«ç§°ä¸ºâ€œåŠåç¨‹â€ï¼ˆsemi-coroutineï¼‰ï¼Œæ„æ€æ˜¯åªæœ‰Generatorå‡½æ•°çš„è°ƒç”¨è€…ï¼Œæ‰èƒ½å°†ç¨‹åºçš„æ‰§è¡Œæƒè¿˜ç»™Generatorå‡½æ•°ã€‚å¦‚æœæ˜¯å®Œå…¨æ‰§è¡Œçš„åç¨‹ï¼Œä»»ä½•å‡½æ•°éƒ½å¯ä»¥è®©æš‚åœçš„åç¨‹ç»§ç»­æ‰§è¡Œã€‚ å¦‚æœå°†Generatorå‡½æ•°å½“ä½œåç¨‹ï¼Œå®Œå…¨å¯ä»¥å°†å¤šä¸ªéœ€è¦äº’ç›¸åä½œçš„ä»»åŠ¡å†™æˆGeneratorå‡½æ•°ï¼Œå®ƒä»¬ä¹‹é—´ä½¿ç”¨yieldè¯­å¥äº¤æ¢æ§åˆ¶æƒã€‚ åº”ç”¨Generatorå¯ä»¥æš‚åœå‡½æ•°æ‰§è¡Œï¼Œè¿”å›ä»»æ„è¡¨è¾¾å¼çš„å€¼ã€‚è¿™ç§ç‰¹ç‚¹ä½¿å¾—Generatoræœ‰å¤šç§åº”ç”¨åœºæ™¯ã€‚ ï¼ˆ1ï¼‰å¼‚æ­¥æ“ä½œçš„åŒæ­¥åŒ–è¡¨è¾¾Generatorå‡½æ•°çš„æš‚åœæ‰§è¡Œçš„æ•ˆæœï¼Œæ„å‘³ç€å¯ä»¥æŠŠå¼‚æ­¥æ“ä½œå†™åœ¨yieldè¯­å¥é‡Œé¢ï¼Œç­‰åˆ°è°ƒç”¨nextæ–¹æ³•æ—¶å†å¾€åæ‰§è¡Œã€‚è¿™å®é™…ä¸Šç­‰åŒäºä¸éœ€è¦å†™å›è°ƒå‡½æ•°äº†ï¼Œå› ä¸ºå¼‚æ­¥æ“ä½œçš„åç»­æ“ä½œå¯ä»¥æ”¾åœ¨yieldè¯­å¥ä¸‹é¢ï¼Œåæ­£è¦ç­‰åˆ°è°ƒç”¨nextæ–¹æ³•æ—¶å†æ‰§è¡Œã€‚æ‰€ä»¥ï¼ŒGeneratorå‡½æ•°çš„ä¸€ä¸ªé‡è¦å®é™…æ„ä¹‰å°±æ˜¯ç”¨æ¥å¤„ç†å¼‚æ­¥æ“ä½œï¼Œæ”¹å†™å›è°ƒå‡½æ•°ã€‚ 1234567891011function* loadUI() &#123; showLoadingScreen(); yield loadUIDataAsynchronously(); hideLoadingScreen();&#125;var loader = loadUI();// åŠ è½½UIloader.next()// å¸è½½UIloader.next() ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨loadUIå‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°ä¸ä¼šæ‰§è¡Œï¼Œä»…è¿”å›ä¸€ä¸ªéå†å™¨ã€‚ä¸‹ä¸€æ¬¡å¯¹è¯¥éå†å™¨è°ƒç”¨nextæ–¹æ³•ï¼Œåˆ™ä¼šæ˜¾ç¤ºLoadingç•Œé¢ï¼Œå¹¶ä¸”å¼‚æ­¥åŠ è½½æ•°æ®ã€‚ç­‰åˆ°æ•°æ®åŠ è½½å®Œæˆï¼Œå†ä¸€æ¬¡ä½¿ç”¨nextæ–¹æ³•ï¼Œåˆ™ä¼šéšè—Loadingç•Œé¢ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§å†™æ³•çš„å¥½å¤„æ˜¯æ‰€æœ‰Loadingç•Œé¢çš„é€»è¾‘ï¼Œéƒ½è¢«å°è£…åœ¨ä¸€ä¸ªå‡½æ•°ï¼ŒæŒ‰éƒ¨å°±ç­éå¸¸æ¸…æ™°ã€‚ Ajaxæ˜¯å…¸å‹çš„å¼‚æ­¥æ“ä½œï¼Œé€šè¿‡Generatorå‡½æ•°éƒ¨ç½²Ajaxæ“ä½œï¼Œå¯ä»¥ç”¨åŒæ­¥çš„æ–¹å¼è¡¨è¾¾ã€‚ 1234567891011121314function* main() &#123; var result = yield request(\"http://some.url\"); var resp = JSON.parse(result); console.log(resp.value);&#125;function request(url) &#123; makeAjaxCall(url, function(response)&#123; it.next(response); &#125;);&#125;var it = main();it.next(); ä¸Šé¢ä»£ç çš„mainå‡½æ•°ï¼Œå°±æ˜¯é€šè¿‡Ajaxæ“ä½œè·å–æ•°æ®ã€‚å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†å¤šäº†ä¸€ä¸ªyieldï¼Œå®ƒå‡ ä¹ä¸åŒæ­¥æ“ä½œçš„å†™æ³•å®Œå…¨ä¸€æ ·ã€‚æ³¨æ„ï¼ŒmakeAjaxCallå‡½æ•°ä¸­çš„nextæ–¹æ³•ï¼Œå¿…é¡»åŠ ä¸Šresponseå‚æ•°ï¼Œå› ä¸ºyieldè¯­å¥æ„æˆçš„è¡¨è¾¾å¼ï¼Œæœ¬èº«æ˜¯æ²¡æœ‰å€¼çš„ï¼Œæ€»æ˜¯ç­‰äºundefinedã€‚ ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ï¼Œé€šè¿‡Generatorå‡½æ•°é€è¡Œè¯»å–æ–‡æœ¬æ–‡ä»¶ã€‚ 12345678910function* numbers() &#123; let file = new FileReader(\"numbers.txt\"); try &#123; while(!file.eof) &#123; yield parseInt(file.readLine(), 10); &#125; &#125; finally &#123; file.close(); &#125;&#125; ä¸Šé¢ä»£ç æ‰“å¼€æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨yieldè¯­å¥å¯ä»¥æ‰‹åŠ¨é€è¡Œè¯»å–æ–‡ä»¶ã€‚ ï¼ˆ2ï¼‰æ§åˆ¶æµç®¡ç†å¦‚æœæœ‰ä¸€ä¸ªå¤šæ­¥æ“ä½œéå¸¸è€—æ—¶ï¼Œé‡‡ç”¨å›è°ƒå‡½æ•°ï¼Œå¯èƒ½ä¼šå†™æˆä¸‹é¢è¿™æ ·ã€‚ 123456789step1(function (value1) &#123; step2(value1, function(value2) &#123; step3(value2, function(value3) &#123; step4(value3, function(value4) &#123; // Do something with value4 &#125;); &#125;); &#125;);&#125;); é‡‡ç”¨Promiseæ”¹å†™ä¸Šé¢çš„ä»£ç ã€‚ 12345678910Promise.resolve(step1) .then(step2) .then(step3) .then(step4) .then(function (value4) &#123; // Do something with value4 &#125;, function (error) &#123; // Handle any error from step1 through step4 &#125;) .done(); ä¸Šé¢ä»£ç å·²ç»æŠŠå›è°ƒå‡½æ•°ï¼Œæ”¹æˆäº†ç›´çº¿æ‰§è¡Œçš„å½¢å¼ï¼Œä½†æ˜¯åŠ å…¥äº†å¤§é‡Promiseçš„è¯­æ³•ã€‚Generatorå‡½æ•°å¯ä»¥è¿›ä¸€æ­¥æ”¹å–„ä»£ç è¿è¡Œæµç¨‹ã€‚ 1234567891011function* longRunningTask(value1) &#123; try &#123; var value2 = yield step1(value1); var value3 = yield step2(value2); var value4 = yield step3(value3); var value5 = yield step4(value4); // Do something with value4 &#125; catch (e) &#123; // Handle any error from step1 through step4 &#125;&#125; ç„¶åï¼Œä½¿ç”¨ä¸€ä¸ªå‡½æ•°ï¼ŒæŒ‰æ¬¡åºè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰æ­¥éª¤ã€‚ 12345678910scheduler(longRunningTask(initialValue));function scheduler(task) &#123; var taskObj = task.next(task.value); // å¦‚æœGeneratorå‡½æ•°æœªç»“æŸï¼Œå°±ç»§ç»­è°ƒç”¨ if (!taskObj.done) &#123; task.value = taskObj.value scheduler(task); &#125;&#125; æ³¨æ„ï¼Œä¸Šé¢è¿™ç§åšæ³•ï¼Œåªé€‚åˆåŒæ­¥æ“ä½œï¼Œå³æ‰€æœ‰çš„taskéƒ½å¿…é¡»æ˜¯åŒæ­¥çš„ï¼Œä¸èƒ½æœ‰å¼‚æ­¥æ“ä½œã€‚å› ä¸ºè¿™é‡Œçš„ä»£ç ä¸€å¾—åˆ°è¿”å›å€¼ï¼Œå°±ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ²¡æœ‰åˆ¤æ–­å¼‚æ­¥æ“ä½œä½•æ—¶å®Œæˆã€‚å¦‚æœè¦æ§åˆ¶å¼‚æ­¥çš„æ“ä½œæµç¨‹ï¼Œè¯¦è§åé¢çš„ã€Šå¼‚æ­¥æ“ä½œã€‹ä¸€ç« ã€‚ ä¸‹é¢ï¼Œåˆ©ç”¨for...ofå¾ªç¯ä¼šè‡ªåŠ¨ä¾æ¬¡æ‰§è¡Œyieldå‘½ä»¤çš„ç‰¹æ€§ï¼Œæä¾›ä¸€ç§æ›´ä¸€èˆ¬çš„æ§åˆ¶æµç®¡ç†çš„æ–¹æ³•ã€‚ 12345678let steps = [step1Func, step2Func, step3Func];function *iterateSteps(steps)&#123; for (var i=0; i&lt; steps.length; i++)&#123; var step = steps[i]; yield step(); &#125;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„stepså°è£…äº†ä¸€ä¸ªä»»åŠ¡çš„å¤šä¸ªæ­¥éª¤ï¼ŒGeneratorå‡½æ•°iterateStepsåˆ™æ˜¯ä¾æ¬¡ä¸ºè¿™äº›æ­¥éª¤åŠ ä¸Šyieldå‘½ä»¤ã€‚ å°†ä»»åŠ¡åˆ†è§£æˆæ­¥éª¤ä¹‹åï¼Œè¿˜å¯ä»¥å°†é¡¹ç›®åˆ†è§£æˆå¤šä¸ªä¾æ¬¡æ‰§è¡Œçš„ä»»åŠ¡ã€‚ 12345678let jobs = [job1, job2, job3];function *iterateJobs(jobs)&#123; for (var i=0; i&lt; jobs.length; i++)&#123; var job = jobs[i]; yield *iterateSteps(job.steps); &#125;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„jobså°è£…äº†ä¸€ä¸ªé¡¹ç›®çš„å¤šä¸ªä»»åŠ¡ï¼ŒGeneratorå‡½æ•°iterateJobsåˆ™æ˜¯ä¾æ¬¡ä¸ºè¿™äº›ä»»åŠ¡åŠ ä¸Šyield *å‘½ä»¤ã€‚ æœ€åï¼Œå°±å¯ä»¥ç”¨for...ofå¾ªç¯ä¸€æ¬¡æ€§ä¾æ¬¡æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡çš„æ‰€æœ‰æ­¥éª¤ã€‚ 123for (var step of iterateJobs(jobs))&#123; console.log(step.id);&#125; å†æ¬¡æé†’ï¼Œä¸Šé¢çš„åšæ³•åªèƒ½ç”¨äºæ‰€æœ‰æ­¥éª¤éƒ½æ˜¯åŒæ­¥æ“ä½œçš„æƒ…å†µï¼Œä¸èƒ½æœ‰å¼‚æ­¥æ“ä½œçš„æ­¥éª¤ã€‚å¦‚æœæƒ³è¦ä¾æ¬¡æ‰§è¡Œå¼‚æ­¥çš„æ­¥éª¤ï¼Œå¿…é¡»ä½¿ç”¨åé¢çš„ã€Šå¼‚æ­¥æ“ä½œã€‹ä¸€ç« ä»‹ç»çš„æ–¹æ³•ã€‚ for...ofçš„æœ¬è´¨æ˜¯ä¸€ä¸ªwhileå¾ªç¯ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç å®è´¨ä¸Šæ‰§è¡Œçš„æ˜¯ä¸‹é¢çš„é€»è¾‘ã€‚ 12345678var it = iterateJobs(jobs);var res = it.next();while (!res.done)&#123; var result = res.value; // ... res = it.next();&#125; ï¼ˆ3ï¼‰éƒ¨ç½²Iteratoræ¥å£åˆ©ç”¨Generatorå‡½æ•°ï¼Œå¯ä»¥åœ¨ä»»æ„å¯¹è±¡ä¸Šéƒ¨ç½²Iteratoræ¥å£ã€‚ 12345678910111213141516function* iterEntries(obj) &#123; let keys = Object.keys(obj); for (let i=0; i &lt; keys.length; i++) &#123; let key = keys[i]; yield [key, obj[key]]; &#125;&#125;let myObj = &#123; foo: 3, bar: 7 &#125;;for (let [key, value] of iterEntries(myObj)) &#123; console.log(key, value);&#125;// foo 3// bar 7 ä¸Šè¿°ä»£ç ä¸­ï¼ŒmyObjæ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œé€šè¿‡iterEntrieså‡½æ•°ï¼Œå°±æœ‰äº†Iteratoræ¥å£ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥åœ¨ä»»æ„å¯¹è±¡ä¸Šéƒ¨ç½²nextæ–¹æ³•ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªå¯¹æ•°ç»„éƒ¨ç½²Iteratoræ¥å£çš„ä¾‹å­ï¼Œå°½ç®¡æ•°ç»„åŸç”Ÿå…·æœ‰è¿™ä¸ªæ¥å£ã€‚ 12345678910111213function* makeSimpleGenerator(array)&#123; var nextIndex = 0; while(nextIndex &lt; array.length)&#123; yield array[nextIndex++]; &#125;&#125;var gen = makeSimpleGenerator(['yo', 'ya']);gen.next().value // 'yo'gen.next().value // 'ya'gen.next().done // true ï¼ˆ4ï¼‰ä½œä¸ºæ•°æ®ç»“æ„Generatorå¯ä»¥çœ‹ä½œæ˜¯æ•°æ®ç»“æ„ï¼Œæ›´ç¡®åˆ‡åœ°è¯´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªæ•°ç»„ç»“æ„ï¼Œå› ä¸ºGeneratorå‡½æ•°å¯ä»¥è¿”å›ä¸€ç³»åˆ—çš„å€¼ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥å¯¹ä»»æ„è¡¨è¾¾å¼ï¼Œæä¾›ç±»ä¼¼æ•°ç»„çš„æ¥å£ã€‚ 12345function *doStuff() &#123; yield fs.readFile.bind(null, 'hello.txt'); yield fs.readFile.bind(null, 'world.txt'); yield fs.readFile.bind(null, 'and-such.txt');&#125; ä¸Šé¢ä»£ç å°±æ˜¯ä¾æ¬¡è¿”å›ä¸‰ä¸ªå‡½æ•°ï¼Œä½†æ˜¯ç”±äºä½¿ç”¨äº†Generatorå‡½æ•°ï¼Œå¯¼è‡´å¯ä»¥åƒå¤„ç†æ•°ç»„é‚£æ ·ï¼Œå¤„ç†è¿™ä¸‰ä¸ªè¿”å›çš„å‡½æ•°ã€‚ 123for (task of doStuff()) &#123; // taskæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥åƒå›è°ƒå‡½æ•°é‚£æ ·ä½¿ç”¨å®ƒ&#125; å®é™…ä¸Šï¼Œå¦‚æœç”¨ES5è¡¨è¾¾ï¼Œå®Œå…¨å¯ä»¥ç”¨æ•°ç»„æ¨¡æ‹ŸGeneratorçš„è¿™ç§ç”¨æ³•ã€‚ 1234567function doStuff() &#123; return [ fs.readFile.bind(null, 'hello.txt'), fs.readFile.bind(null, 'world.txt'), fs.readFile.bind(null, 'and-such.txt') ];&#125; ä¸Šé¢çš„å‡½æ•°ï¼Œå¯ä»¥ç”¨ä¸€æ¨¡ä¸€æ ·çš„forâ€¦ofå¾ªç¯å¤„ç†ï¼ä¸¤ç›¸ä¸€æ¯”è¾ƒï¼Œå°±ä¸éš¾çœ‹å‡ºGeneratorä½¿å¾—æ•°æ®æˆ–è€…æ“ä½œï¼Œå…·å¤‡äº†ç±»ä¼¼æ•°ç»„çš„æ¥å£ã€‚","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"Generator","slug":"Generator","permalink":"http://microzz.com/tags/Generator/"}]},{"title":"Iteratorå’Œfor...ofå¾ªç¯","date":"2017-01-12T07:45:19.000Z","path":"2017/01/12/iterator/","text":"Iteratorå’Œforâ€¦ofå¾ªç¯Iteratorï¼ˆéå†å™¨ï¼‰çš„æ¦‚å¿µJavaScriptåŸæœ‰çš„è¡¨ç¤ºâ€œé›†åˆâ€çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦æ˜¯æ•°ç»„ï¼ˆArrayï¼‰å’Œå¯¹è±¡ï¼ˆObjectï¼‰ï¼ŒES6åˆæ·»åŠ äº†Mapå’ŒSetã€‚è¿™æ ·å°±æœ‰äº†å››ç§æ•°æ®é›†åˆï¼Œç”¨æˆ·è¿˜å¯ä»¥ç»„åˆä½¿ç”¨å®ƒä»¬ï¼Œå®šä¹‰è‡ªå·±çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚æ•°ç»„çš„æˆå‘˜æ˜¯Mapï¼ŒMapçš„æˆå‘˜æ˜¯å¯¹è±¡ã€‚è¿™æ ·å°±éœ€è¦ä¸€ç§ç»Ÿä¸€çš„æ¥å£æœºåˆ¶ï¼Œæ¥å¤„ç†æ‰€æœ‰ä¸åŒçš„æ•°æ®ç»“æ„ã€‚ éå†å™¨ï¼ˆIteratorï¼‰å°±æ˜¯è¿™æ ·ä¸€ç§æœºåˆ¶ã€‚å®ƒæ˜¯ä¸€ç§æ¥å£ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚ä»»ä½•æ•°æ®ç»“æ„åªè¦éƒ¨ç½²Iteratoræ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œï¼ˆå³ä¾æ¬¡å¤„ç†è¯¥æ•°æ®ç»“æ„çš„æ‰€æœ‰æˆå‘˜ï¼‰ã€‚ Iteratorçš„ä½œç”¨æœ‰ä¸‰ä¸ªï¼šä¸€æ˜¯ä¸ºå„ç§æ•°æ®ç»“æ„ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ã€ç®€ä¾¿çš„è®¿é—®æ¥å£ï¼›äºŒæ˜¯ä½¿å¾—æ•°æ®ç»“æ„çš„æˆå‘˜èƒ½å¤ŸæŒ‰æŸç§æ¬¡åºæ’åˆ—ï¼›ä¸‰æ˜¯ES6åˆ›é€ äº†ä¸€ç§æ–°çš„éå†å‘½ä»¤for...ofå¾ªç¯ï¼ŒIteratoræ¥å£ä¸»è¦ä¾›for...ofæ¶ˆè´¹ã€‚ Iteratorçš„éå†è¿‡ç¨‹æ˜¯è¿™æ ·çš„ã€‚ ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ï¼ŒæŒ‡å‘å½“å‰æ•°æ®ç»“æ„çš„èµ·å§‹ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéå†å™¨å¯¹è±¡æœ¬è´¨ä¸Šï¼Œå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ã€‚ ï¼ˆ2ï¼‰ç¬¬ä¸€æ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„nextæ–¹æ³•ï¼Œå¯ä»¥å°†æŒ‡é’ˆæŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ã€‚ ï¼ˆ3ï¼‰ç¬¬äºŒæ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„nextæ–¹æ³•ï¼ŒæŒ‡é’ˆå°±æŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬äºŒä¸ªæˆå‘˜ã€‚ ï¼ˆ4ï¼‰ä¸æ–­è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„nextæ–¹æ³•ï¼Œç›´åˆ°å®ƒæŒ‡å‘æ•°æ®ç»“æ„çš„ç»“æŸä½ç½®ã€‚ æ¯ä¸€æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼Œéƒ½ä¼šè¿”å›æ•°æ®ç»“æ„çš„å½“å‰æˆå‘˜çš„ä¿¡æ¯ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯è¿”å›ä¸€ä¸ªåŒ…å«valueå’Œdoneä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ã€‚å…¶ä¸­ï¼Œvalueå±æ€§æ˜¯å½“å‰æˆå‘˜çš„å€¼ï¼Œdoneå±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºéå†æ˜¯å¦ç»“æŸã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿnextæ–¹æ³•è¿”å›å€¼çš„ä¾‹å­ã€‚ 12345678910111213141516var it = makeIterator(['a', 'b']);it.next() // &#123; value: \"a\", done: false &#125;it.next() // &#123; value: \"b\", done: false &#125;it.next() // &#123; value: undefined, done: true &#125;function makeIterator(array) &#123; var nextIndex = 0; return &#123; next: function() &#123; return nextIndex &lt; array.length ? &#123;value: array[nextIndex++], done: false&#125; : &#123;value: undefined, done: true&#125;; &#125; &#125;;&#125; ä¸Šé¢ä»£ç å®šä¹‰äº†ä¸€ä¸ªmakeIteratorå‡½æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªéå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œä½œç”¨å°±æ˜¯è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚å¯¹æ•°ç»„[&#39;a&#39;, &#39;b&#39;]æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå°±ä¼šè¿”å›è¯¥æ•°ç»„çš„éå†å™¨å¯¹è±¡ï¼ˆå³æŒ‡é’ˆå¯¹è±¡ï¼‰itã€‚ æŒ‡é’ˆå¯¹è±¡çš„nextæ–¹æ³•ï¼Œç”¨æ¥ç§»åŠ¨æŒ‡é’ˆã€‚å¼€å§‹æ—¶ï¼ŒæŒ‡é’ˆæŒ‡å‘æ•°ç»„çš„å¼€å§‹ä½ç½®ã€‚ç„¶åï¼Œæ¯æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼ŒæŒ‡é’ˆå°±ä¼šæŒ‡å‘æ•°ç»„çš„ä¸‹ä¸€ä¸ªæˆå‘˜ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼ŒæŒ‡å‘aï¼›ç¬¬äºŒæ¬¡è°ƒç”¨ï¼ŒæŒ‡å‘bã€‚ nextæ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºå½“å‰æ•°æ®æˆå‘˜çš„ä¿¡æ¯ã€‚è¿™ä¸ªå¯¹è±¡å…·æœ‰valueå’Œdoneä¸¤ä¸ªå±æ€§ï¼Œvalueå±æ€§è¿”å›å½“å‰ä½ç½®çš„æˆå‘˜ï¼Œdoneå±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºéå†æ˜¯å¦ç»“æŸï¼Œå³æ˜¯å¦è¿˜æœ‰å¿…è¦å†ä¸€æ¬¡è°ƒç”¨nextæ–¹æ³•ã€‚ æ€»ä¹‹ï¼Œè°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„nextæ–¹æ³•ï¼Œå°±å¯ä»¥éå†äº‹å…ˆç»™å®šçš„æ•°æ®ç»“æ„ã€‚ å¯¹äºéå†å™¨å¯¹è±¡æ¥è¯´ï¼Œdone: falseå’Œvalue: undefinedå±æ€§éƒ½æ˜¯å¯ä»¥çœç•¥çš„ï¼Œå› æ­¤ä¸Šé¢çš„makeIteratorå‡½æ•°å¯ä»¥ç®€å†™æˆä¸‹é¢çš„å½¢å¼ã€‚ 12345678910function makeIterator(array) &#123; var nextIndex = 0; return &#123; next: function() &#123; return nextIndex &lt; array.length ? &#123;value: array[nextIndex++]&#125; : &#123;done: true&#125;; &#125; &#125;;&#125; ç”±äºIteratoråªæ˜¯æŠŠæ¥å£è§„æ ¼åŠ åˆ°æ•°æ®ç»“æ„ä¹‹ä¸Šï¼Œæ‰€ä»¥ï¼Œéå†å™¨ä¸å®ƒæ‰€éå†çš„é‚£ä¸ªæ•°æ®ç»“æ„ï¼Œå®é™…ä¸Šæ˜¯åˆ†å¼€çš„ï¼Œå®Œå…¨å¯ä»¥å†™å‡ºæ²¡æœ‰å¯¹åº”æ•°æ®ç»“æ„çš„éå†å™¨å¯¹è±¡ï¼Œæˆ–è€…è¯´ç”¨éå†å™¨å¯¹è±¡æ¨¡æ‹Ÿå‡ºæ•°æ®ç»“æ„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ— é™è¿è¡Œçš„éå†å™¨å¯¹è±¡çš„ä¾‹å­ã€‚ 12345678910111213141516var it = idMaker();it.next().value // '0'it.next().value // '1'it.next().value // '2'// ...function idMaker() &#123; var index = 0; return &#123; next: function() &#123; return &#123;value: index++, done: false&#125;; &#125; &#125;;&#125; ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œéå†å™¨ç”Ÿæˆå‡½æ•°idMakerï¼Œè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼ˆå³æŒ‡é’ˆå¯¹è±¡ï¼‰ã€‚ä½†æ˜¯å¹¶æ²¡æœ‰å¯¹åº”çš„æ•°æ®ç»“æ„ï¼Œæˆ–è€…è¯´ï¼Œéå†å™¨å¯¹è±¡è‡ªå·±æè¿°äº†ä¸€ä¸ªæ•°æ®ç»“æ„å‡ºæ¥ã€‚ åœ¨ES6ä¸­ï¼Œæœ‰äº›æ•°æ®ç»“æ„åŸç”Ÿå…·å¤‡Iteratoræ¥å£ï¼ˆæ¯”å¦‚æ•°ç»„ï¼‰ï¼Œå³ä¸ç”¨ä»»ä½•å¤„ç†ï¼Œå°±å¯ä»¥è¢«for...ofå¾ªç¯éå†ï¼Œæœ‰äº›å°±ä¸è¡Œï¼ˆæ¯”å¦‚å¯¹è±¡ï¼‰ã€‚åŸå› åœ¨äºï¼Œè¿™äº›æ•°æ®ç»“æ„åŸç”Ÿéƒ¨ç½²äº†Symbol.iteratorå±æ€§ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œå¦å¤–ä¸€äº›æ•°æ®ç»“æ„æ²¡æœ‰ã€‚å‡¡æ˜¯éƒ¨ç½²äº†Symbol.iteratorå±æ€§çš„æ•°æ®ç»“æ„ï¼Œå°±ç§°ä¸ºéƒ¨ç½²äº†éå†å™¨æ¥å£ã€‚è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚ å¦‚æœä½¿ç”¨TypeScriptçš„å†™æ³•ï¼Œéå†å™¨æ¥å£ï¼ˆIterableï¼‰ã€æŒ‡é’ˆå¯¹è±¡ï¼ˆIteratorï¼‰å’Œnextæ–¹æ³•è¿”å›å€¼çš„è§„æ ¼å¯ä»¥æè¿°å¦‚ä¸‹ã€‚ 123456789101112interface Iterable &#123; [Symbol.iterator]() : Iterator,&#125;interface Iterator &#123; next(value?: any) : IterationResult,&#125;interface IterationResult &#123; value: any, done: boolean,&#125; æ•°æ®ç»“æ„çš„é»˜è®¤Iteratoræ¥å£Iteratoræ¥å£çš„ç›®çš„ï¼Œå°±æ˜¯ä¸ºæ‰€æœ‰æ•°æ®ç»“æ„ï¼Œæä¾›äº†ä¸€ç§ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ï¼Œå³for...ofå¾ªç¯ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ã€‚å½“ä½¿ç”¨for...ofå¾ªç¯éå†æŸç§æ•°æ®ç»“æ„æ—¶ï¼Œè¯¥å¾ªç¯ä¼šè‡ªåŠ¨å»å¯»æ‰¾Iteratoræ¥å£ã€‚ ä¸€ç§æ•°æ®ç»“æ„åªè¦éƒ¨ç½²äº†Iteratoræ¥å£ï¼Œæˆ‘ä»¬å°±ç§°è¿™ç§æ•°æ®ç»“æ„æ˜¯â€å¯éå†çš„â€œï¼ˆiterableï¼‰ã€‚ ES6è§„å®šï¼Œé»˜è®¤çš„Iteratoræ¥å£éƒ¨ç½²åœ¨æ•°æ®ç»“æ„çš„Symbol.iteratorå±æ€§ï¼Œæˆ–è€…è¯´ï¼Œä¸€ä¸ªæ•°æ®ç»“æ„åªè¦å…·æœ‰Symbol.iteratorå±æ€§ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯â€œå¯éå†çš„â€ï¼ˆiterableï¼‰ã€‚Symbol.iteratorå±æ€§æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯å½“å‰æ•°æ®ç»“æ„é»˜è®¤çš„éå†å™¨ç”Ÿæˆå‡½æ•°ã€‚æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªéå†å™¨ã€‚è‡³äºå±æ€§åSymbol.iteratorï¼Œå®ƒæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿”å›Symbolå¯¹è±¡çš„iteratorå±æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªé¢„å®šä¹‰å¥½çš„ã€ç±»å‹ä¸ºSymbolçš„ç‰¹æ®Šå€¼ï¼Œæ‰€ä»¥è¦æ”¾åœ¨æ–¹æ‹¬å·å†…ã€‚ï¼ˆå‚è§Symbolä¸€ç« ï¼‰ã€‚ 123456789101112const obj = &#123; [Symbol.iterator] : function () &#123; return &#123; next: function () &#123; return &#123; value: 1, done: true &#125;; &#125; &#125;; &#125;&#125;; ä¸Šé¢ä»£ç ä¸­ï¼Œå¯¹è±¡objæ˜¯å¯éå†çš„ï¼ˆiterableï¼‰ï¼Œå› ä¸ºå…·æœ‰Symbol.iteratorå±æ€§ã€‚æ‰§è¡Œè¿™ä¸ªå±æ€§ï¼Œä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚è¯¥å¯¹è±¡çš„æ ¹æœ¬ç‰¹å¾å°±æ˜¯å…·æœ‰nextæ–¹æ³•ã€‚æ¯æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªä»£è¡¨å½“å‰æˆå‘˜çš„ä¿¡æ¯å¯¹è±¡ï¼Œå…·æœ‰valueå’Œdoneä¸¤ä¸ªå±æ€§ã€‚ åœ¨ES6ä¸­ï¼Œæœ‰ä¸‰ç±»æ•°æ®ç»“æ„åŸç”Ÿå…·å¤‡Iteratoræ¥å£ï¼šæ•°ç»„ã€æŸäº›ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€Setå’ŒMapç»“æ„ã€‚ 1234567let arr = ['a', 'b', 'c'];let iter = arr[Symbol.iterator]();iter.next() // &#123; value: 'a', done: false &#125;iter.next() // &#123; value: 'b', done: false &#125;iter.next() // &#123; value: 'c', done: false &#125;iter.next() // &#123; value: undefined, done: true &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡arræ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŸç”Ÿå°±å…·æœ‰éå†å™¨æ¥å£ï¼Œéƒ¨ç½²åœ¨arrçš„Symbol.iteratorå±æ€§ä¸Šé¢ã€‚æ‰€ä»¥ï¼Œè°ƒç”¨è¿™ä¸ªå±æ€§ï¼Œå°±å¾—åˆ°éå†å™¨å¯¹è±¡ã€‚ ä¸Šé¢æåˆ°ï¼ŒåŸç”Ÿå°±éƒ¨ç½²Iteratoræ¥å£çš„æ•°æ®ç»“æ„æœ‰ä¸‰ç±»ï¼Œå¯¹äºè¿™ä¸‰ç±»æ•°æ®ç»“æ„ï¼Œä¸ç”¨è‡ªå·±å†™éå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œfor...ofå¾ªç¯ä¼šè‡ªåŠ¨éå†å®ƒä»¬ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå…¶ä»–æ•°æ®ç»“æ„ï¼ˆä¸»è¦æ˜¯å¯¹è±¡ï¼‰çš„Iteratoræ¥å£ï¼Œéƒ½éœ€è¦è‡ªå·±åœ¨Symbol.iteratorå±æ€§ä¸Šé¢éƒ¨ç½²ï¼Œè¿™æ ·æ‰ä¼šè¢«for...ofå¾ªç¯éå†ã€‚ å¯¹è±¡ï¼ˆObjectï¼‰ä¹‹æ‰€ä»¥æ²¡æœ‰é»˜è®¤éƒ¨ç½²Iteratoræ¥å£ï¼Œæ˜¯å› ä¸ºå¯¹è±¡çš„å“ªä¸ªå±æ€§å…ˆéå†ï¼Œå“ªä¸ªå±æ€§åéå†æ˜¯ä¸ç¡®å®šçš„ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨æŒ‡å®šã€‚æœ¬è´¨ä¸Šï¼Œéå†å™¨æ˜¯ä¸€ç§çº¿æ€§å¤„ç†ï¼Œå¯¹äºä»»ä½•éçº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œéƒ¨ç½²éå†å™¨æ¥å£ï¼Œå°±ç­‰äºéƒ¨ç½²ä¸€ç§çº¿æ€§è½¬æ¢ã€‚ä¸è¿‡ï¼Œä¸¥æ ¼åœ°è¯´ï¼Œå¯¹è±¡éƒ¨ç½²éå†å™¨æ¥å£å¹¶ä¸æ˜¯å¾ˆå¿…è¦ï¼Œå› ä¸ºè¿™æ—¶å¯¹è±¡å®é™…ä¸Šè¢«å½“ä½œMapç»“æ„ä½¿ç”¨ï¼ŒES5æ²¡æœ‰Mapç»“æ„ï¼Œè€ŒES6åŸç”Ÿæä¾›äº†ã€‚ ä¸€ä¸ªå¯¹è±¡å¦‚æœè¦æœ‰å¯è¢«for...ofå¾ªç¯è°ƒç”¨çš„Iteratoræ¥å£ï¼Œå°±å¿…é¡»åœ¨Symbol.iteratorçš„å±æ€§ä¸Šéƒ¨ç½²éå†å™¨ç”Ÿæˆæ–¹æ³•ï¼ˆåŸå‹é“¾ä¸Šçš„å¯¹è±¡å…·æœ‰è¯¥æ–¹æ³•ä¹Ÿå¯ï¼‰ã€‚ 1234567891011121314151617181920212223242526class RangeIterator &#123; constructor(start, stop) &#123; this.value = start; this.stop = stop; &#125; [Symbol.iterator]() &#123; return this; &#125; next() &#123; var value = this.value; if (value &lt; this.stop) &#123; this.value++; return &#123;done: false, value: value&#125;; &#125; else &#123; return &#123;done: true, value: undefined&#125;; &#125; &#125;&#125;function range(start, stop) &#123; return new RangeIterator(start, stop);&#125;for (var value of range(0, 3)) &#123; console.log(value);&#125; ä¸Šé¢ä»£ç æ˜¯ä¸€ä¸ªç±»éƒ¨ç½²Iteratoræ¥å£çš„å†™æ³•ã€‚Symbol.iteratorå±æ€§å¯¹åº”ä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œåè¿”å›å½“å‰å¯¹è±¡çš„éå†å™¨å¯¹è±¡ã€‚ ä¸‹é¢æ˜¯é€šè¿‡éå†å™¨å®ç°æŒ‡é’ˆç»“æ„çš„ä¾‹å­ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142function Obj(value) &#123; this.value = value; this.next = null;&#125;Obj.prototype[Symbol.iterator] = function() &#123; var iterator = &#123; next: next &#125;; var current = this; function next() &#123; if (current) &#123; var value = current.value; current = current.next; return &#123; done: false, value: value &#125;; &#125; else &#123; return &#123; done: true &#125;; &#125; &#125; return iterator;&#125;var one = new Obj(1);var two = new Obj(2);var three = new Obj(3);one.next = two;two.next = three;for (var i of one)&#123; console.log(i);&#125;// 1// 2// 3 ä¸Šé¢ä»£ç é¦–å…ˆåœ¨æ„é€ å‡½æ•°çš„åŸå‹é“¾ä¸Šéƒ¨ç½²Symbol.iteratoræ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ä¼šè¿”å›éå†å™¨å¯¹è±¡iteratorï¼Œè°ƒç”¨è¯¥å¯¹è±¡çš„nextæ–¹æ³•ï¼Œåœ¨è¿”å›ä¸€ä¸ªå€¼çš„åŒæ—¶ï¼Œè‡ªåŠ¨å°†å†…éƒ¨æŒ‡é’ˆç§»åˆ°ä¸‹ä¸€ä¸ªå®ä¾‹ã€‚ ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¸ºå¯¹è±¡æ·»åŠ Iteratoræ¥å£çš„ä¾‹å­ã€‚ 12345678910111213141516171819let obj = &#123; data: [ 'hello', 'world' ], [Symbol.iterator]() &#123; const self = this; let index = 0; return &#123; next() &#123; if (index &lt; self.data.length) &#123; return &#123; value: self.data[index++], done: false &#125;; &#125; else &#123; return &#123; value: undefined, done: true &#125;; &#125; &#125; &#125;; &#125;&#125;; å¯¹äºç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ˆå­˜åœ¨æ•°å€¼é”®åå’Œlengthå±æ€§ï¼‰ï¼Œéƒ¨ç½²Iteratoræ¥å£ï¼Œæœ‰ä¸€ä¸ªç®€ä¾¿æ–¹æ³•ï¼Œå°±æ˜¯Symbol.iteratoræ–¹æ³•ç›´æ¥å¼•ç”¨æ•°ç»„çš„Iteratoræ¥å£ã€‚ 12345NodeList.prototype[Symbol.iterator] = Array.prototype[Symbol.iterator];// æˆ–è€…NodeList.prototype[Symbol.iterator] = [][Symbol.iterator];[...document.querySelectorAll('div')] // å¯ä»¥æ‰§è¡Œäº† ä¸‹é¢æ˜¯ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡è°ƒç”¨æ•°ç»„çš„Symbol.iteratoræ–¹æ³•çš„ä¾‹å­ã€‚ 12345678910let iterable = &#123; 0: 'a', 1: 'b', 2: 'c', length: 3, [Symbol.iterator]: Array.prototype[Symbol.iterator]&#125;;for (let item of iterable) &#123; console.log(item); // 'a', 'b', 'c'&#125; æ³¨æ„ï¼Œæ™®é€šå¯¹è±¡éƒ¨ç½²æ•°ç»„çš„Symbol.iteratoræ–¹æ³•ï¼Œå¹¶æ— æ•ˆæœã€‚ 12345678910let iterable = &#123; a: 'a', b: 'b', c: 'c', length: 3, [Symbol.iterator]: Array.prototype[Symbol.iterator]&#125;;for (let item of iterable) &#123; console.log(item); // undefined, undefined, undefined&#125; å¦‚æœSymbol.iteratoræ–¹æ³•å¯¹åº”çš„ä¸æ˜¯éå†å™¨ç”Ÿæˆå‡½æ•°ï¼ˆå³ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼‰ï¼Œè§£é‡Šå¼•æ“å°†ä¼šæŠ¥é”™ã€‚ 12345var obj = &#123;&#125;;obj[Symbol.iterator] = () =&gt; 1;[...obj] // TypeError: [] is not a function ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡objçš„Symbol.iteratoræ–¹æ³•å¯¹åº”çš„ä¸æ˜¯éå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œå› æ­¤æŠ¥é”™ã€‚ æœ‰äº†éå†å™¨æ¥å£ï¼Œæ•°æ®ç»“æ„å°±å¯ä»¥ç”¨for...ofå¾ªç¯éå†ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨whileå¾ªç¯éå†ã€‚ 1234567var $iterator = ITERABLE[Symbol.iterator]();var $result = $iterator.next();while (!$result.done) &#123; var x = $result.value; // ... $result = $iterator.next();&#125; ä¸Šé¢ä»£ç ä¸­ï¼ŒITERABLEä»£è¡¨æŸç§å¯éå†çš„æ•°æ®ç»“æ„ï¼Œ$iteratoræ˜¯å®ƒçš„éå†å™¨å¯¹è±¡ã€‚éå†å™¨å¯¹è±¡æ¯æ¬¡ç§»åŠ¨æŒ‡é’ˆï¼ˆnextæ–¹æ³•ï¼‰ï¼Œéƒ½æ£€æŸ¥ä¸€ä¸‹è¿”å›å€¼çš„doneå±æ€§ï¼Œå¦‚æœéå†è¿˜æ²¡ç»“æŸï¼Œå°±ç§»åŠ¨éå†å™¨å¯¹è±¡çš„æŒ‡é’ˆåˆ°ä¸‹ä¸€æ­¥ï¼ˆnextæ–¹æ³•ï¼‰ï¼Œä¸æ–­å¾ªç¯ã€‚ è°ƒç”¨Iteratoræ¥å£çš„åœºåˆæœ‰ä¸€äº›åœºåˆä¼šé»˜è®¤è°ƒç”¨Iteratoræ¥å£ï¼ˆå³Symbol.iteratoræ–¹æ³•ï¼‰ï¼Œé™¤äº†ä¸‹æ–‡ä¼šä»‹ç»çš„for...ofå¾ªç¯ï¼Œè¿˜æœ‰å‡ ä¸ªåˆ«çš„åœºåˆã€‚ ï¼ˆ1ï¼‰è§£æ„èµ‹å€¼ å¯¹æ•°ç»„å’ŒSetç»“æ„è¿›è¡Œè§£æ„èµ‹å€¼æ—¶ï¼Œä¼šé»˜è®¤è°ƒç”¨Symbol.iteratoræ–¹æ³•ã€‚ 1234567let set = new Set().add('a').add('b').add('c');let [x,y] = set;// x='a'; y='b'let [first, ...rest] = set;// first='a'; rest=['b','c']; ï¼ˆ2ï¼‰æ‰©å±•è¿ç®—ç¬¦ æ‰©å±•è¿ç®—ç¬¦ï¼ˆâ€¦ï¼‰ä¹Ÿä¼šè°ƒç”¨é»˜è®¤çš„iteratoræ¥å£ã€‚ 12345678// ä¾‹ä¸€var str = 'hello';[...str] // ['h','e','l','l','o']// ä¾‹äºŒlet arr = ['b', 'c'];['a', ...arr, 'd']// ['a', 'b', 'c', 'd'] ä¸Šé¢ä»£ç çš„æ‰©å±•è¿ç®—ç¬¦å†…éƒ¨å°±è°ƒç”¨Iteratoræ¥å£ã€‚ å®é™…ä¸Šï¼Œè¿™æä¾›äº†ä¸€ç§ç®€ä¾¿æœºåˆ¶ï¼Œå¯ä»¥å°†ä»»ä½•éƒ¨ç½²äº†Iteratoræ¥å£çš„æ•°æ®ç»“æ„ï¼Œè½¬ä¸ºæ•°ç»„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æŸä¸ªæ•°æ®ç»“æ„éƒ¨ç½²äº†Iteratoræ¥å£ï¼Œå°±å¯ä»¥å¯¹å®ƒä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼Œå°†å…¶è½¬ä¸ºæ•°ç»„ã€‚ 1let arr = [...iterable]; ï¼ˆ3ï¼‰yield* yield*åé¢è·Ÿçš„æ˜¯ä¸€ä¸ªå¯éå†çš„ç»“æ„ï¼Œå®ƒä¼šè°ƒç”¨è¯¥ç»“æ„çš„éå†å™¨æ¥å£ã€‚ 1234567891011121314let generator = function* () &#123; yield 1; yield* [2,3,4]; yield 5;&#125;;var iterator = generator();iterator.next() // &#123; value: 1, done: false &#125;iterator.next() // &#123; value: 2, done: false &#125;iterator.next() // &#123; value: 3, done: false &#125;iterator.next() // &#123; value: 4, done: false &#125;iterator.next() // &#123; value: 5, done: false &#125;iterator.next() // &#123; value: undefined, done: true &#125; ï¼ˆ4ï¼‰å…¶ä»–åœºåˆ ç”±äºæ•°ç»„çš„éå†ä¼šè°ƒç”¨éå†å™¨æ¥å£ï¼Œæ‰€ä»¥ä»»ä½•æ¥å—æ•°ç»„ä½œä¸ºå‚æ•°çš„åœºåˆï¼Œå…¶å®éƒ½è°ƒç”¨äº†éå†å™¨æ¥å£ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ã€‚ forâ€¦of Array.from() Map(), Set(), WeakMap(), WeakSet()ï¼ˆæ¯”å¦‚new Map([[&#39;a&#39;,1],[&#39;b&#39;,2]])ï¼‰ Promise.all() Promise.race() å­—ç¬¦ä¸²çš„Iteratoræ¥å£å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œä¹ŸåŸç”Ÿå…·æœ‰Iteratoræ¥å£ã€‚ 123456789var someString = \"hi\";typeof someString[Symbol.iterator]// \"function\"var iterator = someString[Symbol.iterator]();iterator.next() // &#123; value: \"h\", done: false &#125;iterator.next() // &#123; value: \"i\", done: false &#125;iterator.next() // &#123; value: undefined, done: true &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œè°ƒç”¨Symbol.iteratoræ–¹æ³•è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªéå†å™¨ä¸Šå¯ä»¥è°ƒç”¨nextæ–¹æ³•ï¼Œå®ç°å¯¹äºå­—ç¬¦ä¸²çš„éå†ã€‚ å¯ä»¥è¦†ç›–åŸç”Ÿçš„Symbol.iteratoræ–¹æ³•ï¼Œè¾¾åˆ°ä¿®æ”¹éå†å™¨è¡Œä¸ºçš„ç›®çš„ã€‚ 1234567891011121314151617181920var str = new String(\"hi\");[...str] // [\"h\", \"i\"]str[Symbol.iterator] = function() &#123; return &#123; next: function() &#123; if (this._first) &#123; this._first = false; return &#123; value: \"bye\", done: false &#125;; &#125; else &#123; return &#123; done: true &#125;; &#125; &#125;, _first: true &#125;;&#125;;[...str] // [\"bye\"]str // \"hi\" ä¸Šé¢ä»£ç ä¸­ï¼Œå­—ç¬¦ä¸²strçš„Symbol.iteratoræ–¹æ³•è¢«ä¿®æ”¹äº†ï¼Œæ‰€ä»¥æ‰©å±•è¿ç®—ç¬¦ï¼ˆ...ï¼‰è¿”å›çš„å€¼å˜æˆäº†byeï¼Œè€Œå­—ç¬¦ä¸²æœ¬èº«è¿˜æ˜¯hiã€‚ Iteratoræ¥å£ä¸Generatorå‡½æ•°Symbol.iteratoræ–¹æ³•çš„æœ€ç®€å•å®ç°ï¼Œè¿˜æ˜¯ä½¿ç”¨ä¸‹ä¸€ç« è¦ä»‹ç»çš„Generatorå‡½æ•°ã€‚ 1234567891011121314151617181920212223var myIterable = &#123;&#125;;myIterable[Symbol.iterator] = function* () &#123; yield 1; yield 2; yield 3;&#125;;[...myIterable] // [1, 2, 3]// æˆ–è€…é‡‡ç”¨ä¸‹é¢çš„ç®€æ´å†™æ³•let obj = &#123; * [Symbol.iterator]() &#123; yield 'hello'; yield 'world'; &#125;&#125;;for (let x of obj) &#123; console.log(x);&#125;// hello// world ä¸Šé¢ä»£ç ä¸­ï¼ŒSymbol.iteratoræ–¹æ³•å‡ ä¹ä¸ç”¨éƒ¨ç½²ä»»ä½•ä»£ç ï¼Œåªè¦ç”¨yieldå‘½ä»¤ç»™å‡ºæ¯ä¸€æ­¥çš„è¿”å›å€¼å³å¯ã€‚ éå†å™¨å¯¹è±¡çš„return()ï¼Œthrow()éå†å™¨å¯¹è±¡é™¤äº†å…·æœ‰nextæ–¹æ³•ï¼Œè¿˜å¯ä»¥å…·æœ‰returnæ–¹æ³•å’Œthrowæ–¹æ³•ã€‚å¦‚æœä½ è‡ªå·±å†™éå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ï¼Œé‚£ä¹ˆnextæ–¹æ³•æ˜¯å¿…é¡»éƒ¨ç½²çš„ï¼Œreturnæ–¹æ³•å’Œthrowæ–¹æ³•æ˜¯å¦éƒ¨ç½²æ˜¯å¯é€‰çš„ã€‚ returnæ–¹æ³•çš„ä½¿ç”¨åœºåˆæ˜¯ï¼Œå¦‚æœfor...ofå¾ªç¯æå‰é€€å‡ºï¼ˆé€šå¸¸æ˜¯å› ä¸ºå‡ºé”™ï¼Œæˆ–è€…æœ‰breakè¯­å¥æˆ–continueè¯­å¥ï¼‰ï¼Œå°±ä¼šè°ƒç”¨returnæ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨å®Œæˆéå†å‰ï¼Œéœ€è¦æ¸…ç†æˆ–é‡Šæ”¾èµ„æºï¼Œå°±å¯ä»¥éƒ¨ç½²returnæ–¹æ³•ã€‚ 1234567891011121314function readLinesSync(file) &#123; return &#123; next() &#123; if (file.isAtEndOfFile()) &#123; file.close(); return &#123; done: true &#125;; &#125; &#125;, return() &#123; file.close(); return &#123; done: true &#125;; &#125;, &#125;;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°readLinesSyncæ¥å—ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå…¶ä¸­é™¤äº†nextæ–¹æ³•ï¼Œè¿˜éƒ¨ç½²äº†returnæ–¹æ³•ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬è®©æ–‡ä»¶çš„éå†æå‰è¿”å›ï¼Œè¿™æ ·å°±ä¼šè§¦å‘æ‰§è¡Œreturnæ–¹æ³•ã€‚ 1234for (let line of readLinesSync(fileName)) &#123; console.log(line); break;&#125; æ³¨æ„ï¼Œreturnæ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ˜¯Generatorè§„æ ¼å†³å®šçš„ã€‚ throwæ–¹æ³•ä¸»è¦æ˜¯é…åˆGeneratorå‡½æ•°ä½¿ç”¨ï¼Œä¸€èˆ¬çš„éå†å™¨å¯¹è±¡ç”¨ä¸åˆ°è¿™ä¸ªæ–¹æ³•ã€‚è¯·å‚é˜…ã€ŠGeneratorå‡½æ•°ã€‹ä¸€ç« ã€‚ forâ€¦ofå¾ªç¯ES6 å€Ÿé‰´ C++ã€Javaã€C# å’Œ Python è¯­è¨€ï¼Œå¼•å…¥äº†for...ofå¾ªç¯ï¼Œä½œä¸ºéå†æ‰€æœ‰æ•°æ®ç»“æ„çš„ç»Ÿä¸€çš„æ–¹æ³•ã€‚ ä¸€ä¸ªæ•°æ®ç»“æ„åªè¦éƒ¨ç½²äº†Symbol.iteratorå±æ€§ï¼Œå°±è¢«è§†ä¸ºå…·æœ‰iteratoræ¥å£ï¼Œå°±å¯ä»¥ç”¨for...ofå¾ªç¯éå†å®ƒçš„æˆå‘˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œfor...ofå¾ªç¯å†…éƒ¨è°ƒç”¨çš„æ˜¯æ•°æ®ç»“æ„çš„Symbol.iteratoræ–¹æ³•ã€‚ for...ofå¾ªç¯å¯ä»¥ä½¿ç”¨çš„èŒƒå›´åŒ…æ‹¬æ•°ç»„ã€Set å’Œ Map ç»“æ„ã€æŸäº›ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ˆæ¯”å¦‚argumentså¯¹è±¡ã€DOM NodeList å¯¹è±¡ï¼‰ã€åæ–‡çš„ Generator å¯¹è±¡ï¼Œä»¥åŠå­—ç¬¦ä¸²ã€‚ æ•°ç»„æ•°ç»„åŸç”Ÿå…·å¤‡iteratoræ¥å£ï¼ˆå³é»˜è®¤éƒ¨ç½²äº†Symbol.iteratorå±æ€§ï¼‰ï¼Œfor...ofå¾ªç¯æœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨è¿™ä¸ªæ¥å£äº§ç”Ÿçš„éå†å™¨ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç è¯æ˜ã€‚ 123456789101112const arr = ['red', 'green', 'blue'];for(let v of arr) &#123; console.log(v); // red green blue&#125;const obj = &#123;&#125;;obj[Symbol.iterator] = arr[Symbol.iterator].bind(arr);for(let v of obj) &#123; console.log(v); // red green blue&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œç©ºå¯¹è±¡objéƒ¨ç½²äº†æ•°ç»„arrçš„Symbol.iteratorå±æ€§ï¼Œç»“æœobjçš„for...ofå¾ªç¯ï¼Œäº§ç”Ÿäº†ä¸arrå®Œå…¨ä¸€æ ·çš„ç»“æœã€‚ for...ofå¾ªç¯å¯ä»¥ä»£æ›¿æ•°ç»„å®ä¾‹çš„forEachæ–¹æ³•ã€‚ 123456const arr = ['red', 'green', 'blue'];arr.forEach(function (element, index) &#123; console.log(element); // red green blue console.log(index); // 0 1 2&#125;); JavaScriptåŸæœ‰çš„for...inå¾ªç¯ï¼Œåªèƒ½è·å¾—å¯¹è±¡çš„é”®åï¼Œä¸èƒ½ç›´æ¥è·å–é”®å€¼ã€‚ES6æä¾›for...ofå¾ªç¯ï¼Œå…è®¸éå†è·å¾—é”®å€¼ã€‚ 123456789var arr = ['a', 'b', 'c', 'd'];for (let a in arr) &#123; console.log(a); // 0 1 2 3&#125;for (let a of arr) &#123; console.log(a); // a b c d&#125; ä¸Šé¢ä»£ç è¡¨æ˜ï¼Œfor...inå¾ªç¯è¯»å–é”®åï¼Œfor...ofå¾ªç¯è¯»å–é”®å€¼ã€‚å¦‚æœè¦é€šè¿‡for...ofå¾ªç¯ï¼Œè·å–æ•°ç»„çš„ç´¢å¼•ï¼Œå¯ä»¥å€ŸåŠ©æ•°ç»„å®ä¾‹çš„entriesæ–¹æ³•å’Œkeysæ–¹æ³•ï¼Œå‚è§ã€Šæ•°ç»„çš„æ‰©å±•ã€‹ç« èŠ‚ã€‚ for...ofå¾ªç¯è°ƒç”¨éå†å™¨æ¥å£ï¼Œæ•°ç»„çš„éå†å™¨æ¥å£åªè¿”å›å…·æœ‰æ•°å­—ç´¢å¼•çš„å±æ€§ã€‚è¿™ä¸€ç‚¹è·Ÿfor...inå¾ªç¯ä¹Ÿä¸ä¸€æ ·ã€‚ 12345678910let arr = [3, 5, 7];arr.foo = 'hello';for (let i in arr) &#123; console.log(i); // \"0\", \"1\", \"2\", \"foo\"&#125;for (let i of arr) &#123; console.log(i); // \"3\", \"5\", \"7\"&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œfor...ofå¾ªç¯ä¸ä¼šè¿”å›æ•°ç»„arrçš„fooå±æ€§ã€‚ Setå’ŒMapç»“æ„Setå’ŒMapç»“æ„ä¹ŸåŸç”Ÿå…·æœ‰Iteratoræ¥å£ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨for...ofå¾ªç¯ã€‚ 123456789101112131415161718var engines = new Set([\"Gecko\", \"Trident\", \"Webkit\", \"Webkit\"]);for (var e of engines) &#123; console.log(e);&#125;// Gecko// Trident// Webkitvar es6 = new Map();es6.set(\"edition\", 6);es6.set(\"committee\", \"TC39\");es6.set(\"standard\", \"ECMA-262\");for (var [name, value] of es6) &#123; console.log(name + \": \" + value);&#125;// edition: 6// committee: TC39// standard: ECMA-262 ä¸Šé¢ä»£ç æ¼”ç¤ºäº†å¦‚ä½•éå†Setç»“æ„å’ŒMapç»“æ„ã€‚å€¼å¾—æ³¨æ„çš„åœ°æ–¹æœ‰ä¸¤ä¸ªï¼Œé¦–å…ˆï¼Œéå†çš„é¡ºåºæ˜¯æŒ‰ç…§å„ä¸ªæˆå‘˜è¢«æ·»åŠ è¿›æ•°æ®ç»“æ„çš„é¡ºåºã€‚å…¶æ¬¡ï¼ŒSetç»“æ„éå†æ—¶ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªå€¼ï¼Œè€ŒMapç»“æ„éå†æ—¶ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„çš„ä¸¤ä¸ªæˆå‘˜åˆ†åˆ«ä¸ºå½“å‰Mapæˆå‘˜çš„é”®åå’Œé”®å€¼ã€‚ 123456789101112let map = new Map().set('a', 1).set('b', 2);for (let pair of map) &#123; console.log(pair);&#125;// ['a', 1]// ['b', 2]for (let [key, value] of map) &#123; console.log(key + ' : ' + value);&#125;// a : 1// b : 2 è®¡ç®—ç”Ÿæˆçš„æ•°æ®ç»“æ„æœ‰äº›æ•°æ®ç»“æ„æ˜¯åœ¨ç°æœ‰æ•°æ®ç»“æ„çš„åŸºç¡€ä¸Šï¼Œè®¡ç®—ç”Ÿæˆçš„ã€‚æ¯”å¦‚ï¼ŒES6çš„æ•°ç»„ã€Setã€Mapéƒ½éƒ¨ç½²äº†ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼Œè°ƒç”¨åéƒ½è¿”å›éå†å™¨å¯¹è±¡ã€‚ entries() è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨æ¥éå†[é”®å, é”®å€¼]ç»„æˆçš„æ•°ç»„ã€‚å¯¹äºæ•°ç»„ï¼Œé”®åå°±æ˜¯ç´¢å¼•å€¼ï¼›å¯¹äºSetï¼Œé”®åä¸é”®å€¼ç›¸åŒã€‚Mapç»“æ„çš„iteratoræ¥å£ï¼Œé»˜è®¤å°±æ˜¯è°ƒç”¨entriesæ–¹æ³•ã€‚ keys() è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨æ¥éå†æ‰€æœ‰çš„é”®åã€‚ values() è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨æ¥éå†æ‰€æœ‰çš„é”®å€¼ã€‚ è¿™ä¸‰ä¸ªæ–¹æ³•è°ƒç”¨åç”Ÿæˆçš„éå†å™¨å¯¹è±¡ï¼Œæ‰€éå†çš„éƒ½æ˜¯è®¡ç®—ç”Ÿæˆçš„æ•°æ®ç»“æ„ã€‚ 1234567let arr = ['a', 'b', 'c'];for (let pair of arr.entries()) &#123; console.log(pair);&#125;// [0, 'a']// [1, 'b']// [2, 'c'] ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡åŒ…æ‹¬å¥½å‡ ç±»ã€‚ä¸‹é¢æ˜¯for...ofå¾ªç¯ç”¨äºå­—ç¬¦ä¸²ã€DOM NodeListå¯¹è±¡ã€argumentså¯¹è±¡çš„ä¾‹å­ã€‚ 1234567891011121314151617181920212223// å­—ç¬¦ä¸²let str = \"hello\";for (let s of str) &#123; console.log(s); // h e l l o&#125;// DOM NodeListå¯¹è±¡let paras = document.querySelectorAll(\"p\");for (let p of paras) &#123; p.classList.add(\"test\");&#125;// argumentså¯¹è±¡function printArgs() &#123; for (let x of arguments) &#123; console.log(x); &#125;&#125;printArgs('a', 'b');// 'a'// 'b' å¯¹äºå­—ç¬¦ä¸²æ¥è¯´ï¼Œfor...ofå¾ªç¯è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯ä¼šæ­£ç¡®è¯†åˆ«32ä½UTF-16å­—ç¬¦ã€‚ 12345for (let x of 'a\\uD83D\\uDC0A') &#123; console.log(x);&#125;// 'a'// '\\uD83D\\uDC0A' å¹¶ä¸æ˜¯æ‰€æœ‰ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡éƒ½å…·æœ‰iteratoræ¥å£ï¼Œä¸€ä¸ªç®€ä¾¿çš„è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨Array.fromæ–¹æ³•å°†å…¶è½¬ä¸ºæ•°ç»„ã€‚ 1234567891011let arrayLike = &#123; length: 2, 0: 'a', 1: 'b' &#125;;// æŠ¥é”™for (let x of arrayLike) &#123; console.log(x);&#125;// æ­£ç¡®for (let x of Array.from(arrayLike)) &#123; console.log(x);&#125; å¯¹è±¡å¯¹äºæ™®é€šçš„å¯¹è±¡ï¼Œfor...ofç»“æ„ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œä¼šæŠ¥é”™ï¼Œå¿…é¡»éƒ¨ç½²äº†iteratoræ¥å£åæ‰èƒ½ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œè¿™æ ·æƒ…å†µä¸‹ï¼Œfor...inå¾ªç¯ä¾ç„¶å¯ä»¥ç”¨æ¥éå†é”®åã€‚ 1234567891011121314151617var es6 = &#123; edition: 6, committee: \"TC39\", standard: \"ECMA-262\"&#125;;for (let e in es6) &#123; console.log(e);&#125;// edition// committee// standardfor (let e of es6) &#123; console.log(e);&#125;// TypeError: es6 is not iterable ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¯¹äºæ™®é€šçš„å¯¹è±¡ï¼Œfor...inå¾ªç¯å¯ä»¥éå†é”®åï¼Œfor...ofå¾ªç¯ä¼šæŠ¥é”™ã€‚ ä¸€ç§è§£å†³æ–¹æ³•æ˜¯ï¼Œä½¿ç”¨Object.keysæ–¹æ³•å°†å¯¹è±¡çš„é”®åç”Ÿæˆä¸€ä¸ªæ•°ç»„ï¼Œç„¶åéå†è¿™ä¸ªæ•°ç»„ã€‚ 123for (var key of Object.keys(someObject)) &#123; console.log(key + \": \" + someObject[key]);&#125; åœ¨å¯¹è±¡ä¸Šéƒ¨ç½²iteratoræ¥å£çš„ä»£ç ï¼Œå‚è§æœ¬ç« å‰é¢éƒ¨åˆ†ã€‚ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹æ³•æ˜¯å°†æ•°ç»„çš„Symbol.iteratorå±æ€§ï¼Œç›´æ¥èµ‹å€¼ç»™å…¶ä»–å¯¹è±¡çš„Symbol.iteratorå±æ€§ã€‚æ¯”å¦‚ï¼Œæƒ³è¦è®©for...ofç¯éå†jQueryå¯¹è±¡ï¼Œåªè¦åŠ ä¸Šä¸‹é¢è¿™ä¸€è¡Œå°±å¯ä»¥äº†ã€‚ 12jQuery.prototype[Symbol.iterator] = Array.prototype[Symbol.iterator]; å¦ä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨Generatorå‡½æ•°å°†å¯¹è±¡é‡æ–°åŒ…è£…ä¸€ä¸‹ã€‚ 123456789101112function* entries(obj) &#123; for (let key of Object.keys(obj)) &#123; yield [key, obj[key]]; &#125;&#125;for (let [key, value] of entries(obj)) &#123; console.log(key, \"-&gt;\", value);&#125;// a -&gt; 1// b -&gt; 2// c -&gt; 3 ä¸å…¶ä»–éå†è¯­æ³•çš„æ¯”è¾ƒä»¥æ•°ç»„ä¸ºä¾‹ï¼ŒJavaScriptæä¾›å¤šç§éå†è¯­æ³•ã€‚æœ€åŸå§‹çš„å†™æ³•å°±æ˜¯forå¾ªç¯ã€‚ 123for (var index = 0; index &lt; myArray.length; index++) &#123; console.log(myArray[index]);&#125; è¿™ç§å†™æ³•æ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤æ•°ç»„æä¾›å†…ç½®çš„forEachæ–¹æ³•ã€‚ 123myArray.forEach(function (value) &#123; console.log(value);&#125;); è¿™ç§å†™æ³•çš„é—®é¢˜åœ¨äºï¼Œæ— æ³•ä¸­é€”è·³å‡ºforEachå¾ªç¯ï¼Œbreakå‘½ä»¤æˆ–returnå‘½ä»¤éƒ½ä¸èƒ½å¥æ•ˆã€‚ for...inå¾ªç¯å¯ä»¥éå†æ•°ç»„çš„é”®åã€‚ 123for (var index in myArray) &#123; console.log(myArray[index]);&#125; forâ€¦inå¾ªç¯æœ‰å‡ ä¸ªç¼ºç‚¹ã€‚ æ•°ç»„çš„é”®åæ˜¯æ•°å­—ï¼Œä½†æ˜¯forâ€¦inå¾ªç¯æ˜¯ä»¥å­—ç¬¦ä¸²ä½œä¸ºé”®åâ€œ0â€ã€â€œ1â€ã€â€œ2â€ç­‰ç­‰ã€‚ forâ€¦inå¾ªç¯ä¸ä»…éå†æ•°å­—é”®åï¼Œè¿˜ä¼šéå†æ‰‹åŠ¨æ·»åŠ çš„å…¶ä»–é”®ï¼Œç”šè‡³åŒ…æ‹¬åŸå‹é“¾ä¸Šçš„é”®ã€‚ æŸäº›æƒ…å†µä¸‹ï¼Œforâ€¦inå¾ªç¯ä¼šä»¥ä»»æ„é¡ºåºéå†é”®åã€‚ æ€»ä¹‹ï¼Œfor...inå¾ªç¯ä¸»è¦æ˜¯ä¸ºéå†å¯¹è±¡è€Œè®¾è®¡çš„ï¼Œä¸é€‚ç”¨äºéå†æ•°ç»„ã€‚ for...ofå¾ªç¯ç›¸æ¯”ä¸Šé¢å‡ ç§åšæ³•ï¼Œæœ‰ä¸€äº›æ˜¾è‘—çš„ä¼˜ç‚¹ã€‚ 123for (let value of myArray) &#123; console.log(value);&#125; æœ‰ç€åŒforâ€¦inä¸€æ ·çš„ç®€æ´è¯­æ³•ï¼Œä½†æ˜¯æ²¡æœ‰forâ€¦iné‚£äº›ç¼ºç‚¹ã€‚ ä¸åŒç”¨äºforEachæ–¹æ³•ï¼Œå®ƒå¯ä»¥ä¸breakã€continueå’Œreturné…åˆä½¿ç”¨ã€‚ æä¾›äº†éå†æ‰€æœ‰æ•°æ®ç»“æ„çš„ç»Ÿä¸€æ“ä½œæ¥å£ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨breakè¯­å¥ï¼Œè·³å‡ºfor...ofå¾ªç¯çš„ä¾‹å­ã€‚ 12345for (var n of fibonacci) &#123; if (n &gt; 1000) break; console.log(n);&#125; ä¸Šé¢çš„ä¾‹å­ï¼Œä¼šè¾“å‡ºæ–æ³¢çº³å¥‘æ•°åˆ—å°äºç­‰äº1000çš„é¡¹ã€‚å¦‚æœå½“å‰é¡¹å¤§äº1000ï¼Œå°±ä¼šä½¿ç”¨breakè¯­å¥è·³å‡ºfor...ofå¾ªç¯ã€‚","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"Iterator","slug":"Iterator","permalink":"http://microzz.com/tags/Iterator/"},{"name":"for","slug":"for","permalink":"http://microzz.com/tags/for/"}]},{"title":"Reflect","date":"2017-01-11T00:25:19.000Z","path":"2017/01/11/reflect/","text":"Reflectæ¦‚è¿°Reflectå¯¹è±¡ä¸Proxyå¯¹è±¡ä¸€æ ·ï¼Œä¹Ÿæ˜¯ ES6 ä¸ºäº†æ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–° APIã€‚Reflectå¯¹è±¡çš„è®¾è®¡ç›®çš„æœ‰è¿™æ ·å‡ ä¸ªã€‚ ï¼ˆ1ï¼‰ å°†Objectå¯¹è±¡çš„ä¸€äº›æ˜æ˜¾å±äºè¯­è¨€å†…éƒ¨çš„æ–¹æ³•ï¼ˆæ¯”å¦‚Object.definePropertyï¼‰ï¼Œæ”¾åˆ°Reflectå¯¹è±¡ä¸Šã€‚ç°é˜¶æ®µï¼ŒæŸäº›æ–¹æ³•åŒæ—¶åœ¨Objectå’ŒReflectå¯¹è±¡ä¸Šéƒ¨ç½²ï¼Œæœªæ¥çš„æ–°æ–¹æ³•å°†åªéƒ¨ç½²åœ¨Reflectå¯¹è±¡ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»Reflectå¯¹è±¡ä¸Šå¯ä»¥æ‹¿åˆ°è¯­è¨€å†…éƒ¨çš„æ–¹æ³•ã€‚ ï¼ˆ2ï¼‰ ä¿®æ”¹æŸäº›Objectæ–¹æ³•çš„è¿”å›ç»“æœï¼Œè®©å…¶å˜å¾—æ›´åˆç†ã€‚æ¯”å¦‚ï¼ŒObject.defineProperty(obj, name, desc)åœ¨æ— æ³•å®šä¹‰å±æ€§æ—¶ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè€ŒReflect.defineProperty(obj, name, desc)åˆ™ä¼šè¿”å›falseã€‚ 1234567891011121314// è€å†™æ³•try &#123; Object.defineProperty(target, property, attributes); // success&#125; catch (e) &#123; // failure&#125;// æ–°å†™æ³•if (Reflect.defineProperty(target, property, attributes)) &#123; // success&#125; else &#123; // failure&#125; ï¼ˆ3ï¼‰ è®©Objectæ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸ºã€‚æŸäº›Objectæ“ä½œæ˜¯å‘½ä»¤å¼ï¼Œæ¯”å¦‚name in objå’Œdelete obj[name]ï¼Œè€ŒReflect.has(obj, name)å’ŒReflect.deleteProperty(obj, name)è®©å®ƒä»¬å˜æˆäº†å‡½æ•°è¡Œä¸ºã€‚ 12345// è€å†™æ³•'assign' in Object // true// æ–°å†™æ³•Reflect.has(Object, 'assign') // true ï¼ˆ4ï¼‰Reflectå¯¹è±¡çš„æ–¹æ³•ä¸Proxyå¯¹è±¡çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼Œåªè¦æ˜¯Proxyå¯¹è±¡çš„æ–¹æ³•ï¼Œå°±èƒ½åœ¨Reflectå¯¹è±¡ä¸Šæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ã€‚è¿™å°±è®©Proxyå¯¹è±¡å¯ä»¥æ–¹ä¾¿åœ°è°ƒç”¨å¯¹åº”çš„Reflectæ–¹æ³•ï¼Œå®Œæˆé»˜è®¤è¡Œä¸ºï¼Œä½œä¸ºä¿®æ”¹è¡Œä¸ºçš„åŸºç¡€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡Proxyæ€ä¹ˆä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œä½ æ€»å¯ä»¥åœ¨Reflectä¸Šè·å–é»˜è®¤è¡Œä¸ºã€‚ 123456789Proxy(target, &#123; set: function(target, name, value, receiver) &#123; var success = Reflect.set(target,name, value, receiver); if (success) &#123; log('property ' + name + ' on ' + target + ' set to ' + value); &#125; return success; &#125;&#125;); ä¸Šé¢ä»£ç ä¸­ï¼ŒProxyæ–¹æ³•æ‹¦æˆªtargetå¯¹è±¡çš„å±æ€§èµ‹å€¼è¡Œä¸ºã€‚å®ƒé‡‡ç”¨Reflect.setæ–¹æ³•å°†å€¼èµ‹å€¼ç»™å¯¹è±¡çš„å±æ€§ï¼Œç¡®ä¿å®ŒæˆåŸæœ‰çš„è¡Œä¸ºï¼Œç„¶åå†éƒ¨ç½²é¢å¤–çš„åŠŸèƒ½ã€‚ ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚ 1234567891011121314var loggedObj = new Proxy(obj, &#123; get(target, name) &#123; console.log('get', target, name); return Reflect.get(target, name); &#125;, deleteProperty(target, name) &#123; console.log('delete' + name); return Reflect.deleteProperty(target, name); &#125;, has(target, name) &#123; console.log('has' + name); return Reflect.has(target, name); &#125;&#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œæ¯ä¸€ä¸ªProxyå¯¹è±¡çš„æ‹¦æˆªæ“ä½œï¼ˆgetã€deleteã€hasï¼‰ï¼Œå†…éƒ¨éƒ½è°ƒç”¨å¯¹åº”çš„Reflectæ–¹æ³•ï¼Œä¿è¯åŸç”Ÿè¡Œä¸ºèƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œã€‚æ·»åŠ çš„å·¥ä½œï¼Œå°±æ˜¯å°†æ¯ä¸€ä¸ªæ“ä½œè¾“å‡ºä¸€è¡Œæ—¥å¿—ã€‚ æœ‰äº†Reflectå¯¹è±¡ä»¥åï¼Œå¾ˆå¤šæ“ä½œä¼šæ›´æ˜“è¯»ã€‚ 12345// è€å†™æ³•Function.prototype.apply.call(Math.floor, undefined, [1.75]) // 1// æ–°å†™æ³•Reflect.apply(Math.floor, undefined, [1.75]) // 1 é™æ€æ–¹æ³•Reflectå¯¹è±¡ä¸€å…±æœ‰13ä¸ªé™æ€æ–¹æ³•ã€‚ Reflect.apply(target,thisArg,args) Reflect.construct(target,args) Reflect.get(target,name,receiver) Reflect.set(target,name,value,receiver) Reflect.defineProperty(target,name,desc) Reflect.deleteProperty(target,name) Reflect.has(target,name) Reflect.ownKeys(target) Reflect.isExtensible(target) Reflect.preventExtensions(target) Reflect.getOwnPropertyDescriptor(target, name) Reflect.getPrototypeOf(target) Reflect.setPrototypeOf(target, prototype) ä¸Šé¢è¿™äº›æ–¹æ³•çš„ä½œç”¨ï¼Œå¤§éƒ¨åˆ†ä¸Objectå¯¹è±¡çš„åŒåæ–¹æ³•çš„ä½œç”¨éƒ½æ˜¯ç›¸åŒçš„ï¼Œè€Œä¸”å®ƒä¸Proxyå¯¹è±¡çš„æ–¹æ³•æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚ä¸‹é¢æ˜¯å¯¹å®ƒä»¬çš„è§£é‡Šã€‚ Reflect.get(target, name, receiver)Reflect.getæ–¹æ³•æŸ¥æ‰¾å¹¶è¿”å›targetå¯¹è±¡çš„nameå±æ€§ï¼Œå¦‚æœæ²¡æœ‰è¯¥å±æ€§ï¼Œåˆ™è¿”å›undefinedã€‚ 1234567891011var myObject = &#123; foo: 1, bar: 2, get baz() &#123; return this.foo + this.bar; &#125;,&#125;Reflect.get(myObject, 'foo') // 1Reflect.get(myObject, 'bar') // 2Reflect.get(myObject, 'baz') // 3 å¦‚æœnameå±æ€§éƒ¨ç½²äº†è¯»å–å‡½æ•°ï¼ˆgetterï¼‰ï¼Œåˆ™è¯»å–å‡½æ•°çš„thisç»‘å®šreceiverã€‚ 1234567891011121314var myObject = &#123; foo: 1, bar: 2, get baz() &#123; return this.foo + this.bar; &#125;,&#125;;var myReceiverObject = &#123; foo: 4, bar: 4,&#125;;Reflect.get(myObject, 'baz', myReceiverObject) // 8 å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼ŒReflect.getæ–¹æ³•ä¼šæŠ¥é”™ã€‚ 12Reflect.get(1, 'foo') // æŠ¥é”™Reflect.get(false, 'foo') // æŠ¥é”™ Reflect.set(target, name, value, receiver)Reflect.setæ–¹æ³•è®¾ç½®targetå¯¹è±¡çš„nameå±æ€§ç­‰äºvalueã€‚ 1234567891011121314var myObject = &#123; foo: 1, set bar(value) &#123; return this.foo = value; &#125;,&#125;myObject.foo // 1Reflect.set(myObject, 'foo', 2);myObject.foo // 2Reflect.set(myObject, 'bar', 3)myObject.foo // 3 å¦‚æœnameå±æ€§è®¾ç½®äº†èµ‹å€¼å‡½æ•°ï¼Œåˆ™èµ‹å€¼å‡½æ•°çš„thisç»‘å®šreceiverã€‚ 1234567891011121314var myObject = &#123; foo: 4, set bar(value) &#123; return this.foo = value; &#125;,&#125;;var myReceiverObject = &#123; foo: 0,&#125;;Reflect.set(myObject, 'bar', 1, myReceiverObject);myObject.foo // 4myReceiverObject.foo // 1 å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼ŒReflect.setä¼šæŠ¥é”™ã€‚ 12Reflect.set(1, 'foo', &#123;&#125;) // æŠ¥é”™Reflect.set(false, 'foo', &#123;&#125;) // æŠ¥é”™ Reflect.has(obj, name)Reflect.hasæ–¹æ³•å¯¹åº”name in objé‡Œé¢çš„inè¿ç®—ç¬¦ã€‚ 123456789var myObject = &#123; foo: 1,&#125;;// æ—§å†™æ³•'foo' in myObject // true// æ–°å†™æ³•Reflect.has(myObject, 'foo') // true å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼ŒReflect.haså’Œinè¿ç®—ç¬¦éƒ½ä¼šæŠ¥é”™ã€‚ Reflect.deleteProperty(obj, name)Reflect.deletePropertyæ–¹æ³•ç­‰åŒäºdelete obj[name]ï¼Œç”¨äºåˆ é™¤å¯¹è±¡çš„å±æ€§ã€‚ 1234567const myObj = &#123; foo: 'bar' &#125;;// æ—§å†™æ³•delete myObj.foo;// æ–°å†™æ³•Reflect.deleteProperty(myObj, 'foo'); è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æœåˆ é™¤æˆåŠŸï¼Œæˆ–è€…è¢«åˆ é™¤çš„å±æ€§ä¸å­˜åœ¨ï¼Œè¿”å›trueï¼›åˆ é™¤å¤±è´¥ï¼Œè¢«åˆ é™¤çš„å±æ€§ä¾ç„¶å­˜åœ¨ï¼Œè¿”å›falseã€‚ Reflect.construct(target, args)Reflect.constructæ–¹æ³•ç­‰åŒäºnew target(...args)ï¼Œè¿™æä¾›äº†ä¸€ç§ä¸ä½¿ç”¨newï¼Œæ¥è°ƒç”¨æ„é€ å‡½æ•°çš„æ–¹æ³•ã€‚ 123456789function Greeting(name) &#123; this.name = name;&#125;// new çš„å†™æ³•const instance = new Greeting('å¼ ä¸‰');// Reflect.construct çš„å†™æ³•const instance = Reflect.construct(Greeting, 'å¼ ä¸‰'); Reflect.getPrototypeOf(obj)Reflect.getPrototypeOfæ–¹æ³•ç”¨äºè¯»å–å¯¹è±¡çš„__proto__å±æ€§ï¼Œå¯¹åº”Object.getPrototypeOf(obj)ã€‚ 1234567const myObj = new FancyThing();// æ—§å†™æ³•Object.getPrototypeOf(myObj) === FancyThing.prototype;// æ–°å†™æ³•Reflect.getPrototypeOf(myObj) === FancyThing.prototype; Reflect.getPrototypeOfå’ŒObject.getPrototypeOfçš„ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼ˆåŒ…æ‹¬nullå’Œundefinedï¼‰ï¼ŒObject.getPrototypeOfä¼šå°†è¿™ä¸ªå‚æ•°è½¬ä¸ºå¯¹è±¡ï¼Œç„¶åå†è¿è¡Œï¼Œè€ŒReflect.getPrototypeOfä¼šæŠ¥é”™ã€‚ 12Object.getPrototypeOf(1) // undefinedReflect.getPrototypeOf(1) // æŠ¥é”™ Reflect.setPrototypeOf(obj, newProto)Reflect.setPrototypeOfæ–¹æ³•ç”¨äºè®¾ç½®å¯¹è±¡çš„__proto__å±æ€§ï¼Œå¯¹åº”Object.setPrototypeOf(obj, newProto)ã€‚ 1234567const myObj = new FancyThing();// æ—§å†™æ³•Object.setPrototypeOf(myObj, OtherThing.prototype);// æ–°å†™æ³•Reflect.setPrototypeOf(myObj, OtherThing.prototype); å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼ŒReflect.setPrototypeOfå’ŒObject.setPrototypeOféƒ½ä¼šæŠ¥é”™ã€‚ 12Object.setPrototypeOf(1) // æŠ¥é”™Reflect.setPrototypeOf(1) // æŠ¥é”™ Reflect.apply(func, thisArg, args)Reflect.applyæ–¹æ³•ç­‰åŒäºFunction.prototype.apply.call(func, thisArg, args)ï¼Œç”¨äºç»‘å®šthiså¯¹è±¡åæ‰§è¡Œç»™å®šå‡½æ•°ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœè¦ç»‘å®šä¸€ä¸ªå‡½æ•°çš„thiså¯¹è±¡ï¼Œå¯ä»¥è¿™æ ·å†™fn.apply(obj, args)ï¼Œä½†æ˜¯å¦‚æœå‡½æ•°å®šä¹‰äº†è‡ªå·±çš„applyæ–¹æ³•ï¼Œå°±åªèƒ½å†™æˆFunction.prototype.apply.call(fn, obj, args)ï¼Œé‡‡ç”¨Reflectå¯¹è±¡å¯ä»¥ç®€åŒ–è¿™ç§æ“ä½œã€‚ 1234567891011const ages = [11, 33, 12, 54, 18, 96];// æ—§å†™æ³•const youngest = Math.min.apply(Math, ages);const oldest = Math.max.apply(Math, ages);const type = Object.prototype.toString.call(youngest);// æ–°å†™æ³•const youngest = Reflect.apply(Math.min, Math, ages);const oldest = Reflect.apply(Math.max, Math, ages);const type = Reflect.apply(Object.prototype.toString, youngest); Reflect.defineProperty(target, propertyKey, attributes)Reflect.definePropertyæ–¹æ³•åŸºæœ¬ç­‰åŒäºObject.definePropertyï¼Œç”¨æ¥ä¸ºå¯¹è±¡å®šä¹‰å±æ€§ã€‚æœªæ¥ï¼Œåè€…ä¼šè¢«é€æ¸åºŸé™¤ï¼Œè¯·ä»ç°åœ¨å¼€å§‹å°±ä½¿ç”¨Reflect.definePropertyä»£æ›¿å®ƒã€‚ 12345678910111213function MyDate() &#123; /*â€¦*/&#125;// æ—§å†™æ³•Object.defineProperty(MyDate, 'now', &#123; value: () =&gt; new Date.now()&#125;);// æ–°å†™æ³•Reflect.defineProperty(MyDate, 'now', &#123; value: () =&gt; new Date.now()&#125;); å¦‚æœReflect.definePropertyçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ï¼Œæ¯”å¦‚Reflect.defineProperty(1, &#39;foo&#39;)ã€‚ Reflect.getOwnPropertyDescriptor(target, propertyKey)Reflect.getOwnPropertyDescriptoråŸºæœ¬ç­‰åŒäºObject.getOwnPropertyDescriptorï¼Œç”¨äºå¾—åˆ°æŒ‡å®šå±æ€§çš„æè¿°å¯¹è±¡ï¼Œå°†æ¥ä¼šæ›¿ä»£æ‰åè€…ã€‚ 1234567891011var myObject = &#123;&#125;;Object.defineProperty(myObject, 'hidden', &#123; value: true, enumerable: false,&#125;);// æ—§å†™æ³•var theDescriptor = Object.getOwnPropertyDescriptor(myObject, 'hidden');// æ–°å†™æ³•var theDescriptor = Reflect.getOwnPropertyDescriptor(myObject, 'hidden'); Reflect.getOwnPropertyDescriptorå’ŒObject.getOwnPropertyDescriptorçš„ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼ŒObject.getOwnPropertyDescriptor(1, &#39;foo&#39;)ä¸æŠ¥é”™ï¼Œè¿”å›undefinedï¼Œè€ŒReflect.getOwnPropertyDescriptor(1, &#39;foo&#39;)ä¼šæŠ›å‡ºé”™è¯¯ï¼Œè¡¨ç¤ºå‚æ•°éæ³•ã€‚ Reflect.isExtensible (target)Reflect.isExtensibleæ–¹æ³•å¯¹åº”Object.isExtensibleï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå½“å‰å¯¹è±¡æ˜¯å¦å¯æ‰©å±•ã€‚ 1234567const myObject = &#123;&#125;;// æ—§å†™æ³•Object.isExtensible(myObject) // true// æ–°å†™æ³•Reflect.isExtensible(myObject) // true å¦‚æœå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼ŒObject.isExtensibleä¼šè¿”å›falseï¼Œå› ä¸ºéå¯¹è±¡æœ¬æ¥å°±æ˜¯ä¸å¯æ‰©å±•çš„ï¼Œè€ŒReflect.isExtensibleä¼šæŠ¥é”™ã€‚ 12Object.isExtensible(1) // falseReflect.isExtensible(1) // æŠ¥é”™ Reflect.preventExtensions(target)Reflect.preventExtensionså¯¹åº”Object.preventExtensionsæ–¹æ³•ï¼Œç”¨äºè®©ä¸€ä¸ªå¯¹è±¡å˜ä¸ºä¸å¯æ‰©å±•ã€‚å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ“ä½œæˆåŠŸã€‚ 1234567var myObject = &#123;&#125;;// æ—§å†™æ³•Object.isExtensible(myObject) // true// æ–°å†™æ³•Reflect.preventExtensions(myObject) // true å¦‚æœå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼ŒObject.isExtensibleåœ¨ ES5 ç¯å¢ƒæŠ¥é”™ï¼Œåœ¨ ES6 ç¯å¢ƒè¿”å›è¿™ä¸ªå‚æ•°ï¼Œè€ŒReflect.preventExtensionsä¼šæŠ¥é”™ã€‚ 12345678// ES5Object.preventExtensions(1) // æŠ¥é”™// ES6Object.preventExtensions(1) // 1// æ–°å†™æ³•Reflect.preventExtensions(1) // æŠ¥é”™ Reflect.ownKeys (target)Reflect.ownKeysæ–¹æ³•ç”¨äºè¿”å›å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼ŒåŸºæœ¬ç­‰åŒäºObject.getOwnPropertyNamesä¸Object.getOwnPropertySymbolsä¹‹å’Œã€‚ 1234567891011121314151617var myObject = &#123; foo: 1, bar: 2, [Symbol.for('baz')]: 3, [Symbol.for('bing')]: 4,&#125;;// æ—§å†™æ³•Object.getOwnPropertyNames(myObject)// ['foo', 'bar']Object.getOwnPropertySymbols(myObject)//[Symbol.for('baz'), Symbol.for('bing')]// æ–°å†™æ³•Reflect.ownKeys(myObject)// ['foo', 'bar', Symbol.for('baz'), Symbol.for('bing')] å®ä¾‹ï¼šä½¿ç”¨ Proxy å®ç°è§‚å¯Ÿè€…æ¨¡å¼è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver modeï¼‰æŒ‡çš„æ˜¯å‡½æ•°è‡ªåŠ¨è§‚å¯Ÿæ•°æ®å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡æœ‰å˜åŒ–ï¼Œå‡½æ•°å°±ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚ 12345678910111213const person = observable(&#123; name: 'å¼ ä¸‰', age: 20&#125;);function print() &#123; console.log(`$&#123;person.name&#125;, $&#123;person.age&#125;`)&#125;observe(print);person.name = 'æå››';// è¾“å‡º// æå››, 20 ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°æ®å¯¹è±¡personæ˜¯è§‚å¯Ÿç›®æ ‡ï¼Œå‡½æ•°printæ˜¯è§‚å¯Ÿè€…ã€‚ä¸€æ—¦æ•°æ®å¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼Œprintå°±ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚ ä¸‹é¢ï¼Œä½¿ç”¨ Proxy å†™ä¸€ä¸ªè§‚å¯Ÿè€…æ¨¡å¼çš„æœ€ç®€å•å®ç°ï¼Œå³å®ç°observableå’Œobserveè¿™ä¸¤ä¸ªå‡½æ•°ã€‚æ€è·¯æ˜¯observableå‡½æ•°è¿”å›ä¸€ä¸ªåŸå§‹å¯¹è±¡çš„ Proxy ä»£ç†ï¼Œæ‹¦æˆªèµ‹å€¼æ“ä½œï¼Œè§¦å‘å……å½“è§‚å¯Ÿè€…çš„å„ä¸ªå‡½æ•°ã€‚ 12345678910const queuedObservers = new Set();const observe = fn =&gt; queuedObservers.add(fn);const observable = obj =&gt; new Proxy(obj, &#123;set&#125;);function set(target, key, value, receiver) &#123; const result = Reflect.set(target, key, value, receiver); queuedObservers.forEach(observer =&gt; observer()); return result;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå…ˆå®šä¹‰äº†ä¸€ä¸ªSeté›†åˆï¼Œæ‰€æœ‰è§‚å¯Ÿè€…å‡½æ•°éƒ½æ”¾è¿›è¿™ä¸ªé›†åˆã€‚ç„¶åï¼Œobservableå‡½æ•°è¿”å›åŸå§‹å¯¹è±¡çš„ä»£ç†ï¼Œæ‹¦æˆªèµ‹å€¼æ“ä½œã€‚æ‹¦æˆªå‡½æ•°setä¹‹ä¸­ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰è§‚å¯Ÿè€…ã€‚","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"Reflect","slug":"Reflect","permalink":"http://microzz.com/tags/Reflect/"}]},{"title":"Proxy","date":"2017-01-09T02:40:19.000Z","path":"2017/01/09/proxy/","text":"Proxyæ¦‚è¿°Proxy ç”¨äºä¿®æ”¹æŸäº›æ“ä½œçš„é»˜è®¤è¡Œä¸ºï¼Œç­‰åŒäºåœ¨è¯­è¨€å±‚é¢åšå‡ºä¿®æ”¹ï¼Œæ‰€ä»¥å±äºä¸€ç§â€œå…ƒç¼–ç¨‹â€ï¼ˆmeta programmingï¼‰ï¼Œå³å¯¹ç¼–ç¨‹è¯­è¨€è¿›è¡Œç¼–ç¨‹ã€‚ Proxy å¯ä»¥ç†è§£æˆï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚â€œæ‹¦æˆªâ€ï¼Œå¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®ï¼Œéƒ½å¿…é¡»å…ˆé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¯¹å¤–ç•Œçš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œæ”¹å†™ã€‚Proxy è¿™ä¸ªè¯çš„åŸæ„æ˜¯ä»£ç†ï¼Œç”¨åœ¨è¿™é‡Œè¡¨ç¤ºç”±å®ƒæ¥â€œä»£ç†â€æŸäº›æ“ä½œï¼Œå¯ä»¥è¯‘ä¸ºâ€œä»£ç†å™¨â€ã€‚ 12345678910var obj = new Proxy(&#123;&#125;, &#123; get: function (target, key, receiver) &#123; console.log(`getting $&#123;key&#125;!`); return Reflect.get(target, key, receiver); &#125;, set: function (target, key, value, receiver) &#123; console.log(`setting $&#123;key&#125;!`); return Reflect.set(target, key, value, receiver); &#125;&#125;); ä¸Šé¢ä»£ç å¯¹ä¸€ä¸ªç©ºå¯¹è±¡æ¶è®¾äº†ä¸€å±‚æ‹¦æˆªï¼Œé‡å®šä¹‰äº†å±æ€§çš„è¯»å–ï¼ˆgetï¼‰å’Œè®¾ç½®ï¼ˆsetï¼‰è¡Œä¸ºã€‚è¿™é‡Œæš‚æ—¶å…ˆä¸è§£é‡Šå…·ä½“çš„è¯­æ³•ï¼Œåªçœ‹è¿è¡Œç»“æœã€‚å¯¹è®¾ç½®äº†æ‹¦æˆªè¡Œä¸ºçš„å¯¹è±¡objï¼Œå»è¯»å†™å®ƒçš„å±æ€§ï¼Œå°±ä¼šå¾—åˆ°ä¸‹é¢çš„ç»“æœã€‚ 123456obj.count = 1// setting count!++obj.count// getting count!// setting count!// 2 ä¸Šé¢ä»£ç è¯´æ˜ï¼ŒProxy å®é™…ä¸Šé‡è½½ï¼ˆoverloadï¼‰äº†ç‚¹è¿ç®—ç¬¦ï¼Œå³ç”¨è‡ªå·±çš„å®šä¹‰è¦†ç›–äº†è¯­è¨€çš„åŸå§‹å®šä¹‰ã€‚ ES6 åŸç”Ÿæä¾› Proxy æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ Proxy å®ä¾‹ã€‚ 1var proxy = new Proxy(target, handler); Proxy å¯¹è±¡çš„æ‰€æœ‰ç”¨æ³•ï¼Œéƒ½æ˜¯ä¸Šé¢è¿™ç§å½¢å¼ï¼Œä¸åŒçš„åªæ˜¯handlerå‚æ•°çš„å†™æ³•ã€‚å…¶ä¸­ï¼Œnew Proxy()è¡¨ç¤ºç”Ÿæˆä¸€ä¸ªProxyå®ä¾‹ï¼Œtargetå‚æ•°è¡¨ç¤ºæ‰€è¦æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ï¼Œhandlerå‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å®šåˆ¶æ‹¦æˆªè¡Œä¸ºã€‚ ä¸‹é¢æ˜¯å¦ä¸€ä¸ªæ‹¦æˆªè¯»å–å±æ€§è¡Œä¸ºçš„ä¾‹å­ã€‚ 123456789var proxy = new Proxy(&#123;&#125;, &#123; get: function(target, property) &#123; return 35; &#125;&#125;);proxy.time // 35proxy.name // 35proxy.title // 35 ä¸Šé¢ä»£ç ä¸­ï¼Œä½œä¸ºæ„é€ å‡½æ•°ï¼ŒProxyæ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‰€è¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼ˆä¸Šä¾‹æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼‰ï¼Œå³å¦‚æœæ²¡æœ‰Proxyçš„ä»‹å…¥ï¼Œæ“ä½œåŸæ¥è¦è®¿é—®çš„å°±æ˜¯è¿™ä¸ªå¯¹è±¡ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œå¯¹äºæ¯ä¸€ä¸ªè¢«ä»£ç†çš„æ“ä½œï¼Œéœ€è¦æä¾›ä¸€ä¸ªå¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æ‹¦æˆªå¯¹åº”çš„æ“ä½œã€‚æ¯”å¦‚ï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œé…ç½®å¯¹è±¡æœ‰ä¸€ä¸ªgetæ–¹æ³•ï¼Œç”¨æ¥æ‹¦æˆªå¯¹ç›®æ ‡å¯¹è±¡å±æ€§çš„è®¿é—®è¯·æ±‚ã€‚getæ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ç›®æ ‡å¯¹è±¡å’Œæ‰€è¦è®¿é—®çš„å±æ€§ã€‚å¯ä»¥çœ‹åˆ°ï¼Œç”±äºæ‹¦æˆªå‡½æ•°æ€»æ˜¯è¿”å›35ï¼Œæ‰€ä»¥è®¿é—®ä»»ä½•å±æ€§éƒ½å¾—åˆ°35ã€‚ æ³¨æ„ï¼Œè¦ä½¿å¾—Proxyèµ·ä½œç”¨ï¼Œå¿…é¡»é’ˆå¯¹Proxyå®ä¾‹ï¼ˆä¸Šä¾‹æ˜¯proxyå¯¹è±¡ï¼‰è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç›®æ ‡å¯¹è±¡ï¼ˆä¸Šä¾‹æ˜¯ç©ºå¯¹è±¡ï¼‰è¿›è¡Œæ“ä½œã€‚ å¦‚æœhandleræ²¡æœ‰è®¾ç½®ä»»ä½•æ‹¦æˆªï¼Œé‚£å°±ç­‰åŒäºç›´æ¥é€šå‘åŸå¯¹è±¡ã€‚ 12345var target = &#123;&#125;;var handler = &#123;&#125;;var proxy = new Proxy(target, handler);proxy.a = 'b';target.a // \"b\" ä¸Šé¢ä»£ç ä¸­ï¼Œhandleræ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œæ²¡æœ‰ä»»ä½•æ‹¦æˆªæ•ˆæœï¼Œè®¿é—®handlerå°±ç­‰åŒäºè®¿é—®targetã€‚ ä¸€ä¸ªæŠ€å·§æ˜¯å°† Proxy å¯¹è±¡ï¼Œè®¾ç½®åˆ°object.proxyå±æ€§ï¼Œä»è€Œå¯ä»¥åœ¨objectå¯¹è±¡ä¸Šè°ƒç”¨ã€‚ 1var object = &#123; proxy: new Proxy(target, handler) &#125;; Proxy å®ä¾‹ä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚ 12345678var proxy = new Proxy(&#123;&#125;, &#123; get: function(target, property) &#123; return 35; &#125;&#125;);let obj = Object.create(proxy);obj.time // 35 ä¸Šé¢ä»£ç ä¸­ï¼Œproxyå¯¹è±¡æ˜¯objå¯¹è±¡çš„åŸå‹ï¼Œobjå¯¹è±¡æœ¬èº«å¹¶æ²¡æœ‰timeå±æ€§ï¼Œæ‰€ä»¥æ ¹æ®åŸå‹é“¾ï¼Œä¼šåœ¨proxyå¯¹è±¡ä¸Šè¯»å–è¯¥å±æ€§ï¼Œå¯¼è‡´è¢«æ‹¦æˆªã€‚ åŒä¸€ä¸ªæ‹¦æˆªå™¨å‡½æ•°ï¼Œå¯ä»¥è®¾ç½®æ‹¦æˆªå¤šä¸ªæ“ä½œã€‚ 12345678910111213141516171819202122232425var handler = &#123; get: function(target, name) &#123; if (name === 'prototype') &#123; return Object.prototype; &#125; return 'Hello, ' + name; &#125;, apply: function(target, thisBinding, args) &#123; return args[0]; &#125;, construct: function(target, args) &#123; return &#123;value: args[1]&#125;; &#125;&#125;;var fproxy = new Proxy(function(x, y) &#123; return x + y;&#125;, handler);fproxy(1, 2) // 1new fproxy(1,2) // &#123;value: 2&#125;fproxy.prototype === Object.prototype // truefproxy.foo // \"Hello, foo\" ä¸‹é¢æ˜¯ Proxy æ”¯æŒçš„æ‹¦æˆªæ“ä½œä¸€è§ˆã€‚ å¯¹äºå¯ä»¥è®¾ç½®ã€ä½†æ²¡æœ‰è®¾ç½®æ‹¦æˆªçš„æ“ä½œï¼Œåˆ™ç›´æ¥è½åœ¨ç›®æ ‡å¯¹è±¡ä¸Šï¼ŒæŒ‰ç…§åŸå…ˆçš„æ–¹å¼äº§ç”Ÿç»“æœã€‚ ï¼ˆ1ï¼‰get(target, propKey, receiver) æ‹¦æˆªå¯¹è±¡å±æ€§çš„è¯»å–ï¼Œæ¯”å¦‚proxy.fooå’Œproxy[&#39;foo&#39;]ã€‚ æœ€åä¸€ä¸ªå‚æ•°receiveræ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯é€‰ï¼Œå‚è§ä¸‹é¢Reflect.getçš„éƒ¨åˆ†ã€‚ ï¼ˆ2ï¼‰set(target, propKey, value, receiver) æ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®ï¼Œæ¯”å¦‚proxy.foo = væˆ–proxy[&#39;foo&#39;] = vï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ ï¼ˆ3ï¼‰has(target, propKey) æ‹¦æˆªpropKey in proxyçš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ ï¼ˆ4ï¼‰deleteProperty(target, propKey) æ‹¦æˆªdelete proxy[propKey]çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ ï¼ˆ5ï¼‰ownKeys(target) æ‹¦æˆªObject.getOwnPropertyNames(proxy)ã€Object.getOwnPropertySymbols(proxy)ã€Object.keys(proxy)ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›ç›®æ ‡å¯¹è±¡æ‰€æœ‰è‡ªèº«çš„å±æ€§çš„å±æ€§åï¼Œè€ŒObject.keys()çš„è¿”å›ç»“æœä»…åŒ…æ‹¬ç›®æ ‡å¯¹è±¡è‡ªèº«çš„å¯éå†å±æ€§ã€‚ ï¼ˆ6ï¼‰getOwnPropertyDescriptor(target, propKey) æ‹¦æˆªObject.getOwnPropertyDescriptor(proxy, propKey)ï¼Œè¿”å›å±æ€§çš„æè¿°å¯¹è±¡ã€‚ ï¼ˆ7ï¼‰defineProperty(target, propKey, propDesc) æ‹¦æˆªObject.defineProperty(proxy, propKey, propDescï¼‰ã€Object.defineProperties(proxy, propDescs)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ ï¼ˆ8ï¼‰preventExtensions(target) æ‹¦æˆªObject.preventExtensions(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ ï¼ˆ9ï¼‰getPrototypeOf(target) æ‹¦æˆªObject.getPrototypeOf(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚ ï¼ˆ10ï¼‰isExtensible(target) æ‹¦æˆªObject.isExtensible(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ ï¼ˆ11ï¼‰setPrototypeOf(target, proto) æ‹¦æˆªObject.setPrototypeOf(proxy, proto)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ å¦‚æœç›®æ ‡å¯¹è±¡æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸¤ç§é¢å¤–æ“ä½œå¯ä»¥æ‹¦æˆªã€‚ ï¼ˆ12ï¼‰apply(target, object, args) æ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚proxy(...args)ã€proxy.call(object, ...args)ã€proxy.apply(...)ã€‚ ï¼ˆ13ï¼‰construct(target, args) æ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚new proxy(...args)ã€‚ Proxy å®ä¾‹çš„æ–¹æ³•ä¸‹é¢æ˜¯ä¸Šé¢è¿™äº›æ‹¦æˆªæ–¹æ³•çš„è¯¦ç»†ä»‹ç»ã€‚ get()getæ–¹æ³•ç”¨äºæ‹¦æˆªæŸä¸ªå±æ€§çš„è¯»å–æ“ä½œã€‚ä¸Šæ–‡å·²ç»æœ‰ä¸€ä¸ªä¾‹å­ï¼Œä¸‹é¢æ˜¯å¦ä¸€ä¸ªæ‹¦æˆªè¯»å–æ“ä½œçš„ä¾‹å­ã€‚ 12345678910111213141516var person = &#123; name: \"å¼ ä¸‰\"&#125;;var proxy = new Proxy(person, &#123; get: function(target, property) &#123; if (property in target) &#123; return target[property]; &#125; else &#123; throw new ReferenceError(\"Property \\\"\" + property + \"\\\" does not exist.\"); &#125; &#125;&#125;);proxy.name // \"å¼ ä¸‰\"proxy.age // æŠ›å‡ºä¸€ä¸ªé”™è¯¯ ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœè®¿é—®ç›®æ ‡å¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ‹¦æˆªå‡½æ•°ï¼Œè®¿é—®ä¸å­˜åœ¨çš„å±æ€§ï¼Œåªä¼šè¿”å›undefinedã€‚ getæ–¹æ³•å¯ä»¥ç»§æ‰¿ã€‚ 123456789let proto = new Proxy(&#123;&#125;, &#123; get(target, propertyKey, receiver) &#123; console.log('GET '+propertyKey); return target[propertyKey]; &#125;&#125;);let obj = Object.create(proto);obj.xxx // \"GET xxx\" ä¸Šé¢ä»£ç ä¸­ï¼Œæ‹¦æˆªæ“ä½œå®šä¹‰åœ¨Prototypeå¯¹è±¡ä¸Šé¢ï¼Œæ‰€ä»¥å¦‚æœè¯»å–objå¯¹è±¡ç»§æ‰¿çš„å±æ€§æ—¶ï¼Œæ‹¦æˆªä¼šç”Ÿæ•ˆã€‚ ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨getæ‹¦æˆªï¼Œå®ç°æ•°ç»„è¯»å–è´Ÿæ•°çš„ç´¢å¼•ã€‚ 123456789101112131415161718function createArray(...elements) &#123; let handler = &#123; get(target, propKey, receiver) &#123; let index = Number(propKey); if (index &lt; 0) &#123; propKey = String(target.length + index); &#125; return Reflect.get(target, propKey, receiver); &#125; &#125;; let target = []; target.push(...elements); return new Proxy(target, handler);&#125;let arr = createArray('a', 'b', 'c');arr[-1] // c ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„çš„ä½ç½®å‚æ•°æ˜¯-1ï¼Œå°±ä¼šè¾“å‡ºæ•°ç»„çš„å€’æ•°æœ€åä¸€ä¸ªæˆå‘˜ã€‚ åˆ©ç”¨ Proxyï¼Œå¯ä»¥å°†è¯»å–å±æ€§çš„æ“ä½œï¼ˆgetï¼‰ï¼Œè½¬å˜ä¸ºæ‰§è¡ŒæŸä¸ªå‡½æ•°ï¼Œä»è€Œå®ç°å±æ€§çš„é“¾å¼æ“ä½œã€‚ 123456789101112131415161718192021222324var pipe = (function () &#123; return function (value) &#123; var funcStack = []; var oproxy = new Proxy(&#123;&#125; , &#123; get : function (pipeObject, fnName) &#123; if (fnName === 'get') &#123; return funcStack.reduce(function (val, fn) &#123; return fn(val); &#125;,value); &#125; funcStack.push(window[fnName]); return oproxy; &#125; &#125;); return oproxy; &#125;&#125;());var double = n =&gt; n * 2;var pow = n =&gt; n * n;var reverseInt = n =&gt; n.toString().split(\"\").reverse().join(\"\") | 0;pipe(3).double.pow.reverseInt.get; // 63 ä¸Šé¢ä»£ç è®¾ç½® Proxy ä»¥åï¼Œè¾¾åˆ°äº†å°†å‡½æ•°åé“¾å¼ä½¿ç”¨çš„æ•ˆæœã€‚ ä¸‹é¢çš„ä¾‹å­åˆ™æ˜¯åˆ©ç”¨getæ‹¦æˆªï¼Œå®ç°ä¸€ä¸ªç”Ÿæˆå„ç§DOMèŠ‚ç‚¹çš„é€šç”¨å‡½æ•°domã€‚ 123456789101112131415161718192021222324252627282930const dom = new Proxy(&#123;&#125;, &#123; get(target, property) &#123; return function(attrs = &#123;&#125;, ...children) &#123; const el = document.createElement(property); for (let prop of Object.keys(attrs)) &#123; el.setAttribute(prop, attrs[prop]); &#125; for (let child of children) &#123; if (typeof child === 'string') &#123; child = document.createTextNode(child); &#125; el.appendChild(child); &#125; return el; &#125; &#125;&#125;);const el = dom.div(&#123;&#125;, 'Hello, my name is ', dom.a(&#123;href: '//example.com'&#125;, 'Mark'), '. I like:', dom.ul(&#123;&#125;, dom.li(&#123;&#125;, 'The web'), dom.li(&#123;&#125;, 'Food'), dom.li(&#123;&#125;, 'â€¦actually that\\'s it') ));document.body.appendChild(el); å¦‚æœä¸€ä¸ªå±æ€§ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰å’Œä¸å¯å†™ï¼ˆwritableï¼‰ï¼Œåˆ™è¯¥å±æ€§ä¸èƒ½è¢«ä»£ç†ï¼Œé€šè¿‡ Proxy å¯¹è±¡è®¿é—®è¯¥å±æ€§ä¼šæŠ¥é”™ã€‚ 123456789101112131415161718const target = Object.defineProperties(&#123;&#125;, &#123; foo: &#123; value: 123, writable: false, configurable: false &#125;,&#125;);const handler = &#123; get(target, propKey) &#123; return 'abc'; &#125;&#125;;const proxy = new Proxy(target, handler);proxy.foo// TypeError: Invariant check failed set()setæ–¹æ³•ç”¨æ¥æ‹¦æˆªæŸä¸ªå±æ€§çš„èµ‹å€¼æ“ä½œã€‚ å‡å®šPersonå¯¹è±¡æœ‰ä¸€ä¸ªageå±æ€§ï¼Œè¯¥å±æ€§åº”è¯¥æ˜¯ä¸€ä¸ªä¸å¤§äº200çš„æ•´æ•°ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨Proxyä¿è¯ageçš„å±æ€§å€¼ç¬¦åˆè¦æ±‚ã€‚ 1234567891011121314151617181920212223let validator = &#123; set: function(obj, prop, value) &#123; if (prop === 'age') &#123; if (!Number.isInteger(value)) &#123; throw new TypeError('The age is not an integer'); &#125; if (value &gt; 200) &#123; throw new RangeError('The age seems invalid'); &#125; &#125; // å¯¹äºageä»¥å¤–çš„å±æ€§ï¼Œç›´æ¥ä¿å­˜ obj[prop] = value; &#125;&#125;;let person = new Proxy(&#123;&#125;, validator);person.age = 100;person.age // 100person.age = 'young' // æŠ¥é”™person.age = 300 // æŠ¥é”™ ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºè®¾ç½®äº†å­˜å€¼å‡½æ•°setï¼Œä»»ä½•ä¸ç¬¦åˆè¦æ±‚çš„ageå±æ€§èµ‹å€¼ï¼Œéƒ½ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¿™æ˜¯æ•°æ®éªŒè¯çš„ä¸€ç§å®ç°æ–¹æ³•ã€‚åˆ©ç”¨setæ–¹æ³•ï¼Œè¿˜å¯ä»¥æ•°æ®ç»‘å®šï¼Œå³æ¯å½“å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè‡ªåŠ¨æ›´æ–° DOMã€‚ æœ‰æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨å¯¹è±¡ä¸Šé¢è®¾ç½®å†…éƒ¨å±æ€§ï¼Œå±æ€§åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä½¿ç”¨ä¸‹åˆ’çº¿å¼€å¤´ï¼Œè¡¨ç¤ºè¿™äº›å±æ€§ä¸åº”è¯¥è¢«å¤–éƒ¨ä½¿ç”¨ã€‚ç»“åˆgetå’Œsetæ–¹æ³•ï¼Œå°±å¯ä»¥åšåˆ°é˜²æ­¢è¿™äº›å†…éƒ¨å±æ€§è¢«å¤–éƒ¨è¯»å†™ã€‚ 12345678910111213141516171819202122var handler = &#123; get (target, key) &#123; invariant(key, 'get'); return target[key]; &#125;, set (target, key, value) &#123; invariant(key, 'set'); target[key] = value; return true; &#125;&#125;;function invariant (key, action) &#123; if (key[0] === '_') &#123; throw new Error(`Invalid attempt to $&#123;action&#125; private \"$&#123;key&#125;\" property`); &#125;&#125;var target = &#123;&#125;;var proxy = new Proxy(target, handler);proxy._prop// Error: Invalid attempt to get private \"_prop\" propertyproxy._prop = 'c'// Error: Invalid attempt to set private \"_prop\" property ä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦è¯»å†™çš„å±æ€§åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸‹åˆ’çº¿ï¼Œä¸€å¾‹æŠ›é”™ï¼Œä»è€Œè¾¾åˆ°ç¦æ­¢è¯»å†™å†…éƒ¨å±æ€§çš„ç›®çš„ã€‚ æ³¨æ„ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡è‡ªèº«çš„æŸä¸ªå±æ€§ï¼Œä¸å¯å†™ä¹Ÿä¸å¯é…ç½®ï¼Œé‚£ä¹ˆsetä¸å¾—æ”¹å˜è¿™ä¸ªå±æ€§çš„å€¼ï¼Œåªèƒ½è¿”å›åŒæ ·çš„å€¼ï¼Œå¦åˆ™æŠ¥é”™ã€‚ apply()applyæ–¹æ³•æ‹¦æˆªå‡½æ•°çš„è°ƒç”¨ã€callå’Œapplyæ“ä½œã€‚ applyæ–¹æ³•å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ç›®æ ‡å¯¹è±¡ã€ç›®æ ‡å¯¹è±¡çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆthisï¼‰å’Œç›®æ ‡å¯¹è±¡çš„å‚æ•°æ•°ç»„ã€‚ 12345var handler = &#123; apply (target, ctx, args) &#123; return Reflect.apply(...arguments); &#125;&#125;; ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 1234567891011var target = function () &#123; return 'I am the target'; &#125;;var handler = &#123; apply: function () &#123; return 'I am the proxy'; &#125;&#125;;var p = new Proxy(target, handler);p()// \"I am the proxy\" ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡pæ˜¯ Proxy çš„å®ä¾‹ï¼Œå½“å®ƒä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼ˆp()ï¼‰ï¼Œå°±ä¼šè¢«applyæ–¹æ³•æ‹¦æˆªï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ ä¸‹é¢æ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ã€‚ 123456789101112var twice = &#123; apply (target, ctx, args) &#123; return Reflect.apply(...arguments) * 2; &#125;&#125;;function sum (left, right) &#123; return left + right;&#125;;var proxy = new Proxy(sum, twice);proxy(1, 2) // 6proxy.call(null, 5, 6) // 22proxy.apply(null, [7, 8]) // 30 ä¸Šé¢ä»£ç ä¸­ï¼Œæ¯å½“æ‰§è¡Œproxyå‡½æ•°ï¼ˆç›´æ¥è°ƒç”¨æˆ–callå’Œapplyè°ƒç”¨ï¼‰ï¼Œå°±ä¼šè¢«applyæ–¹æ³•æ‹¦æˆªã€‚ å¦å¤–ï¼Œç›´æ¥è°ƒç”¨Reflect.applyæ–¹æ³•ï¼Œä¹Ÿä¼šè¢«æ‹¦æˆªã€‚ 1Reflect.apply(proxy, null, [9, 10]) // 38 has()hasæ–¹æ³•ç”¨æ¥æ‹¦æˆªHasPropertyæ“ä½œï¼Œå³åˆ¤æ–­å¯¹è±¡æ˜¯å¦å…·æœ‰æŸä¸ªå±æ€§æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šç”Ÿæ•ˆã€‚å…¸å‹çš„æ“ä½œå°±æ˜¯inè¿ç®—ç¬¦ã€‚ ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨hasæ–¹æ³•éšè—æŸäº›å±æ€§ï¼Œä¸è¢«inè¿ç®—ç¬¦å‘ç°ã€‚ 1234567891011var handler = &#123; has (target, key) &#123; if (key[0] === '_') &#123; return false; &#125; return key in target; &#125;&#125;;var target = &#123; _prop: 'foo', prop: 'foo' &#125;;var proxy = new Proxy(target, handler);'_prop' in proxy // false ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœåŸå¯¹è±¡çš„å±æ€§åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸‹åˆ’çº¿ï¼Œproxy.haså°±ä¼šè¿”å›falseï¼Œä»è€Œä¸ä¼šè¢«inè¿ç®—ç¬¦å‘ç°ã€‚ å¦‚æœåŸå¯¹è±¡ä¸å¯é…ç½®æˆ–è€…ç¦æ­¢æ‰©å±•ï¼Œè¿™æ—¶hasæ‹¦æˆªä¼šæŠ¥é”™ã€‚ 12345678910var obj = &#123; a: 10 &#125;;Object.preventExtensions(obj);var p = new Proxy(obj, &#123; has: function(target, prop) &#123; return false; &#125;&#125;);'a' in p // TypeError is thrown ä¸Šé¢ä»£ç ä¸­ï¼Œobjå¯¹è±¡ç¦æ­¢æ‰©å±•ï¼Œç»“æœä½¿ç”¨hasæ‹¦æˆªå°±ä¼šæŠ¥é”™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸä¸ªå±æ€§ä¸å¯é…ç½®ï¼ˆæˆ–è€…ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼‰ï¼Œåˆ™hasæ–¹æ³•å°±ä¸å¾—â€œéšè—â€ï¼ˆå³è¿”å›falseï¼‰ç›®æ ‡å¯¹è±¡çš„è¯¥å±æ€§ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œhasæ–¹æ³•æ‹¦æˆªçš„æ˜¯HasPropertyæ“ä½œï¼Œè€Œä¸æ˜¯HasOwnPropertyæ“ä½œï¼Œå³hasæ–¹æ³•ä¸åˆ¤æ–­ä¸€ä¸ªå±æ€§æ˜¯å¯¹è±¡è‡ªèº«çš„å±æ€§ï¼Œè¿˜æ˜¯ç»§æ‰¿çš„å±æ€§ã€‚ å¦å¤–ï¼Œè™½ç„¶for...inå¾ªç¯ä¹Ÿç”¨åˆ°äº†inè¿ç®—ç¬¦ï¼Œä½†æ˜¯hasæ‹¦æˆªå¯¹for...inå¾ªç¯ä¸ç”Ÿæ•ˆã€‚ 12345678910111213141516171819202122232425262728293031323334let stu1 = &#123;name: 'å¼ ä¸‰', score: 59&#125;;let stu2 = &#123;name: 'æå››', score: 99&#125;;let handler = &#123; has(target, prop) &#123; if (prop === 'score' &amp;&amp; target[prop] &lt; 60) &#123; console.log(`$&#123;target.name&#125; ä¸åŠæ ¼`); return false; &#125; return prop in target; &#125;&#125;let oproxy1 = new Proxy(stu1, handler);let oproxy2 = new Proxy(stu2, handler);'score' in oproxy1// å¼ ä¸‰ ä¸åŠæ ¼// false'score' in oproxy2// truefor (let a in oproxy1) &#123; console.log(oproxy1[a]);&#125;// å¼ ä¸‰// 59for (let b in oproxy2) &#123; console.log(oproxy2[b]);&#125;// æå››// 99 ä¸Šé¢ä»£ç ä¸­ï¼Œhasæ‹¦æˆªåªå¯¹inå¾ªç¯ç”Ÿæ•ˆï¼Œå¯¹for...inå¾ªç¯ä¸ç”Ÿæ•ˆï¼Œå¯¼è‡´ä¸ç¬¦åˆè¦æ±‚çš„å±æ€§æ²¡æœ‰è¢«æ’é™¤åœ¨for...inå¾ªç¯ä¹‹å¤–ã€‚ construct()constructæ–¹æ³•ç”¨äºæ‹¦æˆªnewå‘½ä»¤ï¼Œä¸‹é¢æ˜¯æ‹¦æˆªå¯¹è±¡çš„å†™æ³•ã€‚ 12345var handler = &#123; construct (target, args, newTarget) &#123; return new target(...args); &#125;&#125;; constructæ–¹æ³•å¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ target: ç›®æ ‡å¯¹è±¡ argsï¼šæ„å»ºå‡½æ•°çš„å‚æ•°å¯¹è±¡ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 12345678910var p = new Proxy(function () &#123;&#125;, &#123; construct: function(target, args) &#123; console.log('called: ' + args.join(', ')); return &#123; value: args[0] * 10 &#125;; &#125;&#125;);(new p(1)).value// \"called: 1\"// 10 constructæ–¹æ³•è¿”å›çš„å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ 1234567var p = new Proxy(function() &#123;&#125;, &#123; construct: function(target, argumentsList) &#123; return 1; &#125;&#125;);new p() // æŠ¥é”™ deleteProperty()deletePropertyæ–¹æ³•ç”¨äºæ‹¦æˆªdeleteæ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•æŠ›å‡ºé”™è¯¯æˆ–è€…è¿”å›falseï¼Œå½“å‰å±æ€§å°±æ— æ³•è¢«deleteå‘½ä»¤åˆ é™¤ã€‚ 12345678910111213141516var handler = &#123; deleteProperty (target, key) &#123; invariant(key, 'delete'); return true; &#125;&#125;;function invariant (key, action) &#123; if (key[0] === '_') &#123; throw new Error(`Invalid attempt to $&#123;action&#125; private \"$&#123;key&#125;\" property`); &#125;&#125;var target = &#123; _prop: 'foo' &#125;;var proxy = new Proxy(target, handler);delete proxy._prop// Error: Invalid attempt to delete private \"_prop\" property ä¸Šé¢ä»£ç ä¸­ï¼ŒdeletePropertyæ–¹æ³•æ‹¦æˆªäº†deleteæ“ä½œç¬¦ï¼Œåˆ é™¤ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºä¸‹åˆ’çº¿çš„å±æ€§ä¼šæŠ¥é”™ã€‚ æ³¨æ„ï¼Œç›®æ ‡å¯¹è±¡è‡ªèº«çš„ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰çš„å±æ€§ï¼Œä¸èƒ½è¢«deletePropertyæ–¹æ³•åˆ é™¤ï¼Œå¦åˆ™æŠ¥é”™ã€‚ defineProperty()definePropertyæ–¹æ³•æ‹¦æˆªäº†Object.definePropertyæ“ä½œã€‚ 123456789var handler = &#123; defineProperty (target, key, descriptor) &#123; return false; &#125;&#125;;var target = &#123;&#125;;var proxy = new Proxy(target, handler);proxy.foo = 'bar'// TypeError: proxy defineProperty handler returned false for property '\"foo\"' ä¸Šé¢ä»£ç ä¸­ï¼ŒdefinePropertyæ–¹æ³•è¿”å›falseï¼Œå¯¼è‡´æ·»åŠ æ–°å±æ€§ä¼šæŠ›å‡ºé”™è¯¯ã€‚ æ³¨æ„ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼ˆextensibleï¼‰ï¼Œåˆ™definePropertyä¸èƒ½å¢åŠ ç›®æ ‡å¯¹è±¡ä¸Šä¸å­˜åœ¨çš„å±æ€§ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚å¦å¤–ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡çš„æŸä¸ªå±æ€§ä¸å¯å†™ï¼ˆwritableï¼‰æˆ–ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰ï¼Œåˆ™definePropertyæ–¹æ³•ä¸å¾—æ”¹å˜è¿™ä¸¤ä¸ªè®¾ç½®ã€‚ getOwnPropertyDescriptor()getOwnPropertyDescriptoræ–¹æ³•æ‹¦æˆªObject.getOwnPropertyDescriptorï¼Œè¿”å›ä¸€ä¸ªå±æ€§æè¿°å¯¹è±¡æˆ–è€…undefinedã€‚ 12345678910111213141516var handler = &#123; getOwnPropertyDescriptor (target, key) &#123; if (key[0] === '_') &#123; return; &#125; return Object.getOwnPropertyDescriptor(target, key); &#125;&#125;;var target = &#123; _foo: 'bar', baz: 'tar' &#125;;var proxy = new Proxy(target, handler);Object.getOwnPropertyDescriptor(proxy, 'wat')// undefinedObject.getOwnPropertyDescriptor(proxy, '_foo')// undefinedObject.getOwnPropertyDescriptor(proxy, 'baz')// &#123; value: 'tar', writable: true, enumerable: true, configurable: true &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œhandler.getOwnPropertyDescriptoræ–¹æ³•å¯¹äºç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºä¸‹åˆ’çº¿çš„å±æ€§åä¼šè¿”å›undefinedã€‚ getPrototypeOf()getPrototypeOfæ–¹æ³•ä¸»è¦ç”¨æ¥æ‹¦æˆªObject.getPrototypeOf()è¿ç®—ç¬¦ï¼Œä»¥åŠå…¶ä»–ä¸€äº›æ“ä½œã€‚ Object.prototype.__proto__ Object.prototype.isPrototypeOf() Object.getPrototypeOf() Reflect.getPrototypeOf() instanceofè¿ç®—ç¬¦ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 1234567var proto = &#123;&#125;;var p = new Proxy(&#123;&#125;, &#123; getPrototypeOf(target) &#123; return proto; &#125;&#125;);Object.getPrototypeOf(p) === proto // true ä¸Šé¢ä»£ç ä¸­ï¼ŒgetPrototypeOfæ–¹æ³•æ‹¦æˆªObject.getPrototypeOf()ï¼Œè¿”å›protoå¯¹è±¡ã€‚ æ³¨æ„ï¼ŒgetPrototypeOfæ–¹æ³•çš„è¿”å›å€¼å¿…é¡»æ˜¯å¯¹è±¡æˆ–è€…nullï¼Œå¦åˆ™æŠ¥é”™ã€‚å¦å¤–ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼ˆextensibleï¼‰ï¼Œ getPrototypeOfæ–¹æ³•å¿…é¡»è¿”å›ç›®æ ‡å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚ isExtensible()isExtensibleæ–¹æ³•æ‹¦æˆªObject.isExtensibleæ“ä½œã€‚ 12345678910var p = new Proxy(&#123;&#125;, &#123; isExtensible: function(target) &#123; console.log(\"called\"); return true; &#125;&#125;);Object.isExtensible(p)// \"called\"// true ä¸Šé¢ä»£ç è®¾ç½®äº†isExtensibleæ–¹æ³•ï¼Œåœ¨è°ƒç”¨Object.isExtensibleæ—¶ä¼šè¾“å‡ºcalledã€‚ æ³¨æ„ï¼Œè¯¥æ–¹æ³•åªèƒ½è¿”å›å¸ƒå°”å€¼ï¼Œå¦åˆ™è¿”å›å€¼ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚ è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªå¼ºé™åˆ¶ï¼Œå®ƒçš„è¿”å›å€¼å¿…é¡»ä¸ç›®æ ‡å¯¹è±¡çš„isExtensibleå±æ€§ä¿æŒä¸€è‡´ï¼Œå¦åˆ™å°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚ 1Object.isExtensible(proxy) === Object.isExtensible(target) ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 1234567var p = new Proxy(&#123;&#125;, &#123; isExtensible: function(target) &#123; return false; &#125;&#125;);Object.isExtensible(p) // æŠ¥é”™ ownKeys()ownKeysæ–¹æ³•ç”¨æ¥æ‹¦æˆªä»¥ä¸‹æ“ä½œã€‚ Object.getOwnPropertyNames() Object.getOwnPropertySymbols() Object.keys() ä¸‹é¢æ˜¯æ‹¦æˆªObject.keys()çš„ä¾‹å­ã€‚ 12345678910111213141516let target = &#123; a: 1, b: 2, c: 3&#125;;let handler = &#123; ownKeys(target) &#123; return ['a']; &#125;&#125;;let proxy = new Proxy(target, handler);Object.keys(proxy)// [ 'a' ] ä¸Šé¢ä»£ç æ‹¦æˆªäº†å¯¹äºtargetå¯¹è±¡çš„Object.keys()æ“ä½œï¼Œåªè¿”å›aã€bã€cä¸‰ä¸ªå±æ€§ä¹‹ä¸­çš„aå±æ€§ã€‚ ä¸‹é¢çš„ä¾‹å­æ˜¯æ‹¦æˆªç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºä¸‹åˆ’çº¿çš„å±æ€§åã€‚ 1234567891011121314151617let target = &#123; _bar: 'foo', _prop: 'bar', prop: 'baz'&#125;;let handler = &#123; ownKeys (target) &#123; return Reflect.ownKeys(target).filter(key =&gt; key[0] !== '_'); &#125;&#125;;let proxy = new Proxy(target, handler);for (let key of Object.keys(proxy)) &#123; console.log(target[key]);&#125;// \"baz\" æ³¨æ„ï¼Œä½¿ç”¨Object.keysæ–¹æ³•æ—¶ï¼Œæœ‰ä¸‰ç±»å±æ€§ä¼šè¢«ownKeysæ–¹æ³•è‡ªåŠ¨è¿‡æ»¤ï¼Œä¸ä¼šè¿”å›ã€‚ ç›®æ ‡å¯¹è±¡ä¸Šä¸å­˜åœ¨çš„å±æ€§ å±æ€§åä¸º Symbol å€¼ ä¸å¯éå†ï¼ˆenumerableï¼‰çš„å±æ€§ 123456789101112131415161718192021222324let target = &#123; a: 1, b: 2, c: 3, [Symbol.for('secret')]: '4',&#125;;Object.defineProperty(target, 'key', &#123; enumerable: false, configurable: true, writable: true, value: 'static'&#125;);let handler = &#123; ownKeys(target) &#123; return ['a', 'd', Symbol.for('secret'), 'key']; &#125;&#125;;let proxy = new Proxy(target, handler);Object.keys(proxy)// ['a'] ä¸Šé¢ä»£ç ä¸­ï¼ŒownKeysæ–¹æ³•ä¹‹ä¸­ï¼Œæ˜¾å¼è¿”å›ä¸å­˜åœ¨çš„å±æ€§ï¼ˆdï¼‰ã€Symbol å€¼ï¼ˆSymbol.for(&#39;secret&#39;)ï¼‰ã€ä¸å¯éå†çš„å±æ€§ï¼ˆkeyï¼‰ï¼Œç»“æœéƒ½è¢«è‡ªåŠ¨è¿‡æ»¤æ‰ã€‚ ownKeysæ–¹æ³•è¿˜å¯ä»¥æ‹¦æˆªObject.getOwnPropertyNames()ã€‚ 12345678var p = new Proxy(&#123;&#125;, &#123; ownKeys: function(target) &#123; return ['a', 'b', 'c']; &#125;&#125;);Object.getOwnPropertyNames(p)// [ 'a', 'b', 'c' ] ownKeysæ–¹æ³•è¿”å›çš„æ•°ç»„æˆå‘˜ï¼Œåªèƒ½æ˜¯å­—ç¬¦ä¸²æˆ– Symbol å€¼ã€‚å¦‚æœæœ‰å…¶ä»–ç±»å‹çš„å€¼ï¼Œæˆ–è€…è¿”å›çš„æ ¹æœ¬ä¸æ˜¯æ•°ç»„ï¼Œå°±ä¼šæŠ¥é”™ã€‚ 12345678910var obj = &#123;&#125;;var p = new Proxy(obj, &#123; ownKeys: function(target) &#123; return [123, true, undefined, null, &#123;&#125;, []]; &#125;&#125;);Object.getOwnPropertyNames(p)// Uncaught TypeError: 123 is not a valid property name ä¸Šé¢ä»£ç ä¸­ï¼ŒownKeysæ–¹æ³•è™½ç„¶è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªæ•°ç»„æˆå‘˜éƒ½ä¸æ˜¯å­—ç¬¦ä¸²æˆ– Symbol å€¼ï¼Œå› æ­¤å°±æŠ¥é”™äº†ã€‚ å¦‚æœç›®æ ‡å¯¹è±¡è‡ªèº«åŒ…å«ä¸å¯é…ç½®çš„å±æ€§ï¼Œåˆ™è¯¥å±æ€§å¿…é¡»è¢«ownKeysæ–¹æ³•è¿”å›ï¼Œå¦åˆ™æŠ¥é”™ã€‚ 123456789101112131415var obj = &#123;&#125;;Object.defineProperty(obj, 'a', &#123; configurable: false, enumerable: true, value: 10 &#125;);var p = new Proxy(obj, &#123; ownKeys: function(target) &#123; return ['b']; &#125;&#125;);Object.getOwnPropertyNames(p)// Uncaught TypeError: 'ownKeys' on proxy: trap result did not include 'a' ä¸Šé¢ä»£ç ä¸­ï¼Œobjå¯¹è±¡çš„aå±æ€§æ˜¯ä¸å¯é…ç½®çš„ï¼Œè¿™æ—¶ownKeysæ–¹æ³•è¿”å›çš„æ•°ç»„ä¹‹ä¸­ï¼Œå¿…é¡»åŒ…å«aï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ å¦å¤–ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡æ˜¯ä¸å¯æ‰©å±•çš„ï¼ˆnon-extensitionï¼‰ï¼Œè¿™æ—¶ownKeysæ–¹æ³•è¿”å›çš„æ•°ç»„ä¹‹ä¸­ï¼Œå¿…é¡»åŒ…å«åŸå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œä¸”ä¸èƒ½åŒ…å«å¤šä½™çš„å±æ€§ï¼Œå¦åˆ™æŠ¥é”™ã€‚ 1234567891011121314var obj = &#123; a: 1&#125;;Object.preventExtensions(obj);var p = new Proxy(obj, &#123; ownKeys: function(target) &#123; return ['a', 'b']; &#125;&#125;);Object.getOwnPropertyNames(p)// Uncaught TypeError: 'ownKeys' on proxy: trap returned extra keys but proxy target is non-extensible ä¸Šé¢ä»£ç ä¸­ï¼ŒObjå¯¹è±¡æ˜¯ä¸å¯æ‰©å±•çš„ï¼Œè¿™æ—¶ownKeysæ–¹æ³•è¿”å›çš„æ•°ç»„ä¹‹ä¸­ï¼ŒåŒ…å«äº†objå¯¹è±¡çš„å¤šä½™å±æ€§bï¼Œæ‰€ä»¥å¯¼è‡´äº†æŠ¥é”™ã€‚ preventExtensions()preventExtensionsæ–¹æ³•æ‹¦æˆªObject.preventExtensions()ã€‚è¯¥æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦åˆ™ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚ è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œåªæœ‰ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•æ—¶ï¼ˆå³Object.isExtensible(proxy)ä¸ºfalseï¼‰ï¼Œproxy.preventExtensionsæ‰èƒ½è¿”å›trueï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ 1234567var p = new Proxy(&#123;&#125;, &#123; preventExtensions: function(target) &#123; return true; &#125;&#125;);Object.preventExtensions(p) // æŠ¥é”™ ä¸Šé¢ä»£ç ä¸­ï¼Œproxy.preventExtensionsæ–¹æ³•è¿”å›trueï¼Œä½†è¿™æ—¶Object.isExtensible(proxy)ä¼šè¿”å›trueï¼Œå› æ­¤æŠ¥é”™ã€‚ ä¸ºäº†é˜²æ­¢å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œé€šå¸¸è¦åœ¨proxy.preventExtensionsæ–¹æ³•é‡Œé¢ï¼Œè°ƒç”¨ä¸€æ¬¡Object.preventExtensionsã€‚ 1234567891011var p = new Proxy(&#123;&#125;, &#123; preventExtensions: function(target) &#123; console.log('called'); Object.preventExtensions(target); return true; &#125;&#125;);Object.preventExtensions(p)// \"called\"// true setPrototypeOf()setPrototypeOfæ–¹æ³•ä¸»è¦ç”¨æ¥æ‹¦æˆªObject.setPrototypeOfæ–¹æ³•ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 12345678910var handler = &#123; setPrototypeOf (target, proto) &#123; throw new Error('Changing the prototype is forbidden'); &#125;&#125;;var proto = &#123;&#125;;var target = function () &#123;&#125;;var proxy = new Proxy(target, handler);proxy.setPrototypeOf(proxy, proto);// Error: Changing the prototype is forbidden ä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦ä¿®æ”¹targetçš„åŸå‹å¯¹è±¡ï¼Œå°±ä¼šæŠ¥é”™ã€‚ æ³¨æ„ï¼Œè¯¥æ–¹æ³•åªèƒ½è¿”å›å¸ƒå°”å€¼ï¼Œå¦åˆ™ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚å¦å¤–ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼ˆextensibleï¼‰ï¼ŒsetPrototypeOfæ–¹æ³•ä¸å¾—æ”¹å˜ç›®æ ‡å¯¹è±¡çš„åŸå‹ã€‚ Proxy.revocable()Proxy.revocableæ–¹æ³•è¿”å›ä¸€ä¸ªå¯å–æ¶ˆçš„ Proxy å®ä¾‹ã€‚ 12345678910let target = &#123;&#125;;let handler = &#123;&#125;;let &#123;proxy, revoke&#125; = Proxy.revocable(target, handler);proxy.foo = 123;proxy.foo // 123revoke();proxy.foo // TypeError: Revoked Proxy.revocableæ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„proxyå±æ€§æ˜¯Proxyå®ä¾‹ï¼Œrevokeå±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥å–æ¶ˆProxyå®ä¾‹ã€‚ä¸Šé¢ä»£ç ä¸­ï¼Œå½“æ‰§è¡Œrevokeå‡½æ•°ä¹‹åï¼Œå†è®¿é—®Proxyå®ä¾‹ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ Proxy.revocableçš„ä¸€ä¸ªä½¿ç”¨åœºæ™¯æ˜¯ï¼Œç›®æ ‡å¯¹è±¡ä¸å…è®¸ç›´æ¥è®¿é—®ï¼Œå¿…é¡»é€šè¿‡ä»£ç†è®¿é—®ï¼Œä¸€æ—¦è®¿é—®ç»“æŸï¼Œå°±æ”¶å›ä»£ç†æƒï¼Œä¸å…è®¸å†æ¬¡è®¿é—®ã€‚ this é—®é¢˜è™½ç„¶ Proxy å¯ä»¥ä»£ç†é’ˆå¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ï¼Œä½†å®ƒä¸æ˜¯ç›®æ ‡å¯¹è±¡çš„é€æ˜ä»£ç†ï¼Œå³ä¸åšä»»ä½•æ‹¦æˆªçš„æƒ…å†µä¸‹ï¼Œä¹Ÿæ— æ³•ä¿è¯ä¸ç›®æ ‡å¯¹è±¡çš„è¡Œä¸ºä¸€è‡´ã€‚ä¸»è¦åŸå› å°±æ˜¯åœ¨ Proxy ä»£ç†çš„æƒ…å†µä¸‹ï¼Œç›®æ ‡å¯¹è±¡å†…éƒ¨çš„thiså…³é”®å­—ä¼šæŒ‡å‘ Proxy ä»£ç†ã€‚ 1234567891011const target = &#123; m: function () &#123; console.log(this === proxy); &#125;&#125;;const handler = &#123;&#125;;const proxy = new Proxy(target, handler);target.m() // falseproxy.m() // true ä¸Šé¢ä»£ç ä¸­ï¼Œä¸€æ—¦proxyä»£ç†target.mï¼Œåè€…å†…éƒ¨çš„thiså°±æ˜¯æŒ‡å‘proxyï¼Œè€Œä¸æ˜¯targetã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œç”±äºthisæŒ‡å‘çš„å˜åŒ–ï¼Œå¯¼è‡´ Proxy æ— æ³•ä»£ç†ç›®æ ‡å¯¹è±¡ã€‚ 12345678910111213141516const _name = new WeakMap();class Person &#123; constructor(name) &#123; _name.set(this, name); &#125; get name() &#123; return _name.get(this); &#125;&#125;const jane = new Person('Jane');jane.name // 'Jane'const proxy = new Proxy(jane, &#123;&#125;);proxy.name // undefined ä¸Šé¢ä»£ç ä¸­ï¼Œç›®æ ‡å¯¹è±¡janeçš„nameå±æ€§ï¼Œå®é™…ä¿å­˜åœ¨å¤–éƒ¨WeakMapå¯¹è±¡_nameä¸Šé¢ï¼Œé€šè¿‡thisé”®åŒºåˆ†ã€‚ç”±äºé€šè¿‡proxy.nameè®¿é—®æ—¶ï¼ŒthisæŒ‡å‘proxyï¼Œå¯¼è‡´æ— æ³•å–åˆ°å€¼ï¼Œæ‰€ä»¥è¿”å›undefinedã€‚ æ­¤å¤–ï¼Œæœ‰äº›åŸç”Ÿå¯¹è±¡çš„å†…éƒ¨å±æ€§ï¼Œåªæœ‰é€šè¿‡æ­£ç¡®çš„thisæ‰èƒ½æ‹¿åˆ°ï¼Œæ‰€ä»¥ Proxy ä¹Ÿæ— æ³•ä»£ç†è¿™äº›åŸç”Ÿå¯¹è±¡çš„å±æ€§ã€‚ 123456const target = new Date();const handler = &#123;&#125;;const proxy = new Proxy(target, handler);proxy.getDate();// TypeError: this is not a Date object. ä¸Šé¢ä»£ç ä¸­ï¼ŒgetDateæ–¹æ³•åªèƒ½åœ¨Dateå¯¹è±¡å®ä¾‹ä¸Šé¢æ‹¿åˆ°ï¼Œå¦‚æœthisä¸æ˜¯Dateå¯¹è±¡å®ä¾‹å°±ä¼šæŠ¥é”™ã€‚è¿™æ—¶ï¼Œthisç»‘å®šåŸå§‹å¯¹è±¡ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ 123456789101112const target = new Date('2015-01-01');const handler = &#123; get(target, prop) &#123; if (prop === 'getDate') &#123; return target.getDate.bind(target); &#125; return Reflect.get(target, prop); &#125;&#125;;const proxy = new Proxy(target, handler);proxy.getDate() // 1 å®ä¾‹ï¼šWeb æœåŠ¡çš„å®¢æˆ·ç«¯Proxy å¯¹è±¡å¯ä»¥æ‹¦æˆªç›®æ ‡å¯¹è±¡çš„ä»»æ„å±æ€§ï¼Œè¿™ä½¿å¾—å®ƒå¾ˆåˆé€‚ç”¨æ¥å†™ Web æœåŠ¡çš„å®¢æˆ·ç«¯ã€‚ 123456const service = createWebService('http://example.com/data');service.employees().then(json =&gt; &#123; const employees = JSON.parse(json); // Â·Â·Â·&#125;); ä¸Šé¢ä»£ç æ–°å»ºäº†ä¸€ä¸ª Web æœåŠ¡çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£è¿”å›å„ç§æ•°æ®ã€‚Proxy å¯ä»¥æ‹¦æˆªè¿™ä¸ªå¯¹è±¡çš„ä»»æ„å±æ€§ï¼Œæ‰€ä»¥ä¸ç”¨ä¸ºæ¯ä¸€ç§æ•°æ®å†™ä¸€ä¸ªé€‚é…æ–¹æ³•ï¼Œåªè¦å†™ä¸€ä¸ª Proxy æ‹¦æˆªå°±å¯ä»¥äº†ã€‚ 1234567function createWebService(baseUrl) &#123; return new Proxy(&#123;&#125;, &#123; get(target, propKey, receiver) &#123; return () =&gt; httpGet(baseUrl+'/' + propKey); &#125; &#125;);&#125; åŒç†ï¼ŒProxy ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°æ•°æ®åº“çš„ ORM å±‚ã€‚","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"Proxy","slug":"Proxy","permalink":"http://microzz.com/tags/Proxy/"}]},{"title":"Setå’ŒMapæ•°æ®ç»“æ„","date":"2017-01-05T03:40:19.000Z","path":"2017/01/05/set-map/","text":"Setå’ŒMapæ•°æ®ç»“æ„SetåŸºæœ¬ç”¨æ³•ES6æä¾›äº†æ–°çš„æ•°æ®ç»“æ„Setã€‚å®ƒç±»ä¼¼äºæ•°ç»„ï¼Œä½†æ˜¯æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤çš„å€¼ã€‚ Setæœ¬èº«æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”ŸæˆSetæ•°æ®ç»“æ„ã€‚ 12345678var s = new Set();[2, 3, 5, 4, 5, 2, 2].map(x =&gt; s.add(x));for (let i of s) &#123; console.log(i);&#125;// 2 3 5 4 ä¸Šé¢ä»£ç é€šè¿‡addæ–¹æ³•å‘Setç»“æ„åŠ å…¥æˆå‘˜ï¼Œç»“æœè¡¨æ˜Setç»“æ„ä¸ä¼šæ·»åŠ é‡å¤çš„å€¼ã€‚ Setå‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªæ•°ç»„ï¼ˆæˆ–ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼‰ä½œä¸ºå‚æ•°ï¼Œç”¨æ¥åˆå§‹åŒ–ã€‚ 1234567891011121314151617181920// ä¾‹ä¸€var set = new Set([1, 2, 3, 4, 4]);[...set]// [1, 2, 3, 4]// ä¾‹äºŒvar items = new Set([1, 2, 3, 4, 5, 5, 5, 5]);items.size // 5// ä¾‹ä¸‰function divs () &#123; return [...document.querySelectorAll('div')];&#125;var set = new Set(divs());set.size // 56// ç±»ä¼¼äºdivs().forEach(div =&gt; set.add(div));set.size // 56 ä¸Šé¢ä»£ç ä¸­ï¼Œä¾‹ä¸€å’Œä¾‹äºŒéƒ½æ˜¯Setå‡½æ•°æ¥å—æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œä¾‹ä¸‰æ˜¯æ¥å—ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚ ä¸Šé¢ä»£ç ä¸­ï¼Œä¹Ÿå±•ç¤ºäº†ä¸€ç§å»é™¤æ•°ç»„é‡å¤æˆå‘˜çš„æ–¹æ³•ã€‚ 12// å»é™¤æ•°ç»„çš„é‡å¤æˆå‘˜[...new Set(array)] å‘SetåŠ å…¥å€¼çš„æ—¶å€™ï¼Œä¸ä¼šå‘ç”Ÿç±»å‹è½¬æ¢ï¼Œæ‰€ä»¥5å’Œ&quot;5&quot;æ˜¯ä¸¤ä¸ªä¸åŒçš„å€¼ã€‚Setå†…éƒ¨åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ä¸åŒï¼Œä½¿ç”¨çš„ç®—æ³•å«åšâ€œSame-value equalityâ€ï¼Œå®ƒç±»ä¼¼äºç²¾ç¡®ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ===ï¼‰ï¼Œä¸»è¦çš„åŒºåˆ«æ˜¯NaNç­‰äºè‡ªèº«ï¼Œè€Œç²¾ç¡®ç›¸ç­‰è¿ç®—ç¬¦è®¤ä¸ºNaNä¸ç­‰äºè‡ªèº«ã€‚ 123456let set = new Set();let a = NaN;let b = NaN;set.add(a);set.add(b);set // Set &#123;NaN&#125; ä¸Šé¢ä»£ç å‘Setå®ä¾‹æ·»åŠ äº†ä¸¤ä¸ªNaNï¼Œä½†æ˜¯åªèƒ½åŠ å…¥ä¸€ä¸ªã€‚è¿™è¡¨æ˜ï¼Œåœ¨Setå†…éƒ¨ï¼Œä¸¤ä¸ªNaNæ˜¯ç›¸ç­‰ã€‚ å¦å¤–ï¼Œä¸¤ä¸ªå¯¹è±¡æ€»æ˜¯ä¸ç›¸ç­‰çš„ã€‚ 1234567let set = new Set();set.add(&#123;&#125;);set.size // 1set.add(&#123;&#125;);set.size // 2 ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œç”±äºä¸¤ä¸ªç©ºå¯¹è±¡ä¸ç›¸ç­‰ï¼Œæ‰€ä»¥å®ƒä»¬è¢«è§†ä¸ºä¸¤ä¸ªå€¼ã€‚ Setå®ä¾‹çš„å±æ€§å’Œæ–¹æ³•Setç»“æ„çš„å®ä¾‹æœ‰ä»¥ä¸‹å±æ€§ã€‚ Set.prototype.constructorï¼šæ„é€ å‡½æ•°ï¼Œé»˜è®¤å°±æ˜¯Setå‡½æ•°ã€‚ Set.prototype.sizeï¼šè¿”å›Setå®ä¾‹çš„æˆå‘˜æ€»æ•°ã€‚ Setå®ä¾‹çš„æ–¹æ³•åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæ“ä½œæ–¹æ³•ï¼ˆç”¨äºæ“ä½œæ•°æ®ï¼‰å’Œéå†æ–¹æ³•ï¼ˆç”¨äºéå†æˆå‘˜ï¼‰ã€‚ä¸‹é¢å…ˆä»‹ç»å››ä¸ªæ“ä½œæ–¹æ³•ã€‚ add(value)ï¼šæ·»åŠ æŸä¸ªå€¼ï¼Œè¿”å›Setç»“æ„æœ¬èº«ã€‚ delete(value)ï¼šåˆ é™¤æŸä¸ªå€¼ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºåˆ é™¤æ˜¯å¦æˆåŠŸã€‚ has(value)ï¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥å€¼æ˜¯å¦ä¸ºSetçš„æˆå‘˜ã€‚ clear()ï¼šæ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚ ä¸Šé¢è¿™äº›å±æ€§å’Œæ–¹æ³•çš„å®ä¾‹å¦‚ä¸‹ã€‚ 1234567891011s.add(1).add(2).add(2);// æ³¨æ„2è¢«åŠ å…¥äº†ä¸¤æ¬¡s.size // 2s.has(1) // trues.has(2) // trues.has(3) // falses.delete(2);s.has(2) // false ä¸‹é¢æ˜¯ä¸€ä¸ªå¯¹æ¯”ï¼Œçœ‹çœ‹åœ¨åˆ¤æ–­æ˜¯å¦åŒ…æ‹¬ä¸€ä¸ªé”®ä¸Šé¢ï¼ŒObjectç»“æ„å’ŒSetç»“æ„çš„å†™æ³•ä¸åŒã€‚ 12345678910111213141516171819// å¯¹è±¡çš„å†™æ³•var properties = &#123; 'width': 1, 'height': 1&#125;;if (properties[someName]) &#123; // do something&#125;// Setçš„å†™æ³•var properties = new Set();properties.add('width');properties.add('height');if (properties.has(someName)) &#123; // do something&#125; Array.fromæ–¹æ³•å¯ä»¥å°†Setç»“æ„è½¬ä¸ºæ•°ç»„ã€‚ 12var items = new Set([1, 2, 3, 4, 5]);var array = Array.from(items); è¿™å°±æä¾›äº†å»é™¤æ•°ç»„é‡å¤æˆå‘˜çš„å¦ä¸€ç§æ–¹æ³•ã€‚ 12345function dedupe(array) &#123; return Array.from(new Set(array));&#125;dedupe([1, 1, 2, 3]) // [1, 2, 3] éå†æ“ä½œSetç»“æ„çš„å®ä¾‹æœ‰å››ä¸ªéå†æ–¹æ³•ï¼Œå¯ä»¥ç”¨äºéå†æˆå‘˜ã€‚ keys()ï¼šè¿”å›é”®åçš„éå†å™¨ values()ï¼šè¿”å›é”®å€¼çš„éå†å™¨ entries()ï¼šè¿”å›é”®å€¼å¯¹çš„éå†å™¨ forEach()ï¼šä½¿ç”¨å›è°ƒå‡½æ•°éå†æ¯ä¸ªæˆå‘˜ éœ€è¦ç‰¹åˆ«æŒ‡å‡ºçš„æ˜¯ï¼ŒSetçš„éå†é¡ºåºå°±æ˜¯æ’å…¥é¡ºåºã€‚è¿™ä¸ªç‰¹æ€§æœ‰æ—¶éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ä½¿ç”¨Setä¿å­˜ä¸€ä¸ªå›è°ƒå‡½æ•°åˆ—è¡¨ï¼Œè°ƒç”¨æ—¶å°±èƒ½ä¿è¯æŒ‰ç…§æ·»åŠ é¡ºåºè°ƒç”¨ã€‚ ï¼ˆ1ï¼‰keys()ï¼Œvalues()ï¼Œentries() keysæ–¹æ³•ã€valuesæ–¹æ³•ã€entriesæ–¹æ³•è¿”å›çš„éƒ½æ˜¯éå†å™¨å¯¹è±¡ï¼ˆè¯¦è§ã€ŠIterator å¯¹è±¡ã€‹ä¸€ç« ï¼‰ã€‚ç”±äº Set ç»“æ„æ²¡æœ‰é”®åï¼Œåªæœ‰é”®å€¼ï¼ˆæˆ–è€…è¯´é”®åå’Œé”®å€¼æ˜¯åŒä¸€ä¸ªå€¼ï¼‰ï¼Œæ‰€ä»¥keysæ–¹æ³•å’Œvaluesæ–¹æ³•çš„è¡Œä¸ºå®Œå…¨ä¸€è‡´ã€‚ 12345678910111213141516171819202122let set = new Set(['red', 'green', 'blue']);for (let item of set.keys()) &#123; console.log(item);&#125;// red// green// bluefor (let item of set.values()) &#123; console.log(item);&#125;// red// green// bluefor (let item of set.entries()) &#123; console.log(item);&#125;// [\"red\", \"red\"]// [\"green\", \"green\"]// [\"blue\", \"blue\"] ä¸Šé¢ä»£ç ä¸­ï¼Œentriesæ–¹æ³•è¿”å›çš„éå†å™¨ï¼ŒåŒæ—¶åŒ…æ‹¬é”®åå’Œé”®å€¼ï¼Œæ‰€ä»¥æ¯æ¬¡è¾“å‡ºä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ä¸¤ä¸ªæˆå‘˜å®Œå…¨ç›¸ç­‰ã€‚ Setç»“æ„çš„å®ä¾‹é»˜è®¤å¯éå†ï¼Œå®ƒçš„é»˜è®¤éå†å™¨ç”Ÿæˆå‡½æ•°å°±æ˜¯å®ƒçš„valuesæ–¹æ³•ã€‚ 12Set.prototype[Symbol.iterator] === Set.prototype.values// true è¿™æ„å‘³ç€ï¼Œå¯ä»¥çœç•¥valuesæ–¹æ³•ï¼Œç›´æ¥ç”¨for...ofå¾ªç¯éå†Setã€‚ 12345678let set = new Set(['red', 'green', 'blue']);for (let x of set) &#123; console.log(x);&#125;// red// green// blue ï¼ˆ2ï¼‰forEach() Setç»“æ„çš„å®ä¾‹çš„forEachæ–¹æ³•ï¼Œç”¨äºå¯¹æ¯ä¸ªæˆå‘˜æ‰§è¡ŒæŸç§æ“ä½œï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚ 12345let set = new Set([1, 2, 3]);set.forEach((value, key) =&gt; console.log(value * 2) )// 2// 4// 6 ä¸Šé¢ä»£ç è¯´æ˜ï¼ŒforEachæ–¹æ³•çš„å‚æ•°å°±æ˜¯ä¸€ä¸ªå¤„ç†å‡½æ•°ã€‚è¯¥å‡½æ•°çš„å‚æ•°ä¾æ¬¡ä¸ºé”®å€¼ã€é”®åã€é›†åˆæœ¬èº«ï¼ˆä¸Šä¾‹çœç•¥äº†è¯¥å‚æ•°ï¼‰ã€‚å¦å¤–ï¼ŒforEachæ–¹æ³•è¿˜å¯ä»¥æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºç»‘å®šçš„thiså¯¹è±¡ã€‚ ï¼ˆ3ï¼‰éå†çš„åº”ç”¨ æ‰©å±•è¿ç®—ç¬¦ï¼ˆ...ï¼‰å†…éƒ¨ä½¿ç”¨for...ofå¾ªç¯ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨äºSetç»“æ„ã€‚ 123let set = new Set(['red', 'green', 'blue']);let arr = [...set];// ['red', 'green', 'blue'] æ‰©å±•è¿ç®—ç¬¦å’ŒSetç»“æ„ç›¸ç»“åˆï¼Œå°±å¯ä»¥å»é™¤æ•°ç»„çš„é‡å¤æˆå‘˜ã€‚ 123let arr = [3, 5, 2, 2, 5, 5];let unique = [...new Set(arr)];// [3, 5, 2] è€Œä¸”ï¼Œæ•°ç»„çš„mapå’Œfilteræ–¹æ³•ä¹Ÿå¯ä»¥ç”¨äºSetäº†ã€‚ 1234567let set = new Set([1, 2, 3]);set = new Set([...set].map(x =&gt; x * 2));// è¿”å›Setç»“æ„ï¼š&#123;2, 4, 6&#125;let set = new Set([1, 2, 3, 4, 5]);set = new Set([...set].filter(x =&gt; (x % 2) == 0));// è¿”å›Setç»“æ„ï¼š&#123;2, 4&#125; å› æ­¤ä½¿ç”¨Setå¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°å¹¶é›†ï¼ˆUnionï¼‰ã€äº¤é›†ï¼ˆIntersectï¼‰å’Œå·®é›†ï¼ˆDifferenceï¼‰ã€‚ 1234567891011121314let a = new Set([1, 2, 3]);let b = new Set([4, 3, 2]);// å¹¶é›†let union = new Set([...a, ...b]);// Set &#123;1, 2, 3, 4&#125;// äº¤é›†let intersect = new Set([...a].filter(x =&gt; b.has(x)));// set &#123;2, 3&#125;// å·®é›†let difference = new Set([...a].filter(x =&gt; !b.has(x)));// Set &#123;1&#125; å¦‚æœæƒ³åœ¨éå†æ“ä½œä¸­ï¼ŒåŒæ­¥æ”¹å˜åŸæ¥çš„Setç»“æ„ï¼Œç›®å‰æ²¡æœ‰ç›´æ¥çš„æ–¹æ³•ï¼Œä½†æœ‰ä¸¤ç§å˜é€šæ–¹æ³•ã€‚ä¸€ç§æ˜¯åˆ©ç”¨åŸSetç»“æ„æ˜ å°„å‡ºä¸€ä¸ªæ–°çš„ç»“æ„ï¼Œç„¶åèµ‹å€¼ç»™åŸæ¥çš„Setç»“æ„ï¼›å¦ä¸€ç§æ˜¯åˆ©ç”¨Array.fromæ–¹æ³•ã€‚ 123456789// æ–¹æ³•ä¸€let set = new Set([1, 2, 3]);set = new Set([...set].map(val =&gt; val * 2));// setçš„å€¼æ˜¯2, 4, 6// æ–¹æ³•äºŒlet set = new Set([1, 2, 3]);set = new Set(Array.from(set, val =&gt; val * 2));// setçš„å€¼æ˜¯2, 4, 6 ä¸Šé¢ä»£ç æä¾›äº†ä¸¤ç§æ–¹æ³•ï¼Œç›´æ¥åœ¨éå†æ“ä½œä¸­æ”¹å˜åŸæ¥çš„Setç»“æ„ã€‚ WeakSetWeakSetç»“æ„ä¸Setç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸é‡å¤çš„å€¼çš„é›†åˆã€‚ä½†æ˜¯ï¼Œå®ƒä¸Setæœ‰ä¸¤ä¸ªåŒºåˆ«ã€‚ é¦–å…ˆï¼ŒWeakSetçš„æˆå‘˜åªèƒ½æ˜¯å¯¹è±¡ï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–ç±»å‹çš„å€¼ã€‚ å…¶æ¬¡ï¼ŒWeakSetä¸­çš„å¯¹è±¡éƒ½æ˜¯å¼±å¼•ç”¨ï¼Œå³åƒåœ¾å›æ”¶æœºåˆ¶ä¸è€ƒè™‘WeakSetå¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå…¶ä»–å¯¹è±¡éƒ½ä¸å†å¼•ç”¨è¯¥å¯¹è±¡ï¼Œé‚£ä¹ˆåƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨å›æ”¶è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ï¼Œä¸è€ƒè™‘è¯¥å¯¹è±¡è¿˜å­˜åœ¨äºWeakSetä¹‹ä¸­ã€‚è¿™ä¸ªç‰¹ç‚¹æ„å‘³ç€ï¼Œæ— æ³•å¼•ç”¨WeakSetçš„æˆå‘˜ï¼Œå› æ­¤WeakSetæ˜¯ä¸å¯éå†çš„ã€‚ 12345var ws = new WeakSet();ws.add(1)// TypeError: Invalid value used in weak setws.add(Symbol())// TypeError: invalid value used in weak set ä¸Šé¢ä»£ç è¯•å›¾å‘WeakSetæ·»åŠ ä¸€ä¸ªæ•°å€¼å’ŒSymbolå€¼ï¼Œç»“æœæŠ¥é”™ï¼Œå› ä¸ºWeakSetåªèƒ½æ”¾ç½®å¯¹è±¡ã€‚ WeakSetæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨newå‘½ä»¤ï¼Œåˆ›å»ºWeakSetæ•°æ®ç»“æ„ã€‚ 1var ws = new WeakSet(); ä½œä¸ºæ„é€ å‡½æ•°ï¼ŒWeakSetå¯ä»¥æ¥å—ä¸€ä¸ªæ•°ç»„æˆ–ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚ï¼ˆå®é™…ä¸Šï¼Œä»»ä½•å…·æœ‰iterableæ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ä½œä¸ºWeakSetçš„å‚æ•°ã€‚ï¼‰è¯¥æ•°ç»„çš„æ‰€æœ‰æˆå‘˜ï¼Œéƒ½ä¼šè‡ªåŠ¨æˆä¸ºWeakSetå®ä¾‹å¯¹è±¡çš„æˆå‘˜ã€‚ 12var a = [[1,2], [3,4]];var ws = new WeakSet(a); ä¸Šé¢ä»£ç ä¸­ï¼Œaæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒæœ‰ä¸¤ä¸ªæˆå‘˜ï¼Œä¹Ÿéƒ½æ˜¯æ•°ç»„ã€‚å°†aä½œä¸ºWeakSetæ„é€ å‡½æ•°çš„å‚æ•°ï¼Œaçš„æˆå‘˜ä¼šè‡ªåŠ¨æˆä¸ºWeakSetçš„æˆå‘˜ã€‚ æ³¨æ„ï¼Œæ˜¯aæ•°ç»„çš„æˆå‘˜æˆä¸ºWeakSetçš„æˆå‘˜ï¼Œè€Œä¸æ˜¯aæ•°ç»„æœ¬èº«ã€‚è¿™æ„å‘³ç€ï¼Œæ•°ç»„çš„æˆå‘˜åªèƒ½æ˜¯å¯¹è±¡ã€‚ 123var b = [3, 4];var ws = new WeakSet(b);// Uncaught TypeError: Invalid value used in weak set(â€¦) ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„bçš„æˆå‘˜ä¸æ˜¯å¯¹è±¡ï¼ŒåŠ å…¥WeaKSetå°±ä¼šæŠ¥é”™ã€‚ WeakSetç»“æ„æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ã€‚ WeakSet.prototype.add(value)ï¼šå‘WeakSetå®ä¾‹æ·»åŠ ä¸€ä¸ªæ–°æˆå‘˜ã€‚ WeakSet.prototype.delete(value)ï¼šæ¸…é™¤WeakSetå®ä¾‹çš„æŒ‡å®šæˆå‘˜ã€‚ WeakSet.prototype.has(value)ï¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªå€¼æ˜¯å¦åœ¨WeakSetå®ä¾‹ä¹‹ä¸­ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 123456789101112var ws = new WeakSet();var obj = &#123;&#125;;var foo = &#123;&#125;;ws.add(window);ws.add(obj);ws.has(window); // truews.has(foo); // falsews.delete(window);ws.has(window); // false WeakSetæ²¡æœ‰sizeå±æ€§ï¼Œæ²¡æœ‰åŠæ³•éå†å®ƒçš„æˆå‘˜ã€‚ 12345ws.size // undefinedws.forEach // undefinedws.forEach(function(item)&#123; console.log('WeakSet has ' + item)&#125;)// TypeError: undefined is not a function ä¸Šé¢ä»£ç è¯•å›¾è·å–sizeå’ŒforEachå±æ€§ï¼Œç»“æœéƒ½ä¸èƒ½æˆåŠŸã€‚ WeakSetä¸èƒ½éå†ï¼Œæ˜¯å› ä¸ºæˆå‘˜éƒ½æ˜¯å¼±å¼•ç”¨ï¼Œéšæ—¶å¯èƒ½æ¶ˆå¤±ï¼Œéå†æœºåˆ¶æ— æ³•ä¿è¯æˆå‘˜çš„å­˜åœ¨ï¼Œå¾ˆå¯èƒ½åˆšåˆšéå†ç»“æŸï¼Œæˆå‘˜å°±å–ä¸åˆ°äº†ã€‚WeakSetçš„ä¸€ä¸ªç”¨å¤„ï¼Œæ˜¯å‚¨å­˜DOMèŠ‚ç‚¹ï¼Œè€Œä¸ç”¨æ‹…å¿ƒè¿™äº›èŠ‚ç‚¹ä»æ–‡æ¡£ç§»é™¤æ—¶ï¼Œä¼šå¼•å‘å†…å­˜æ³„æ¼ã€‚ ä¸‹é¢æ˜¯WeakSetçš„å¦ä¸€ä¸ªä¾‹å­ã€‚ 1234567891011const foos = new WeakSet()class Foo &#123; constructor() &#123; foos.add(this) &#125; method () &#123; if (!foos.has(this)) &#123; throw new TypeError('Foo.prototype.method åªèƒ½åœ¨Fooçš„å®ä¾‹ä¸Šè°ƒç”¨ï¼'); &#125; &#125;&#125; ä¸Šé¢ä»£ç ä¿è¯äº†Fooçš„å®ä¾‹æ–¹æ³•ï¼Œåªèƒ½åœ¨Fooçš„å®ä¾‹ä¸Šè°ƒç”¨ã€‚è¿™é‡Œä½¿ç”¨WeakSetçš„å¥½å¤„æ˜¯ï¼Œfooså¯¹å®ä¾‹çš„å¼•ç”¨ï¼Œä¸ä¼šè¢«è®¡å…¥å†…å­˜å›æ”¶æœºåˆ¶ï¼Œæ‰€ä»¥åˆ é™¤å®ä¾‹çš„æ—¶å€™ï¼Œä¸ç”¨è€ƒè™‘foosï¼Œä¹Ÿä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼ã€‚ MapMapç»“æ„çš„ç›®çš„å’ŒåŸºæœ¬ç”¨æ³•JavaScriptçš„å¯¹è±¡ï¼ˆObjectï¼‰ï¼Œæœ¬è´¨ä¸Šæ˜¯é”®å€¼å¯¹çš„é›†åˆï¼ˆHashç»“æ„ï¼‰ï¼Œä½†æ˜¯ä¼ ç»Ÿä¸Šåªèƒ½ç”¨å­—ç¬¦ä¸²å½“ä½œé”®ã€‚è¿™ç»™å®ƒçš„ä½¿ç”¨å¸¦æ¥äº†å¾ˆå¤§çš„é™åˆ¶ã€‚ 12345var data = &#123;&#125;;var element = document.getElementById('myDiv');data[element] = 'metadata';data['[object HTMLDivElement]'] // \"metadata\" ä¸Šé¢ä»£ç åŸæ„æ˜¯å°†ä¸€ä¸ªDOMèŠ‚ç‚¹ä½œä¸ºå¯¹è±¡dataçš„é”®ï¼Œä½†æ˜¯ç”±äºå¯¹è±¡åªæ¥å—å­—ç¬¦ä¸²ä½œä¸ºé”®åï¼Œæ‰€ä»¥elementè¢«è‡ªåŠ¨è½¬ä¸ºå­—ç¬¦ä¸²[object HTMLDivElement]ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒES6æä¾›äº†Mapæ•°æ®ç»“æ„ã€‚å®ƒç±»ä¼¼äºå¯¹è±¡ï¼Œä¹Ÿæ˜¯é”®å€¼å¯¹çš„é›†åˆï¼Œä½†æ˜¯â€œé”®â€çš„èŒƒå›´ä¸é™äºå­—ç¬¦ä¸²ï¼Œå„ç§ç±»å‹çš„å€¼ï¼ˆåŒ…æ‹¬å¯¹è±¡ï¼‰éƒ½å¯ä»¥å½“ä½œé”®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒObjectç»“æ„æä¾›äº†â€œå­—ç¬¦ä¸²â€”å€¼â€çš„å¯¹åº”ï¼ŒMapç»“æ„æä¾›äº†â€œå€¼â€”å€¼â€çš„å¯¹åº”ï¼Œæ˜¯ä¸€ç§æ›´å®Œå–„çš„Hashç»“æ„å®ç°ã€‚å¦‚æœä½ éœ€è¦â€œé”®å€¼å¯¹â€çš„æ•°æ®ç»“æ„ï¼ŒMapæ¯”Objectæ›´åˆé€‚ã€‚ 123456789var m = new Map();var o = &#123;p: 'Hello World'&#125;;m.set(o, 'content')m.get(o) // \"content\"m.has(o) // truem.delete(o) // truem.has(o) // false ä¸Šé¢ä»£ç ä½¿ç”¨setæ–¹æ³•ï¼Œå°†å¯¹è±¡oå½“ä½œmçš„ä¸€ä¸ªé”®ï¼Œç„¶ååˆä½¿ç”¨getæ–¹æ³•è¯»å–è¿™ä¸ªé”®ï¼Œæ¥ç€ä½¿ç”¨deleteæ–¹æ³•åˆ é™¤äº†è¿™ä¸ªé”®ã€‚ ä½œä¸ºæ„é€ å‡½æ•°ï¼ŒMapä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ã€‚è¯¥æ•°ç»„çš„æˆå‘˜æ˜¯ä¸€ä¸ªä¸ªè¡¨ç¤ºé”®å€¼å¯¹çš„æ•°ç»„ã€‚ 12345678910var map = new Map([ ['name', 'å¼ ä¸‰'], ['title', 'Author']]);map.size // 2map.has('name') // truemap.get('name') // \"å¼ ä¸‰\"map.has('title') // truemap.get('title') // \"Author\" ä¸Šé¢ä»£ç åœ¨æ–°å»ºMapå®ä¾‹æ—¶ï¼Œå°±æŒ‡å®šäº†ä¸¤ä¸ªé”®nameå’Œtitleã€‚ Mapæ„é€ å‡½æ•°æ¥å—æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯ä¸‹é¢çš„ç®—æ³•ã€‚ 123456var items = [ ['name', 'å¼ ä¸‰'], ['title', 'Author']];var map = new Map();items.forEach(([key, value]) =&gt; map.set(key, value)); ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå­—ç¬¦ä¸²trueå’Œå¸ƒå°”å€¼trueæ˜¯ä¸¤ä¸ªä¸åŒçš„é”®ã€‚ 1234567var m = new Map([ [true, 'foo'], ['true', 'bar']]);m.get(true) // 'foo'm.get('true') // 'bar' å¦‚æœå¯¹åŒä¸€ä¸ªé”®å¤šæ¬¡èµ‹å€¼ï¼Œåé¢çš„å€¼å°†è¦†ç›–å‰é¢çš„å€¼ã€‚ 1234567let map = new Map();map.set(1, 'aaa').set(1, 'bbb');map.get(1) // \"bbb\" ä¸Šé¢ä»£ç å¯¹é”®1è¿ç»­èµ‹å€¼ä¸¤æ¬¡ï¼Œåä¸€æ¬¡çš„å€¼è¦†ç›–å‰ä¸€æ¬¡çš„å€¼ã€‚ å¦‚æœè¯»å–ä¸€ä¸ªæœªçŸ¥çš„é”®ï¼Œåˆ™è¿”å›undefinedã€‚ 12new Map().get('asfddfsasadf')// undefined æ³¨æ„ï¼Œåªæœ‰å¯¹åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼ŒMapç»“æ„æ‰å°†å…¶è§†ä¸ºåŒä¸€ä¸ªé”®ã€‚è¿™ä¸€ç‚¹è¦éå¸¸å°å¿ƒã€‚ 1234var map = new Map();map.set(['a'], 555);map.get(['a']) // undefined ä¸Šé¢ä»£ç çš„setå’Œgetæ–¹æ³•ï¼Œè¡¨é¢æ˜¯é’ˆå¯¹åŒä¸€ä¸ªé”®ï¼Œä½†å®é™…ä¸Šè¿™æ˜¯ä¸¤ä¸ªå€¼ï¼Œå†…å­˜åœ°å€æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› æ­¤getæ–¹æ³•æ— æ³•è¯»å–è¯¥é”®ï¼Œè¿”å›undefinedã€‚ åŒç†ï¼ŒåŒæ ·çš„å€¼çš„ä¸¤ä¸ªå®ä¾‹ï¼Œåœ¨Mapç»“æ„ä¸­è¢«è§†ä¸ºä¸¤ä¸ªé”®ã€‚ 1234567891011var map = new Map();var k1 = ['a'];var k2 = ['a'];map.set(k1, 111).set(k2, 222);map.get(k1) // 111map.get(k2) // 222 ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡k1å’Œk2çš„å€¼æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å®ƒä»¬åœ¨Mapç»“æ„ä¸­è¢«è§†ä¸ºä¸¤ä¸ªé”®ã€‚ ç”±ä¸Šå¯çŸ¥ï¼ŒMapçš„é”®å®é™…ä¸Šæ˜¯è·Ÿå†…å­˜åœ°å€ç»‘å®šçš„ï¼Œåªè¦å†…å­˜åœ°å€ä¸ä¸€æ ·ï¼Œå°±è§†ä¸ºä¸¤ä¸ªé”®ã€‚è¿™å°±è§£å†³äº†åŒåå±æ€§ç¢°æ’ï¼ˆclashï¼‰çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ‰©å±•åˆ«äººçš„åº“çš„æ—¶å€™ï¼Œå¦‚æœä½¿ç”¨å¯¹è±¡ä½œä¸ºé”®åï¼Œå°±ä¸ç”¨æ‹…å¿ƒè‡ªå·±çš„å±æ€§ä¸åŸä½œè€…çš„å±æ€§åŒåã€‚ å¦‚æœMapçš„é”®æ˜¯ä¸€ä¸ªç®€å•ç±»å‹çš„å€¼ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ï¼‰ï¼Œåˆ™åªè¦ä¸¤ä¸ªå€¼ä¸¥æ ¼ç›¸ç­‰ï¼ŒMapå°†å…¶è§†ä¸ºä¸€ä¸ªé”®ï¼ŒåŒ…æ‹¬0å’Œ-0ã€‚å¦å¤–ï¼Œè™½ç„¶NaNä¸ä¸¥æ ¼ç›¸ç­‰äºè‡ªèº«ï¼Œä½†Mapå°†å…¶è§†ä¸ºåŒä¸€ä¸ªé”®ã€‚ 1234567let map = new Map();map.set(NaN, 123);map.get(NaN) // 123map.set(-0, 123);map.get(+0) // 123 å®ä¾‹çš„å±æ€§å’Œæ“ä½œæ–¹æ³•Mapç»“æ„çš„å®ä¾‹æœ‰ä»¥ä¸‹å±æ€§å’Œæ“ä½œæ–¹æ³•ã€‚ ï¼ˆ1ï¼‰sizeå±æ€§ sizeå±æ€§è¿”å›Mapç»“æ„çš„æˆå‘˜æ€»æ•°ã€‚ 12345let map = new Map();map.set('foo', true);map.set('bar', false);map.size // 2 ï¼ˆ2ï¼‰set(key, value) setæ–¹æ³•è®¾ç½®keyæ‰€å¯¹åº”çš„é”®å€¼ï¼Œç„¶åè¿”å›æ•´ä¸ªMapç»“æ„ã€‚å¦‚æœkeyå·²ç»æœ‰å€¼ï¼Œåˆ™é”®å€¼ä¼šè¢«æ›´æ–°ï¼Œå¦åˆ™å°±æ–°ç”Ÿæˆè¯¥é”®ã€‚ 12345var m = new Map();m.set(\"edition\", 6) // é”®æ˜¯å­—ç¬¦ä¸²m.set(262, \"standard\") // é”®æ˜¯æ•°å€¼m.set(undefined, \"nah\") // é”®æ˜¯undefined setæ–¹æ³•è¿”å›çš„æ˜¯Mapæœ¬èº«ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ã€‚ 1234let map = new Map() .set(1, 'a') .set(2, 'b') .set(3, 'c'); ï¼ˆ3ï¼‰get(key) getæ–¹æ³•è¯»å–keyå¯¹åº”çš„é”®å€¼ï¼Œå¦‚æœæ‰¾ä¸åˆ°keyï¼Œè¿”å›undefinedã€‚ 123456var m = new Map();var hello = function() &#123;console.log(\"hello\");&#125;m.set(hello, \"Hello ES6!\") // é”®æ˜¯å‡½æ•°m.get(hello) // Hello ES6! ï¼ˆ4ï¼‰has(key) hasæ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªé”®æ˜¯å¦åœ¨Mapæ•°æ®ç»“æ„ä¸­ã€‚ 12345678910var m = new Map();m.set(\"edition\", 6);m.set(262, \"standard\");m.set(undefined, \"nah\");m.has(\"edition\") // truem.has(\"years\") // falsem.has(262) // truem.has(undefined) // true ï¼ˆ5ï¼‰delete(key) deleteæ–¹æ³•åˆ é™¤æŸä¸ªé”®ï¼Œè¿”å›trueã€‚å¦‚æœåˆ é™¤å¤±è´¥ï¼Œè¿”å›falseã€‚ 123456var m = new Map();m.set(undefined, \"nah\");m.has(undefined) // truem.delete(undefined)m.has(undefined) // false ï¼ˆ6ï¼‰clear() clearæ–¹æ³•æ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚ 1234567let map = new Map();map.set('foo', true);map.set('bar', false);map.size // 2map.clear()map.size // 0 éå†æ–¹æ³•MapåŸç”Ÿæä¾›ä¸‰ä¸ªéå†å™¨ç”Ÿæˆå‡½æ•°å’Œä¸€ä¸ªéå†æ–¹æ³•ã€‚ keys()ï¼šè¿”å›é”®åçš„éå†å™¨ã€‚ values()ï¼šè¿”å›é”®å€¼çš„éå†å™¨ã€‚ entries()ï¼šè¿”å›æ‰€æœ‰æˆå‘˜çš„éå†å™¨ã€‚ forEach()ï¼šéå†Mapçš„æ‰€æœ‰æˆå‘˜ã€‚ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼ŒMapçš„éå†é¡ºåºå°±æ˜¯æ’å…¥é¡ºåºã€‚ ä¸‹é¢æ˜¯ä½¿ç”¨å®ä¾‹ã€‚ 1234567891011121314151617181920212223242526272829303132let map = new Map([ ['F', 'no'], ['T', 'yes'],]);for (let key of map.keys()) &#123; console.log(key);&#125;// \"F\"// \"T\"for (let value of map.values()) &#123; console.log(value);&#125;// \"no\"// \"yes\"for (let item of map.entries()) &#123; console.log(item[0], item[1]);&#125;// \"F\" \"no\"// \"T\" \"yes\"// æˆ–è€…for (let [key, value] of map.entries()) &#123; console.log(key, value);&#125;// ç­‰åŒäºä½¿ç”¨map.entries()for (let [key, value] of map) &#123; console.log(key, value);&#125; ä¸Šé¢ä»£ç æœ€åçš„é‚£ä¸ªä¾‹å­ï¼Œè¡¨ç¤ºMapç»“æ„çš„é»˜è®¤éå†å™¨æ¥å£ï¼ˆSymbol.iteratorå±æ€§ï¼‰ï¼Œå°±æ˜¯entriesæ–¹æ³•ã€‚ 12map[Symbol.iterator] === map.entries// true Mapç»“æ„è½¬ä¸ºæ•°ç»„ç»“æ„ï¼Œæ¯”è¾ƒå¿«é€Ÿçš„æ–¹æ³•æ˜¯ç»“åˆä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼ˆ...ï¼‰ã€‚ 1234567891011121314151617let map = new Map([ [1, 'one'], [2, 'two'], [3, 'three'],]);[...map.keys()]// [1, 2, 3][...map.values()]// ['one', 'two', 'three'][...map.entries()]// [[1,'one'], [2, 'two'], [3, 'three']][...map]// [[1,'one'], [2, 'two'], [3, 'three']] ç»“åˆæ•°ç»„çš„mapæ–¹æ³•ã€filteræ–¹æ³•ï¼Œå¯ä»¥å®ç°Mapçš„éå†å’Œè¿‡æ»¤ï¼ˆMapæœ¬èº«æ²¡æœ‰mapå’Œfilteræ–¹æ³•ï¼‰ã€‚ 1234567891011121314let map0 = new Map() .set(1, 'a') .set(2, 'b') .set(3, 'c');let map1 = new Map( [...map0].filter(([k, v]) =&gt; k &lt; 3));// äº§ç”ŸMapç»“æ„ &#123;1 =&gt; 'a', 2 =&gt; 'b'&#125;let map2 = new Map( [...map0].map(([k, v]) =&gt; [k * 2, '_' + v]) );// äº§ç”ŸMapç»“æ„ &#123;2 =&gt; '_a', 4 =&gt; '_b', 6 =&gt; '_c'&#125; æ­¤å¤–ï¼ŒMapè¿˜æœ‰ä¸€ä¸ªforEachæ–¹æ³•ï¼Œä¸æ•°ç»„çš„forEachæ–¹æ³•ç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥å®ç°éå†ã€‚ 123map.forEach(function(value, key, map) &#123; console.log(\"Key: %s, Value: %s\", key, value);&#125;); forEachæ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šthisã€‚ 123456789var reporter = &#123; report: function(key, value) &#123; console.log(\"Key: %s, Value: %s\", key, value); &#125;&#125;;map.forEach(function(value, key, map) &#123; this.report(key, value);&#125;, reporter); ä¸Šé¢ä»£ç ä¸­ï¼ŒforEachæ–¹æ³•çš„å›è°ƒå‡½æ•°çš„thisï¼Œå°±æŒ‡å‘reporterã€‚ ä¸å…¶ä»–æ•°æ®ç»“æ„çš„äº’ç›¸è½¬æ¢ï¼ˆ1ï¼‰Mapè½¬ä¸ºæ•°ç»„ å‰é¢å·²ç»æè¿‡ï¼ŒMapè½¬ä¸ºæ•°ç»„æœ€æ–¹ä¾¿çš„æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼ˆâ€¦ï¼‰ã€‚ 123let myMap = new Map().set(true, 7).set(&#123;foo: 3&#125;, ['abc']);[...myMap]// [ [ true, 7 ], [ &#123; foo: 3 &#125;, [ 'abc' ] ] ] ï¼ˆ2ï¼‰æ•°ç»„è½¬ä¸ºMap å°†æ•°ç»„è½¬å…¥Mapæ„é€ å‡½æ•°ï¼Œå°±å¯ä»¥è½¬ä¸ºMapã€‚ 12new Map([[true, 7], [&#123;foo: 3&#125;, ['abc']]])// Map &#123;true =&gt; 7, Object &#123;foo: 3&#125; =&gt; ['abc']&#125; ï¼ˆ3ï¼‰Mapè½¬ä¸ºå¯¹è±¡ å¦‚æœæ‰€æœ‰Mapçš„é”®éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒå¯ä»¥è½¬ä¸ºå¯¹è±¡ã€‚ 1234567891011function strMapToObj(strMap) &#123; let obj = Object.create(null); for (let [k,v] of strMap) &#123; obj[k] = v; &#125; return obj;&#125;let myMap = new Map().set('yes', true).set('no', false);strMapToObj(myMap)// &#123; yes: true, no: false &#125; ï¼ˆ4ï¼‰å¯¹è±¡è½¬ä¸ºMap 12345678910function objToStrMap(obj) &#123; let strMap = new Map(); for (let k of Object.keys(obj)) &#123; strMap.set(k, obj[k]); &#125; return strMap;&#125;objToStrMap(&#123;yes: true, no: false&#125;)// [ [ 'yes', true ], [ 'no', false ] ] ï¼ˆ5ï¼‰Mapè½¬ä¸ºJSON Mapè½¬ä¸ºJSONè¦åŒºåˆ†ä¸¤ç§æƒ…å†µã€‚ä¸€ç§æƒ…å†µæ˜¯ï¼ŒMapçš„é”®åéƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™æ—¶å¯ä»¥é€‰æ‹©è½¬ä¸ºå¯¹è±¡JSONã€‚ 1234567function strMapToJson(strMap) &#123; return JSON.stringify(strMapToObj(strMap));&#125;let myMap = new Map().set('yes', true).set('no', false);strMapToJson(myMap)// '&#123;\"yes\":true,\"no\":false&#125;' å¦ä¸€ç§æƒ…å†µæ˜¯ï¼ŒMapçš„é”®åæœ‰éå­—ç¬¦ä¸²ï¼Œè¿™æ—¶å¯ä»¥é€‰æ‹©è½¬ä¸ºæ•°ç»„JSONã€‚ 1234567function mapToArrayJson(map) &#123; return JSON.stringify([...map]);&#125;let myMap = new Map().set(true, 7).set(&#123;foo: 3&#125;, ['abc']);mapToArrayJson(myMap)// '[[true,7],[&#123;\"foo\":3&#125;,[\"abc\"]]]' ï¼ˆ6ï¼‰JSONè½¬ä¸ºMap JSONè½¬ä¸ºMapï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰é”®åéƒ½æ˜¯å­—ç¬¦ä¸²ã€‚ 123456function jsonToStrMap(jsonStr) &#123; return objToStrMap(JSON.parse(jsonStr));&#125;jsonToStrMap('&#123;\"yes\":true,\"no\":false&#125;')// Map &#123;'yes' =&gt; true, 'no' =&gt; false&#125; ä½†æ˜¯ï¼Œæœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œæ•´ä¸ªJSONå°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸”æ¯ä¸ªæ•°ç»„æˆå‘˜æœ¬èº«ï¼Œåˆæ˜¯ä¸€ä¸ªæœ‰ä¸¤ä¸ªæˆå‘˜çš„æ•°ç»„ã€‚è¿™æ—¶ï¼Œå®ƒå¯ä»¥ä¸€ä¸€å¯¹åº”åœ°è½¬ä¸ºMapã€‚è¿™å¾€å¾€æ˜¯æ•°ç»„è½¬ä¸ºJSONçš„é€†æ“ä½œã€‚ 123456function jsonToMap(jsonStr) &#123; return new Map(JSON.parse(jsonStr));&#125;jsonToMap('[[true,7],[&#123;\"foo\":3&#125;,[\"abc\"]]]')// Map &#123;true =&gt; 7, Object &#123;foo: 3&#125; =&gt; ['abc']&#125; WeakMapWeakMapç»“æ„ä¸Mapç»“æ„åŸºæœ¬ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯å®ƒåªæ¥å—å¯¹è±¡ä½œä¸ºé”®åï¼ˆnullé™¤å¤–ï¼‰ï¼Œä¸æ¥å—å…¶ä»–ç±»å‹çš„å€¼ä½œä¸ºé”®åï¼Œè€Œä¸”é”®åæ‰€æŒ‡å‘çš„å¯¹è±¡ï¼Œä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ã€‚ 12345var map = new WeakMap()map.set(1, 2)// TypeError: 1 is not an object!map.set(Symbol(), 2)// TypeError: Invalid value used as weak map key ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœå°†1å’ŒSymbolä½œä¸ºWeakMapçš„é”®åï¼Œéƒ½ä¼šæŠ¥é”™ã€‚ WeakMapçš„è®¾è®¡ç›®çš„åœ¨äºï¼Œé”®åæ˜¯å¯¹è±¡çš„å¼±å¼•ç”¨ï¼ˆåƒåœ¾å›æ”¶æœºåˆ¶ä¸å°†è¯¥å¼•ç”¨è€ƒè™‘åœ¨å†…ï¼‰ï¼Œæ‰€ä»¥å…¶æ‰€å¯¹åº”çš„å¯¹è±¡å¯èƒ½ä¼šè¢«è‡ªåŠ¨å›æ”¶ã€‚å½“å¯¹è±¡è¢«å›æ”¶åï¼ŒWeakMapè‡ªåŠ¨ç§»é™¤å¯¹åº”çš„é”®å€¼å¯¹ã€‚å…¸å‹åº”ç”¨æ˜¯ï¼Œä¸€ä¸ªå¯¹åº”DOMå…ƒç´ çš„WeakMapç»“æ„ï¼Œå½“æŸä¸ªDOMå…ƒç´ è¢«æ¸…é™¤ï¼Œå…¶æ‰€å¯¹åº”çš„WeakMapè®°å½•å°±ä¼šè‡ªåŠ¨è¢«ç§»é™¤ã€‚åŸºæœ¬ä¸Šï¼ŒWeakMapçš„ä¸“ç”¨åœºåˆå°±æ˜¯ï¼Œå®ƒçš„é”®æ‰€å¯¹åº”çš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šåœ¨å°†æ¥æ¶ˆå¤±ã€‚WeakMapç»“æ„æœ‰åŠ©äºé˜²æ­¢å†…å­˜æ³„æ¼ã€‚ ä¸‹é¢æ˜¯WeakMapç»“æ„çš„ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°ç”¨æ³•ä¸Šä¸Mapå‡ ä¹ä¸€æ ·ã€‚ 123456789var wm = new WeakMap();var element = document.querySelector(\".element\");wm.set(element, \"Original\");wm.get(element) // \"Original\"element.parentNode.removeChild(element);element = null;wm.get(element) // undefined ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡wmæ˜¯ä¸€ä¸ªWeakMapå®ä¾‹ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªDOMèŠ‚ç‚¹elementä½œä¸ºé”®åï¼Œç„¶åé”€æ¯è¿™ä¸ªèŠ‚ç‚¹ï¼Œelementå¯¹åº”çš„é”®å°±è‡ªåŠ¨æ¶ˆå¤±äº†ï¼Œå†å¼•ç”¨è¿™ä¸ªé”®åå°±è¿”å›undefinedã€‚ WeakMapä¸Mapåœ¨APIä¸Šçš„åŒºåˆ«ä¸»è¦æ˜¯ä¸¤ä¸ªï¼Œä¸€æ˜¯æ²¡æœ‰éå†æ“ä½œï¼ˆå³æ²¡æœ‰key()ã€values()å’Œentries()æ–¹æ³•ï¼‰ï¼Œä¹Ÿæ²¡æœ‰sizeå±æ€§ï¼›äºŒæ˜¯æ— æ³•æ¸…ç©ºï¼Œå³ä¸æ”¯æŒclearæ–¹æ³•ã€‚è¿™ä¸WeakMapçš„é”®ä¸è¢«è®¡å…¥å¼•ç”¨ã€è¢«åƒåœ¾å›æ”¶æœºåˆ¶å¿½ç•¥æœ‰å…³ã€‚å› æ­¤ï¼ŒWeakMapåªæœ‰å››ä¸ªæ–¹æ³•å¯ç”¨ï¼šget()ã€set()ã€has()ã€delete()ã€‚ 1234567var wm = new WeakMap();wm.size// undefinedwm.forEach// undefined å‰æ–‡è¯´è¿‡ï¼ŒWeakMapåº”ç”¨çš„å…¸å‹åœºåˆå°±æ˜¯DOMèŠ‚ç‚¹ä½œä¸ºé”®åã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 123456789let myElement = document.getElementById('logo');let myWeakmap = new WeakMap();myWeakmap.set(myElement, &#123;timesClicked: 0&#125;);myElement.addEventListener('click', function() &#123; let logoData = myWeakmap.get(myElement); logoData.timesClicked++;&#125;, false); ä¸Šé¢ä»£ç ä¸­ï¼ŒmyElementæ˜¯ä¸€ä¸ª DOM èŠ‚ç‚¹ï¼Œæ¯å½“å‘ç”Ÿclickäº‹ä»¶ï¼Œå°±æ›´æ–°ä¸€ä¸‹çŠ¶æ€ã€‚æˆ‘ä»¬å°†è¿™ä¸ªçŠ¶æ€ä½œä¸ºé”®å€¼æ”¾åœ¨ WeakMap é‡Œï¼Œå¯¹åº”çš„é”®åå°±æ˜¯myElementã€‚ä¸€æ—¦è¿™ä¸ª DOM èŠ‚ç‚¹åˆ é™¤ï¼Œè¯¥çŠ¶æ€å°±ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œä¸å­˜åœ¨å†…å­˜æ³„æ¼é£é™©ã€‚ WeakMap çš„å¦ä¸€ä¸ªç”¨å¤„æ˜¯éƒ¨ç½²ç§æœ‰å±æ€§ã€‚ 123456789101112131415161718192021222324let _counter = new WeakMap();let _action = new WeakMap();class Countdown &#123; constructor(counter, action) &#123; _counter.set(this, counter); _action.set(this, action); &#125; dec() &#123; let counter = _counter.get(this); if (counter &lt; 1) return; counter--; _counter.set(this, counter); if (counter === 0) &#123; _action.get(this)(); &#125; &#125;&#125;let c = new Countdown(2, () =&gt; console.log('DONE'));c.dec()c.dec()// DONE ä¸Šé¢ä»£ç ä¸­ï¼ŒCountdownç±»çš„ä¸¤ä¸ªå†…éƒ¨å±æ€§_counterå’Œ_actionï¼Œæ˜¯å®ä¾‹çš„å¼±å¼•ç”¨ï¼Œæ‰€ä»¥å¦‚æœåˆ é™¤å®ä¾‹ï¼Œå®ƒä»¬ä¹Ÿå°±éšä¹‹æ¶ˆå¤±ï¼Œä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"Set","slug":"Set","permalink":"http://microzz.com/tags/Set/"},{"name":"Map","slug":"Map","permalink":"http://microzz.com/tags/Map/"}]},{"title":"Symbol","date":"2017-01-01T05:43:19.000Z","path":"2017/01/01/symbol/","text":"Symbolæ¦‚è¿°ES5çš„å¯¹è±¡å±æ€§åéƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™å®¹æ˜“é€ æˆå±æ€§åçš„å†²çªã€‚æ¯”å¦‚ï¼Œä½ ä½¿ç”¨äº†ä¸€ä¸ªä»–äººæä¾›çš„å¯¹è±¡ï¼Œä½†åˆæƒ³ä¸ºè¿™ä¸ªå¯¹è±¡æ·»åŠ æ–°çš„æ–¹æ³•ï¼ˆmixinæ¨¡å¼ï¼‰ï¼Œæ–°æ–¹æ³•çš„åå­—å°±æœ‰å¯èƒ½ä¸ç°æœ‰æ–¹æ³•äº§ç”Ÿå†²çªã€‚å¦‚æœæœ‰ä¸€ç§æœºåˆ¶ï¼Œä¿è¯æ¯ä¸ªå±æ€§çš„åå­—éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„å°±å¥½äº†ï¼Œè¿™æ ·å°±ä»æ ¹æœ¬ä¸Šé˜²æ­¢å±æ€§åçš„å†²çªã€‚è¿™å°±æ˜¯ES6å¼•å…¥Symbolçš„åŸå› ã€‚ ES6å¼•å…¥äº†ä¸€ç§æ–°çš„åŸå§‹æ•°æ®ç±»å‹Symbolï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼ã€‚å®ƒæ˜¯JavaScriptè¯­è¨€çš„ç¬¬ä¸ƒç§æ•°æ®ç±»å‹ï¼Œå‰å…­ç§æ˜¯ï¼šUndefinedã€Nullã€å¸ƒå°”å€¼ï¼ˆBooleanï¼‰ã€å­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€æ•°å€¼ï¼ˆNumberï¼‰ã€å¯¹è±¡ï¼ˆObjectï¼‰ã€‚ Symbolå€¼é€šè¿‡Symbolå‡½æ•°ç”Ÿæˆã€‚è¿™å°±æ˜¯è¯´ï¼Œå¯¹è±¡çš„å±æ€§åç°åœ¨å¯ä»¥æœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯åŸæ¥å°±æœ‰çš„å­—ç¬¦ä¸²ï¼Œå¦ä¸€ç§å°±æ˜¯æ–°å¢çš„Symbolç±»å‹ã€‚å‡¡æ˜¯å±æ€§åå±äºSymbolç±»å‹ï¼Œå°±éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œå¯ä»¥ä¿è¯ä¸ä¼šä¸å…¶ä»–å±æ€§åäº§ç”Ÿå†²çªã€‚ 1234let s = Symbol();typeof s// \"symbol\" ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡så°±æ˜¯ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å€¼ã€‚typeofè¿ç®—ç¬¦çš„ç»“æœï¼Œè¡¨æ˜å˜é‡sæ˜¯Symbolæ•°æ®ç±»å‹ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ä¹‹ç±»çš„å…¶ä»–ç±»å‹ã€‚ æ³¨æ„ï¼ŒSymbolå‡½æ•°å‰ä¸èƒ½ä½¿ç”¨newå‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºç”Ÿæˆçš„Symbolæ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹çš„å€¼ï¼Œä¸æ˜¯å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”±äºSymbolå€¼ä¸æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä¸èƒ½æ·»åŠ å±æ€§ã€‚åŸºæœ¬ä¸Šï¼Œå®ƒæ˜¯ä¸€ç§ç±»ä¼¼äºå­—ç¬¦ä¸²çš„æ•°æ®ç±»å‹ã€‚ Symbolå‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºå¯¹Symbolå®ä¾‹çš„æè¿°ï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨æ§åˆ¶å°æ˜¾ç¤ºï¼Œæˆ–è€…è½¬ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œæ¯”è¾ƒå®¹æ˜“åŒºåˆ†ã€‚ 12345678var s1 = Symbol('foo');var s2 = Symbol('bar');s1 // Symbol(foo)s2 // Symbol(bar)s1.toString() // \"Symbol(foo)\"s2.toString() // \"Symbol(bar)\" ä¸Šé¢ä»£ç ä¸­ï¼Œs1å’Œs2æ˜¯ä¸¤ä¸ªSymbolå€¼ã€‚å¦‚æœä¸åŠ å‚æ•°ï¼Œå®ƒä»¬åœ¨æ§åˆ¶å°çš„è¾“å‡ºéƒ½æ˜¯Symbol()ï¼Œä¸åˆ©äºåŒºåˆ†ã€‚æœ‰äº†å‚æ•°ä»¥åï¼Œå°±ç­‰äºä¸ºå®ƒä»¬åŠ ä¸Šäº†æè¿°ï¼Œè¾“å‡ºçš„æ—¶å€™å°±èƒ½å¤Ÿåˆ†æ¸…ï¼Œåˆ°åº•æ˜¯å“ªä¸€ä¸ªå€¼ã€‚ å¦‚æœ Symbol çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±ä¼šè°ƒç”¨è¯¥å¯¹è±¡çš„toStringæ–¹æ³•ï¼Œå°†å…¶è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åæ‰ç”Ÿæˆä¸€ä¸ª Symbol å€¼ã€‚ 1234567const obj = &#123; toString() &#123; return 'abc'; &#125;&#125;;const sym = Symbol(obj);sym // Symbol(abc) æ³¨æ„ï¼ŒSymbolå‡½æ•°çš„å‚æ•°åªæ˜¯è¡¨ç¤ºå¯¹å½“å‰ Symbol å€¼çš„æè¿°ï¼Œå› æ­¤ç›¸åŒå‚æ•°çš„Symbolå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸ç›¸ç­‰çš„ã€‚ 1234567891011// æ²¡æœ‰å‚æ•°çš„æƒ…å†µvar s1 = Symbol();var s2 = Symbol();s1 === s2 // false// æœ‰å‚æ•°çš„æƒ…å†µvar s1 = Symbol('foo');var s2 = Symbol('foo');s1 === s2 // false ä¸Šé¢ä»£ç ä¸­ï¼Œs1å’Œs2éƒ½æ˜¯Symbolå‡½æ•°çš„è¿”å›å€¼ï¼Œè€Œä¸”å‚æ•°ç›¸åŒï¼Œä½†æ˜¯å®ƒä»¬æ˜¯ä¸ç›¸ç­‰çš„ã€‚ Symbolå€¼ä¸èƒ½ä¸å…¶ä»–ç±»å‹çš„å€¼è¿›è¡Œè¿ç®—ï¼Œä¼šæŠ¥é”™ã€‚ 123456var sym = Symbol('My symbol');\"your symbol is \" + sym// TypeError: can't convert symbol to string`your symbol is $&#123;sym&#125;`// TypeError: can't convert symbol to string ä½†æ˜¯ï¼ŒSymbolå€¼å¯ä»¥æ˜¾å¼è½¬ä¸ºå­—ç¬¦ä¸²ã€‚ 1234var sym = Symbol('My symbol');String(sym) // 'Symbol(My symbol)'sym.toString() // 'Symbol(My symbol)' å¦å¤–ï¼ŒSymbolå€¼ä¹Ÿå¯ä»¥è½¬ä¸ºå¸ƒå°”å€¼ï¼Œä½†æ˜¯ä¸èƒ½è½¬ä¸ºæ•°å€¼ã€‚ 12345678910var sym = Symbol();Boolean(sym) // true!sym // falseif (sym) &#123; // ...&#125;Number(sym) // TypeErrorsym + 2 // TypeError ä½œä¸ºå±æ€§åçš„Symbolç”±äºæ¯ä¸€ä¸ªSymbolå€¼éƒ½æ˜¯ä¸ç›¸ç­‰çš„ï¼Œè¿™æ„å‘³ç€Symbolå€¼å¯ä»¥ä½œä¸ºæ ‡è¯†ç¬¦ï¼Œç”¨äºå¯¹è±¡çš„å±æ€§åï¼Œå°±èƒ½ä¿è¯ä¸ä¼šå‡ºç°åŒåçš„å±æ€§ã€‚è¿™å¯¹äºä¸€ä¸ªå¯¹è±¡ç”±å¤šä¸ªæ¨¡å—æ„æˆçš„æƒ…å†µéå¸¸æœ‰ç”¨ï¼Œèƒ½é˜²æ­¢æŸä¸€ä¸ªé”®è¢«ä¸å°å¿ƒæ”¹å†™æˆ–è¦†ç›–ã€‚ 1234567891011121314151617var mySymbol = Symbol();// ç¬¬ä¸€ç§å†™æ³•var a = &#123;&#125;;a[mySymbol] = 'Hello!';// ç¬¬äºŒç§å†™æ³•var a = &#123; [mySymbol]: 'Hello!'&#125;;// ç¬¬ä¸‰ç§å†™æ³•var a = &#123;&#125;;Object.defineProperty(a, mySymbol, &#123; value: 'Hello!' &#125;);// ä»¥ä¸Šå†™æ³•éƒ½å¾—åˆ°åŒæ ·ç»“æœa[mySymbol] // \"Hello!\" ä¸Šé¢ä»£ç é€šè¿‡æ–¹æ‹¬å·ç»“æ„å’ŒObject.definePropertyï¼Œå°†å¯¹è±¡çš„å±æ€§åæŒ‡å®šä¸ºä¸€ä¸ªSymbolå€¼ã€‚ æ³¨æ„ï¼ŒSymbolå€¼ä½œä¸ºå¯¹è±¡å±æ€§åæ—¶ï¼Œä¸èƒ½ç”¨ç‚¹è¿ç®—ç¬¦ã€‚ 123456var mySymbol = Symbol();var a = &#123;&#125;;a.mySymbol = 'Hello!';a[mySymbol] // undefineda['mySymbol'] // \"Hello!\" ä¸Šé¢ä»£ç ä¸­ï¼Œå› ä¸ºç‚¹è¿ç®—ç¬¦åé¢æ€»æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¸ä¼šè¯»å–mySymbolä½œä¸ºæ ‡è¯†åæ‰€æŒ‡ä»£çš„é‚£ä¸ªå€¼ï¼Œå¯¼è‡´açš„å±æ€§åå®é™…ä¸Šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªSymbolå€¼ã€‚ åŒç†ï¼Œåœ¨å¯¹è±¡çš„å†…éƒ¨ï¼Œä½¿ç”¨Symbolå€¼å®šä¹‰å±æ€§æ—¶ï¼ŒSymbolå€¼å¿…é¡»æ”¾åœ¨æ–¹æ‹¬å·ä¹‹ä¸­ã€‚ 1234567let s = Symbol();let obj = &#123; [s]: function (arg) &#123; ... &#125;&#125;;obj[s](123); ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœsä¸æ”¾åœ¨æ–¹æ‹¬å·ä¸­ï¼Œè¯¥å±æ€§çš„é”®åå°±æ˜¯å­—ç¬¦ä¸²sï¼Œè€Œä¸æ˜¯sæ‰€ä»£è¡¨çš„é‚£ä¸ªSymbolå€¼ã€‚ é‡‡ç”¨å¢å¼ºçš„å¯¹è±¡å†™æ³•ï¼Œä¸Šé¢ä»£ç çš„objå¯¹è±¡å¯ä»¥å†™å¾—æ›´ç®€æ´ä¸€äº›ã€‚ 123let obj = &#123; [s](arg) &#123; ... &#125;&#125;; Symbolç±»å‹è¿˜å¯ä»¥ç”¨äºå®šä¹‰ä¸€ç»„å¸¸é‡ï¼Œä¿è¯è¿™ç»„å¸¸é‡çš„å€¼éƒ½æ˜¯ä¸ç›¸ç­‰çš„ã€‚ 1234567log.levels = &#123; DEBUG: Symbol('debug'), INFO: Symbol('info'), WARN: Symbol('warn')&#125;;log(log.levels.DEBUG, 'debug message');log(log.levels.INFO, 'info message'); ä¸‹é¢æ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ã€‚ 12345678910111213const COLOR_RED = Symbol();const COLOR_GREEN = Symbol();function getComplement(color) &#123; switch (color) &#123; case COLOR_RED: return COLOR_GREEN; case COLOR_GREEN: return COLOR_RED; default: throw new Error('Undefined color'); &#125;&#125; å¸¸é‡ä½¿ç”¨Symbolå€¼æœ€å¤§çš„å¥½å¤„ï¼Œå°±æ˜¯å…¶ä»–ä»»ä½•å€¼éƒ½ä¸å¯èƒ½æœ‰ç›¸åŒçš„å€¼äº†ï¼Œå› æ­¤å¯ä»¥ä¿è¯ä¸Šé¢çš„switchè¯­å¥ä¼šæŒ‰è®¾è®¡çš„æ–¹å¼å·¥ä½œã€‚ è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒSymbolå€¼ä½œä¸ºå±æ€§åæ—¶ï¼Œè¯¥å±æ€§è¿˜æ˜¯å…¬å¼€å±æ€§ï¼Œä¸æ˜¯ç§æœ‰å±æ€§ã€‚ å®ä¾‹ï¼šæ¶ˆé™¤é­”æœ¯å­—ç¬¦ä¸²é­”æœ¯å­—ç¬¦ä¸²æŒ‡çš„æ˜¯ï¼Œåœ¨ä»£ç ä¹‹ä¸­å¤šæ¬¡å‡ºç°ã€ä¸ä»£ç å½¢æˆå¼ºè€¦åˆçš„æŸä¸€ä¸ªå…·ä½“çš„å­—ç¬¦ä¸²æˆ–è€…æ•°å€¼ã€‚é£æ ¼è‰¯å¥½çš„ä»£ç ï¼Œåº”è¯¥å°½é‡æ¶ˆé™¤é­”æœ¯å­—ç¬¦ä¸²ï¼Œè¯¥ç”±å«ä¹‰æ¸…æ™°çš„å˜é‡ä»£æ›¿ã€‚ 1234567891011121314function getArea(shape, options) &#123; var area = 0; switch (shape) &#123; case 'Triangle': // é­”æœ¯å­—ç¬¦ä¸² area = .5 * options.width * options.height; break; /* ... more code ... */ &#125; return area;&#125;getArea('Triangle', &#123; width: 100, height: 100 &#125;); // é­”æœ¯å­—ç¬¦ä¸² ä¸Šé¢ä»£ç ä¸­ï¼Œå­—ç¬¦ä¸²â€œTriangleâ€å°±æ˜¯ä¸€ä¸ªé­”æœ¯å­—ç¬¦ä¸²ã€‚å®ƒå¤šæ¬¡å‡ºç°ï¼Œä¸ä»£ç å½¢æˆâ€œå¼ºè€¦åˆâ€ï¼Œä¸åˆ©äºå°†æ¥çš„ä¿®æ”¹å’Œç»´æŠ¤ã€‚ å¸¸ç”¨çš„æ¶ˆé™¤é­”æœ¯å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œå°±æ˜¯æŠŠå®ƒå†™æˆä¸€ä¸ªå˜é‡ã€‚ 123456789101112131415var shapeType = &#123; triangle: 'Triangle'&#125;;function getArea(shape, options) &#123; var area = 0; switch (shape) &#123; case shapeType.triangle: area = .5 * options.width * options.height; break; &#125; return area;&#125;getArea(shapeType.triangle, &#123; width: 100, height: 100 &#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬æŠŠâ€œTriangleâ€å†™æˆshapeTypeå¯¹è±¡çš„triangleå±æ€§ï¼Œè¿™æ ·å°±æ¶ˆé™¤äº†å¼ºè€¦åˆã€‚ å¦‚æœä»”ç»†åˆ†æï¼Œå¯ä»¥å‘ç°shapeType.triangleç­‰äºå“ªä¸ªå€¼å¹¶ä¸é‡è¦ï¼Œåªè¦ç¡®ä¿ä¸ä¼šè·Ÿå…¶ä»–shapeTypeå±æ€§çš„å€¼å†²çªå³å¯ã€‚å› æ­¤ï¼Œè¿™é‡Œå°±å¾ˆé€‚åˆæ”¹ç”¨Symbolå€¼ã€‚ 123const shapeType = &#123; triangle: Symbol()&#125;; ä¸Šé¢ä»£ç ä¸­ï¼Œé™¤äº†å°†shapeType.triangleçš„å€¼è®¾ä¸ºä¸€ä¸ªSymbolï¼Œå…¶ä»–åœ°æ–¹éƒ½ä¸ç”¨ä¿®æ”¹ã€‚ å±æ€§åçš„éå†Symbol ä½œä¸ºå±æ€§åï¼Œè¯¥å±æ€§ä¸ä¼šå‡ºç°åœ¨for...inã€for...ofå¾ªç¯ä¸­ï¼Œä¹Ÿä¸ä¼šè¢«Object.keys()ã€Object.getOwnPropertyNames()ã€JSON.stringify()è¿”å›ã€‚ä½†æ˜¯ï¼Œå®ƒä¹Ÿä¸æ˜¯ç§æœ‰å±æ€§ï¼Œæœ‰ä¸€ä¸ªObject.getOwnPropertySymbolsæ–¹æ³•ï¼Œå¯ä»¥è·å–æŒ‡å®šå¯¹è±¡çš„æ‰€æœ‰ Symbol å±æ€§åã€‚ Object.getOwnPropertySymbolsæ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜æ˜¯å½“å‰å¯¹è±¡çš„æ‰€æœ‰ç”¨ä½œå±æ€§åçš„ Symbol å€¼ã€‚ 1234567891011var obj = &#123;&#125;;var a = Symbol('a');var b = Symbol('b');obj[a] = 'Hello';obj[b] = 'World';var objectSymbols = Object.getOwnPropertySymbols(obj);objectSymbols// [Symbol(a), Symbol(b)] ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ï¼ŒObject.getOwnPropertySymbolsæ–¹æ³•ä¸for...inå¾ªç¯ã€Object.getOwnPropertyNamesæ–¹æ³•è¿›è¡Œå¯¹æ¯”çš„ä¾‹å­ã€‚ 1234567891011121314151617var obj = &#123;&#125;;var foo = Symbol(\"foo\");Object.defineProperty(obj, foo, &#123; value: \"foobar\",&#125;);for (var i in obj) &#123; console.log(i); // æ— è¾“å‡º&#125;Object.getOwnPropertyNames(obj)// []Object.getOwnPropertySymbols(obj)// [Symbol(foo)] ä¸Šé¢ä»£ç ä¸­ï¼Œä½¿ç”¨Object.getOwnPropertyNamesæ–¹æ³•å¾—ä¸åˆ°Symbolå±æ€§åï¼Œéœ€è¦ä½¿ç”¨Object.getOwnPropertySymbolsæ–¹æ³•ã€‚ å¦ä¸€ä¸ªæ–°çš„APIï¼ŒReflect.ownKeysæ–¹æ³•å¯ä»¥è¿”å›æ‰€æœ‰ç±»å‹çš„é”®åï¼ŒåŒ…æ‹¬å¸¸è§„é”®åå’Œ Symbol é”®åã€‚ 12345678let obj = &#123; [Symbol('my_key')]: 1, enum: 2, nonEnum: 3&#125;;Reflect.ownKeys(obj)// [\"enum\", \"nonEnum\", Symbol(my_key)] ç”±äºä»¥ Symbol å€¼ä½œä¸ºåç§°çš„å±æ€§ï¼Œä¸ä¼šè¢«å¸¸è§„æ–¹æ³•éå†å¾—åˆ°ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œä¸ºå¯¹è±¡å®šä¹‰ä¸€äº›éç§æœ‰çš„ã€ä½†åˆå¸Œæœ›åªç”¨äºå†…éƒ¨çš„æ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526var size = Symbol('size');class Collection &#123; constructor() &#123; this[size] = 0; &#125; add(item) &#123; this[this[size]] = item; this[size]++; &#125; static sizeOf(instance) &#123; return instance[size]; &#125;&#125;var x = new Collection();Collection.sizeOf(x) // 0x.add('foo');Collection.sizeOf(x) // 1Object.keys(x) // ['0']Object.getOwnPropertyNames(x) // ['0']Object.getOwnPropertySymbols(x) // [Symbol(size)] ä¸Šé¢ä»£ç ä¸­ï¼Œå¯¹è±¡xçš„sizeå±æ€§æ˜¯ä¸€ä¸ª Symbol å€¼ï¼Œæ‰€ä»¥Object.keys(x)ã€Object.getOwnPropertyNames(x)éƒ½æ— æ³•è·å–å®ƒã€‚è¿™å°±é€ æˆäº†ä¸€ç§éç§æœ‰çš„å†…éƒ¨æ–¹æ³•çš„æ•ˆæœã€‚ Symbol.for()ï¼ŒSymbol.keyFor()æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›é‡æ–°ä½¿ç”¨åŒä¸€ä¸ªSymbolå€¼ï¼ŒSymbol.foræ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œç„¶åæœç´¢æœ‰æ²¡æœ‰ä»¥è¯¥å‚æ•°ä½œä¸ºåç§°çš„Symbolå€¼ã€‚å¦‚æœæœ‰ï¼Œå°±è¿”å›è¿™ä¸ªSymbolå€¼ï¼Œå¦åˆ™å°±æ–°å»ºå¹¶è¿”å›ä¸€ä¸ªä»¥è¯¥å­—ç¬¦ä¸²ä¸ºåç§°çš„Symbolå€¼ã€‚ 1234var s1 = Symbol.for('foo');var s2 = Symbol.for('foo');s1 === s2 // true ä¸Šé¢ä»£ç ä¸­ï¼Œs1å’Œs2éƒ½æ˜¯ Symbol å€¼ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æ˜¯åŒæ ·å‚æ•°çš„Symbol.foræ–¹æ³•ç”Ÿæˆçš„ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯åŒä¸€ä¸ªå€¼ã€‚ Symbol.for()ä¸Symbol()è¿™ä¸¤ç§å†™æ³•ï¼Œéƒ½ä¼šç”Ÿæˆæ–°çš„Symbolã€‚å®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼Œå‰è€…ä¼šè¢«ç™»è®°åœ¨å…¨å±€ç¯å¢ƒä¸­ä¾›æœç´¢ï¼Œåè€…ä¸ä¼šã€‚Symbol.for()ä¸ä¼šæ¯æ¬¡è°ƒç”¨å°±è¿”å›ä¸€ä¸ªæ–°çš„ Symbol ç±»å‹çš„å€¼ï¼Œè€Œæ˜¯ä¼šå…ˆæ£€æŸ¥ç»™å®šçš„keyæ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨æ‰ä¼šæ–°å»ºä¸€ä¸ªå€¼ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ è°ƒç”¨Symbol.for(&quot;cat&quot;)30æ¬¡ï¼Œæ¯æ¬¡éƒ½ä¼šè¿”å›åŒä¸€ä¸ª Symbol å€¼ï¼Œä½†æ˜¯è°ƒç”¨Symbol(&quot;cat&quot;)30æ¬¡ï¼Œä¼šè¿”å›30ä¸ªä¸åŒçš„Symbolå€¼ã€‚ 12345Symbol.for(\"bar\") === Symbol.for(\"bar\")// trueSymbol(\"bar\") === Symbol(\"bar\")// false ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºSymbol()å†™æ³•æ²¡æœ‰ç™»è®°æœºåˆ¶ï¼Œæ‰€ä»¥æ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ªä¸åŒçš„å€¼ã€‚ Symbol.keyForæ–¹æ³•è¿”å›ä¸€ä¸ªå·²ç™»è®°çš„ Symbol ç±»å‹å€¼çš„keyã€‚ 12345var s1 = Symbol.for(\"foo\");Symbol.keyFor(s1) // \"foo\"var s2 = Symbol(\"foo\");Symbol.keyFor(s2) // undefined ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡s2å±äºæœªç™»è®°çš„Symbolå€¼ï¼Œæ‰€ä»¥è¿”å›undefinedã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSymbol.forä¸ºSymbolå€¼ç™»è®°çš„åå­—ï¼Œæ˜¯å…¨å±€ç¯å¢ƒçš„ï¼Œå¯ä»¥åœ¨ä¸åŒçš„ iframe æˆ– service worker ä¸­å–åˆ°åŒä¸€ä¸ªå€¼ã€‚ 123456iframe = document.createElement('iframe');iframe.src = String(window.location);document.body.appendChild(iframe);iframe.contentWindow.Symbol.for('foo') === Symbol.for('foo')// true ä¸Šé¢ä»£ç ä¸­ï¼Œiframe çª—å£ç”Ÿæˆçš„ Symbol å€¼ï¼Œå¯ä»¥åœ¨ä¸»é¡µé¢å¾—åˆ°ã€‚ å®ä¾‹ï¼šæ¨¡å—çš„ Singleton æ¨¡å¼Singletonæ¨¡å¼æŒ‡çš„æ˜¯è°ƒç”¨ä¸€ä¸ªç±»ï¼Œä»»ä½•æ—¶å€™è¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚ å¯¹äºNodeæ¥è¯´ï¼Œæ¨¡å—æ–‡ä»¶å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªç±»ã€‚æ€ä¹ˆä¿è¯æ¯æ¬¡æ‰§è¡Œè¿™ä¸ªæ¨¡å—æ–‡ä»¶ï¼Œè¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹å‘¢ï¼Ÿ å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå¯ä»¥æŠŠå®ä¾‹æ”¾åˆ°é¡¶å±‚å¯¹è±¡globalã€‚ 12345678910// mod.jsfunction A() &#123; this.foo = 'hello';&#125;if (!global._foo) &#123; global._foo = new A();&#125;module.exports = global._foo; ç„¶åï¼ŒåŠ è½½ä¸Šé¢çš„mod.jsã€‚ 12var a = require('./mod.js');console.log(a.foo); ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡aä»»ä½•æ—¶å€™åŠ è½½çš„éƒ½æ˜¯Açš„åŒä¸€ä¸ªå®ä¾‹ã€‚ ä½†æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå…¨å±€å˜é‡global._fooæ˜¯å¯å†™çš„ï¼Œä»»ä½•æ–‡ä»¶éƒ½å¯ä»¥ä¿®æ”¹ã€‚ 12var a = require('./mod.js');global._foo = 123; ä¸Šé¢çš„ä»£ç ï¼Œä¼šä½¿å¾—åˆ«çš„è„šæœ¬åŠ è½½mod.jséƒ½å¤±çœŸã€‚ ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‡ºç°ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Symbolã€‚ 123456789101112// mod.jsconst FOO_KEY = Symbol.for('foo');function A() &#123; this.foo = 'hello';&#125;if (!global[FOO_KEY]) &#123; global[FOO_KEY] = new A();&#125;module.exports = global[FOO_KEY]; ä¸Šé¢ä»£ç ä¸­ï¼Œå¯ä»¥ä¿è¯global[FOO_KEY]ä¸ä¼šè¢«æ— æ„é—´è¦†ç›–ï¼Œä½†è¿˜æ˜¯å¯ä»¥è¢«æ”¹å†™ã€‚ 12var a = require('./mod.js');global[Symbol.for('foo')] = 123; å¦‚æœé”®åä½¿ç”¨Symbolæ–¹æ³•ç”Ÿæˆï¼Œé‚£ä¹ˆå¤–éƒ¨å°†æ— æ³•å¼•ç”¨è¿™ä¸ªå€¼ï¼Œå½“ç„¶ä¹Ÿå°±æ— æ³•æ”¹å†™ã€‚ 1234// mod.jsconst FOO_KEY = Symbol('foo');// åé¢ä»£ç ç›¸åŒ â€¦â€¦ ä¸Šé¢ä»£ç å°†å¯¼è‡´å…¶ä»–è„šæœ¬éƒ½æ— æ³•å¼•ç”¨FOO_KEYã€‚ä½†è¿™æ ·ä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœå¤šæ¬¡æ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼Œæ¯æ¬¡å¾—åˆ°çš„FOO_KEYéƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚è™½ç„¶Nodeä¼šå°†è„šæœ¬çš„æ‰§è¡Œç»“æœç¼“å­˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ä¼šå¤šæ¬¡æ‰§è¡ŒåŒä¸€ä¸ªè„šæœ¬ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ï¼Œæ‰€ä»¥ä¹Ÿä¸æ˜¯å®Œå…¨å¯é ã€‚ å†…ç½®çš„Symbolå€¼é™¤äº†å®šä¹‰è‡ªå·±ä½¿ç”¨çš„Symbolå€¼ä»¥å¤–ï¼ŒES6è¿˜æä¾›äº†11ä¸ªå†…ç½®çš„Symbolå€¼ï¼ŒæŒ‡å‘è¯­è¨€å†…éƒ¨ä½¿ç”¨çš„æ–¹æ³•ã€‚ Symbol.hasInstanceå¯¹è±¡çš„Symbol.hasInstanceå±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªå†…éƒ¨æ–¹æ³•ã€‚å½“å…¶ä»–å¯¹è±¡ä½¿ç”¨instanceofè¿ç®—ç¬¦ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºè¯¥å¯¹è±¡çš„å®ä¾‹æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚æ¯”å¦‚ï¼Œfoo instanceof Fooåœ¨è¯­è¨€å†…éƒ¨ï¼Œå®é™…è°ƒç”¨çš„æ˜¯Foo[Symbol.hasInstance](foo)ã€‚ 1234567class MyClass &#123; [Symbol.hasInstance](foo) &#123; return foo instanceof Array; &#125;&#125;[1, 2, 3] instanceof new MyClass() // true ä¸Šé¢ä»£ç ä¸­ï¼ŒMyClassæ˜¯ä¸€ä¸ªç±»ï¼Œnew MyClass()ä¼šè¿”å›ä¸€ä¸ªå®ä¾‹ã€‚è¯¥å®ä¾‹çš„Symbol.hasInstanceæ–¹æ³•ï¼Œä¼šåœ¨è¿›è¡Œinstanceofè¿ç®—æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œåˆ¤æ–­å·¦ä¾§çš„è¿ç®—å­æ˜¯å¦ä¸ºArrayçš„å®ä¾‹ã€‚ ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚ 123456789class Even &#123; static [Symbol.hasInstance](obj) &#123; return Number(obj) % 2 === 0; &#125;&#125;1 instanceof Even // false2 instanceof Even // true12345 instanceof Even // false Symbol.isConcatSpreadableå¯¹è±¡çš„Symbol.isConcatSpreadableå±æ€§ç­‰äºä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡ä½¿ç”¨Array.prototype.concat()æ—¶ï¼Œæ˜¯å¦å¯ä»¥å±•å¼€ã€‚ 1234567let arr1 = ['c', 'd'];['a', 'b'].concat(arr1, 'e') // ['a', 'b', 'c', 'd', 'e']arr1[Symbol.isConcatSpreadable] // undefinedlet arr2 = ['c', 'd'];arr2[Symbol.isConcatSpreadable] = false;['a', 'b'].concat(arr2, 'e') // ['a', 'b', ['c','d'], 'e'] ä¸Šé¢ä»£ç è¯´æ˜ï¼Œæ•°ç»„çš„é»˜è®¤è¡Œä¸ºæ˜¯å¯ä»¥å±•å¼€ã€‚Symbol.isConcatSpreadableå±æ€§ç­‰äºtrueæˆ–undefinedï¼Œéƒ½æœ‰è¿™ä¸ªæ•ˆæœã€‚ ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ä¹Ÿå¯ä»¥å±•å¼€ï¼Œä½†å®ƒçš„Symbol.isConcatSpreadableå±æ€§é»˜è®¤ä¸ºfalseï¼Œå¿…é¡»æ‰‹åŠ¨æ‰“å¼€ã€‚ 12345let obj = &#123;length: 2, 0: 'c', 1: 'd'&#125;;['a', 'b'].concat(obj, 'e') // ['a', 'b', obj, 'e']obj[Symbol.isConcatSpreadable] = true;['a', 'b'].concat(obj, 'e') // ['a', 'b', 'c', 'd', 'e'] å¯¹äºä¸€ä¸ªç±»æ¥è¯´ï¼ŒSymbol.isConcatSpreadableå±æ€§å¿…é¡»å†™æˆå®ä¾‹çš„å±æ€§ã€‚ 1234567891011121314151617181920class A1 extends Array &#123; constructor(args) &#123; super(args); this[Symbol.isConcatSpreadable] = true; &#125;&#125;class A2 extends Array &#123; constructor(args) &#123; super(args); this[Symbol.isConcatSpreadable] = false; &#125;&#125;let a1 = new A1();a1[0] = 3;a1[1] = 4;let a2 = new A2();a2[0] = 5;a2[1] = 6;[1, 2].concat(a1).concat(a2)// [1, 2, 3, 4, [5, 6]] ä¸Šé¢ä»£ç ä¸­ï¼Œç±»A1æ˜¯å¯å±•å¼€çš„ï¼Œç±»A2æ˜¯ä¸å¯å±•å¼€çš„ï¼Œæ‰€ä»¥ä½¿ç”¨concatæ—¶æœ‰ä¸ä¸€æ ·çš„ç»“æœã€‚ Symbol.specieså¯¹è±¡çš„Symbol.specieså±æ€§ï¼ŒæŒ‡å‘å½“å‰å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚åˆ›é€ å®ä¾‹æ—¶ï¼Œé»˜è®¤ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå³ä½¿ç”¨è¿™ä¸ªå±æ€§è¿”å›çš„å‡½æ•°å½“ä½œæ„é€ å‡½æ•°ï¼Œæ¥åˆ›é€ æ–°çš„å®ä¾‹å¯¹è±¡ã€‚ 1234class MyArray extends Array &#123; // è¦†ç›–çˆ¶ç±» Array çš„æ„é€ å‡½æ•° static get [Symbol.species]() &#123; return Array; &#125;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå­ç±»MyArrayç»§æ‰¿äº†çˆ¶ç±»Arrayã€‚åˆ›å»ºMyArrayçš„å®ä¾‹å¯¹è±¡æ—¶ï¼Œæœ¬æ¥ä¼šè°ƒç”¨å®ƒè‡ªå·±çš„æ„é€ å‡½æ•°ï¼ˆæœ¬ä¾‹ä¸­è¢«çœç•¥äº†ï¼‰ï¼Œä½†æ˜¯ç”±äºå®šä¹‰äº†Symbol.specieså±æ€§ï¼Œæ‰€ä»¥ä¼šä½¿ç”¨è¿™ä¸ªå±æ€§è¿”å›çš„çš„å‡½æ•°ï¼Œåˆ›å»ºMyArrayçš„å®ä¾‹ã€‚ è¿™ä¸ªä¾‹å­ä¹Ÿè¯´æ˜ï¼Œå®šä¹‰Symbol.specieså±æ€§è¦é‡‡ç”¨getè¯»å–å™¨ã€‚é»˜è®¤çš„Symbol.specieså±æ€§ç­‰åŒäºä¸‹é¢çš„å†™æ³•ã€‚ 123static get [Symbol.species]() &#123; return this;&#125; ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 12345678class MyArray extends Array &#123; static get [Symbol.species]() &#123; return Array; &#125;&#125;var a = new MyArray(1,2,3);var mapped = a.map(x =&gt; x * x);mapped instanceof MyArray // falsemapped instanceof Array // true ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºæ„é€ å‡½æ•°è¢«æ›¿æ¢æˆäº†Arrayã€‚æ‰€ä»¥ï¼Œmappedå¯¹è±¡ä¸æ˜¯MyArrayçš„å®ä¾‹ï¼Œè€Œæ˜¯Arrayçš„å®ä¾‹ã€‚ Symbol.matchå¯¹è±¡çš„Symbol.matchå±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªå‡½æ•°ã€‚å½“æ‰§è¡Œstr.match(myObject)æ—¶ï¼Œå¦‚æœè¯¥å±æ€§å­˜åœ¨ï¼Œä¼šè°ƒç”¨å®ƒï¼Œè¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼ã€‚ 1234567891011String.prototype.match(regexp)// ç­‰åŒäºregexp[Symbol.match](this)class MyMatcher &#123; [Symbol.match](string) &#123; return 'hello world'.indexOf(string); &#125;&#125;'e'.match(new MyMatcher()) // 1 Symbol.replaceå¯¹è±¡çš„Symbol.replaceå±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªæ–¹æ³•ï¼Œå½“è¯¥å¯¹è±¡è¢«String.prototype.replaceæ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼šè¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼ã€‚ 123String.prototype.replace(searchValue, replaceValue)// ç­‰åŒäºsearchValue[Symbol.replace](this, replaceValue) ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 1234const x = &#123;&#125;;x[Symbol.replace] = (...s) =&gt; console.log(s);'Hello'.replace(x, 'World') // [\"Hello\", \"World\"] Symbol.replaceæ–¹æ³•ä¼šæ”¶åˆ°ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯replaceæ–¹æ³•æ­£åœ¨ä½œç”¨çš„å¯¹è±¡ï¼Œä¸Šé¢ä¾‹å­æ˜¯Helloï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ›¿æ¢åçš„å€¼ï¼Œä¸Šé¢ä¾‹å­æ˜¯Worldã€‚ Symbol.searchå¯¹è±¡çš„Symbol.searchå±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªæ–¹æ³•ï¼Œå½“è¯¥å¯¹è±¡è¢«String.prototype.searchæ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼šè¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼ã€‚ 12345678910111213String.prototype.search(regexp)// ç­‰åŒäºregexp[Symbol.search](this)class MySearch &#123; constructor(value) &#123; this.value = value; &#125; [Symbol.search](string) &#123; return string.indexOf(this.value); &#125;&#125;'foobar'.search(new MySearch('foo')) // 0 Symbol.splitå¯¹è±¡çš„Symbol.splitå±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªæ–¹æ³•ï¼Œå½“è¯¥å¯¹è±¡è¢«String.prototype.splitæ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼šè¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼ã€‚ 123String.prototype.split(separator, limit)// ç­‰åŒäºseparator[Symbol.split](this, limit) ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 123456789101112131415161718192021222324class MySplitter &#123; constructor(value) &#123; this.value = value; &#125; [Symbol.split](string) &#123; var index = string.indexOf(this.value); if (index === -1) &#123; return string; &#125; return [ string.substr(0, index), string.substr(index + this.value.length) ]; &#125;&#125;'foobar'.split(new MySplitter('foo'))// ['', 'bar']'foobar'.split(new MySplitter('bar'))// ['foo', '']'foobar'.split(new MySplitter('baz'))// 'foobar' ä¸Šé¢æ–¹æ³•ä½¿ç”¨Symbol.splitæ–¹æ³•ï¼Œé‡æ–°å®šä¹‰äº†å­—ç¬¦ä¸²å¯¹è±¡çš„splitæ–¹æ³•çš„è¡Œä¸ºï¼Œ Symbol.iteratorå¯¹è±¡çš„Symbol.iteratorå±æ€§ï¼ŒæŒ‡å‘è¯¥å¯¹è±¡çš„é»˜è®¤éå†å™¨æ–¹æ³•ã€‚ 12345678var myIterable = &#123;&#125;;myIterable[Symbol.iterator] = function* () &#123; yield 1; yield 2; yield 3;&#125;;[...myIterable] // [1, 2, 3] å¯¹è±¡è¿›è¡Œfor...ofå¾ªç¯æ—¶ï¼Œä¼šè°ƒç”¨Symbol.iteratoræ–¹æ³•ï¼Œè¿”å›è¯¥å¯¹è±¡çš„é»˜è®¤éå†å™¨ï¼Œè¯¦ç»†ä»‹ç»å‚è§ã€ŠIteratorå’Œforâ€¦ofå¾ªç¯ã€‹ä¸€ç« ã€‚ 12345678910111213141516171819class Collection &#123; *[Symbol.iterator]() &#123; let i = 0; while(this[i] !== undefined) &#123; yield this[i]; ++i; &#125; &#125;&#125;let myCollection = new Collection();myCollection[0] = 1;myCollection[1] = 2;for(let value of myCollection) &#123; console.log(value);&#125;// 1// 2 Symbol.toPrimitiveå¯¹è±¡çš„Symbol.toPrimitiveå±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªæ–¹æ³•ã€‚è¯¥å¯¹è±¡è¢«è½¬ä¸ºåŸå§‹ç±»å‹çš„å€¼æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿”å›è¯¥å¯¹è±¡å¯¹åº”çš„åŸå§‹ç±»å‹å€¼ã€‚ Symbol.toPrimitiveè¢«è°ƒç”¨æ—¶ï¼Œä¼šæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œè¡¨ç¤ºå½“å‰è¿ç®—çš„æ¨¡å¼ï¼Œä¸€å…±æœ‰ä¸‰ç§æ¨¡å¼ã€‚ Numberï¼šè¯¥åœºåˆéœ€è¦è½¬æˆæ•°å€¼ Stringï¼šè¯¥åœºåˆéœ€è¦è½¬æˆå­—ç¬¦ä¸² Defaultï¼šè¯¥åœºåˆå¯ä»¥è½¬æˆæ•°å€¼ï¼Œä¹Ÿå¯ä»¥è½¬æˆå­—ç¬¦ä¸² 12345678910111213141516171819let obj = &#123; [Symbol.toPrimitive](hint) &#123; switch (hint) &#123; case 'number': return 123; case 'string': return 'str'; case 'default': return 'default'; default: throw new Error(); &#125; &#125;&#125;;2 * obj // 2463 + obj // '3default'obj == 'default' // trueString(obj) // 'str' Symbol.toStringTagå¯¹è±¡çš„Symbol.toStringTagå±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªæ–¹æ³•ã€‚åœ¨è¯¥å¯¹è±¡ä¸Šé¢è°ƒç”¨Object.prototype.toStringæ–¹æ³•æ—¶ï¼Œå¦‚æœè¿™ä¸ªå±æ€§å­˜åœ¨ï¼Œå®ƒçš„è¿”å›å€¼ä¼šå‡ºç°åœ¨toStringæ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ä¹‹ä¸­ï¼Œè¡¨ç¤ºå¯¹è±¡çš„ç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥ç”¨æ¥å®šåˆ¶[object Object]æˆ–[object Array]ä¸­objectåé¢çš„é‚£ä¸ªå­—ç¬¦ä¸²ã€‚ 123456789101112// ä¾‹ä¸€(&#123;[Symbol.toStringTag]: 'Foo'&#125;.toString())// \"[object Foo]\"// ä¾‹äºŒclass Collection &#123; get [Symbol.toStringTag]() &#123; return 'xxx'; &#125;&#125;var x = new Collection();Object.prototype.toString.call(x) // \"[object xxx]\" ES6æ–°å¢å†…ç½®å¯¹è±¡çš„Symbol.toStringTagå±æ€§å€¼å¦‚ä¸‹ã€‚ JSON[Symbol.toStringTag]ï¼šâ€™JSONâ€™ Math[Symbol.toStringTag]ï¼šâ€™Mathâ€™ Moduleå¯¹è±¡M[Symbol.toStringTag]ï¼šâ€™Moduleâ€™ ArrayBuffer.prototype[Symbol.toStringTag]ï¼šâ€™ArrayBufferâ€™ DataView.prototype[Symbol.toStringTag]ï¼šâ€™DataViewâ€™ Map.prototype[Symbol.toStringTag]ï¼šâ€™Mapâ€™ Promise.prototype[Symbol.toStringTag]ï¼šâ€™Promiseâ€™ Set.prototype[Symbol.toStringTag]ï¼šâ€™Setâ€™ %TypedArray%.prototype[Symbol.toStringTag]ï¼šâ€™Uint8Arrayâ€™ç­‰ WeakMap.prototype[Symbol.toStringTag]ï¼šâ€™WeakMapâ€™ WeakSet.prototype[Symbol.toStringTag]ï¼šâ€™WeakSetâ€™ %MapIteratorPrototype%[Symbol.toStringTag]ï¼šâ€™Map Iteratorâ€™ %SetIteratorPrototype%[Symbol.toStringTag]ï¼šâ€™Set Iteratorâ€™ %StringIteratorPrototype%[Symbol.toStringTag]ï¼šâ€™String Iteratorâ€™ Symbol.prototype[Symbol.toStringTag]ï¼šâ€™Symbolâ€™ Generator.prototype[Symbol.toStringTag]ï¼šâ€™Generatorâ€™ GeneratorFunction.prototype[Symbol.toStringTag]ï¼šâ€™GeneratorFunctionâ€™ Symbol.unscopableså¯¹è±¡çš„Symbol.unscopableså±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ã€‚è¯¥å¯¹è±¡æŒ‡å®šäº†ä½¿ç”¨withå…³é”®å­—æ—¶ï¼Œå“ªäº›å±æ€§ä¼šè¢«withç¯å¢ƒæ’é™¤ã€‚ 123456789101112Array.prototype[Symbol.unscopables]// &#123;// copyWithin: true,// entries: true,// fill: true,// find: true,// findIndex: true,// keys: true// &#125;Object.keys(Array.prototype[Symbol.unscopables])// ['copyWithin', 'entries', 'fill', 'find', 'findIndex', 'keys'] ä¸Šé¢ä»£ç è¯´æ˜ï¼Œæ•°ç»„æœ‰6ä¸ªå±æ€§ï¼Œä¼šè¢«withå‘½ä»¤æ’é™¤ã€‚ 123456789101112131415161718192021222324// æ²¡æœ‰unscopablesæ—¶class MyClass &#123; foo() &#123; return 1; &#125;&#125;var foo = function () &#123; return 2; &#125;;with (MyClass.prototype) &#123; foo(); // 1&#125;// æœ‰unscopablesæ—¶class MyClass &#123; foo() &#123; return 1; &#125; get [Symbol.unscopables]() &#123; return &#123; foo: true &#125;; &#125;&#125;var foo = function () &#123; return 2; &#125;;with (MyClass.prototype) &#123; foo(); // 2&#125;","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"Symbol","slug":"Symbol","permalink":"http://microzz.com/tags/Symbol/"}]},{"title":"å¯¹è±¡çš„æ‰©å±•(Object)","date":"2016-12-25T04:45:19.000Z","path":"2016/12/25/object/","text":"å¯¹è±¡çš„æ‰©å±•å±æ€§çš„ç®€æ´è¡¨ç¤ºæ³•ES6å…è®¸ç›´æ¥å†™å…¥å˜é‡å’Œå‡½æ•°ï¼Œä½œä¸ºå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚è¿™æ ·çš„ä¹¦å†™æ›´åŠ ç®€æ´ã€‚ 123456var foo = 'bar';var baz = &#123;foo&#125;;baz // &#123;foo: \"bar\"&#125;// ç­‰åŒäºvar baz = &#123;foo: foo&#125;; ä¸Šé¢ä»£ç è¡¨æ˜ï¼ŒES6 å…è®¸åœ¨å¯¹è±¡ä¹‹ä¸­ï¼Œç›´æ¥å†™å˜é‡ã€‚è¿™æ—¶ï¼Œå±æ€§åä¸ºå˜é‡å, å±æ€§å€¼ä¸ºå˜é‡çš„å€¼ã€‚ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚ 1234567891011function f(x, y) &#123; return &#123;x, y&#125;;&#125;// ç­‰åŒäºfunction f(x, y) &#123; return &#123;x: x, y: y&#125;;&#125;f(1, 2) // Object &#123;x: 1, y: 2&#125; é™¤äº†å±æ€§ç®€å†™ï¼Œæ–¹æ³•ä¹Ÿå¯ä»¥ç®€å†™ã€‚ 12345678910111213var o = &#123; method() &#123; return \"Hello!\"; &#125;&#125;;// ç­‰åŒäºvar o = &#123; method: function() &#123; return \"Hello!\"; &#125;&#125;; ä¸‹é¢æ˜¯ä¸€ä¸ªå®é™…çš„ä¾‹å­ã€‚ 12345678910111213var birth = '2000/01/01';var Person = &#123; name: 'å¼ ä¸‰', //ç­‰åŒäºbirth: birth birth, // ç­‰åŒäºhello: function ()... hello() &#123; console.log('æˆ‘çš„åå­—æ˜¯', this.name); &#125;&#125;; è¿™ç§å†™æ³•ç”¨äºå‡½æ•°çš„è¿”å›å€¼ï¼Œå°†ä¼šéå¸¸æ–¹ä¾¿ã€‚ 12345678function getPoint() &#123; var x = 1; var y = 10; return &#123;x, y&#125;;&#125;getPoint()// &#123;x:1, y:10&#125; CommonJSæ¨¡å—è¾“å‡ºå˜é‡ï¼Œå°±éå¸¸åˆé€‚ä½¿ç”¨ç®€æ´å†™æ³•ã€‚ 123456789101112131415161718192021var ms = &#123;&#125;;function getItem (key) &#123; return key in ms ? ms[key] : null;&#125;function setItem (key, value) &#123; ms[key] = value;&#125;function clear () &#123; ms = &#123;&#125;;&#125;module.exports = &#123; getItem, setItem, clear &#125;;// ç­‰åŒäºmodule.exports = &#123; getItem: getItem, setItem: setItem, clear: clear&#125;; å±æ€§çš„èµ‹å€¼å™¨ï¼ˆsetterï¼‰å’Œå–å€¼å™¨ï¼ˆgetterï¼‰ï¼Œäº‹å®ä¸Šä¹Ÿæ˜¯é‡‡ç”¨è¿™ç§å†™æ³•ã€‚ 1234567891011121314var cart = &#123; _wheels: 4, get wheels () &#123; return this._wheels; &#125;, set wheels (value) &#123; if (value &lt; this._wheels) &#123; throw new Error('æ•°å€¼å¤ªå°äº†ï¼'); &#125; this._wheels = value; &#125;&#125; æ³¨æ„ï¼Œç®€æ´å†™æ³•çš„å±æ€§åæ€»æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™ä¼šå¯¼è‡´ä¸€äº›çœ‹ä¸Šå»æ¯”è¾ƒå¥‡æ€ªçš„ç»“æœã€‚ 123456789var obj = &#123; class () &#123;&#125;&#125;;// ç­‰åŒäºvar obj = &#123; 'class': function() &#123;&#125;&#125;; ä¸Šé¢ä»£ç ä¸­ï¼Œclassæ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¸ä¼šå› ä¸ºå®ƒå±äºå…³é”®å­—ï¼Œè€Œå¯¼è‡´è¯­æ³•è§£ææŠ¥é”™ã€‚ å¦‚æœæŸä¸ªæ–¹æ³•çš„å€¼æ˜¯ä¸€ä¸ªGeneratorå‡½æ•°ï¼Œå‰é¢éœ€è¦åŠ ä¸Šæ˜Ÿå·ã€‚ 12345var obj = &#123; * m()&#123; yield 'hello world'; &#125;&#125;; å±æ€§åè¡¨è¾¾å¼JavaScriptè¯­è¨€å®šä¹‰å¯¹è±¡çš„å±æ€§ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ã€‚ 12345// æ–¹æ³•ä¸€obj.foo = true;// æ–¹æ³•äºŒobj['a' + 'bc'] = 123; ä¸Šé¢ä»£ç çš„æ–¹æ³•ä¸€æ˜¯ç›´æ¥ç”¨æ ‡è¯†ç¬¦ä½œä¸ºå±æ€§åï¼Œæ–¹æ³•äºŒæ˜¯ç”¨è¡¨è¾¾å¼ä½œä¸ºå±æ€§åï¼Œè¿™æ—¶è¦å°†è¡¨è¾¾å¼æ”¾åœ¨æ–¹æ‹¬å·ä¹‹å†…ã€‚ ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨å­—é¢é‡æ–¹å¼å®šä¹‰å¯¹è±¡ï¼ˆä½¿ç”¨å¤§æ‹¬å·ï¼‰ï¼Œåœ¨ ES5 ä¸­åªèƒ½ä½¿ç”¨æ–¹æ³•ä¸€ï¼ˆæ ‡è¯†ç¬¦ï¼‰å®šä¹‰å±æ€§ã€‚ 1234var obj = &#123; foo: true, abc: 123&#125;; ES6 å…è®¸å­—é¢é‡å®šä¹‰å¯¹è±¡æ—¶ï¼Œç”¨æ–¹æ³•äºŒï¼ˆè¡¨è¾¾å¼ï¼‰ä½œä¸ºå¯¹è±¡çš„å±æ€§åï¼Œå³æŠŠè¡¨è¾¾å¼æ”¾åœ¨æ–¹æ‹¬å·å†…ã€‚ 123456let propKey = 'foo';let obj = &#123; [propKey]: true, ['a' + 'bc']: 123&#125;; ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚ 12345678910var lastWord = 'last word';var a = &#123; 'first word': 'hello', [lastWord]: 'world'&#125;;a['first word'] // \"hello\"a[lastWord] // \"world\"a['last word'] // \"world\" è¡¨è¾¾å¼è¿˜å¯ä»¥ç”¨äºå®šä¹‰æ–¹æ³•åã€‚ 1234567let obj = &#123; ['h' + 'ello']() &#123; return 'hi'; &#125;&#125;;obj.hello() // hi æ³¨æ„ï¼Œå±æ€§åè¡¨è¾¾å¼ä¸ç®€æ´è¡¨ç¤ºæ³•ï¼Œä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼Œä¼šæŠ¥é”™ã€‚ 12345678// æŠ¥é”™var foo = 'bar';var bar = 'abc';var baz = &#123; [foo] &#125;;// æ­£ç¡®var foo = 'bar';var baz = &#123; [foo]: 'abc'&#125;; æ³¨æ„ï¼Œå±æ€§åè¡¨è¾¾å¼å¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šè‡ªåŠ¨å°†å¯¹è±¡è½¬ä¸ºå­—ç¬¦ä¸²[object Object]ï¼Œè¿™ä¸€ç‚¹è¦ç‰¹åˆ«å°å¿ƒã€‚ 123456789const keyA = &#123;a: 1&#125;;const keyB = &#123;b: 2&#125;;const myObject = &#123; [keyA]: 'valueA', [keyB]: 'valueB'&#125;;myObject // Object &#123;[object Object]: \"valueB\"&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œ[keyA]å’Œ[keyB]å¾—åˆ°çš„éƒ½æ˜¯[object Object]ï¼Œæ‰€ä»¥[keyB]ä¼šæŠŠ[keyA]è¦†ç›–æ‰ï¼Œè€ŒmyObjectæœ€ååªæœ‰ä¸€ä¸ª[object Object]å±æ€§ã€‚ æ–¹æ³•çš„ name å±æ€§å‡½æ•°çš„nameå±æ€§ï¼Œè¿”å›å‡½æ•°åã€‚å¯¹è±¡æ–¹æ³•ä¹Ÿæ˜¯å‡½æ•°ï¼Œå› æ­¤ä¹Ÿæœ‰nameå±æ€§ã€‚ 1234567const person = &#123; sayName() &#123; console.log('hello!'); &#125;,&#125;;person.sayName.name // \"sayName\" ä¸Šé¢ä»£ç ä¸­ï¼Œæ–¹æ³•çš„nameå±æ€§è¿”å›å‡½æ•°åï¼ˆå³æ–¹æ³•åï¼‰ã€‚ å¦‚æœå¯¹è±¡çš„æ–¹æ³•ä½¿ç”¨äº†å–å€¼å‡½æ•°ï¼ˆgetterï¼‰å’Œå­˜å€¼å‡½æ•°ï¼ˆsetterï¼‰ï¼Œåˆ™nameå±æ€§ä¸æ˜¯åœ¨è¯¥æ–¹æ³•ä¸Šé¢ï¼Œè€Œæ˜¯è¯¥æ–¹æ³•çš„å±æ€§çš„æè¿°å¯¹è±¡çš„getå’Œsetå±æ€§ä¸Šé¢ï¼Œè¿”å›å€¼æ˜¯æ–¹æ³•åå‰åŠ ä¸Šgetå’Œsetã€‚ 123456789101112const obj = &#123; get foo() &#123;&#125;, set foo(x) &#123;&#125;&#125;;obj.foo.name// TypeError: Cannot read property 'name' of undefinedconst descriptor = Object.getOwnPropertyDescriptor(obj, 'foo');descriptor.get.name // \"get foo\"descriptor.set.name // \"set foo\" æœ‰ä¸¤ç§ç‰¹æ®Šæƒ…å†µï¼šbindæ–¹æ³•åˆ›é€ çš„å‡½æ•°ï¼Œnameå±æ€§è¿”å›boundåŠ ä¸ŠåŸå‡½æ•°çš„åå­—ï¼›Functionæ„é€ å‡½æ•°åˆ›é€ çš„å‡½æ•°ï¼Œnameå±æ€§è¿”å›anonymousã€‚ 123456(new Function()).name // \"anonymous\"var doSomething = function() &#123; // ...&#125;;doSomething.bind().name // \"bound doSomething\" å¦‚æœå¯¹è±¡çš„æ–¹æ³•æ˜¯ä¸€ä¸ª Symbol å€¼ï¼Œé‚£ä¹ˆnameå±æ€§è¿”å›çš„æ˜¯è¿™ä¸ª Symbol å€¼çš„æè¿°ã€‚ 12345678const key1 = Symbol('description');const key2 = Symbol();let obj = &#123; [key1]() &#123;&#125;, [key2]() &#123;&#125;,&#125;;obj[key1].name // \"[description]\"obj[key2].name // \"\" ä¸Šé¢ä»£ç ä¸­ï¼Œkey1å¯¹åº”çš„ Symbol å€¼æœ‰æè¿°ï¼Œkey2æ²¡æœ‰ã€‚ Object.is()ES5æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œåªæœ‰ä¸¤ä¸ªè¿ç®—ç¬¦ï¼šç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ==ï¼‰å’Œä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ===ï¼‰ã€‚å®ƒä»¬éƒ½æœ‰ç¼ºç‚¹ï¼Œå‰è€…ä¼šè‡ªåŠ¨è½¬æ¢æ•°æ®ç±»å‹ï¼Œåè€…çš„NaNä¸ç­‰äºè‡ªèº«ï¼Œä»¥åŠ+0ç­‰äº-0ã€‚JavaScriptç¼ºä¹ä¸€ç§è¿ç®—ï¼Œåœ¨æ‰€æœ‰ç¯å¢ƒä¸­ï¼Œåªè¦ä¸¤ä¸ªå€¼æ˜¯ä¸€æ ·çš„ï¼Œå®ƒä»¬å°±åº”è¯¥ç›¸ç­‰ã€‚ ES6æå‡ºâ€œSame-value equalityâ€ï¼ˆåŒå€¼ç›¸ç­‰ï¼‰ç®—æ³•ï¼Œç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚Object.iså°±æ˜¯éƒ¨ç½²è¿™ä¸ªç®—æ³•çš„æ–°æ–¹æ³•ã€‚å®ƒç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ä¸¥æ ¼ç›¸ç­‰ï¼Œä¸ä¸¥æ ¼æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆ===ï¼‰çš„è¡Œä¸ºåŸºæœ¬ä¸€è‡´ã€‚ 1234Object.is('foo', 'foo')// trueObject.is(&#123;&#125;, &#123;&#125;)// false ä¸åŒä¹‹å¤„åªæœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯+0ä¸ç­‰äº-0ï¼ŒäºŒæ˜¯NaNç­‰äºè‡ªèº«ã€‚ 12345+0 === -0 //trueNaN === NaN // falseObject.is(+0, -0) // falseObject.is(NaN, NaN) // true ES5å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç ï¼Œéƒ¨ç½²Object.isã€‚ 12345678910111213Object.defineProperty(Object, 'is', &#123; value: function(x, y) &#123; if (x === y) &#123; // é’ˆå¯¹+0 ä¸ç­‰äº -0çš„æƒ…å†µ return x !== 0 || 1 / x === 1 / y; &#125; // é’ˆå¯¹NaNçš„æƒ…å†µ return x !== x &amp;&amp; y !== y; &#125;, configurable: true, enumerable: false, writable: true&#125;); Object.assign()åŸºæœ¬ç”¨æ³•Object.assignæ–¹æ³•ç”¨äºå¯¹è±¡çš„åˆå¹¶ï¼Œå°†æºå¯¹è±¡ï¼ˆsourceï¼‰çš„æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼Œå¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ï¼ˆtargetï¼‰ã€‚ 1234567var target = &#123; a: 1 &#125;;var source1 = &#123; b: 2 &#125;;var source2 = &#123; c: 3 &#125;;Object.assign(target, source1, source2);target // &#123;a:1, b:2, c:3&#125; Object.assignæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œåé¢çš„å‚æ•°éƒ½æ˜¯æºå¯¹è±¡ã€‚ æ³¨æ„ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡ä¸æºå¯¹è±¡æœ‰åŒåå±æ€§ï¼Œæˆ–å¤šä¸ªæºå¯¹è±¡æœ‰åŒåå±æ€§ï¼Œåˆ™åé¢çš„å±æ€§ä¼šè¦†ç›–å‰é¢çš„å±æ€§ã€‚ 1234567var target = &#123; a: 1, b: 1 &#125;;var source1 = &#123; b: 2, c: 2 &#125;;var source2 = &#123; c: 3 &#125;;Object.assign(target, source1, source2);target // &#123;a:1, b:2, c:3&#125; å¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°ï¼ŒObject.assignä¼šç›´æ¥è¿”å›è¯¥å‚æ•°ã€‚ 12var obj = &#123;a: 1&#125;;Object.assign(obj) === obj // true å¦‚æœè¯¥å‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œåˆ™ä¼šå…ˆè½¬æˆå¯¹è±¡ï¼Œç„¶åè¿”å›ã€‚ 1typeof Object.assign(2) // \"object\" ç”±äºundefinedå’Œnullæ— æ³•è½¬æˆå¯¹è±¡ï¼Œæ‰€ä»¥å¦‚æœå®ƒä»¬ä½œä¸ºå‚æ•°ï¼Œå°±ä¼šæŠ¥é”™ã€‚ 12Object.assign(undefined) // æŠ¥é”™Object.assign(null) // æŠ¥é”™ å¦‚æœéå¯¹è±¡å‚æ•°å‡ºç°åœ¨æºå¯¹è±¡çš„ä½ç½®ï¼ˆå³éé¦–å‚æ•°ï¼‰ï¼Œé‚£ä¹ˆå¤„ç†è§„åˆ™æœ‰æ‰€ä¸åŒã€‚é¦–å…ˆï¼Œè¿™äº›å‚æ•°éƒ½ä¼šè½¬æˆå¯¹è±¡ï¼Œå¦‚æœæ— æ³•è½¬æˆå¯¹è±¡ï¼Œå°±ä¼šè·³è¿‡ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœundefinedå’Œnullä¸åœ¨é¦–å‚æ•°ï¼Œå°±ä¸ä¼šæŠ¥é”™ã€‚ 123let obj = &#123;a: 1&#125;;Object.assign(obj, undefined) === obj // trueObject.assign(obj, null) === obj // true å…¶ä»–ç±»å‹çš„å€¼ï¼ˆå³æ•°å€¼ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼‰ä¸åœ¨é¦–å‚æ•°ï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ã€‚ä½†æ˜¯ï¼Œé™¤äº†å­—ç¬¦ä¸²ä¼šä»¥æ•°ç»„å½¢å¼ï¼Œæ‹·è´å…¥ç›®æ ‡å¯¹è±¡ï¼Œå…¶ä»–å€¼éƒ½ä¸ä¼šäº§ç”Ÿæ•ˆæœã€‚ 123456var v1 = 'abc';var v2 = true;var v3 = 10;var obj = Object.assign(&#123;&#125;, v1, v2, v3);console.log(obj); // &#123; \"0\": \"a\", \"1\": \"b\", \"2\": \"c\" &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œv1ã€v2ã€v3åˆ†åˆ«æ˜¯å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼å’Œæ•°å€¼ï¼Œç»“æœåªæœ‰å­—ç¬¦ä¸²åˆå…¥ç›®æ ‡å¯¹è±¡ï¼ˆä»¥å­—ç¬¦æ•°ç»„çš„å½¢å¼ï¼‰ï¼Œæ•°å€¼å’Œå¸ƒå°”å€¼éƒ½ä¼šè¢«å¿½ç•¥ã€‚è¿™æ˜¯å› ä¸ºåªæœ‰å­—ç¬¦ä¸²çš„åŒ…è£…å¯¹è±¡ï¼Œä¼šäº§ç”Ÿå¯æšä¸¾å±æ€§ã€‚ 123Object(true) // &#123;[[PrimitiveValue]]: true&#125;Object(10) // &#123;[[PrimitiveValue]]: 10&#125;Object('abc') // &#123;0: \"a\", 1: \"b\", 2: \"c\", length: 3, [[PrimitiveValue]]: \"abc\"&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå¸ƒå°”å€¼ã€æ•°å€¼ã€å­—ç¬¦ä¸²åˆ†åˆ«è½¬æˆå¯¹åº”çš„åŒ…è£…å¯¹è±¡ï¼Œå¯ä»¥çœ‹åˆ°å®ƒä»¬çš„åŸå§‹å€¼éƒ½åœ¨åŒ…è£…å¯¹è±¡çš„å†…éƒ¨å±æ€§[[PrimitiveValue]]ä¸Šé¢ï¼Œè¿™ä¸ªå±æ€§æ˜¯ä¸ä¼šè¢«Object.assignæ‹·è´çš„ã€‚åªæœ‰å­—ç¬¦ä¸²çš„åŒ…è£…å¯¹è±¡ï¼Œä¼šäº§ç”Ÿå¯æšä¸¾çš„å®ä¹‰å±æ€§ï¼Œé‚£äº›å±æ€§åˆ™ä¼šè¢«æ‹·è´ã€‚ Object.assignæ‹·è´çš„å±æ€§æ˜¯æœ‰é™åˆ¶çš„ï¼Œåªæ‹·è´æºå¯¹è±¡çš„è‡ªèº«å±æ€§ï¼ˆä¸æ‹·è´ç»§æ‰¿å±æ€§ï¼‰ï¼Œä¹Ÿä¸æ‹·è´ä¸å¯æšä¸¾çš„å±æ€§ï¼ˆenumerable: falseï¼‰ã€‚ 1234567Object.assign(&#123;b: 'c'&#125;, Object.defineProperty(&#123;&#125;, 'invisible', &#123; enumerable: false, value: 'hello' &#125;))// &#123; b: 'c' &#125; ä¸Šé¢ä»£ç ä¸­ï¼ŒObject.assignè¦æ‹·è´çš„å¯¹è±¡åªæœ‰ä¸€ä¸ªä¸å¯æšä¸¾å±æ€§invisibleï¼Œè¿™ä¸ªå±æ€§å¹¶æ²¡æœ‰è¢«æ‹·è´è¿›å»ã€‚ å±æ€§åä¸ºSymbolå€¼çš„å±æ€§ï¼Œä¹Ÿä¼šè¢«Object.assignæ‹·è´ã€‚ 12Object.assign(&#123; a: 'b' &#125;, &#123; [Symbol('c')]: 'd' &#125;)// &#123; a: 'b', Symbol(c): 'd' &#125; æ³¨æ„ç‚¹Object.assignæ–¹æ³•å®è¡Œçš„æ˜¯æµ…æ‹·è´ï¼Œè€Œä¸æ˜¯æ·±æ‹·è´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæºå¯¹è±¡æŸä¸ªå±æ€§çš„å€¼æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆç›®æ ‡å¯¹è±¡æ‹·è´å¾—åˆ°çš„æ˜¯è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚ 12345var obj1 = &#123;a: &#123;b: 1&#125;&#125;;var obj2 = Object.assign(&#123;&#125;, obj1);obj1.a.b = 2;obj2.a.b // 2 ä¸Šé¢ä»£ç ä¸­ï¼Œæºå¯¹è±¡obj1çš„aå±æ€§çš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒObject.assignæ‹·è´å¾—åˆ°çš„æ˜¯è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚è¿™ä¸ªå¯¹è±¡çš„ä»»ä½•å˜åŒ–ï¼Œéƒ½ä¼šåæ˜ åˆ°ç›®æ ‡å¯¹è±¡ä¸Šé¢ã€‚ å¯¹äºè¿™ç§åµŒå¥—çš„å¯¹è±¡ï¼Œä¸€æ—¦é‡åˆ°åŒåå±æ€§ï¼ŒObject.assignçš„å¤„ç†æ–¹æ³•æ˜¯æ›¿æ¢ï¼Œè€Œä¸æ˜¯æ·»åŠ ã€‚ 1234var target = &#123; a: &#123; b: 'c', d: 'e' &#125; &#125;var source = &#123; a: &#123; b: 'hello' &#125; &#125;Object.assign(target, source)// &#123; a: &#123; b: 'hello' &#125; &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œtargetå¯¹è±¡çš„aå±æ€§è¢«sourceå¯¹è±¡çš„aå±æ€§æ•´ä¸ªæ›¿æ¢æ‰äº†ï¼Œè€Œä¸ä¼šå¾—åˆ°{ a: { b: &#39;hello&#39;, d: &#39;e&#39; } }çš„ç»“æœã€‚è¿™é€šå¸¸ä¸æ˜¯å¼€å‘è€…æƒ³è¦çš„ï¼Œéœ€è¦ç‰¹åˆ«å°å¿ƒã€‚ æœ‰ä¸€äº›å‡½æ•°åº“æä¾›Object.assignçš„å®šåˆ¶ç‰ˆæœ¬ï¼ˆæ¯”å¦‚Lodashçš„_.defaultsDeepæ–¹æ³•ï¼‰ï¼Œå¯ä»¥è§£å†³æµ…æ‹·è´çš„é—®é¢˜ï¼Œå¾—åˆ°æ·±æ‹·è´çš„åˆå¹¶ã€‚ æ³¨æ„ï¼ŒObject.assignå¯ä»¥ç”¨æ¥å¤„ç†æ•°ç»„ï¼Œä½†æ˜¯ä¼šæŠŠæ•°ç»„è§†ä¸ºå¯¹è±¡ã€‚ 12Object.assign([1, 2, 3], [4, 5])// [4, 5, 3] ä¸Šé¢ä»£ç ä¸­ï¼ŒObject.assignæŠŠæ•°ç»„è§†ä¸ºå±æ€§åä¸º0ã€1ã€2çš„å¯¹è±¡ï¼Œå› æ­¤æºæ•°ç»„çš„0å·å±æ€§4è¦†ç›–äº†ç›®æ ‡æ•°ç»„çš„0å·å±æ€§1ã€‚ å¸¸è§ç”¨é€”Object.assignæ–¹æ³•æœ‰å¾ˆå¤šç”¨å¤„ã€‚ ï¼ˆ1ï¼‰ä¸ºå¯¹è±¡æ·»åŠ å±æ€§ 12345class Point &#123; constructor(x, y) &#123; Object.assign(this, &#123;x, y&#125;); &#125;&#125; ä¸Šé¢æ–¹æ³•é€šè¿‡Object.assignæ–¹æ³•ï¼Œå°†xå±æ€§å’Œyå±æ€§æ·»åŠ åˆ°Pointç±»çš„å¯¹è±¡å®ä¾‹ã€‚ ï¼ˆ2ï¼‰ä¸ºå¯¹è±¡æ·»åŠ æ–¹æ³• 12345678910111213141516Object.assign(SomeClass.prototype, &#123; someMethod(arg1, arg2) &#123; Â·Â·Â· &#125;, anotherMethod() &#123; Â·Â·Â· &#125;&#125;);// ç­‰åŒäºä¸‹é¢çš„å†™æ³•SomeClass.prototype.someMethod = function (arg1, arg2) &#123; Â·Â·Â·&#125;;SomeClass.prototype.anotherMethod = function () &#123; Â·Â·Â·&#125;; ä¸Šé¢ä»£ç ä½¿ç”¨äº†å¯¹è±¡å±æ€§çš„ç®€æ´è¡¨ç¤ºæ³•ï¼Œç›´æ¥å°†ä¸¤ä¸ªå‡½æ•°æ”¾åœ¨å¤§æ‹¬å·ä¸­ï¼Œå†ä½¿ç”¨assignæ–¹æ³•æ·»åŠ åˆ°SomeClass.prototypeä¹‹ä¸­ã€‚ ï¼ˆ3ï¼‰å…‹éš†å¯¹è±¡ 123function clone(origin) &#123; return Object.assign(&#123;&#125;, origin);&#125; ä¸Šé¢ä»£ç å°†åŸå§‹å¯¹è±¡æ‹·è´åˆ°ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå°±å¾—åˆ°äº†åŸå§‹å¯¹è±¡çš„å…‹éš†ã€‚ ä¸è¿‡ï¼Œé‡‡ç”¨è¿™ç§æ–¹æ³•å…‹éš†ï¼Œåªèƒ½å…‹éš†åŸå§‹å¯¹è±¡è‡ªèº«çš„å€¼ï¼Œä¸èƒ½å…‹éš†å®ƒç»§æ‰¿çš„å€¼ã€‚å¦‚æœæƒ³è¦ä¿æŒç»§æ‰¿é“¾ï¼Œå¯ä»¥é‡‡ç”¨ä¸‹é¢çš„ä»£ç ã€‚ 1234function clone(origin) &#123; let originProto = Object.getPrototypeOf(origin); return Object.assign(Object.create(originProto), origin);&#125; ï¼ˆ4ï¼‰åˆå¹¶å¤šä¸ªå¯¹è±¡ å°†å¤šä¸ªå¯¹è±¡åˆå¹¶åˆ°æŸä¸ªå¯¹è±¡ã€‚ 12const merge = (target, ...sources) =&gt; Object.assign(target, ...sources); å¦‚æœå¸Œæœ›åˆå¹¶åè¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¯ä»¥æ”¹å†™ä¸Šé¢å‡½æ•°ï¼Œå¯¹ä¸€ä¸ªç©ºå¯¹è±¡åˆå¹¶ã€‚ 12const merge = (...sources) =&gt; Object.assign(&#123;&#125;, ...sources); ï¼ˆ5ï¼‰ä¸ºå±æ€§æŒ‡å®šé»˜è®¤å€¼ 12345678const DEFAULTS = &#123; logLevel: 0, outputFormat: 'html'&#125;;function processContent(options) &#123; options = Object.assign(&#123;&#125;, DEFAULTS, options);&#125; ä¸Šé¢ä»£ç ä¸­ï¼ŒDEFAULTSå¯¹è±¡æ˜¯é»˜è®¤å€¼ï¼Œoptionså¯¹è±¡æ˜¯ç”¨æˆ·æä¾›çš„å‚æ•°ã€‚Object.assignæ–¹æ³•å°†DEFAULTSå’Œoptionsåˆå¹¶æˆä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¦‚æœä¸¤è€…æœ‰åŒåå±æ€§ï¼Œåˆ™optionçš„å±æ€§å€¼ä¼šè¦†ç›–DEFAULTSçš„å±æ€§å€¼ã€‚ æ³¨æ„ï¼Œç”±äºå­˜åœ¨æ·±æ‹·è´çš„é—®é¢˜ï¼ŒDEFAULTSå¯¹è±¡å’Œoptionså¯¹è±¡çš„æ‰€æœ‰å±æ€§çš„å€¼ï¼Œéƒ½åªèƒ½æ˜¯ç®€å•ç±»å‹ï¼Œè€Œä¸èƒ½æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ã€‚å¦åˆ™ï¼Œå°†å¯¼è‡´DEFAULTSå¯¹è±¡çš„è¯¥å±æ€§ä¸èµ·ä½œç”¨ã€‚ å±æ€§çš„å¯æšä¸¾æ€§å¯¹è±¡çš„æ¯ä¸ªå±æ€§éƒ½æœ‰ä¸€ä¸ªæè¿°å¯¹è±¡ï¼ˆDescriptorï¼‰ï¼Œç”¨æ¥æ§åˆ¶è¯¥å±æ€§çš„è¡Œä¸ºã€‚Object.getOwnPropertyDescriptoræ–¹æ³•å¯ä»¥è·å–è¯¥å±æ€§çš„æè¿°å¯¹è±¡ã€‚ 12345678let obj = &#123; foo: 123 &#125;;Object.getOwnPropertyDescriptor(obj, 'foo')// &#123;// value: 123,// writable: true,// enumerable: true,// configurable: true// &#125; æè¿°å¯¹è±¡çš„enumerableå±æ€§ï¼Œç§°ä¸ºâ€å¯æšä¸¾æ€§â€œï¼Œå¦‚æœè¯¥å±æ€§ä¸ºfalseï¼Œå°±è¡¨ç¤ºæŸäº›æ“ä½œä¼šå¿½ç•¥å½“å‰å±æ€§ã€‚ ES5æœ‰ä¸‰ä¸ªæ“ä½œä¼šå¿½ç•¥enumerableä¸ºfalseçš„å±æ€§ã€‚ for...inå¾ªç¯ï¼šåªéå†å¯¹è±¡è‡ªèº«çš„å’Œç»§æ‰¿çš„å¯æšä¸¾çš„å±æ€§ Object.keys()ï¼šè¿”å›å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰å¯æšä¸¾çš„å±æ€§çš„é”®å JSON.stringify()ï¼šåªä¸²è¡ŒåŒ–å¯¹è±¡è‡ªèº«çš„å¯æšä¸¾çš„å±æ€§ ES6æ–°å¢äº†ä¸€ä¸ªæ“ä½œObject.assign()ï¼Œä¼šå¿½ç•¥enumerableä¸ºfalseçš„å±æ€§ï¼Œåªæ‹·è´å¯¹è±¡è‡ªèº«çš„å¯æšä¸¾çš„å±æ€§ã€‚ è¿™å››ä¸ªæ“ä½œä¹‹ä¸­ï¼Œåªæœ‰for...inä¼šè¿”å›ç»§æ‰¿çš„å±æ€§ã€‚å®é™…ä¸Šï¼Œå¼•å…¥enumerableçš„æœ€åˆç›®çš„ï¼Œå°±æ˜¯è®©æŸäº›å±æ€§å¯ä»¥è§„é¿æ‰for...inæ“ä½œã€‚æ¯”å¦‚ï¼Œå¯¹è±¡åŸå‹çš„toStringæ–¹æ³•ï¼Œä»¥åŠæ•°ç»„çš„lengthå±æ€§ï¼Œå°±é€šè¿‡è¿™ç§æ‰‹æ®µï¼Œä¸ä¼šè¢«for...inéå†åˆ°ã€‚ 12345Object.getOwnPropertyDescriptor(Object.prototype, 'toString').enumerable// falseObject.getOwnPropertyDescriptor([], 'length').enumerable// false ä¸Šé¢ä»£ç ä¸­ï¼ŒtoStringå’Œlengthå±æ€§çš„enumerableéƒ½æ˜¯falseï¼Œå› æ­¤for...inä¸ä¼šéå†åˆ°è¿™ä¸¤ä¸ªç»§æ‰¿è‡ªåŸå‹çš„å±æ€§ã€‚ å¦å¤–ï¼ŒES6è§„å®šï¼Œæ‰€æœ‰Classçš„åŸå‹çš„æ–¹æ³•éƒ½æ˜¯ä¸å¯æšä¸¾çš„ã€‚ 12Object.getOwnPropertyDescriptor(class &#123;foo() &#123;&#125;&#125;.prototype, 'foo').enumerable// false æ€»çš„æ¥è¯´ï¼Œæ“ä½œä¸­å¼•å…¥ç»§æ‰¿çš„å±æ€§ä¼šè®©é—®é¢˜å¤æ‚åŒ–ï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬åªå…³å¿ƒå¯¹è±¡è‡ªèº«çš„å±æ€§ã€‚æ‰€ä»¥ï¼Œå°½é‡ä¸è¦ç”¨for...inå¾ªç¯ï¼Œè€Œç”¨Object.keys()ä»£æ›¿ã€‚ å±æ€§çš„éå†ES6ä¸€å…±æœ‰5ç§æ–¹æ³•å¯ä»¥éå†å¯¹è±¡çš„å±æ€§ã€‚ ï¼ˆ1ï¼‰forâ€¦in for...inå¾ªç¯éå†å¯¹è±¡è‡ªèº«çš„å’Œç»§æ‰¿çš„å¯æšä¸¾å±æ€§ï¼ˆä¸å«Symbolå±æ€§ï¼‰ã€‚ ï¼ˆ2ï¼‰Object.keys(obj) Object.keysè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…æ‹¬å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼ˆä¸å«Symbolå±æ€§ï¼‰ã€‚ ï¼ˆ3ï¼‰Object.getOwnPropertyNames(obj) Object.getOwnPropertyNamesè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰å±æ€§ï¼ˆä¸å«Symbolå±æ€§ï¼Œä½†æ˜¯åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§ï¼‰ã€‚ ï¼ˆ4ï¼‰Object.getOwnPropertySymbols(obj) Object.getOwnPropertySymbolsè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰Symbolå±æ€§ã€‚ ï¼ˆ5ï¼‰Reflect.ownKeys(obj) Reflect.ownKeysè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰å±æ€§ï¼Œä¸ç®¡æ˜¯å±æ€§åæ˜¯Symbolæˆ–å­—ç¬¦ä¸²ï¼Œä¹Ÿä¸ç®¡æ˜¯å¦å¯æšä¸¾ã€‚ ä»¥ä¸Šçš„5ç§æ–¹æ³•éå†å¯¹è±¡çš„å±æ€§ï¼Œéƒ½éµå®ˆåŒæ ·çš„å±æ€§éå†çš„æ¬¡åºè§„åˆ™ã€‚ é¦–å…ˆéå†æ‰€æœ‰å±æ€§åä¸ºæ•°å€¼çš„å±æ€§ï¼ŒæŒ‰ç…§æ•°å­—æ’åºã€‚ å…¶æ¬¡éå†æ‰€æœ‰å±æ€§åä¸ºå­—ç¬¦ä¸²çš„å±æ€§ï¼ŒæŒ‰ç…§ç”Ÿæˆæ—¶é—´æ’åºã€‚ æœ€åéå†æ‰€æœ‰å±æ€§åä¸ºSymbolå€¼çš„å±æ€§ï¼ŒæŒ‰ç…§ç”Ÿæˆæ—¶é—´æ’åºã€‚ 12Reflect.ownKeys(&#123; [Symbol()]:0, b:0, 10:0, 2:0, a:0 &#125;)// ['2', '10', 'b', 'a', Symbol()] ä¸Šé¢ä»£ç ä¸­ï¼ŒReflect.ownKeysæ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†å‚æ•°å¯¹è±¡çš„æ‰€æœ‰å±æ€§ã€‚è¿™ä¸ªæ•°ç»„çš„å±æ€§æ¬¡åºæ˜¯è¿™æ ·çš„ï¼Œé¦–å…ˆæ˜¯æ•°å€¼å±æ€§2å’Œ10ï¼Œå…¶æ¬¡æ˜¯å­—ç¬¦ä¸²å±æ€§bå’Œaï¼Œæœ€åæ˜¯Symbolå±æ€§ã€‚ __proto__å±æ€§ï¼ŒObject.setPrototypeOf()ï¼ŒObject.getPrototypeOf()ï¼ˆ1ï¼‰__proto__å±æ€§ __proto__å±æ€§ï¼ˆå‰åå„ä¸¤ä¸ªä¸‹åˆ’çº¿ï¼‰ï¼Œç”¨æ¥è¯»å–æˆ–è®¾ç½®å½“å‰å¯¹è±¡çš„prototypeå¯¹è±¡ã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨ï¼ˆåŒ…æ‹¬IE11ï¼‰éƒ½éƒ¨ç½²äº†è¿™ä¸ªå±æ€§ã€‚ 123456789// es6çš„å†™æ³•var obj = &#123; method: function() &#123; ... &#125;&#125;;obj.__proto__ = someOtherObj;// es5çš„å†™æ³•var obj = Object.create(someOtherObj);obj.method = function() &#123; ... &#125;; è¯¥å±æ€§æ²¡æœ‰å†™å…¥ES6çš„æ­£æ–‡ï¼Œè€Œæ˜¯å†™å…¥äº†é™„å½•ï¼ŒåŸå› æ˜¯__proto__å‰åçš„åŒä¸‹åˆ’çº¿ï¼Œè¯´æ˜å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå†…éƒ¨å±æ€§ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ­£å¼çš„å¯¹å¤–çš„APIï¼Œåªæ˜¯ç”±äºæµè§ˆå™¨å¹¿æ³›æ”¯æŒï¼Œæ‰è¢«åŠ å…¥äº†ES6ã€‚æ ‡å‡†æ˜ç¡®è§„å®šï¼Œåªæœ‰æµè§ˆå™¨å¿…é¡»éƒ¨ç½²è¿™ä¸ªå±æ€§ï¼Œå…¶ä»–è¿è¡Œç¯å¢ƒä¸ä¸€å®šéœ€è¦éƒ¨ç½²ï¼Œè€Œä¸”æ–°çš„ä»£ç æœ€å¥½è®¤ä¸ºè¿™ä¸ªå±æ€§æ˜¯ä¸å­˜åœ¨çš„ã€‚å› æ­¤ï¼Œæ— è®ºä»è¯­ä¹‰çš„è§’åº¦ï¼Œè¿˜æ˜¯ä»å…¼å®¹æ€§çš„è§’åº¦ï¼Œéƒ½ä¸è¦ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸‹é¢çš„Object.setPrototypeOf()ï¼ˆå†™æ“ä½œï¼‰ã€Object.getPrototypeOf()ï¼ˆè¯»æ“ä½œï¼‰ã€Object.create()ï¼ˆç”Ÿæˆæ“ä½œï¼‰ä»£æ›¿ã€‚ åœ¨å®ç°ä¸Šï¼Œ__proto__è°ƒç”¨çš„æ˜¯Object.prototype.__proto__ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ã€‚ 123456789101112131415161718192021222324Object.defineProperty(Object.prototype, '__proto__', &#123; get() &#123; let _thisObj = Object(this); return Object.getPrototypeOf(_thisObj); &#125;, set(proto) &#123; if (this === undefined || this === null) &#123; throw new TypeError(); &#125; if (!isObject(this)) &#123; return undefined; &#125; if (!isObject(proto)) &#123; return undefined; &#125; let status = Reflect.setPrototypeOf(this, proto); if (!status) &#123; throw new TypeError(); &#125; &#125;,&#125;);function isObject(value) &#123; return Object(value) === value;&#125; å¦‚æœä¸€ä¸ªå¯¹è±¡æœ¬èº«éƒ¨ç½²äº†__proto__å±æ€§ï¼Œåˆ™è¯¥å±æ€§çš„å€¼å°±æ˜¯å¯¹è±¡çš„åŸå‹ã€‚ 12Object.getPrototypeOf(&#123; __proto__: null &#125;)// null ï¼ˆ2ï¼‰Object.setPrototypeOf() Object.setPrototypeOfæ–¹æ³•çš„ä½œç”¨ä¸__proto__ç›¸åŒï¼Œç”¨æ¥è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„prototypeå¯¹è±¡ã€‚å®ƒæ˜¯ES6æ­£å¼æ¨èçš„è®¾ç½®åŸå‹å¯¹è±¡çš„æ–¹æ³•ã€‚ 12345// æ ¼å¼Object.setPrototypeOf(object, prototype)// ç”¨æ³•var o = Object.setPrototypeOf(&#123;&#125;, null); è¯¥æ–¹æ³•ç­‰åŒäºä¸‹é¢çš„å‡½æ•°ã€‚ 1234function (obj, proto) &#123; obj.__proto__ = proto; return obj;&#125; ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 12345678910let proto = &#123;&#125;;let obj = &#123; x: 10 &#125;;Object.setPrototypeOf(obj, proto);proto.y = 20;proto.z = 40;obj.x // 10obj.y // 20obj.z // 40 ä¸Šé¢ä»£ç å°†protoå¯¹è±¡è®¾ä¸ºobjå¯¹è±¡çš„åŸå‹ï¼Œæ‰€ä»¥ä»objå¯¹è±¡å¯ä»¥è¯»å–protoå¯¹è±¡çš„å±æ€§ã€‚ ï¼ˆ3ï¼‰Object.getPrototypeOf() è¯¥æ–¹æ³•ä¸setPrototypeOfæ–¹æ³•é…å¥—ï¼Œç”¨äºè¯»å–ä¸€ä¸ªå¯¹è±¡çš„prototypeå¯¹è±¡ã€‚ 1Object.getPrototypeOf(obj); ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 1234567891011function Rectangle() &#123;&#125;var rec = new Rectangle();Object.getPrototypeOf(rec) === Rectangle.prototype// trueObject.setPrototypeOf(rec, Object.prototype);Object.getPrototypeOf(rec) === Rectangle.prototype// false Object.keys()ï¼ŒObject.values()ï¼ŒObject.entries()Object.keys()ES5 å¼•å…¥äº†Object.keysæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜æ˜¯å‚æ•°å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰å±æ€§çš„é”®åã€‚ 123var obj = &#123; foo: 'bar', baz: 42 &#125;;Object.keys(obj)// [\"foo\", \"baz\"] ES2017 å¼•å…¥äº†è·ŸObject.keysé…å¥—çš„Object.valueså’ŒObject.entriesï¼Œä½œä¸ºéå†ä¸€ä¸ªå¯¹è±¡çš„è¡¥å……æ‰‹æ®µã€‚ 1234567891011121314let &#123;keys, values, entries&#125; = Object;let obj = &#123; a: 1, b: 2, c: 3 &#125;;for (let key of keys(obj)) &#123; console.log(key); // 'a', 'b', 'c'&#125;for (let value of values(obj)) &#123; console.log(value); // 1, 2, 3&#125;for (let [key, value] of entries(obj)) &#123; console.log([key, value]); // ['a', 1], ['b', 2], ['c', 3]&#125; Object.values()Object.valuesæ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜æ˜¯å‚æ•°å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰å±æ€§çš„é”®å€¼ã€‚ 123var obj = &#123; foo: 'bar', baz: 42 &#125;;Object.values(obj)// [\"bar\", 42] è¿”å›æ•°ç»„çš„æˆå‘˜é¡ºåºï¼Œä¸æœ¬ç« çš„ã€Šå±æ€§çš„éå†ã€‹éƒ¨åˆ†ä»‹ç»çš„æ’åˆ—è§„åˆ™ä¸€è‡´ã€‚ 123var obj = &#123; 100: 'a', 2: 'b', 7: 'c' &#125;;Object.values(obj)// [\"b\", \"c\", \"a\"] ä¸Šé¢ä»£ç ä¸­ï¼Œå±æ€§åä¸ºæ•°å€¼çš„å±æ€§ï¼Œæ˜¯æŒ‰ç…§æ•°å€¼å¤§å°ï¼Œä»å°åˆ°å¤§éå†çš„ï¼Œå› æ­¤è¿”å›çš„é¡ºåºæ˜¯bã€cã€aã€‚ Object.valuesåªè¿”å›å¯¹è±¡è‡ªèº«çš„å¯éå†å±æ€§ã€‚ 12var obj = Object.create(&#123;&#125;, &#123;p: &#123;value: 42&#125;&#125;);Object.values(obj) // [] ä¸Šé¢ä»£ç ä¸­ï¼ŒObject.createæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ·»åŠ çš„å¯¹è±¡å±æ€§ï¼ˆå±æ€§pï¼‰ï¼Œå¦‚æœä¸æ˜¾å¼å£°æ˜ï¼Œé»˜è®¤æ˜¯ä¸å¯éå†çš„ï¼Œå› ä¸ºpæ˜¯ç»§æ‰¿çš„å±æ€§ï¼Œè€Œä¸æ˜¯å¯¹è±¡è‡ªèº«çš„å±æ€§ã€‚Object.valuesä¸ä¼šè¿”å›è¿™ä¸ªå±æ€§ã€‚ Object.valuesä¼šè¿‡æ»¤å±æ€§åä¸º Symbol å€¼çš„å±æ€§ã€‚ 12Object.values(&#123; [Symbol()]: 123, foo: 'abc' &#125;);// ['abc'] å¦‚æœObject.valuesæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¼šè¿”å›å„ä¸ªå­—ç¬¦ç»„æˆçš„ä¸€ä¸ªæ•°ç»„ã€‚ 12Object.values('foo')// ['f', 'o', 'o'] ä¸Šé¢ä»£ç ä¸­ï¼Œå­—ç¬¦ä¸²ä¼šå…ˆè½¬æˆä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦ï¼Œå°±æ˜¯è¯¥å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ã€‚å› æ­¤ï¼ŒObject.valuesè¿”å›æ¯ä¸ªå±æ€§çš„é”®å€¼ï¼Œå°±æ˜¯å„ä¸ªå­—ç¬¦ç»„æˆçš„ä¸€ä¸ªæ•°ç»„ã€‚ å¦‚æœå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼ŒObject.valuesä¼šå…ˆå°†å…¶è½¬ä¸ºå¯¹è±¡ã€‚ç”±äºæ•°å€¼å’Œå¸ƒå°”å€¼çš„åŒ…è£…å¯¹è±¡ï¼Œéƒ½ä¸ä¼šä¸ºå®ä¾‹æ·»åŠ éç»§æ‰¿çš„å±æ€§ã€‚æ‰€ä»¥ï¼ŒObject.valuesä¼šè¿”å›ç©ºæ•°ç»„ã€‚ 12Object.values(42) // []Object.values(true) // [] Object.entriesObject.entriesæ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜æ˜¯å‚æ•°å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰å±æ€§çš„é”®å€¼å¯¹æ•°ç»„ã€‚ 123var obj = &#123; foo: 'bar', baz: 42 &#125;;Object.entries(obj)// [ [\"foo\", \"bar\"], [\"baz\", 42] ] é™¤äº†è¿”å›å€¼ä¸ä¸€æ ·ï¼Œè¯¥æ–¹æ³•çš„è¡Œä¸ºä¸Object.valuesåŸºæœ¬ä¸€è‡´ã€‚ å¦‚æœåŸå¯¹è±¡çš„å±æ€§åæ˜¯ä¸€ä¸ªSymbolå€¼ï¼Œè¯¥å±æ€§ä¼šè¢«çœç•¥ã€‚ 12Object.entries(&#123; [Symbol()]: 123, foo: 'abc' &#125;);// [ [ 'foo', 'abc' ] ] ä¸Šé¢ä»£ç ä¸­ï¼ŒåŸå¯¹è±¡æœ‰ä¸¤ä¸ªå±æ€§ï¼ŒObject.entriesåªè¾“å‡ºå±æ€§åéSymbolå€¼çš„å±æ€§ã€‚å°†æ¥å¯èƒ½ä¼šæœ‰Reflect.ownEntries()æ–¹æ³•ï¼Œè¿”å›å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰å±æ€§ã€‚ Object.entriesçš„åŸºæœ¬ç”¨é€”æ˜¯éå†å¯¹è±¡çš„å±æ€§ã€‚ 123456let obj = &#123; one: 1, two: 2 &#125;;for (let [k, v] of Object.entries(obj)) &#123; console.log(`$&#123;JSON.stringify(k)&#125;: $&#123;JSON.stringify(v)&#125;`);&#125;// \"one\": 1// \"two\": 2 Object.entriesæ–¹æ³•çš„ä¸€ä¸ªç”¨å¤„æ˜¯ï¼Œå°†å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„Mapç»“æ„ã€‚ 123var obj = &#123; foo: 'bar', baz: 42 &#125;;var map = new Map(Object.entries(obj));map // Map &#123; foo: \"bar\", baz: 42 &#125; è‡ªå·±å®ç°Object.entriesæ–¹æ³•ï¼Œéå¸¸ç®€å•ã€‚ 123456789101112131415// Generatorå‡½æ•°çš„ç‰ˆæœ¬function* entries(obj) &#123; for (let key of Object.keys(obj)) &#123; yield [key, obj[key]]; &#125;&#125;// éGeneratorå‡½æ•°çš„ç‰ˆæœ¬function entries(obj) &#123; let arr = []; for (let key of Object.keys(obj)) &#123; arr.push([key, obj[key]]); &#125; return arr;&#125; å¯¹è±¡çš„æ‰©å±•è¿ç®—ç¬¦ç›®å‰ï¼ŒES7æœ‰ä¸€ä¸ªææ¡ˆï¼Œå°†Restè¿ç®—ç¬¦ï¼ˆè§£æ„èµ‹å€¼ï¼‰/æ‰©å±•è¿ç®—ç¬¦ï¼ˆ...ï¼‰å¼•å…¥å¯¹è±¡ã€‚Babelè½¬ç å™¨å·²ç»æ”¯æŒè¿™é¡¹åŠŸèƒ½ã€‚ ï¼ˆ1ï¼‰è§£æ„èµ‹å€¼ å¯¹è±¡çš„è§£æ„èµ‹å€¼ç”¨äºä»ä¸€ä¸ªå¯¹è±¡å–å€¼ï¼Œç›¸å½“äºå°†æ‰€æœ‰å¯éå†çš„ã€ä½†å°šæœªè¢«è¯»å–çš„å±æ€§ï¼Œåˆ†é…åˆ°æŒ‡å®šçš„å¯¹è±¡ä¸Šé¢ã€‚æ‰€æœ‰çš„é”®å’Œå®ƒä»¬çš„å€¼ï¼Œéƒ½ä¼šæ‹·è´åˆ°æ–°å¯¹è±¡ä¸Šé¢ã€‚ 1234let &#123; x, y, ...z &#125; = &#123; x: 1, y: 2, a: 3, b: 4 &#125;;x // 1y // 2z // &#123; a: 3, b: 4 &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡zæ˜¯è§£æ„èµ‹å€¼æ‰€åœ¨çš„å¯¹è±¡ã€‚å®ƒè·å–ç­‰å·å³è¾¹çš„æ‰€æœ‰å°šæœªè¯»å–çš„é”®ï¼ˆaå’Œbï¼‰ï¼Œå°†å®ƒä»¬è¿åŒå€¼ä¸€èµ·æ‹·è´è¿‡æ¥ã€‚ ç”±äºè§£æ„èµ‹å€¼è¦æ±‚ç­‰å·å³è¾¹æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å¦‚æœç­‰å·å³è¾¹æ˜¯undefinedæˆ–nullï¼Œå°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒä»¬æ— æ³•è½¬ä¸ºå¯¹è±¡ã€‚ 12let &#123; x, y, ...z &#125; = null; // è¿è¡Œæ—¶é”™è¯¯let &#123; x, y, ...z &#125; = undefined; // è¿è¡Œæ—¶é”™è¯¯ è§£æ„èµ‹å€¼å¿…é¡»æ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ 12let &#123; ...x, y, z &#125; = obj; // å¥æ³•é”™è¯¯let &#123; x, ...y, ...z &#125; = obj; // å¥æ³•é”™è¯¯ ä¸Šé¢ä»£ç ä¸­ï¼Œè§£æ„èµ‹å€¼ä¸æ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ã€‚ æ³¨æ„ï¼Œè§£æ„èµ‹å€¼çš„æ‹·è´æ˜¯æµ…æ‹·è´ï¼Œå³å¦‚æœä¸€ä¸ªé”®çš„å€¼æ˜¯å¤åˆç±»å‹çš„å€¼ï¼ˆæ•°ç»„ã€å¯¹è±¡ã€å‡½æ•°ï¼‰ã€é‚£ä¹ˆè§£æ„èµ‹å€¼æ‹·è´çš„æ˜¯è¿™ä¸ªå€¼çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯è¿™ä¸ªå€¼çš„å‰¯æœ¬ã€‚ 1234let obj = &#123; a: &#123; b: 1 &#125; &#125;;let &#123; ...x &#125; = obj;obj.a.b = 2;x.a.b // 2 ä¸Šé¢ä»£ç ä¸­ï¼Œxæ˜¯è§£æ„èµ‹å€¼æ‰€åœ¨çš„å¯¹è±¡ï¼Œæ‹·è´äº†å¯¹è±¡objçš„aå±æ€§ã€‚aå±æ€§å¼•ç”¨äº†ä¸€ä¸ªå¯¹è±¡ï¼Œä¿®æ”¹è¿™ä¸ªå¯¹è±¡çš„å€¼ï¼Œä¼šå½±å“åˆ°è§£æ„èµ‹å€¼å¯¹å®ƒçš„å¼•ç”¨ã€‚ å¦å¤–ï¼Œè§£æ„èµ‹å€¼ä¸ä¼šæ‹·è´ç»§æ‰¿è‡ªåŸå‹å¯¹è±¡çš„å±æ€§ã€‚ 12345let o1 = &#123; a: 1 &#125;;let o2 = &#123; b: 2 &#125;;o2.__proto__ = o1;let o3 = &#123; ...o2 &#125;;o3 // &#123; b: 2 &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå¯¹è±¡o3æ˜¯o2çš„æ‹·è´ï¼Œä½†æ˜¯åªå¤åˆ¶äº†o2è‡ªèº«çš„å±æ€§ï¼Œæ²¡æœ‰å¤åˆ¶å®ƒçš„åŸå‹å¯¹è±¡o1çš„å±æ€§ã€‚ ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚ 1234567var o = Object.create(&#123; x: 1, y: 2 &#125;);o.z = 3;let &#123; x, ...&#123; y, z &#125; &#125; = o;x // 1y // undefinedz // 3 ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡xæ˜¯å•çº¯çš„è§£æ„èµ‹å€¼ï¼Œæ‰€ä»¥å¯ä»¥è¯»å–ç»§æ‰¿çš„å±æ€§ï¼›è§£æ„èµ‹å€¼äº§ç”Ÿçš„å˜é‡yå’Œzï¼Œåªèƒ½è¯»å–å¯¹è±¡è‡ªèº«çš„å±æ€§ï¼Œæ‰€ä»¥åªæœ‰å˜é‡zå¯ä»¥èµ‹å€¼æˆåŠŸã€‚ è§£æ„èµ‹å€¼çš„ä¸€ä¸ªç”¨å¤„ï¼Œæ˜¯æ‰©å±•æŸä¸ªå‡½æ•°çš„å‚æ•°ï¼Œå¼•å…¥å…¶ä»–æ“ä½œã€‚ 12345678function baseFunction(&#123; a, b &#125;) &#123; // ...&#125;function wrapperFunction(&#123; x, y, ...restConfig &#125;) &#123; // ä½¿ç”¨xå’Œyå‚æ•°è¿›è¡Œæ“ä½œ // å…¶ä½™å‚æ•°ä¼ ç»™åŸå§‹å‡½æ•° return baseFunction(restConfig);&#125; ä¸Šé¢ä»£ç ä¸­ï¼ŒåŸå§‹å‡½æ•°baseFunctionæ¥å—aå’Œbä½œä¸ºå‚æ•°ï¼Œå‡½æ•°wrapperFunctionåœ¨baseFunctionçš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ‰©å±•ï¼Œèƒ½å¤Ÿæ¥å—å¤šä½™çš„å‚æ•°ï¼Œå¹¶ä¸”ä¿ç•™åŸå§‹å‡½æ•°çš„è¡Œä¸ºã€‚ ï¼ˆ2ï¼‰æ‰©å±•è¿ç®—ç¬¦ æ‰©å±•è¿ç®—ç¬¦ï¼ˆ...ï¼‰ç”¨äºå–å‡ºå‚æ•°å¯¹è±¡çš„æ‰€æœ‰å¯éå†å±æ€§ï¼Œæ‹·è´åˆ°å½“å‰å¯¹è±¡ä¹‹ä¸­ã€‚ 123let z = &#123; a: 3, b: 4 &#125;;let n = &#123; ...z &#125;;n // &#123; a: 3, b: 4 &#125; è¿™ç­‰åŒäºä½¿ç”¨Object.assignæ–¹æ³•ã€‚ 123let aClone = &#123; ...a &#125;;// ç­‰åŒäºlet aClone = Object.assign(&#123;&#125;, a); æ‰©å±•è¿ç®—ç¬¦å¯ä»¥ç”¨äºåˆå¹¶ä¸¤ä¸ªå¯¹è±¡ã€‚ 123let ab = &#123; ...a, ...b &#125;;// ç­‰åŒäºlet ab = Object.assign(&#123;&#125;, a, b); å¦‚æœç”¨æˆ·è‡ªå®šä¹‰çš„å±æ€§ï¼Œæ”¾åœ¨æ‰©å±•è¿ç®—ç¬¦åé¢ï¼Œåˆ™æ‰©å±•è¿ç®—ç¬¦å†…éƒ¨çš„åŒåå±æ€§ä¼šè¢«è¦†ç›–æ‰ã€‚ 1234567let aWithOverrides = &#123; ...a, x: 1, y: 2 &#125;;// ç­‰åŒäºlet aWithOverrides = &#123; ...a, ...&#123; x: 1, y: 2 &#125; &#125;;// ç­‰åŒäºlet x = 1, y = 2, aWithOverrides = &#123; ...a, x, y &#125;;// ç­‰åŒäºlet aWithOverrides = Object.assign(&#123;&#125;, a, &#123; x: 1, y: 2 &#125;); ä¸Šé¢ä»£ç ä¸­ï¼Œaå¯¹è±¡çš„xå±æ€§å’Œyå±æ€§ï¼Œæ‹·è´åˆ°æ–°å¯¹è±¡åä¼šè¢«è¦†ç›–æ‰ã€‚ è¿™ç”¨æ¥ä¿®æ”¹ç°æœ‰å¯¹è±¡éƒ¨åˆ†çš„éƒ¨åˆ†å±æ€§å°±å¾ˆæ–¹ä¾¿äº†ã€‚ 1234let newVersion = &#123; ...previousVersion, name: 'New Name' // Override the name property&#125;; ä¸Šé¢ä»£ç ä¸­ï¼ŒnewVersionå¯¹è±¡è‡ªå®šä¹‰äº†nameå±æ€§ï¼Œå…¶ä»–å±æ€§å…¨éƒ¨å¤åˆ¶è‡ªpreviousVersionå¯¹è±¡ã€‚ å¦‚æœæŠŠè‡ªå®šä¹‰å±æ€§æ”¾åœ¨æ‰©å±•è¿ç®—ç¬¦å‰é¢ï¼Œå°±å˜æˆäº†è®¾ç½®æ–°å¯¹è±¡çš„é»˜è®¤å±æ€§å€¼ã€‚ 12345let aWithDefaults = &#123; x: 1, y: 2, ...a &#125;;// ç­‰åŒäºlet aWithDefaults = Object.assign(&#123;&#125;, &#123; x: 1, y: 2 &#125;, a);// ç­‰åŒäºlet aWithDefaults = Object.assign(&#123; x: 1, y: 2 &#125;, a); æ‰©å±•è¿ç®—ç¬¦çš„å‚æ•°å¯¹è±¡ä¹‹ä¸­ï¼Œå¦‚æœæœ‰å–å€¼å‡½æ•°getï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ä¼šæ‰§è¡Œçš„ã€‚ 1234567891011121314151617// å¹¶ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºxå±æ€§åªæ˜¯è¢«å®šä¹‰ï¼Œä½†æ²¡æ‰§è¡Œlet aWithXGetter = &#123; ...a, get x() &#123; throws new Error('not thrown yet'); &#125;&#125;;// ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºxå±æ€§è¢«æ‰§è¡Œäº†let runtimeError = &#123; ...a, ...&#123; get x() &#123; throws new Error('thrown now'); &#125; &#125;&#125;; å¦‚æœæ‰©å±•è¿ç®—ç¬¦çš„å‚æ•°æ˜¯nullæˆ–undefinedï¼Œè¿™ä¸ªä¸¤ä¸ªå€¼ä¼šè¢«å¿½ç•¥ï¼Œä¸ä¼šæŠ¥é”™ã€‚ 1let emptyObject = &#123; ...null, ...undefined &#125;; // ä¸æŠ¥é”™ Object.getOwnPropertyDescriptors()ES5æœ‰ä¸€ä¸ªObject.getOwnPropertyDescriptoræ–¹æ³•ï¼Œè¿”å›æŸä¸ªå¯¹è±¡å±æ€§çš„æè¿°å¯¹è±¡ï¼ˆdescriptorï¼‰ã€‚ 12345678var obj = &#123; p: 'a' &#125;;Object.getOwnPropertyDescriptor(obj, 'p')// Object &#123; value: \"a\",// writable: true,// enumerable: true,// configurable: true// &#125; ES7æœ‰ä¸€ä¸ªææ¡ˆï¼Œæå‡ºäº†Object.getOwnPropertyDescriptorsæ–¹æ³•ï¼Œè¿”å›æŒ‡å®šå¯¹è±¡æ‰€æœ‰è‡ªèº«å±æ€§ï¼ˆéç»§æ‰¿å±æ€§ï¼‰çš„æè¿°å¯¹è±¡ã€‚ 12345678910111213141516const obj = &#123; foo: 123, get bar() &#123; return 'abc' &#125;&#125;;Object.getOwnPropertyDescriptors(obj)// &#123; foo:// &#123; value: 123,// writable: true,// enumerable: true,// configurable: true &#125;,// bar:// &#123; get: [Function: bar],// set: undefined,// enumerable: true,// configurable: true &#125; &#125; Object.getOwnPropertyDescriptorsæ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€æœ‰åŸå¯¹è±¡çš„å±æ€§åéƒ½æ˜¯è¯¥å¯¹è±¡çš„å±æ€§åï¼Œå¯¹åº”çš„å±æ€§å€¼å°±æ˜¯è¯¥å±æ€§çš„æè¿°å¯¹è±¡ã€‚ è¯¥æ–¹æ³•çš„å®ç°éå¸¸å®¹æ˜“ã€‚ 1234567function getOwnPropertyDescriptors(obj) &#123; const result = &#123;&#125;; for (let key of Reflect.ownKeys(obj)) &#123; result[key] = Object.getOwnPropertyDescriptor(obj, key); &#125; return result;&#125; è¯¥æ–¹æ³•çš„æå‡ºç›®çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³Object.assign()æ— æ³•æ­£ç¡®æ‹·è´getå±æ€§å’Œsetå±æ€§çš„é—®é¢˜ã€‚ 1234567891011121314const source = &#123; set foo(value) &#123; console.log(value); &#125;&#125;;const target1 = &#123;&#125;;Object.assign(target1, source);Object.getOwnPropertyDescriptor(target1, 'foo')// &#123; value: undefined,// writable: true,// enumerable: true,// configurable: true &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œsourceå¯¹è±¡çš„fooå±æ€§çš„å€¼æ˜¯ä¸€ä¸ªèµ‹å€¼å‡½æ•°ï¼ŒObject.assignæ–¹æ³•å°†è¿™ä¸ªå±æ€§æ‹·è´ç»™target1å¯¹è±¡ï¼Œç»“æœè¯¥å±æ€§çš„å€¼å˜æˆäº†undefinedã€‚è¿™æ˜¯å› ä¸ºObject.assignæ–¹æ³•æ€»æ˜¯æ‹·è´ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œè€Œä¸ä¼šæ‹·è´å®ƒèƒŒåçš„èµ‹å€¼æ–¹æ³•æˆ–å–å€¼æ–¹æ³•ã€‚ è¿™æ—¶ï¼ŒObject.getOwnPropertyDescriptorsæ–¹æ³•é…åˆObject.definePropertiesæ–¹æ³•ï¼Œå°±å¯ä»¥å®ç°æ­£ç¡®æ‹·è´ã€‚ 12345678910111213const source = &#123; set foo(value) &#123; console.log(value); &#125;&#125;;const target2 = &#123;&#125;;Object.defineProperties(target2, Object.getOwnPropertyDescriptors(source));Object.getOwnPropertyDescriptor(target2, 'foo')// &#123; get: undefined,// set: [Function: foo],// enumerable: true,// configurable: true &#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå°†ä¸¤ä¸ªå¯¹è±¡åˆå¹¶çš„é€»è¾‘æç‚¼å‡ºæ¥ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·ã€‚ 1234const shallowMerge = (target, source) =&gt; Object.defineProperties( target, Object.getOwnPropertyDescriptors(source)); Object.getOwnPropertyDescriptorsæ–¹æ³•çš„å¦ä¸€ä¸ªç”¨å¤„ï¼Œæ˜¯é…åˆObject.createæ–¹æ³•ï¼Œå°†å¯¹è±¡å±æ€§å…‹éš†åˆ°ä¸€ä¸ªæ–°å¯¹è±¡ã€‚è¿™å±äºæµ…æ‹·è´ã€‚ 123456789const clone = Object.create(Object.getPrototypeOf(obj), Object.getOwnPropertyDescriptors(obj));// æˆ–è€…const shallowClone = (obj) =&gt; Object.create( Object.getPrototypeOf(obj), Object.getOwnPropertyDescriptors(obj)); ä¸Šé¢ä»£ç ä¼šå…‹éš†å¯¹è±¡objã€‚ å¦å¤–ï¼ŒObject.getOwnPropertyDescriptorsæ–¹æ³•å¯ä»¥å®ç°ï¼Œä¸€ä¸ªå¯¹è±¡ç»§æ‰¿å¦ä¸€ä¸ªå¯¹è±¡ã€‚ä»¥å‰ï¼Œç»§æ‰¿å¦ä¸€ä¸ªå¯¹è±¡ï¼Œå¸¸å¸¸å†™æˆä¸‹é¢è¿™æ ·ã€‚ 1234const obj = &#123; __proto__: prot, foo: 123,&#125;; ES6è§„å®š__proto__åªæœ‰æµè§ˆå™¨è¦éƒ¨ç½²ï¼Œå…¶ä»–ç¯å¢ƒä¸ç”¨éƒ¨ç½²ã€‚å¦‚æœå»é™¤__proto__ï¼Œä¸Šé¢ä»£ç å°±è¦æ”¹æˆä¸‹é¢è¿™æ ·ã€‚ 1234567891011const obj = Object.create(prot);obj.foo = 123;// æˆ–è€…const obj = Object.assign( Object.create(prot), &#123; foo: 123, &#125;); æœ‰äº†Object.getOwnPropertyDescriptorsï¼Œæˆ‘ä»¬å°±æœ‰äº†å¦ä¸€ç§å†™æ³•ã€‚ 123456const obj = Object.create( prot, Object.getOwnPropertyDescriptors(&#123; foo: 123, &#125;)); Object.getOwnPropertyDescriptorsä¹Ÿå¯ä»¥ç”¨æ¥å®ç°Mixinï¼ˆæ··å…¥ï¼‰æ¨¡å¼ã€‚ 123456789101112let mix = (object) =&gt; (&#123; with: (...mixins) =&gt; mixins.reduce( (c, mixin) =&gt; Object.create( c, Object.getOwnPropertyDescriptors(mixin) ), object)&#125;);// multiple mixins examplelet a = &#123;a: 'a'&#125;;let b = &#123;b: 'b'&#125;;let c = &#123;c: 'c'&#125;;let d = mix(c).with(a, b); ä¸Šé¢ä»£ç ä¸­ï¼Œå¯¹è±¡aå’Œbè¢«æ··å…¥äº†å¯¹è±¡cã€‚ å‡ºäºå®Œæ•´æ€§çš„è€ƒè™‘ï¼ŒObject.getOwnPropertyDescriptorsè¿›å…¥æ ‡å‡†ä»¥åï¼Œè¿˜ä¼šæœ‰Reflect.getOwnPropertyDescriptorsæ–¹æ³•ã€‚","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"Object","slug":"Object","permalink":"http://microzz.com/tags/Object/"}]},{"title":"å‡½æ•°çš„æ‰©å±•(Function)","date":"2016-12-10T07:45:19.000Z","path":"2016/12/10/function/","text":"å‡½æ•°çš„æ‰©å±•å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼åŸºæœ¬ç”¨æ³•åœ¨ES6ä¹‹å‰ï¼Œä¸èƒ½ç›´æ¥ä¸ºå‡½æ•°çš„å‚æ•°æŒ‡å®šé»˜è®¤å€¼ï¼Œåªèƒ½é‡‡ç”¨å˜é€šçš„æ–¹æ³•ã€‚ 12345678function log(x, y) &#123; y = y || 'World'; console.log(x, y);&#125;log('Hello') // Hello Worldlog('Hello', 'China') // Hello Chinalog('Hello', '') // Hello World ä¸Šé¢ä»£ç æ£€æŸ¥å‡½æ•°logçš„å‚æ•°yæœ‰æ²¡æœ‰èµ‹å€¼ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æŒ‡å®šé»˜è®¤å€¼ä¸ºWorldã€‚è¿™ç§å†™æ³•çš„ç¼ºç‚¹åœ¨äºï¼Œå¦‚æœå‚æ•°yèµ‹å€¼äº†ï¼Œä½†æ˜¯å¯¹åº”çš„å¸ƒå°”å€¼ä¸ºfalseï¼Œåˆ™è¯¥èµ‹å€¼ä¸èµ·ä½œç”¨ã€‚å°±åƒä¸Šé¢ä»£ç çš„æœ€åä¸€è¡Œï¼Œå‚æ•°yç­‰äºç©ºå­—ç¬¦ï¼Œç»“æœè¢«æ”¹ä¸ºé»˜è®¤å€¼ã€‚ ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œé€šå¸¸éœ€è¦å…ˆåˆ¤æ–­ä¸€ä¸‹å‚æ•°yæ˜¯å¦è¢«èµ‹å€¼ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå†ç­‰äºé»˜è®¤å€¼ã€‚ 123if (typeof y === 'undefined') &#123; y = 'World';&#125; ES6å…è®¸ä¸ºå‡½æ•°çš„å‚æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œå³ç›´æ¥å†™åœ¨å‚æ•°å®šä¹‰çš„åé¢ã€‚ 1234567function log(x, y = 'World') &#123; console.log(x, y);&#125;log('Hello') // Hello Worldlog('Hello', 'China') // Hello Chinalog('Hello', '') // Hello å¯ä»¥çœ‹åˆ°ï¼ŒES6çš„å†™æ³•æ¯”ES5ç®€æ´è®¸å¤šï¼Œè€Œä¸”éå¸¸è‡ªç„¶ã€‚ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚ 1234567function Point(x = 0, y = 0) &#123; this.x = x; this.y = y;&#125;var p = new Point();p // &#123; x: 0, y: 0 &#125; é™¤äº†ç®€æ´ï¼ŒES6çš„å†™æ³•è¿˜æœ‰ä¸¤ä¸ªå¥½å¤„ï¼šé¦–å…ˆï¼Œé˜…è¯»ä»£ç çš„äººï¼Œå¯ä»¥ç«‹åˆ»æ„è¯†åˆ°å“ªäº›å‚æ•°æ˜¯å¯ä»¥çœç•¥çš„ï¼Œä¸ç”¨æŸ¥çœ‹å‡½æ•°ä½“æˆ–æ–‡æ¡£ï¼›å…¶æ¬¡ï¼Œæœ‰åˆ©äºå°†æ¥çš„ä»£ç ä¼˜åŒ–ï¼Œå³ä½¿æœªæ¥çš„ç‰ˆæœ¬åœ¨å¯¹å¤–æ¥å£ä¸­ï¼Œå½»åº•æ‹¿æ‰è¿™ä¸ªå‚æ•°ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´ä»¥å‰çš„ä»£ç æ— æ³•è¿è¡Œã€‚ å‚æ•°å˜é‡æ˜¯é»˜è®¤å£°æ˜çš„ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨letæˆ–constå†æ¬¡å£°æ˜ã€‚ 1234function foo(x = 5) &#123; let x = 1; // error const x = 2; // error&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå‚æ•°å˜é‡xæ˜¯é»˜è®¤å£°æ˜çš„ï¼Œåœ¨å‡½æ•°ä½“ä¸­ï¼Œä¸èƒ½ç”¨letæˆ–constå†æ¬¡å£°æ˜ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ ä¸è§£æ„èµ‹å€¼é»˜è®¤å€¼ç»“åˆä½¿ç”¨å‚æ•°é»˜è®¤å€¼å¯ä»¥ä¸è§£æ„èµ‹å€¼çš„é»˜è®¤å€¼ï¼Œç»“åˆèµ·æ¥ä½¿ç”¨ã€‚ 12345678function foo(&#123;x, y = 5&#125;) &#123; console.log(x, y);&#125;foo(&#123;&#125;) // undefined, 5foo(&#123;x: 1&#125;) // 1, 5foo(&#123;x: 1, y: 2&#125;) // 1, 2foo() // TypeError: Cannot read property 'x' of undefined ä¸Šé¢ä»£ç ä½¿ç”¨äº†å¯¹è±¡çš„è§£æ„èµ‹å€¼é»˜è®¤å€¼ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼ã€‚åªæœ‰å½“å‡½æ•°fooçš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå˜é‡xå’Œyæ‰ä¼šé€šè¿‡è§£æ„èµ‹å€¼è€Œç”Ÿæˆã€‚å¦‚æœå‡½æ•°fooè°ƒç”¨æ—¶å‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œå˜é‡xå’Œyå°±ä¸ä¼šç”Ÿæˆï¼Œä»è€ŒæŠ¥é”™ã€‚å¦‚æœå‚æ•°å¯¹è±¡æ²¡æœ‰yå±æ€§ï¼Œyçš„é»˜è®¤å€¼5æ‰ä¼šç”Ÿæ•ˆã€‚ ä¸‹é¢æ˜¯å¦ä¸€ä¸ªå¯¹è±¡çš„è§£æ„èµ‹å€¼é»˜è®¤å€¼çš„ä¾‹å­ã€‚ 123456789function fetch(url, &#123; body = '', method = 'GET', headers = &#123;&#125; &#125;) &#123; console.log(method);&#125;fetch('http://example.com', &#123;&#125;)// \"GET\"fetch('http://example.com')// æŠ¥é”™ ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœå‡½æ•°fetchçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±å¯ä»¥ä¸ºå®ƒçš„ä¸‰ä¸ªå±æ€§è®¾ç½®é»˜è®¤å€¼ã€‚ ä¸Šé¢çš„å†™æ³•ä¸èƒ½çœç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¦‚æœç»“åˆå‡½æ•°å‚æ•°çš„é»˜è®¤å€¼ï¼Œå°±å¯ä»¥çœç•¥ç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™æ—¶ï¼Œå°±å‡ºç°äº†åŒé‡é»˜è®¤å€¼ã€‚ 123456function fetch(url, &#123; method = 'GET' &#125; = &#123;&#125;) &#123; console.log(method);&#125;fetch('http://example.com')// \"GET\" ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°fetchæ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°æ—¶ï¼Œå‡½æ•°å‚æ•°çš„é»˜è®¤å€¼å°±ä¼šç”Ÿæ•ˆï¼Œç„¶åæ‰æ˜¯è§£æ„èµ‹å€¼çš„é»˜è®¤å€¼ç”Ÿæ•ˆï¼Œå˜é‡methodæ‰ä¼šå–åˆ°é»˜è®¤å€¼GETã€‚ å†è¯·é—®ä¸‹é¢ä¸¤ç§å†™æ³•æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ 123456789// å†™æ³•ä¸€function m1(&#123;x = 0, y = 0&#125; = &#123;&#125;) &#123; return [x, y];&#125;// å†™æ³•äºŒfunction m2(&#123;x, y&#125; = &#123; x: 0, y: 0 &#125;) &#123; return [x, y];&#125; ä¸Šé¢ä¸¤ç§å†™æ³•éƒ½å¯¹å‡½æ•°çš„å‚æ•°è®¾å®šäº†é»˜è®¤å€¼ï¼ŒåŒºåˆ«æ˜¯å†™æ³•ä¸€å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼æ˜¯ç©ºå¯¹è±¡ï¼Œä½†æ˜¯è®¾ç½®äº†å¯¹è±¡è§£æ„èµ‹å€¼çš„é»˜è®¤å€¼ï¼›å†™æ³•äºŒå‡½æ•°å‚æ•°çš„é»˜è®¤å€¼æ˜¯ä¸€ä¸ªæœ‰å…·ä½“å±æ€§çš„å¯¹è±¡ï¼Œä½†æ˜¯æ²¡æœ‰è®¾ç½®å¯¹è±¡è§£æ„èµ‹å€¼çš„é»˜è®¤å€¼ã€‚ 123456789101112131415161718// å‡½æ•°æ²¡æœ‰å‚æ•°çš„æƒ…å†µm1() // [0, 0]m2() // [0, 0]// xå’Œyéƒ½æœ‰å€¼çš„æƒ…å†µm1(&#123;x: 3, y: 8&#125;) // [3, 8]m2(&#123;x: 3, y: 8&#125;) // [3, 8]// xæœ‰å€¼ï¼Œyæ— å€¼çš„æƒ…å†µm1(&#123;x: 3&#125;) // [3, 0]m2(&#123;x: 3&#125;) // [3, undefined]// xå’Œyéƒ½æ— å€¼çš„æƒ…å†µm1(&#123;&#125;) // [0, 0];m2(&#123;&#125;) // [undefined, undefined]m1(&#123;z: 3&#125;) // [0, 0]m2(&#123;z: 3&#125;) // [undefined, undefined] å‚æ•°é»˜è®¤å€¼çš„ä½ç½®é€šå¸¸æƒ…å†µä¸‹ï¼Œå®šä¹‰äº†é»˜è®¤å€¼çš„å‚æ•°ï¼Œåº”è¯¥æ˜¯å‡½æ•°çš„å°¾å‚æ•°ã€‚å› ä¸ºè¿™æ ·æ¯”è¾ƒå®¹æ˜“çœ‹å‡ºæ¥ï¼Œåˆ°åº•çœç•¥äº†å“ªäº›å‚æ•°ã€‚å¦‚æœéå°¾éƒ¨çš„å‚æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œå®é™…ä¸Šè¿™ä¸ªå‚æ•°æ˜¯æ²¡æ³•çœç•¥çš„ã€‚ 12345678910111213141516171819// ä¾‹ä¸€function f(x = 1, y) &#123; return [x, y];&#125;f() // [1, undefined]f(2) // [2, undefined])f(, 1) // æŠ¥é”™f(undefined, 1) // [1, 1]// ä¾‹äºŒfunction f(x, y = 5, z) &#123; return [x, y, z];&#125;f() // [undefined, 5, undefined]f(1) // [1, 5, undefined]f(1, ,2) // æŠ¥é”™f(1, undefined, 2) // [1, 5, 2] ä¸Šé¢ä»£ç ä¸­ï¼Œæœ‰é»˜è®¤å€¼çš„å‚æ•°éƒ½ä¸æ˜¯å°¾å‚æ•°ã€‚è¿™æ—¶ï¼Œæ— æ³•åªçœç•¥è¯¥å‚æ•°ï¼Œè€Œä¸çœç•¥å®ƒåé¢çš„å‚æ•°ï¼Œé™¤éæ˜¾å¼è¾“å…¥undefinedã€‚ å¦‚æœä¼ å…¥undefinedï¼Œå°†è§¦å‘è¯¥å‚æ•°ç­‰äºé»˜è®¤å€¼ï¼Œnullåˆ™æ²¡æœ‰è¿™ä¸ªæ•ˆæœã€‚ 123456function foo(x = 5, y = 6) &#123; console.log(x, y);&#125;foo(undefined, null)// 5 null ä¸Šé¢ä»£ç ä¸­ï¼Œxå‚æ•°å¯¹åº”undefinedï¼Œç»“æœè§¦å‘äº†é»˜è®¤å€¼ï¼Œyå‚æ•°ç­‰äºnullï¼Œå°±æ²¡æœ‰è§¦å‘é»˜è®¤å€¼ã€‚ å‡½æ•°çš„lengthå±æ€§æŒ‡å®šäº†é»˜è®¤å€¼ä»¥åï¼Œå‡½æ•°çš„lengthå±æ€§ï¼Œå°†è¿”å›æ²¡æœ‰æŒ‡å®šé»˜è®¤å€¼çš„å‚æ•°ä¸ªæ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŒ‡å®šäº†é»˜è®¤å€¼åï¼Œlengthå±æ€§å°†å¤±çœŸã€‚ 123(function (a) &#123;&#125;).length // 1(function (a = 5) &#123;&#125;).length // 0(function (a, b, c = 5) &#123;&#125;).length // 2 ä¸Šé¢ä»£ç ä¸­ï¼Œlengthå±æ€§çš„è¿”å›å€¼ï¼Œç­‰äºå‡½æ•°çš„å‚æ•°ä¸ªæ•°å‡å»æŒ‡å®šäº†é»˜è®¤å€¼çš„å‚æ•°ä¸ªæ•°ã€‚æ¯”å¦‚ï¼Œä¸Šé¢æœ€åä¸€ä¸ªå‡½æ•°ï¼Œå®šä¹‰äº†3ä¸ªå‚æ•°ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå‚æ•°cæŒ‡å®šäº†é»˜è®¤å€¼ï¼Œå› æ­¤lengthå±æ€§ç­‰äº3å‡å»1ï¼Œæœ€åå¾—åˆ°2ã€‚ è¿™æ˜¯å› ä¸ºlengthå±æ€§çš„å«ä¹‰æ˜¯ï¼Œè¯¥å‡½æ•°é¢„æœŸä¼ å…¥çš„å‚æ•°ä¸ªæ•°ã€‚æŸä¸ªå‚æ•°æŒ‡å®šé»˜è®¤å€¼ä»¥åï¼Œé¢„æœŸä¼ å…¥çš„å‚æ•°ä¸ªæ•°å°±ä¸åŒ…æ‹¬è¿™ä¸ªå‚æ•°äº†ã€‚åŒç†ï¼Œrestå‚æ•°ä¹Ÿä¸ä¼šè®¡å…¥lengthå±æ€§ã€‚ 1(function(...args) &#123;&#125;).length // 0 å¦‚æœè®¾ç½®äº†é»˜è®¤å€¼çš„å‚æ•°ä¸æ˜¯å°¾å‚æ•°ï¼Œé‚£ä¹ˆlengthå±æ€§ä¹Ÿä¸å†è®¡å…¥åé¢çš„å‚æ•°äº†ã€‚ 12(function (a = 0, b, c) &#123;&#125;).length // 0(function (a, b = 1, c) &#123;&#125;).length // 1 ä½œç”¨åŸŸä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œå¦‚æœå‚æ•°é»˜è®¤å€¼æ˜¯ä¸€ä¸ªå˜é‡ï¼Œåˆ™è¯¥å˜é‡æ‰€å¤„çš„ä½œç”¨åŸŸï¼Œä¸å…¶ä»–å˜é‡çš„ä½œç”¨åŸŸè§„åˆ™æ˜¯ä¸€æ ·çš„ï¼Œå³å…ˆæ˜¯å½“å‰å‡½æ•°çš„ä½œç”¨åŸŸï¼Œç„¶åæ‰æ˜¯å…¨å±€ä½œç”¨åŸŸã€‚ 1234567var x = 1;function f(x, y = x) &#123; console.log(y);&#125;f(2) // 2 ä¸Šé¢ä»£ç ä¸­ï¼Œå‚æ•°yçš„é»˜è®¤å€¼ç­‰äºxã€‚è°ƒç”¨æ—¶ï¼Œç”±äºå‡½æ•°ä½œç”¨åŸŸå†…éƒ¨çš„å˜é‡xå·²ç»ç”Ÿæˆï¼Œæ‰€ä»¥yç­‰äºå‚æ•°xï¼Œè€Œä¸æ˜¯å…¨å±€å˜é‡xã€‚ å¦‚æœè°ƒç”¨æ—¶ï¼Œå‡½æ•°ä½œç”¨åŸŸå†…éƒ¨çš„å˜é‡xæ²¡æœ‰ç”Ÿæˆï¼Œç»“æœå°±ä¼šä¸ä¸€æ ·ã€‚ 12345678let x = 1;function f(y = x) &#123; let x = 2; console.log(y);&#125;f() // 1 ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°è°ƒç”¨æ—¶ï¼Œyçš„é»˜è®¤å€¼å˜é‡xå°šæœªåœ¨å‡½æ•°å†…éƒ¨ç”Ÿæˆï¼Œæ‰€ä»¥xæŒ‡å‘å…¨å±€å˜é‡ã€‚ å¦‚æœæ­¤æ—¶ï¼Œå…¨å±€å˜é‡xä¸å­˜åœ¨ï¼Œå°±ä¼šæŠ¥é”™ã€‚ 123456function f(y = x) &#123; let x = 2; console.log(y);&#125;f() // ReferenceError: x is not defined ä¸‹é¢è¿™æ ·å†™ï¼Œä¹Ÿä¼šæŠ¥é”™ã€‚ 1234567var x = 1;function foo(x = x) &#123; // ...&#125;foo() // ReferenceError: x is not defined ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°fooçš„å‚æ•°xçš„é»˜è®¤å€¼ä¹Ÿæ˜¯xã€‚è¿™æ—¶ï¼Œé»˜è®¤å€¼xçš„ä½œç”¨åŸŸæ˜¯å‡½æ•°ä½œç”¨åŸŸï¼Œè€Œä¸æ˜¯å…¨å±€ä½œç”¨åŸŸã€‚ç”±äºåœ¨å‡½æ•°ä½œç”¨åŸŸä¸­ï¼Œå­˜åœ¨å˜é‡xï¼Œä½†æ˜¯é»˜è®¤å€¼åœ¨xèµ‹å€¼ä¹‹å‰å…ˆæ‰§è¡Œäº†ï¼Œæ‰€ä»¥è¿™æ—¶å±äºæš‚æ—¶æ€§æ­»åŒºï¼ˆå‚è§ã€Šletå’Œconstå‘½ä»¤ã€‹ä¸€ç« ï¼‰ï¼Œä»»ä½•å¯¹xçš„æ“ä½œéƒ½ä¼šæŠ¥é”™ã€‚ å¦‚æœå‚æ•°çš„é»˜è®¤å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ä½œç”¨åŸŸæ˜¯å…¶å£°æ˜æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚ 12345678let foo = 'outer';function bar(func = x =&gt; foo) &#123; let foo = 'inner'; console.log(func()); // outer&#125;bar(); ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°barçš„å‚æ•°funcçš„é»˜è®¤å€¼æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¿”å›å€¼ä¸ºå˜é‡fooã€‚è¿™ä¸ªåŒ¿åå‡½æ•°å£°æ˜æ—¶ï¼Œbarå‡½æ•°çš„ä½œç”¨åŸŸè¿˜æ²¡æœ‰å½¢æˆï¼Œæ‰€ä»¥åŒ¿åå‡½æ•°é‡Œé¢çš„fooæŒ‡å‘å¤–å±‚ä½œç”¨åŸŸçš„fooï¼Œè¾“å‡ºouterã€‚ å¦‚æœå†™æˆä¸‹é¢è¿™æ ·ï¼Œå°±ä¼šæŠ¥é”™ã€‚ 123456function bar(func = () =&gt; foo) &#123; let foo = 'inner'; console.log(func());&#125;bar() // ReferenceError: foo is not defined ä¸Šé¢ä»£ç ä¸­ï¼ŒåŒ¿åå‡½æ•°é‡Œé¢çš„fooæŒ‡å‘å‡½æ•°å¤–å±‚ï¼Œä½†æ˜¯å‡½æ•°å¤–å±‚å¹¶æ²¡æœ‰å£°æ˜fooï¼Œæ‰€ä»¥å°±æŠ¥é”™äº†ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ã€‚ 12345678var x = 1;function foo(x, y = function() &#123; x = 2; &#125;) &#123; var x = 3; y(); console.log(x);&#125;foo() // 3 ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°fooçš„å‚æ•°yçš„é»˜è®¤å€¼æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ã€‚å‡½æ•°fooè°ƒç”¨æ—¶ï¼Œå®ƒçš„å‚æ•°xçš„å€¼ä¸ºundefinedï¼Œæ‰€ä»¥yå‡½æ•°å†…éƒ¨çš„xä¸€å¼€å§‹æ˜¯undefinedï¼Œåæ¥è¢«é‡æ–°èµ‹å€¼2ã€‚ä½†æ˜¯ï¼Œå‡½æ•°fooå†…éƒ¨é‡æ–°å£°æ˜äº†ä¸€ä¸ªxï¼Œå€¼ä¸º3ï¼Œè¿™ä¸¤ä¸ªxæ˜¯ä¸ä¸€æ ·çš„ï¼Œäº’ç›¸ä¸äº§ç”Ÿå½±å“ï¼Œå› æ­¤æœ€åè¾“å‡º3ã€‚ å¦‚æœå°†var x = 3çš„varå»é™¤ï¼Œä¸¤ä¸ªxå°±æ˜¯ä¸€æ ·çš„ï¼Œæœ€åè¾“å‡ºçš„å°±æ˜¯2ã€‚ 12345678var x = 1;function foo(x, y = function() &#123; x = 2; &#125;) &#123; x = 3; y(); console.log(x);&#125;foo() // 2 åº”ç”¨åˆ©ç”¨å‚æ•°é»˜è®¤å€¼ï¼Œå¯ä»¥æŒ‡å®šæŸä¸€ä¸ªå‚æ•°ä¸å¾—çœç•¥ï¼Œå¦‚æœçœç•¥å°±æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ 12345678910function throwIfMissing() &#123; throw new Error('Missing parameter');&#125;function foo(mustBeProvided = throwIfMissing()) &#123; return mustBeProvided;&#125;foo()// Error: Missing parameter ä¸Šé¢ä»£ç çš„fooå‡½æ•°ï¼Œå¦‚æœè°ƒç”¨çš„æ—¶å€™æ²¡æœ‰å‚æ•°ï¼Œå°±ä¼šè°ƒç”¨é»˜è®¤å€¼throwIfMissingå‡½æ•°ï¼Œä»è€ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ ä»ä¸Šé¢ä»£ç è¿˜å¯ä»¥çœ‹åˆ°ï¼Œå‚æ•°mustBeProvidedçš„é»˜è®¤å€¼ç­‰äºthrowIfMissingå‡½æ•°çš„è¿è¡Œç»“æœï¼ˆå³å‡½æ•°åä¹‹åæœ‰ä¸€å¯¹åœ†æ‹¬å·ï¼‰ï¼Œè¿™è¡¨æ˜å‚æ•°çš„é»˜è®¤å€¼ä¸æ˜¯åœ¨å®šä¹‰æ—¶æ‰§è¡Œï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶æ‰§è¡Œï¼ˆå³å¦‚æœå‚æ•°å·²ç»èµ‹å€¼ï¼Œé»˜è®¤å€¼ä¸­çš„å‡½æ•°å°±ä¸ä¼šè¿è¡Œï¼‰ï¼Œè¿™ä¸pythonè¯­è¨€ä¸ä¸€æ ·ã€‚ å¦å¤–ï¼Œå¯ä»¥å°†å‚æ•°é»˜è®¤å€¼è®¾ä¸ºundefinedï¼Œè¡¨æ˜è¿™ä¸ªå‚æ•°æ˜¯å¯ä»¥çœç•¥çš„ã€‚ 1function foo(optional = undefined) &#123; Â·Â·Â· &#125; restå‚æ•°ES6å¼•å…¥restå‚æ•°ï¼ˆå½¢å¼ä¸ºâ€œâ€¦å˜é‡åâ€ï¼‰ï¼Œç”¨äºè·å–å‡½æ•°çš„å¤šä½™å‚æ•°ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä½¿ç”¨argumentså¯¹è±¡äº†ã€‚restå‚æ•°æ­é…çš„å˜é‡æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥å˜é‡å°†å¤šä½™çš„å‚æ•°æ”¾å…¥æ•°ç»„ä¸­ã€‚ 1234567891011function add(...values) &#123; let sum = 0; for (var val of values) &#123; sum += val; &#125; return sum;&#125;add(2, 5, 3) // 10 ä¸Šé¢ä»£ç çš„addå‡½æ•°æ˜¯ä¸€ä¸ªæ±‚å’Œå‡½æ•°ï¼Œåˆ©ç”¨restå‚æ•°ï¼Œå¯ä»¥å‘è¯¥å‡½æ•°ä¼ å…¥ä»»æ„æ•°ç›®çš„å‚æ•°ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªrestå‚æ•°ä»£æ›¿argumentså˜é‡çš„ä¾‹å­ã€‚ 1234567// argumentså˜é‡çš„å†™æ³•function sortNumbers() &#123; return Array.prototype.slice.call(arguments).sort();&#125;// restå‚æ•°çš„å†™æ³•const sortNumbers = (...numbers) =&gt; numbers.sort(); ä¸Šé¢ä»£ç çš„ä¸¤ç§å†™æ³•ï¼Œæ¯”è¾ƒåå¯ä»¥å‘ç°ï¼Œrestå‚æ•°çš„å†™æ³•æ›´è‡ªç„¶ä¹Ÿæ›´ç®€æ´ã€‚ restå‚æ•°ä¸­çš„å˜é‡ä»£è¡¨ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥æ•°ç»„ç‰¹æœ‰çš„æ–¹æ³•éƒ½å¯ä»¥ç”¨äºè¿™ä¸ªå˜é‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ©ç”¨restå‚æ•°æ”¹å†™æ•°ç»„pushæ–¹æ³•çš„ä¾‹å­ã€‚ 123456789function push(array, ...items) &#123; items.forEach(function(item) &#123; array.push(item); console.log(item); &#125;);&#125;var a = [];push(a, 1, 2, 3) æ³¨æ„ï¼Œrestå‚æ•°ä¹‹åä¸èƒ½å†æœ‰å…¶ä»–å‚æ•°ï¼ˆå³åªèƒ½æ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ 1234// æŠ¥é”™function f(a, ...b, c) &#123; // ...&#125; å‡½æ•°çš„lengthå±æ€§ï¼Œä¸åŒ…æ‹¬restå‚æ•°ã€‚ 123(function(a) &#123;&#125;).length // 1(function(...a) &#123;&#125;).length // 0(function(a, ...b) &#123;&#125;).length // 1 æ‰©å±•è¿ç®—ç¬¦å«ä¹‰æ‰©å±•è¿ç®—ç¬¦ï¼ˆspreadï¼‰æ˜¯ä¸‰ä¸ªç‚¹ï¼ˆ...ï¼‰ã€‚å®ƒå¥½æ¯”restå‚æ•°çš„é€†è¿ç®—ï¼Œå°†ä¸€ä¸ªæ•°ç»„è½¬ä¸ºç”¨é€—å·åˆ†éš”çš„å‚æ•°åºåˆ—ã€‚ 12345678console.log(...[1, 2, 3])// 1 2 3console.log(1, ...[2, 3, 4], 5)// 1 2 3 4 5[...document.querySelectorAll('div')]// [&lt;div&gt;, &lt;div&gt;, &lt;div&gt;] è¯¥è¿ç®—ç¬¦ä¸»è¦ç”¨äºå‡½æ•°è°ƒç”¨ã€‚ 12345678910function push(array, ...items) &#123; array.push(...items);&#125;function add(x, y) &#123; return x + y;&#125;var numbers = [4, 38];add(...numbers) // 42 ä¸Šé¢ä»£ç ä¸­ï¼Œarray.push(...items)å’Œadd(...numbers)è¿™ä¸¤è¡Œï¼Œéƒ½æ˜¯å‡½æ•°çš„è°ƒç”¨ï¼Œå®ƒä»¬çš„éƒ½ä½¿ç”¨äº†æ‰©å±•è¿ç®—ç¬¦ã€‚è¯¥è¿ç®—ç¬¦å°†ä¸€ä¸ªæ•°ç»„ï¼Œå˜ä¸ºå‚æ•°åºåˆ—ã€‚ æ‰©å±•è¿ç®—ç¬¦ä¸æ­£å¸¸çš„å‡½æ•°å‚æ•°å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œéå¸¸çµæ´»ã€‚ 123function f(v, w, x, y, z) &#123; &#125;var args = [0, 1];f(-1, ...args, 2, ...[3]); æ›¿ä»£æ•°ç»„çš„applyæ–¹æ³•ç”±äºæ‰©å±•è¿ç®—ç¬¦å¯ä»¥å±•å¼€æ•°ç»„ï¼Œæ‰€ä»¥ä¸å†éœ€è¦applyæ–¹æ³•ï¼Œå°†æ•°ç»„è½¬ä¸ºå‡½æ•°çš„å‚æ•°äº†ã€‚ 12345678910111213// ES5çš„å†™æ³•function f(x, y, z) &#123; // ...&#125;var args = [0, 1, 2];f.apply(null, args);// ES6çš„å†™æ³•function f(x, y, z) &#123; // ...&#125;var args = [0, 1, 2];f(...args); ä¸‹é¢æ˜¯æ‰©å±•è¿ç®—ç¬¦å–ä»£applyæ–¹æ³•çš„ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œåº”ç”¨Math.maxæ–¹æ³•ï¼Œç®€åŒ–æ±‚å‡ºä¸€ä¸ªæ•°ç»„æœ€å¤§å…ƒç´ çš„å†™æ³•ã€‚ 12345678// ES5çš„å†™æ³•Math.max.apply(null, [14, 3, 77])// ES6çš„å†™æ³•Math.max(...[14, 3, 77])// ç­‰åŒäºMath.max(14, 3, 77); ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œç”±äºJavaScriptä¸æä¾›æ±‚æ•°ç»„æœ€å¤§å…ƒç´ çš„å‡½æ•°ï¼Œæ‰€ä»¥åªèƒ½å¥—ç”¨Math.maxå‡½æ•°ï¼Œå°†æ•°ç»„è½¬ä¸ºä¸€ä¸ªå‚æ•°åºåˆ—ï¼Œç„¶åæ±‚æœ€å¤§å€¼ã€‚æœ‰äº†æ‰©å±•è¿ç®—ç¬¦ä»¥åï¼Œå°±å¯ä»¥ç›´æ¥ç”¨Math.maxäº†ã€‚ å¦ä¸€ä¸ªä¾‹å­æ˜¯é€šè¿‡pushå‡½æ•°ï¼Œå°†ä¸€ä¸ªæ•°ç»„æ·»åŠ åˆ°å¦ä¸€ä¸ªæ•°ç»„çš„å°¾éƒ¨ã€‚ 123456789// ES5çš„å†™æ³•var arr1 = [0, 1, 2];var arr2 = [3, 4, 5];Array.prototype.push.apply(arr1, arr2);// ES6çš„å†™æ³•var arr1 = [0, 1, 2];var arr2 = [3, 4, 5];arr1.push(...arr2); ä¸Šé¢ä»£ç çš„ES5å†™æ³•ä¸­ï¼Œpushæ–¹æ³•çš„å‚æ•°ä¸èƒ½æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥åªå¥½é€šè¿‡applyæ–¹æ³•å˜é€šä½¿ç”¨pushæ–¹æ³•ã€‚æœ‰äº†æ‰©å±•è¿ç®—ç¬¦ï¼Œå°±å¯ä»¥ç›´æ¥å°†æ•°ç»„ä¼ å…¥pushæ–¹æ³•ã€‚ ä¸‹é¢æ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ã€‚ 1234// ES5new (Date.bind.apply(Date, [null, 2015, 1, 1]))// ES6new Date(...[2015, 1, 1]); æ‰©å±•è¿ç®—ç¬¦çš„åº”ç”¨ï¼ˆ1ï¼‰åˆå¹¶æ•°ç»„ æ‰©å±•è¿ç®—ç¬¦æä¾›äº†æ•°ç»„åˆå¹¶çš„æ–°å†™æ³•ã€‚ 12345678910111213141516// ES5[1, 2].concat(more)// ES6[1, 2, ...more]var arr1 = ['a', 'b'];var arr2 = ['c'];var arr3 = ['d', 'e'];// ES5çš„åˆå¹¶æ•°ç»„arr1.concat(arr2, arr3);// [ 'a', 'b', 'c', 'd', 'e' ]// ES6çš„åˆå¹¶æ•°ç»„[...arr1, ...arr2, ...arr3]// [ 'a', 'b', 'c', 'd', 'e' ] ï¼ˆ2ï¼‰ä¸è§£æ„èµ‹å€¼ç»“åˆ æ‰©å±•è¿ç®—ç¬¦å¯ä»¥ä¸è§£æ„èµ‹å€¼ç»“åˆèµ·æ¥ï¼Œç”¨äºç”Ÿæˆæ•°ç»„ã€‚ 1234// ES5a = list[0], rest = list.slice(1)// ES6[a, ...rest] = list ä¸‹é¢æ˜¯å¦å¤–ä¸€äº›ä¾‹å­ã€‚ 1234567891011const [first, ...rest] = [1, 2, 3, 4, 5];first // 1rest // [2, 3, 4, 5]const [first, ...rest] = [];first // undefinedrest // []:const [first, ...rest] = [\"foo\"];first // \"foo\"rest // [] å¦‚æœå°†æ‰©å±•è¿ç®—ç¬¦ç”¨äºæ•°ç»„èµ‹å€¼ï¼Œåªèƒ½æ”¾åœ¨å‚æ•°çš„æœ€åä¸€ä½ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ 12345const [...butLast, last] = [1, 2, 3, 4, 5];// æŠ¥é”™const [first, ...middle, last] = [1, 2, 3, 4, 5];// æŠ¥é”™ ï¼ˆ3ï¼‰å‡½æ•°çš„è¿”å›å€¼ JavaScriptçš„å‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¦‚æœéœ€è¦è¿”å›å¤šä¸ªå€¼ï¼Œåªèƒ½è¿”å›æ•°ç»„æˆ–å¯¹è±¡ã€‚æ‰©å±•è¿ç®—ç¬¦æä¾›äº†è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§å˜é€šæ–¹æ³•ã€‚ 12var dateFields = readDateFields(database);var d = new Date(...dateFields); ä¸Šé¢ä»£ç ä»æ•°æ®åº“å–å‡ºä¸€è¡Œæ•°æ®ï¼Œé€šè¿‡æ‰©å±•è¿ç®—ç¬¦ï¼Œç›´æ¥å°†å…¶ä¼ å…¥æ„é€ å‡½æ•°Dateã€‚ ï¼ˆ4ï¼‰å­—ç¬¦ä¸² æ‰©å±•è¿ç®—ç¬¦è¿˜å¯ä»¥å°†å­—ç¬¦ä¸²è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚ 12[...'hello']// [ \"h\", \"e\", \"l\", \"l\", \"o\" ] ä¸Šé¢çš„å†™æ³•ï¼Œæœ‰ä¸€ä¸ªé‡è¦çš„å¥½å¤„ï¼Œé‚£å°±æ˜¯èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«32ä½çš„Unicodeå­—ç¬¦ã€‚ 12'x\\uD83D\\uDE80y'.length // 4[...'x\\uD83D\\uDE80y'].length // 3 ä¸Šé¢ä»£ç çš„ç¬¬ä¸€ç§å†™æ³•ï¼ŒJavaScriptä¼šå°†32ä½Unicodeå­—ç¬¦ï¼Œè¯†åˆ«ä¸º2ä¸ªå­—ç¬¦ï¼Œé‡‡ç”¨æ‰©å±•è¿ç®—ç¬¦å°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚å› æ­¤ï¼Œæ­£ç¡®è¿”å›å­—ç¬¦ä¸²é•¿åº¦çš„å‡½æ•°ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·å†™ã€‚ 12345function length(str) &#123; return [...str].length;&#125;length('x\\uD83D\\uDE80y') // 3 å‡¡æ˜¯æ¶‰åŠåˆ°æ“ä½œ32ä½Unicodeå­—ç¬¦çš„å‡½æ•°ï¼Œéƒ½æœ‰è¿™ä¸ªé—®é¢˜ã€‚å› æ­¤ï¼Œæœ€å¥½éƒ½ç”¨æ‰©å±•è¿ç®—ç¬¦æ”¹å†™ã€‚ 1234567let str = 'x\\uD83D\\uDE80y';str.split('').reverse().join('')// 'y\\uDE80\\uD83Dx'[...str].reverse().join('')// 'y\\uD83D\\uDE80x' ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœä¸ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼Œå­—ç¬¦ä¸²çš„reverseæ“ä½œå°±ä¸æ­£ç¡®ã€‚ ï¼ˆ5ï¼‰å®ç°äº†Iteratoræ¥å£çš„å¯¹è±¡ ä»»ä½•Iteratoræ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ç”¨æ‰©å±•è¿ç®—ç¬¦è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚ 12var nodeList = document.querySelectorAll('div');var array = [...nodeList]; ä¸Šé¢ä»£ç ä¸­ï¼ŒquerySelectorAllæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªnodeListå¯¹è±¡ã€‚å®ƒä¸æ˜¯æ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚è¿™æ—¶ï¼Œæ‰©å±•è¿ç®—ç¬¦å¯ä»¥å°†å…¶è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼ŒåŸå› å°±åœ¨äºNodeListå¯¹è±¡å®ç°äº†Iteratoræ¥å£ã€‚ å¯¹äºé‚£äº›æ²¡æœ‰éƒ¨ç½²Iteratoræ¥å£çš„ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œæ‰©å±•è¿ç®—ç¬¦å°±æ— æ³•å°†å…¶è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚ 123456789let arrayLike = &#123; '0': 'a', '1': 'b', '2': 'c', length: 3&#125;;// TypeError: Cannot spread non-iterable object.let arr = [...arrayLike]; ä¸Šé¢ä»£ç ä¸­ï¼ŒarrayLikeæ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œä½†æ˜¯æ²¡æœ‰éƒ¨ç½²Iteratoræ¥å£ï¼Œæ‰©å±•è¿ç®—ç¬¦å°±ä¼šæŠ¥é”™ã€‚è¿™æ—¶ï¼Œå¯ä»¥æ”¹ä¸ºä½¿ç”¨Array.fromæ–¹æ³•å°†arrayLikeè½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚ ï¼ˆ6ï¼‰Mapå’ŒSetç»“æ„ï¼ŒGeneratorå‡½æ•° æ‰©å±•è¿ç®—ç¬¦å†…éƒ¨è°ƒç”¨çš„æ˜¯æ•°æ®ç»“æ„çš„Iteratoræ¥å£ï¼Œå› æ­¤åªè¦å…·æœ‰Iteratoræ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼Œæ¯”å¦‚Mapç»“æ„ã€‚ 1234567let map = new Map([ [1, 'one'], [2, 'two'], [3, 'three'],]);let arr = [...map.keys()]; // [1, 2, 3] Generatorå‡½æ•°è¿è¡Œåï¼Œè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ã€‚ 1234567var go = function*()&#123; yield 1; yield 2; yield 3;&#125;;[...go()] // [1, 2, 3] ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡goæ˜¯ä¸€ä¸ªGeneratorå‡½æ•°ï¼Œæ‰§è¡Œåè¿”å›çš„æ˜¯ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå¯¹è¿™ä¸ªéå†å™¨å¯¹è±¡æ‰§è¡Œæ‰©å±•è¿ç®—ç¬¦ï¼Œå°±ä¼šå°†å†…éƒ¨éå†å¾—åˆ°çš„å€¼ï¼Œè½¬ä¸ºä¸€ä¸ªæ•°ç»„ã€‚ å¦‚æœå¯¹æ²¡æœ‰iteratoræ¥å£çš„å¯¹è±¡ï¼Œä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼Œå°†ä¼šæŠ¥é”™ã€‚ 12var obj = &#123;a: 1, b: 2&#125;;let arr = [...obj]; // TypeError: Cannot spread non-iterable object ä¸¥æ ¼æ¨¡å¼ä»ES5å¼€å§‹ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥è®¾å®šä¸ºä¸¥æ ¼æ¨¡å¼ã€‚ 1234function doSomething(a, b) &#123; 'use strict'; // code&#125; ã€ŠECMAScript 2016æ ‡å‡†ã€‹åšäº†ä¸€ç‚¹ä¿®æ”¹ï¼Œè§„å®šåªè¦å‡½æ•°å‚æ•°ä½¿ç”¨äº†é»˜è®¤å€¼ã€è§£æ„èµ‹å€¼ã€æˆ–è€…æ‰©å±•è¿ç®—ç¬¦ï¼Œé‚£ä¹ˆå‡½æ•°å†…éƒ¨å°±ä¸èƒ½æ˜¾å¼è®¾å®šä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ 12345678910111213141516171819202122232425// æŠ¥é”™function doSomething(a, b = a) &#123; 'use strict'; // code&#125;// æŠ¥é”™const doSomething = function (&#123;a, b&#125;) &#123; 'use strict'; // code&#125;;// æŠ¥é”™const doSomething = (...a) =&gt; &#123; 'use strict'; // code&#125;;const obj = &#123; // æŠ¥é”™ doSomething(&#123;a, b&#125;) &#123; 'use strict'; // code &#125;&#125;; è¿™æ ·è§„å®šçš„åŸå› æ˜¯ï¼Œå‡½æ•°å†…éƒ¨çš„ä¸¥æ ¼æ¨¡å¼ï¼ŒåŒæ—¶é€‚ç”¨äºå‡½æ•°ä½“ä»£ç å’Œå‡½æ•°å‚æ•°ä»£ç ã€‚ä½†æ˜¯ï¼Œå‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œå…ˆæ‰§è¡Œå‡½æ•°å‚æ•°ä»£ç ï¼Œç„¶åå†æ‰§è¡Œå‡½æ•°ä½“ä»£ç ã€‚è¿™æ ·å°±æœ‰ä¸€ä¸ªä¸åˆç†çš„åœ°æ–¹ï¼Œåªæœ‰ä»å‡½æ•°ä½“ä»£ç ä¹‹ä¸­ï¼Œæ‰èƒ½çŸ¥é“å‚æ•°ä»£ç æ˜¯å¦åº”è¯¥ä»¥ä¸¥æ ¼æ¨¡å¼æ‰§è¡Œï¼Œä½†æ˜¯å‚æ•°ä»£ç å´åº”è¯¥å…ˆäºå‡½æ•°ä½“ä»£ç æ‰§è¡Œã€‚ 12345// æŠ¥é”™function doSomething(value = 070) &#123; 'use strict'; return value;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå‚æ•°valueçš„é»˜è®¤å€¼æ˜¯å…«è¿›åˆ¶æ•°070ï¼Œä½†æ˜¯ä¸¥æ ¼æ¨¡å¼ä¸‹ä¸èƒ½ç”¨å‰ç¼€0è¡¨ç¤ºå…«è¿›åˆ¶ï¼Œæ‰€ä»¥åº”è¯¥æŠ¥é”™ã€‚ä½†æ˜¯å®é™…ä¸Šï¼ŒJavaScriptå¼•æ“ä¼šå…ˆæˆåŠŸæ‰§è¡Œvalue = 070ï¼Œç„¶åè¿›å…¥å‡½æ•°ä½“å†…éƒ¨ï¼Œå‘ç°éœ€è¦ç”¨ä¸¥æ ¼æ¨¡å¼æ‰§è¡Œï¼Œè¿™æ—¶æ‰ä¼šæŠ¥é”™ã€‚ è™½ç„¶å¯ä»¥å…ˆè§£æå‡½æ•°ä½“ä»£ç ï¼Œå†æ‰§è¡Œå‚æ•°ä»£ç ï¼Œä½†æ˜¯è¿™æ ·æ— ç–‘å°±å¢åŠ äº†å¤æ‚æ€§ã€‚å› æ­¤ï¼Œæ ‡å‡†ç´¢æ€§ç¦æ­¢äº†è¿™ç§ç”¨æ³•ï¼Œåªè¦å‚æ•°ä½¿ç”¨äº†é»˜è®¤å€¼ã€è§£æ„èµ‹å€¼ã€æˆ–è€…æ‰©å±•è¿ç®—ç¬¦ï¼Œå°±ä¸èƒ½æ˜¾å¼æŒ‡å®šä¸¥æ ¼æ¨¡å¼ã€‚ ä¸¤ç§æ–¹æ³•å¯ä»¥è§„é¿è¿™ç§é™åˆ¶ã€‚ç¬¬ä¸€ç§æ˜¯è®¾å®šå…¨å±€æ€§çš„ä¸¥æ ¼æ¨¡å¼ï¼Œè¿™æ˜¯åˆæ³•çš„ã€‚ 12345'use strict';function doSomething(a, b = a) &#123; // code&#125; ç¬¬äºŒç§æ˜¯æŠŠå‡½æ•°åŒ…åœ¨ä¸€ä¸ªæ— å‚æ•°çš„ç«‹å³æ‰§è¡Œå‡½æ•°é‡Œé¢ã€‚ 123456const doSomething = (function () &#123; 'use strict'; return function(value = 42) &#123; return value; &#125;;&#125;()); name å±æ€§å‡½æ•°çš„nameå±æ€§ï¼Œè¿”å›è¯¥å‡½æ•°çš„å‡½æ•°åã€‚ 12function foo() &#123;&#125;foo.name // \"foo\" è¿™ä¸ªå±æ€§æ—©å°±è¢«æµè§ˆå™¨å¹¿æ³›æ”¯æŒï¼Œä½†æ˜¯ç›´åˆ° ES6ï¼Œæ‰å°†å…¶å†™å…¥äº†æ ‡å‡†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒES6 å¯¹è¿™ä¸ªå±æ€§çš„è¡Œä¸ºåšå‡ºäº†ä¸€äº›ä¿®æ”¹ã€‚å¦‚æœå°†ä¸€ä¸ªåŒ¿åå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼ŒES5 çš„nameå±æ€§ï¼Œä¼šè¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œè€Œ ES6 çš„nameå±æ€§ä¼šè¿”å›å®é™…çš„å‡½æ•°åã€‚ 1234567var f = function () &#123;&#125;;// ES5f.name // \"\"// ES6f.name // \"f\" ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡fç­‰äºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼ŒES5 å’Œ ES6 çš„nameå±æ€§è¿”å›çš„å€¼ä¸ä¸€æ ·ã€‚ å¦‚æœå°†ä¸€ä¸ªå…·åå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œåˆ™ ES5 å’Œ ES6 çš„nameå±æ€§éƒ½è¿”å›è¿™ä¸ªå…·åå‡½æ•°åŸæœ¬çš„åå­—ã€‚ 1234567const bar = function baz() &#123;&#125;;// ES5bar.name // \"baz\"// ES6bar.name // \"baz\" Functionæ„é€ å‡½æ•°è¿”å›çš„å‡½æ•°å®ä¾‹ï¼Œnameå±æ€§çš„å€¼ä¸ºanonymousã€‚ 1(new Function).name // \"anonymous\" bindè¿”å›çš„å‡½æ•°ï¼Œnameå±æ€§å€¼ä¼šåŠ ä¸Šboundå‰ç¼€ã€‚ 1234function foo() &#123;&#125;;foo.bind(&#123;&#125;).name // \"bound foo\"(function()&#123;&#125;).bind(&#123;&#125;).name // \"bound \" ç®­å¤´å‡½æ•°åŸºæœ¬ç”¨æ³•ES6å…è®¸ä½¿ç”¨â€œç®­å¤´â€ï¼ˆ=&gt;ï¼‰å®šä¹‰å‡½æ•°ã€‚ 1var f = v =&gt; v; ä¸Šé¢çš„ç®­å¤´å‡½æ•°ç­‰åŒäºï¼š 123var f = function(v) &#123; return v;&#125;; å¦‚æœç®­å¤´å‡½æ•°ä¸éœ€è¦å‚æ•°æˆ–éœ€è¦å¤šä¸ªå‚æ•°ï¼Œå°±ä½¿ç”¨ä¸€ä¸ªåœ†æ‹¬å·ä»£è¡¨å‚æ•°éƒ¨åˆ†ã€‚ 123456789var f = () =&gt; 5;// ç­‰åŒäºvar f = function () &#123; return 5 &#125;;var sum = (num1, num2) =&gt; num1 + num2;// ç­‰åŒäºvar sum = function(num1, num2) &#123; return num1 + num2;&#125;; å¦‚æœç®­å¤´å‡½æ•°çš„ä»£ç å—éƒ¨åˆ†å¤šäºä¸€æ¡è¯­å¥ï¼Œå°±è¦ä½¿ç”¨å¤§æ‹¬å·å°†å®ƒä»¬æ‹¬èµ·æ¥ï¼Œå¹¶ä¸”ä½¿ç”¨returnè¯­å¥è¿”å›ã€‚ 1var sum = (num1, num2) =&gt; &#123; return num1 + num2; &#125; ç”±äºå¤§æ‹¬å·è¢«è§£é‡Šä¸ºä»£ç å—ï¼Œæ‰€ä»¥å¦‚æœç®­å¤´å‡½æ•°ç›´æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»åœ¨å¯¹è±¡å¤–é¢åŠ ä¸Šæ‹¬å·ã€‚ 1var getTempItem = id =&gt; (&#123; id: id, name: \"Temp\" &#125;); ç®­å¤´å‡½æ•°å¯ä»¥ä¸å˜é‡è§£æ„ç»“åˆä½¿ç”¨ã€‚ 123456const full = (&#123; first, last &#125;) =&gt; first + ' ' + last;// ç­‰åŒäºfunction full(person) &#123; return person.first + ' ' + person.last;&#125; ç®­å¤´å‡½æ•°ä½¿å¾—è¡¨è¾¾æ›´åŠ ç®€æ´ã€‚ 12const isEven = n =&gt; n % 2 == 0;const square = n =&gt; n * n; ä¸Šé¢ä»£ç åªç”¨äº†ä¸¤è¡Œï¼Œå°±å®šä¹‰äº†ä¸¤ä¸ªç®€å•çš„å·¥å…·å‡½æ•°ã€‚å¦‚æœä¸ç”¨ç®­å¤´å‡½æ•°ï¼Œå¯èƒ½å°±è¦å ç”¨å¤šè¡Œï¼Œè€Œä¸”è¿˜ä¸å¦‚ç°åœ¨è¿™æ ·å†™é†’ç›®ã€‚ ç®­å¤´å‡½æ•°çš„ä¸€ä¸ªç”¨å¤„æ˜¯ç®€åŒ–å›è°ƒå‡½æ•°ã€‚ 1234567// æ­£å¸¸å‡½æ•°å†™æ³•[1,2,3].map(function (x) &#123; return x * x;&#125;);// ç®­å¤´å‡½æ•°å†™æ³•[1,2,3].map(x =&gt; x * x); å¦ä¸€ä¸ªä¾‹å­æ˜¯ 1234567// æ­£å¸¸å‡½æ•°å†™æ³•var result = values.sort(function (a, b) &#123; return a - b;&#125;);// ç®­å¤´å‡½æ•°å†™æ³•var result = values.sort((a, b) =&gt; a - b); ä¸‹é¢æ˜¯restå‚æ•°ä¸ç®­å¤´å‡½æ•°ç»“åˆçš„ä¾‹å­ã€‚ 123456789const numbers = (...nums) =&gt; nums;numbers(1, 2, 3, 4, 5)// [1,2,3,4,5]const headAndTail = (head, ...tail) =&gt; [head, tail];headAndTail(1, 2, 3, 4, 5)// [1,[2,3,4,5]] ä½¿ç”¨æ³¨æ„ç‚¹ç®­å¤´å‡½æ•°æœ‰å‡ ä¸ªä½¿ç”¨æ³¨æ„ç‚¹ã€‚ ï¼ˆ1ï¼‰å‡½æ•°ä½“å†…çš„thiså¯¹è±¡ï¼Œå°±æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ—¶æ‰€åœ¨çš„å¯¹è±¡ã€‚ ï¼ˆ2ï¼‰ä¸å¯ä»¥å½“ä½œæ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯ä»¥ä½¿ç”¨newå‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ ï¼ˆ3ï¼‰ä¸å¯ä»¥ä½¿ç”¨argumentså¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨å‡½æ•°ä½“å†…ä¸å­˜åœ¨ã€‚å¦‚æœè¦ç”¨ï¼Œå¯ä»¥ç”¨Restå‚æ•°ä»£æ›¿ã€‚ ï¼ˆ4ï¼‰ä¸å¯ä»¥ä½¿ç”¨yieldå‘½ä»¤ï¼Œå› æ­¤ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œGeneratorå‡½æ•°ã€‚ ä¸Šé¢å››ç‚¹ä¸­ï¼Œç¬¬ä¸€ç‚¹å°¤å…¶å€¼å¾—æ³¨æ„ã€‚thiså¯¹è±¡çš„æŒ‡å‘æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯åœ¨ç®­å¤´å‡½æ•°ä¸­ï¼Œå®ƒæ˜¯å›ºå®šçš„ã€‚ 12345678910function foo() &#123; setTimeout(() =&gt; &#123; console.log('id:', this.id); &#125;, 100);&#125;var id = 21;foo.call(&#123; id: 42 &#125;);// id: 42 ä¸Šé¢ä»£ç ä¸­ï¼ŒsetTimeoutçš„å‚æ•°æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œè¿™ä¸ªç®­å¤´å‡½æ•°çš„å®šä¹‰ç”Ÿæ•ˆæ˜¯åœ¨fooå‡½æ•°ç”Ÿæˆæ—¶ï¼Œè€Œå®ƒçš„çœŸæ­£æ‰§è¡Œè¦ç­‰åˆ°100æ¯«ç§’åã€‚å¦‚æœæ˜¯æ™®é€šå‡½æ•°ï¼Œæ‰§è¡Œæ—¶thisåº”è¯¥æŒ‡å‘å…¨å±€å¯¹è±¡windowï¼Œè¿™æ—¶åº”è¯¥è¾“å‡º21ã€‚ä½†æ˜¯ï¼Œç®­å¤´å‡½æ•°å¯¼è‡´thisæ€»æ˜¯æŒ‡å‘å‡½æ•°å®šä¹‰ç”Ÿæ•ˆæ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼ˆæœ¬ä¾‹æ˜¯{id: 42}ï¼‰ï¼Œæ‰€ä»¥è¾“å‡ºçš„æ˜¯42ã€‚ ç®­å¤´å‡½æ•°å¯ä»¥è®©setTimeouté‡Œé¢çš„thisï¼Œç»‘å®šå®šä¹‰æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸï¼Œè€Œä¸æ˜¯æŒ‡å‘è¿è¡Œæ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸã€‚ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚ 1234567891011121314151617function Timer() &#123; this.s1 = 0; this.s2 = 0; // ç®­å¤´å‡½æ•° setInterval(() =&gt; this.s1++, 1000); // æ™®é€šå‡½æ•° setInterval(function () &#123; this.s2++; &#125;, 1000);&#125;var timer = new Timer();setTimeout(() =&gt; console.log('s1: ', timer.s1), 3100);setTimeout(() =&gt; console.log('s2: ', timer.s2), 3100);// s1: 3// s2: 0 ä¸Šé¢ä»£ç ä¸­ï¼ŒTimerå‡½æ•°å†…éƒ¨è®¾ç½®äº†ä¸¤ä¸ªå®šæ—¶å™¨ï¼Œåˆ†åˆ«ä½¿ç”¨äº†ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°ã€‚å‰è€…çš„thisç»‘å®šå®šä¹‰æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸï¼ˆå³Timerå‡½æ•°ï¼‰ï¼Œåè€…çš„thisæŒ‡å‘è¿è¡Œæ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸï¼ˆå³å…¨å±€å¯¹è±¡ï¼‰ã€‚æ‰€ä»¥ï¼Œ3100æ¯«ç§’ä¹‹åï¼Œtimer.s1è¢«æ›´æ–°äº†3æ¬¡ï¼Œè€Œtimer.s2ä¸€æ¬¡éƒ½æ²¡æ›´æ–°ã€‚ ç®­å¤´å‡½æ•°å¯ä»¥è®©thisæŒ‡å‘å›ºå®šåŒ–ï¼Œè¿™ç§ç‰¹æ€§å¾ˆæœ‰åˆ©äºå°è£…å›è°ƒå‡½æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼ŒDOMäº‹ä»¶çš„å›è°ƒå‡½æ•°å°è£…åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œé¢ã€‚ 123456789101112var handler = &#123; id: '123456', init: function() &#123; document.addEventListener('click', event =&gt; this.doSomething(event.type), false); &#125;, doSomething: function(type) &#123; console.log('Handling ' + type + ' for ' + this.id); &#125;&#125;; ä¸Šé¢ä»£ç çš„initæ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†ç®­å¤´å‡½æ•°ï¼Œè¿™å¯¼è‡´è¿™ä¸ªç®­å¤´å‡½æ•°é‡Œé¢çš„thisï¼Œæ€»æ˜¯æŒ‡å‘handlerå¯¹è±¡ã€‚å¦åˆ™ï¼Œå›è°ƒå‡½æ•°è¿è¡Œæ—¶ï¼Œthis.doSomethingè¿™ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºæ­¤æ—¶thisæŒ‡å‘documentå¯¹è±¡ã€‚ thisæŒ‡å‘çš„å›ºå®šåŒ–ï¼Œå¹¶ä¸æ˜¯å› ä¸ºç®­å¤´å‡½æ•°å†…éƒ¨æœ‰ç»‘å®šthisçš„æœºåˆ¶ï¼Œå®é™…åŸå› æ˜¯ç®­å¤´å‡½æ•°æ ¹æœ¬æ²¡æœ‰è‡ªå·±çš„thisï¼Œå¯¼è‡´å†…éƒ¨çš„thiså°±æ˜¯å¤–å±‚ä»£ç å—çš„thisã€‚æ­£æ˜¯å› ä¸ºå®ƒæ²¡æœ‰thisï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°ã€‚ æ‰€ä»¥ï¼Œç®­å¤´å‡½æ•°è½¬æˆES5çš„ä»£ç å¦‚ä¸‹ã€‚ 123456789101112131415// ES6function foo() &#123; setTimeout(() =&gt; &#123; console.log('id:', this.id); &#125;, 100);&#125;// ES5function foo() &#123; var _this = this; setTimeout(function () &#123; console.log('id:', _this.id); &#125;, 100);&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œè½¬æ¢åçš„ES5ç‰ˆæœ¬æ¸…æ¥šåœ°è¯´æ˜äº†ï¼Œç®­å¤´å‡½æ•°é‡Œé¢æ ¹æœ¬æ²¡æœ‰è‡ªå·±çš„thisï¼Œè€Œæ˜¯å¼•ç”¨å¤–å±‚çš„thisã€‚ è¯·é—®ä¸‹é¢çš„ä»£ç ä¹‹ä¸­æœ‰å‡ ä¸ªthisï¼Ÿ 123456789101112131415function foo() &#123; return () =&gt; &#123; return () =&gt; &#123; return () =&gt; &#123; console.log('id:', this.id); &#125;; &#125;; &#125;;&#125;var f = foo.call(&#123;id: 1&#125;);var t1 = f.call(&#123;id: 2&#125;)()(); // id: 1var t2 = f().call(&#123;id: 3&#125;)(); // id: 1var t3 = f()().call(&#123;id: 4&#125;); // id: 1 ä¸Šé¢ä»£ç ä¹‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªthisï¼Œå°±æ˜¯å‡½æ•°fooçš„thisï¼Œæ‰€ä»¥t1ã€t2ã€t3éƒ½è¾“å‡ºåŒæ ·çš„ç»“æœã€‚å› ä¸ºæ‰€æœ‰çš„å†…å±‚å‡½æ•°éƒ½æ˜¯ç®­å¤´å‡½æ•°ï¼Œéƒ½æ²¡æœ‰è‡ªå·±çš„thisï¼Œå®ƒä»¬çš„thiså…¶å®éƒ½æ˜¯æœ€å¤–å±‚fooå‡½æ•°çš„thisã€‚ é™¤äº†thisï¼Œä»¥ä¸‹ä¸‰ä¸ªå˜é‡åœ¨ç®­å¤´å‡½æ•°ä¹‹ä¸­ä¹Ÿæ˜¯ä¸å­˜åœ¨çš„ï¼ŒæŒ‡å‘å¤–å±‚å‡½æ•°çš„å¯¹åº”å˜é‡ï¼šargumentsã€superã€new.targetã€‚ 12345678function foo() &#123; setTimeout(() =&gt; &#123; console.log('args:', arguments); &#125;, 100);&#125;foo(2, 4, 6, 8)// args: [2, 4, 6, 8] ä¸Šé¢ä»£ç ä¸­ï¼Œç®­å¤´å‡½æ•°å†…éƒ¨çš„å˜é‡argumentsï¼Œå…¶å®æ˜¯å‡½æ•°fooçš„argumentså˜é‡ã€‚ å¦å¤–ï¼Œç”±äºç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„thisï¼Œæ‰€ä»¥å½“ç„¶ä¹Ÿå°±ä¸èƒ½ç”¨call()ã€apply()ã€bind()è¿™äº›æ–¹æ³•å»æ”¹å˜thisçš„æŒ‡å‘ã€‚ 123456(function() &#123; return [ (() =&gt; this.x).bind(&#123; x: 'inner' &#125;)() ];&#125;).call(&#123; x: 'outer' &#125;);// ['outer'] ä¸Šé¢ä»£ç ä¸­ï¼Œç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„thisï¼Œæ‰€ä»¥bindæ–¹æ³•æ— æ•ˆï¼Œå†…éƒ¨çš„thisæŒ‡å‘å¤–éƒ¨çš„thisã€‚ é•¿æœŸä»¥æ¥ï¼ŒJavaScriptè¯­è¨€çš„thiså¯¹è±¡ä¸€ç›´æ˜¯ä¸€ä¸ªä»¤äººå¤´ç—›çš„é—®é¢˜ï¼Œåœ¨å¯¹è±¡æ–¹æ³•ä¸­ä½¿ç”¨thisï¼Œå¿…é¡»éå¸¸å°å¿ƒã€‚ç®­å¤´å‡½æ•°â€ç»‘å®šâ€thisï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šè§£å†³äº†è¿™ä¸ªå›°æ‰°ã€‚ åµŒå¥—çš„ç®­å¤´å‡½æ•°ç®­å¤´å‡½æ•°å†…éƒ¨ï¼Œè¿˜å¯ä»¥å†ä½¿ç”¨ç®­å¤´å‡½æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªES5è¯­æ³•çš„å¤šé‡åµŒå¥—å‡½æ•°ã€‚ 12345678910function insert(value) &#123; return &#123;into: function (array) &#123; return &#123;after: function (afterValue) &#123; array.splice(array.indexOf(afterValue) + 1, 0, value); return array; &#125;&#125;; &#125;&#125;;&#125;insert(2).into([1, 3]).after(1); //[1, 2, 3] ä¸Šé¢è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°æ”¹å†™ã€‚ 123456let insert = (value) =&gt; (&#123;into: (array) =&gt; (&#123;after: (afterValue) =&gt; &#123; array.splice(array.indexOf(afterValue) + 1, 0, value); return array;&#125;&#125;)&#125;);insert(2).into([1, 3]).after(1); //[1, 2, 3] ä¸‹é¢æ˜¯ä¸€ä¸ªéƒ¨ç½²ç®¡é“æœºåˆ¶ï¼ˆpipelineï¼‰çš„ä¾‹å­ï¼Œå³å‰ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºæ˜¯åä¸€ä¸ªå‡½æ•°çš„è¾“å…¥ã€‚ 123456789const pipeline = (...funcs) =&gt; val =&gt; funcs.reduce((a, b) =&gt; b(a), val);const plus1 = a =&gt; a + 1;const mult2 = a =&gt; a * 2;const addThenMult = pipeline(plus1, mult2);addThenMult(5)// 12 å¦‚æœè§‰å¾—ä¸Šé¢çš„å†™æ³•å¯è¯»æ€§æ¯”è¾ƒå·®ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨ä¸‹é¢çš„å†™æ³•ã€‚ 12345const plus1 = a =&gt; a + 1;const mult2 = a =&gt; a * 2;mult2(plus1(5))// 12 ç®­å¤´å‡½æ•°è¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ”¹å†™Î»æ¼”ç®—ã€‚ 123456// Î»æ¼”ç®—çš„å†™æ³•fix = Î»f.(Î»x.f(Î»v.x(x)(v)))(Î»x.f(Î»v.x(x)(v)))// ES6çš„å†™æ³•var fix = f =&gt; (x =&gt; f(v =&gt; x(x)(v))) (x =&gt; f(v =&gt; x(x)(v))); ä¸Šé¢ä¸¤ç§å†™æ³•ï¼Œå‡ ä¹æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚ç”±äºÎ»æ¼”ç®—å¯¹äºè®¡ç®—æœºç§‘å­¦éå¸¸é‡è¦ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç”¨ES6ä½œä¸ºæ›¿ä»£å·¥å…·ï¼Œæ¢ç´¢è®¡ç®—æœºç§‘å­¦ã€‚ ç»‘å®š thisç®­å¤´å‡½æ•°å¯ä»¥ç»‘å®šthiså¯¹è±¡ï¼Œå¤§å¤§å‡å°‘äº†æ˜¾å¼ç»‘å®šthiså¯¹è±¡çš„å†™æ³•ï¼ˆcallã€applyã€bindï¼‰ã€‚ä½†æ˜¯ï¼Œç®­å¤´å‡½æ•°å¹¶ä¸é€‚ç”¨äºæ‰€æœ‰åœºåˆï¼Œæ‰€ä»¥ES7æå‡ºäº†â€œå‡½æ•°ç»‘å®šâ€ï¼ˆfunction bindï¼‰è¿ç®—ç¬¦ï¼Œç”¨æ¥å–ä»£callã€applyã€bindè°ƒç”¨ã€‚è™½ç„¶è¯¥è¯­æ³•è¿˜æ˜¯ES7çš„ä¸€ä¸ªææ¡ˆï¼Œä½†æ˜¯Babelè½¬ç å™¨å·²ç»æ”¯æŒã€‚ å‡½æ•°ç»‘å®šè¿ç®—ç¬¦æ˜¯å¹¶æ’çš„ä¸¤ä¸ªåŒå†’å·ï¼ˆ::ï¼‰ï¼ŒåŒå†’å·å·¦è¾¹æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå³è¾¹æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¯¥è¿ç®—ç¬¦ä¼šè‡ªåŠ¨å°†å·¦è¾¹çš„å¯¹è±¡ï¼Œä½œä¸ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆå³thiså¯¹è±¡ï¼‰ï¼Œç»‘å®šåˆ°å³è¾¹çš„å‡½æ•°ä¸Šé¢ã€‚ 123456789101112foo::bar;// ç­‰åŒäºbar.bind(foo);foo::bar(...arguments);// ç­‰åŒäºbar.apply(foo, arguments);const hasOwnProperty = Object.prototype.hasOwnProperty;function hasOwn(obj, key) &#123; return obj::hasOwnProperty(key);&#125; å¦‚æœåŒå†’å·å·¦è¾¹ä¸ºç©ºï¼Œå³è¾¹æ˜¯ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œåˆ™ç­‰äºå°†è¯¥æ–¹æ³•ç»‘å®šåœ¨è¯¥å¯¹è±¡ä¸Šé¢ã€‚ 1234567var method = obj::obj.foo;// ç­‰åŒäºvar method = ::obj.foo;let log = ::console.log;// ç­‰åŒäºvar log = console.log.bind(console); ç”±äºåŒå†’å·è¿ç®—ç¬¦è¿”å›çš„è¿˜æ˜¯åŸå¯¹è±¡ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ã€‚ 1234567891011121314// ä¾‹ä¸€import &#123; map, takeWhile, forEach &#125; from \"iterlib\";getPlayers()::map(x =&gt; x.character())::takeWhile(x =&gt; x.strength &gt; 100)::forEach(x =&gt; console.log(x));// ä¾‹äºŒlet &#123; find, html &#125; = jake;document.querySelectorAll(\"div.myClass\")::find(\"p\")::html(\"hahaha\"); å°¾è°ƒç”¨ä¼˜åŒ–ä»€ä¹ˆæ˜¯å°¾è°ƒç”¨ï¼Ÿå°¾è°ƒç”¨ï¼ˆTail Callï¼‰æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œæœ¬èº«éå¸¸ç®€å•ï¼Œä¸€å¥è¯å°±èƒ½è¯´æ¸…æ¥šï¼Œå°±æ˜¯æŒ‡æŸä¸ªå‡½æ•°çš„æœ€åä¸€æ­¥æ˜¯è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚ 123function f(x)&#123; return g(x);&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°fçš„æœ€åä¸€æ­¥æ˜¯è°ƒç”¨å‡½æ•°gï¼Œè¿™å°±å«å°¾è°ƒç”¨ã€‚ ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼Œéƒ½ä¸å±äºå°¾è°ƒç”¨ã€‚ 123456789101112131415// æƒ…å†µä¸€function f(x)&#123; let y = g(x); return y;&#125;// æƒ…å†µäºŒfunction f(x)&#123; return g(x) + 1;&#125;// æƒ…å†µä¸‰function f(x)&#123; g(x);&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œæƒ…å†µä¸€æ˜¯è°ƒç”¨å‡½æ•°gä¹‹åï¼Œè¿˜æœ‰èµ‹å€¼æ“ä½œï¼Œæ‰€ä»¥ä¸å±äºå°¾è°ƒç”¨ï¼Œå³ä½¿è¯­ä¹‰å®Œå…¨ä¸€æ ·ã€‚æƒ…å†µäºŒä¹Ÿå±äºè°ƒç”¨åè¿˜æœ‰æ“ä½œï¼Œå³ä½¿å†™åœ¨ä¸€è¡Œå†…ã€‚æƒ…å†µä¸‰ç­‰åŒäºä¸‹é¢çš„ä»£ç ã€‚ 1234function f(x)&#123; g(x); return undefined;&#125; å°¾è°ƒç”¨ä¸ä¸€å®šå‡ºç°åœ¨å‡½æ•°å°¾éƒ¨ï¼Œåªè¦æ˜¯æœ€åä¸€æ­¥æ“ä½œå³å¯ã€‚ 123456function f(x) &#123; if (x &gt; 0) &#123; return m(x) &#125; return n(x);&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°må’Œnéƒ½å±äºå°¾è°ƒç”¨ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯å‡½æ•°fçš„æœ€åä¸€æ­¥æ“ä½œã€‚ å°¾è°ƒç”¨ä¼˜åŒ–å°¾è°ƒç”¨ä¹‹æ‰€ä»¥ä¸å…¶ä»–è°ƒç”¨ä¸åŒï¼Œå°±åœ¨äºå®ƒçš„ç‰¹æ®Šçš„è°ƒç”¨ä½ç½®ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œå‡½æ•°è°ƒç”¨ä¼šåœ¨å†…å­˜å½¢æˆä¸€ä¸ªâ€œè°ƒç”¨è®°å½•â€ï¼Œåˆç§°â€œè°ƒç”¨å¸§â€ï¼ˆcall frameï¼‰ï¼Œä¿å­˜è°ƒç”¨ä½ç½®å’Œå†…éƒ¨å˜é‡ç­‰ä¿¡æ¯ã€‚å¦‚æœåœ¨å‡½æ•°Açš„å†…éƒ¨è°ƒç”¨å‡½æ•°Bï¼Œé‚£ä¹ˆåœ¨Açš„è°ƒç”¨å¸§ä¸Šæ–¹ï¼Œè¿˜ä¼šå½¢æˆä¸€ä¸ªBçš„è°ƒç”¨å¸§ã€‚ç­‰åˆ°Bè¿è¡Œç»“æŸï¼Œå°†ç»“æœè¿”å›åˆ°Aï¼ŒBçš„è°ƒç”¨å¸§æ‰ä¼šæ¶ˆå¤±ã€‚å¦‚æœå‡½æ•°Bå†…éƒ¨è¿˜è°ƒç”¨å‡½æ•°Cï¼Œé‚£å°±è¿˜æœ‰ä¸€ä¸ªCçš„è°ƒç”¨å¸§ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ‰€æœ‰çš„è°ƒç”¨å¸§ï¼Œå°±å½¢æˆä¸€ä¸ªâ€œè°ƒç”¨æ ˆâ€ï¼ˆcall stackï¼‰ã€‚ å°¾è°ƒç”¨ç”±äºæ˜¯å‡½æ•°çš„æœ€åä¸€æ­¥æ“ä½œï¼Œæ‰€ä»¥ä¸éœ€è¦ä¿ç•™å¤–å±‚å‡½æ•°çš„è°ƒç”¨å¸§ï¼Œå› ä¸ºè°ƒç”¨ä½ç½®ã€å†…éƒ¨å˜é‡ç­‰ä¿¡æ¯éƒ½ä¸ä¼šå†ç”¨åˆ°äº†ï¼Œåªè¦ç›´æ¥ç”¨å†…å±‚å‡½æ•°çš„è°ƒç”¨å¸§ï¼Œå–ä»£å¤–å±‚å‡½æ•°çš„è°ƒç”¨å¸§å°±å¯ä»¥äº†ã€‚ 123456789101112131415function f() &#123; let m = 1; let n = 2; return g(m + n);&#125;f();// ç­‰åŒäºfunction f() &#123; return g(3);&#125;f();// ç­‰åŒäºg(3); ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœå‡½æ•°gä¸æ˜¯å°¾è°ƒç”¨ï¼Œå‡½æ•°få°±éœ€è¦ä¿å­˜å†…éƒ¨å˜é‡må’Œnçš„å€¼ã€gçš„è°ƒç”¨ä½ç½®ç­‰ä¿¡æ¯ã€‚ä½†ç”±äºè°ƒç”¨gä¹‹åï¼Œå‡½æ•°få°±ç»“æŸäº†ï¼Œæ‰€ä»¥æ‰§è¡Œåˆ°æœ€åä¸€æ­¥ï¼Œå®Œå…¨å¯ä»¥åˆ é™¤ f(x) çš„è°ƒç”¨å¸§ï¼Œåªä¿ç•™ g(3) çš„è°ƒç”¨å¸§ã€‚ è¿™å°±å«åšâ€œå°¾è°ƒç”¨ä¼˜åŒ–â€ï¼ˆTail call optimizationï¼‰ï¼Œå³åªä¿ç•™å†…å±‚å‡½æ•°çš„è°ƒç”¨å¸§ã€‚å¦‚æœæ‰€æœ‰å‡½æ•°éƒ½æ˜¯å°¾è°ƒç”¨ï¼Œé‚£ä¹ˆå®Œå…¨å¯ä»¥åšåˆ°æ¯æ¬¡æ‰§è¡Œæ—¶ï¼Œè°ƒç”¨å¸§åªæœ‰ä¸€é¡¹ï¼Œè¿™å°†å¤§å¤§èŠ‚çœå†…å­˜ã€‚è¿™å°±æ˜¯â€œå°¾è°ƒç”¨ä¼˜åŒ–â€çš„æ„ä¹‰ã€‚ æ³¨æ„ï¼Œåªæœ‰ä¸å†ç”¨åˆ°å¤–å±‚å‡½æ•°çš„å†…éƒ¨å˜é‡ï¼Œå†…å±‚å‡½æ•°çš„è°ƒç”¨å¸§æ‰ä¼šå–ä»£å¤–å±‚å‡½æ•°çš„è°ƒç”¨å¸§ï¼Œå¦åˆ™å°±æ— æ³•è¿›è¡Œâ€œå°¾è°ƒç”¨ä¼˜åŒ–â€ã€‚ 1234567function addOne(a)&#123; var one = 1; function inner(b)&#123; return b + one; &#125; return inner(a);&#125; ä¸Šé¢çš„å‡½æ•°ä¸ä¼šè¿›è¡Œå°¾è°ƒç”¨ä¼˜åŒ–ï¼Œå› ä¸ºå†…å±‚å‡½æ•°innerç”¨åˆ°äº†å¤–å±‚å‡½æ•°addOneçš„å†…éƒ¨å˜é‡oneã€‚ å°¾é€’å½’å‡½æ•°è°ƒç”¨è‡ªèº«ï¼Œç§°ä¸ºé€’å½’ã€‚å¦‚æœå°¾è°ƒç”¨è‡ªèº«ï¼Œå°±ç§°ä¸ºå°¾é€’å½’ã€‚ é€’å½’éå¸¸è€—è´¹å†…å­˜ï¼Œå› ä¸ºéœ€è¦åŒæ—¶ä¿å­˜æˆåƒä¸Šç™¾ä¸ªè°ƒç”¨å¸§ï¼Œå¾ˆå®¹æ˜“å‘ç”Ÿâ€œæ ˆæº¢å‡ºâ€é”™è¯¯ï¼ˆstack overflowï¼‰ã€‚ä½†å¯¹äºå°¾é€’å½’æ¥è¯´ï¼Œç”±äºåªå­˜åœ¨ä¸€ä¸ªè°ƒç”¨å¸§ï¼Œæ‰€ä»¥æ°¸è¿œä¸ä¼šå‘ç”Ÿâ€œæ ˆæº¢å‡ºâ€é”™è¯¯ã€‚ 123456function factorial(n) &#123; if (n === 1) return 1; return n * factorial(n - 1);&#125;factorial(5) // 120 ä¸Šé¢ä»£ç æ˜¯ä¸€ä¸ªé˜¶ä¹˜å‡½æ•°ï¼Œè®¡ç®—nçš„é˜¶ä¹˜ï¼Œæœ€å¤šéœ€è¦ä¿å­˜nä¸ªè°ƒç”¨è®°å½•ï¼Œå¤æ‚åº¦ O(n) ã€‚ å¦‚æœæ”¹å†™æˆå°¾é€’å½’ï¼Œåªä¿ç•™ä¸€ä¸ªè°ƒç”¨è®°å½•ï¼Œå¤æ‚åº¦ O(1) ã€‚ 123456function factorial(n, total) &#123; if (n === 1) return total; return factorial(n - 1, n * total);&#125;factorial(5, 1) // 120 è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒè‘—åçš„ä¾‹å­ï¼Œå°±æ˜¯è®¡ç®—fibonacci æ•°åˆ—ï¼Œä¹Ÿèƒ½å……åˆ†è¯´æ˜å°¾é€’å½’ä¼˜åŒ–çš„é‡è¦æ€§ å¦‚æœæ˜¯éå°¾é€’å½’çš„fibonacci é€’å½’æ–¹æ³• 12345678910function Fibonacci (n) &#123; if ( n &lt;= 1 ) &#123;return 1&#125;; return Fibonacci(n - 1) + Fibonacci(n - 2);&#125;Fibonacci(10); // 89// Fibonacci(100)// Fibonacci(500)// å †æ ˆæº¢å‡ºäº† å¦‚æœæˆ‘ä»¬ä½¿ç”¨å°¾é€’å½’ä¼˜åŒ–è¿‡çš„fibonacci é€’å½’ç®—æ³• 123456789function Fibonacci2 (n , ac1 = 1 , ac2 = 1) &#123; if( n &lt;= 1 ) &#123;return ac2&#125;; return Fibonacci2 (n - 1, ac2, ac1 + ac2);&#125;Fibonacci2(100) // 573147844013817200000Fibonacci2(1000) // 7.0330367711422765e+208Fibonacci2(10000) // Infinity ç”±æ­¤å¯è§ï¼Œâ€œå°¾è°ƒç”¨ä¼˜åŒ–â€å¯¹é€’å½’æ“ä½œæ„ä¹‰é‡å¤§ï¼Œæ‰€ä»¥ä¸€äº›å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€å°†å…¶å†™å…¥äº†è¯­è¨€è§„æ ¼ã€‚ES6ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œç¬¬ä¸€æ¬¡æ˜ç¡®è§„å®šï¼Œæ‰€æœ‰ECMAScriptçš„å®ç°ï¼Œéƒ½å¿…é¡»éƒ¨ç½²â€œå°¾è°ƒç”¨ä¼˜åŒ–â€ã€‚è¿™å°±æ˜¯è¯´ï¼Œåœ¨ES6ä¸­ï¼Œåªè¦ä½¿ç”¨å°¾é€’å½’ï¼Œå°±ä¸ä¼šå‘ç”Ÿæ ˆæº¢å‡ºï¼Œç›¸å¯¹èŠ‚çœå†…å­˜ã€‚ é€’å½’å‡½æ•°çš„æ”¹å†™å°¾é€’å½’çš„å®ç°ï¼Œå¾€å¾€éœ€è¦æ”¹å†™é€’å½’å‡½æ•°ï¼Œç¡®ä¿æœ€åä¸€æ­¥åªè°ƒç”¨è‡ªèº«ã€‚åšåˆ°è¿™ä¸€ç‚¹çš„æ–¹æ³•ï¼Œå°±æ˜¯æŠŠæ‰€æœ‰ç”¨åˆ°çš„å†…éƒ¨å˜é‡æ”¹å†™æˆå‡½æ•°çš„å‚æ•°ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œé˜¶ä¹˜å‡½æ•° factorial éœ€è¦ç”¨åˆ°ä¸€ä¸ªä¸­é—´å˜é‡ total ï¼Œé‚£å°±æŠŠè¿™ä¸ªä¸­é—´å˜é‡æ”¹å†™æˆå‡½æ•°çš„å‚æ•°ã€‚è¿™æ ·åšçš„ç¼ºç‚¹å°±æ˜¯ä¸å¤ªç›´è§‚ï¼Œç¬¬ä¸€çœ¼å¾ˆéš¾çœ‹å‡ºæ¥ï¼Œä¸ºä»€ä¹ˆè®¡ç®—5çš„é˜¶ä¹˜ï¼Œéœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°5å’Œ1ï¼Ÿ ä¸¤ä¸ªæ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ–¹æ³•ä¸€æ˜¯åœ¨å°¾é€’å½’å‡½æ•°ä¹‹å¤–ï¼Œå†æä¾›ä¸€ä¸ªæ­£å¸¸å½¢å¼çš„å‡½æ•°ã€‚ 12345678910function tailFactorial(n, total) &#123; if (n === 1) return total; return tailFactorial(n - 1, n * total);&#125;function factorial(n) &#123; return tailFactorial(n, 1);&#125;factorial(5) // 120 ä¸Šé¢ä»£ç é€šè¿‡ä¸€ä¸ªæ­£å¸¸å½¢å¼çš„é˜¶ä¹˜å‡½æ•° factorial ï¼Œè°ƒç”¨å°¾é€’å½’å‡½æ•° tailFactorial ï¼Œçœ‹èµ·æ¥å°±æ­£å¸¸å¤šäº†ã€‚ å‡½æ•°å¼ç¼–ç¨‹æœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œå«åšæŸ¯é‡ŒåŒ–ï¼ˆcurryingï¼‰ï¼Œæ„æ€æ˜¯å°†å¤šå‚æ•°çš„å‡½æ•°è½¬æ¢æˆå•å‚æ•°çš„å½¢å¼ã€‚è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨æŸ¯é‡ŒåŒ–ã€‚ 1234567891011121314function currying(fn, n) &#123; return function (m) &#123; return fn.call(this, m, n); &#125;;&#125;function tailFactorial(n, total) &#123; if (n === 1) return total; return tailFactorial(n - 1, n * total);&#125;const factorial = currying(tailFactorial, 1);factorial(5) // 120 ä¸Šé¢ä»£ç é€šè¿‡æŸ¯é‡ŒåŒ–ï¼Œå°†å°¾é€’å½’å‡½æ•° tailFactorial å˜ä¸ºåªæ¥å—1ä¸ªå‚æ•°çš„ factorial ã€‚ ç¬¬äºŒç§æ–¹æ³•å°±ç®€å•å¤šäº†ï¼Œå°±æ˜¯é‡‡ç”¨ES6çš„å‡½æ•°é»˜è®¤å€¼ã€‚ 123456function factorial(n, total = 1) &#123; if (n === 1) return total; return factorial(n - 1, n * total);&#125;factorial(5) // 120 ä¸Šé¢ä»£ç ä¸­ï¼Œå‚æ•° total æœ‰é»˜è®¤å€¼1ï¼Œæ‰€ä»¥è°ƒç”¨æ—¶ä¸ç”¨æä¾›è¿™ä¸ªå€¼ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œé€’å½’æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å¾ªç¯æ“ä½œã€‚çº¯ç²¹çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€æ²¡æœ‰å¾ªç¯æ“ä½œå‘½ä»¤ï¼Œæ‰€æœ‰çš„å¾ªç¯éƒ½ç”¨é€’å½’å®ç°ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå°¾é€’å½’å¯¹è¿™äº›è¯­è¨€æå…¶é‡è¦ã€‚å¯¹äºå…¶ä»–æ”¯æŒâ€œå°¾è°ƒç”¨ä¼˜åŒ–â€çš„è¯­è¨€ï¼ˆæ¯”å¦‚Luaï¼ŒES6ï¼‰ï¼Œåªéœ€è¦çŸ¥é“å¾ªç¯å¯ä»¥ç”¨é€’å½’ä»£æ›¿ï¼Œè€Œä¸€æ—¦ä½¿ç”¨é€’å½’ï¼Œå°±æœ€å¥½ä½¿ç”¨å°¾é€’å½’ã€‚ ä¸¥æ ¼æ¨¡å¼ES6çš„å°¾è°ƒç”¨ä¼˜åŒ–åªåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å¼€å¯ï¼Œæ­£å¸¸æ¨¡å¼æ˜¯æ— æ•ˆçš„ã€‚ è¿™æ˜¯å› ä¸ºåœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œå‡½æ•°å†…éƒ¨æœ‰ä¸¤ä¸ªå˜é‡ï¼Œå¯ä»¥è·Ÿè¸ªå‡½æ•°çš„è°ƒç”¨æ ˆã€‚ func.argumentsï¼šè¿”å›è°ƒç”¨æ—¶å‡½æ•°çš„å‚æ•°ã€‚ func.callerï¼šè¿”å›è°ƒç”¨å½“å‰å‡½æ•°çš„é‚£ä¸ªå‡½æ•°ã€‚ å°¾è°ƒç”¨ä¼˜åŒ–å‘ç”Ÿæ—¶ï¼Œå‡½æ•°çš„è°ƒç”¨æ ˆä¼šæ”¹å†™ï¼Œå› æ­¤ä¸Šé¢ä¸¤ä¸ªå˜é‡å°±ä¼šå¤±çœŸã€‚ä¸¥æ ¼æ¨¡å¼ç¦ç”¨è¿™ä¸¤ä¸ªå˜é‡ï¼Œæ‰€ä»¥å°¾è°ƒç”¨æ¨¡å¼ä»…åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ç”Ÿæ•ˆã€‚ 123456function restricted() &#123; \"use strict\"; restricted.caller; // æŠ¥é”™ restricted.arguments; // æŠ¥é”™&#125;restricted(); å°¾é€’å½’ä¼˜åŒ–çš„å®ç°å°¾é€’å½’ä¼˜åŒ–åªåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ç”Ÿæ•ˆï¼Œé‚£ä¹ˆæ­£å¸¸æ¨¡å¼ä¸‹ï¼Œæˆ–è€…é‚£äº›ä¸æ”¯æŒè¯¥åŠŸèƒ½çš„ç¯å¢ƒä¸­ï¼Œæœ‰æ²¡æœ‰åŠæ³•ä¹Ÿä½¿ç”¨å°¾é€’å½’ä¼˜åŒ–å‘¢ï¼Ÿå›ç­”æ˜¯å¯ä»¥çš„ï¼Œå°±æ˜¯è‡ªå·±å®ç°å°¾é€’å½’ä¼˜åŒ–ã€‚ å®ƒçš„åŸç†éå¸¸ç®€å•ã€‚å°¾é€’å½’ä¹‹æ‰€ä»¥éœ€è¦ä¼˜åŒ–ï¼ŒåŸå› æ˜¯è°ƒç”¨æ ˆå¤ªå¤šï¼Œé€ æˆæº¢å‡ºï¼Œé‚£ä¹ˆåªè¦å‡å°‘è°ƒç”¨æ ˆï¼Œå°±ä¸ä¼šæº¢å‡ºã€‚æ€ä¹ˆåšå¯ä»¥å‡å°‘è°ƒç”¨æ ˆå‘¢ï¼Ÿå°±æ˜¯é‡‡ç”¨â€œå¾ªç¯â€æ¢æ‰â€œé€’å½’â€ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ­£å¸¸çš„é€’å½’å‡½æ•°ã€‚ 12345678910function sum(x, y) &#123; if (y &gt; 0) &#123; return sum(x + 1, y - 1); &#125; else &#123; return x; &#125;&#125;sum(1, 100000)// Uncaught RangeError: Maximum call stack size exceeded(â€¦) ä¸Šé¢ä»£ç ä¸­ï¼Œsumæ˜¯ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œå‚æ•°xæ˜¯éœ€è¦ç´¯åŠ çš„å€¼ï¼Œå‚æ•°yæ§åˆ¶é€’å½’æ¬¡æ•°ã€‚ä¸€æ—¦æŒ‡å®šsumé€’å½’100000æ¬¡ï¼Œå°±ä¼šæŠ¥é”™ï¼Œæç¤ºè¶…å‡ºè°ƒç”¨æ ˆçš„æœ€å¤§æ¬¡æ•°ã€‚ è¹¦åºŠå‡½æ•°ï¼ˆtrampolineï¼‰å¯ä»¥å°†é€’å½’æ‰§è¡Œè½¬ä¸ºå¾ªç¯æ‰§è¡Œã€‚ 123456function trampoline(f) &#123; while (f &amp;&amp; f instanceof Function) &#123; f = f(); &#125; return f;&#125; ä¸Šé¢å°±æ˜¯è¹¦åºŠå‡½æ•°çš„ä¸€ä¸ªå®ç°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°fä½œä¸ºå‚æ•°ã€‚åªè¦fæ‰§è¡Œåè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå°±ç»§ç»­æ‰§è¡Œã€‚æ³¨æ„ï¼Œè¿™é‡Œæ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åæ‰§è¡Œè¯¥å‡½æ•°ï¼Œè€Œä¸æ˜¯å‡½æ•°é‡Œé¢è°ƒç”¨å‡½æ•°ï¼Œè¿™æ ·å°±é¿å…äº†é€’å½’æ‰§è¡Œï¼Œä»è€Œå°±æ¶ˆé™¤äº†è°ƒç”¨æ ˆè¿‡å¤§çš„é—®é¢˜ã€‚ ç„¶åï¼Œè¦åšçš„å°±æ˜¯å°†åŸæ¥çš„é€’å½’å‡½æ•°ï¼Œæ”¹å†™ä¸ºæ¯ä¸€æ­¥è¿”å›å¦ä¸€ä¸ªå‡½æ•°ã€‚ 1234567function sum(x, y) &#123; if (y &gt; 0) &#123; return sum.bind(null, x + 1, y - 1); &#125; else &#123; return x; &#125;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œsumå‡½æ•°çš„æ¯æ¬¡æ‰§è¡Œï¼Œéƒ½ä¼šè¿”å›è‡ªèº«çš„å¦ä¸€ä¸ªç‰ˆæœ¬ã€‚ ç°åœ¨ï¼Œä½¿ç”¨è¹¦åºŠå‡½æ•°æ‰§è¡Œsumï¼Œå°±ä¸ä¼šå‘ç”Ÿè°ƒç”¨æ ˆæº¢å‡ºã€‚ 12trampoline(sum(1, 100000))// 100001 è¹¦åºŠå‡½æ•°å¹¶ä¸æ˜¯çœŸæ­£çš„å°¾é€’å½’ä¼˜åŒ–ï¼Œä¸‹é¢çš„å®ç°æ‰æ˜¯ã€‚ 1234567891011121314151617181920212223242526272829function tco(f) &#123; var value; var active = false; var accumulated = []; return function accumulator() &#123; accumulated.push(arguments); if (!active) &#123; active = true; while (accumulated.length) &#123; value = f.apply(this, accumulated.shift()); &#125; active = false; return value; &#125; &#125;;&#125;var sum = tco(function(x, y) &#123; if (y &gt; 0) &#123; return sum(x + 1, y - 1) &#125; else &#123; return x &#125;&#125;);sum(1, 100000)// 100001 ä¸Šé¢ä»£ç ä¸­ï¼Œtcoå‡½æ•°æ˜¯å°¾é€’å½’ä¼˜åŒ–çš„å®ç°ï¼Œå®ƒçš„å¥¥å¦™å°±åœ¨äºçŠ¶æ€å˜é‡activeã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå˜é‡æ˜¯ä¸æ¿€æ´»çš„ã€‚ä¸€æ—¦è¿›å…¥å°¾é€’å½’ä¼˜åŒ–çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªå˜é‡å°±æ¿€æ´»äº†ã€‚ç„¶åï¼Œæ¯ä¸€è½®é€’å½’sumè¿”å›çš„éƒ½æ˜¯undefinedï¼Œæ‰€ä»¥å°±é¿å…äº†é€’å½’æ‰§è¡Œï¼›è€Œaccumulatedæ•°ç»„å­˜æ”¾æ¯ä¸€è½®sumæ‰§è¡Œçš„å‚æ•°ï¼Œæ€»æ˜¯æœ‰å€¼çš„ï¼Œè¿™å°±ä¿è¯äº†accumulatorå‡½æ•°å†…éƒ¨çš„whileå¾ªç¯æ€»æ˜¯ä¼šæ‰§è¡Œã€‚è¿™æ ·å°±å¾ˆå·§å¦™åœ°å°†â€œé€’å½’â€æ”¹æˆäº†â€œå¾ªç¯â€ï¼Œè€Œåä¸€è½®çš„å‚æ•°ä¼šå–ä»£å‰ä¸€è½®çš„å‚æ•°ï¼Œä¿è¯äº†è°ƒç”¨æ ˆåªæœ‰ä¸€å±‚ã€‚ å‡½æ•°å‚æ•°çš„å°¾é€—å·ECMAScript 2017å°†å…è®¸å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æœ‰å°¾é€—å·ï¼ˆtrailing commaï¼‰ã€‚ æ­¤å‰ï¼Œå‡½æ•°å®šä¹‰å’Œè°ƒç”¨æ—¶ï¼Œéƒ½ä¸å…è®¸æœ€åä¸€ä¸ªå‚æ•°åé¢å‡ºç°é€—å·ã€‚ 123456789function clownsEverywhere( param1, param2) &#123; /* ... */ &#125;clownsEverywhere( 'foo', 'bar'); ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœåœ¨param2æˆ–baråé¢åŠ ä¸€ä¸ªé€—å·ï¼Œå°±ä¼šæŠ¥é”™ã€‚ è¿™æ ·çš„è¯ï¼Œå¦‚æœä»¥åä¿®æ”¹ä»£ç ï¼Œæƒ³ä¸ºå‡½æ•°clownsEverywhereæ·»åŠ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå°±åŠ¿å¿…è¦åœ¨ç¬¬äºŒä¸ªå‚æ•°åé¢æ·»åŠ ä¸€ä¸ªé€—å·ã€‚è¿™å¯¹ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿæ¥è¯´ï¼Œå°±ä¼šæ˜¾ç¤ºï¼Œæ·»åŠ é€—å·çš„é‚£ä¸€è¡Œä¹Ÿå‘ç”Ÿäº†å˜åŠ¨ã€‚è¿™çœ‹ä¸Šå»æœ‰ç‚¹å†—ä½™ï¼Œå› æ­¤æ–°çš„è¯­æ³•å…è®¸å®šä¹‰å’Œè°ƒç”¨æ—¶ï¼Œå°¾éƒ¨ç›´æ¥æœ‰ä¸€ä¸ªé€—å·ã€‚ 123456789function clownsEverywhere( param1, param2,) &#123; /* ... */ &#125;clownsEverywhere( 'foo', 'bar',);","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"Function","slug":"Function","permalink":"http://microzz.com/tags/Function/"}]},{"title":"æ•°ç»„çš„æ‰©å±•(Array)","date":"2016-11-30T04:45:19.000Z","path":"2016/11/30/array/","text":"æ•°ç»„çš„æ‰©å±•Array.from()Array.fromæ–¹æ³•ç”¨äºå°†ä¸¤ç±»å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼šç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ˆarray-like objectï¼‰å’Œå¯éå†ï¼ˆiterableï¼‰çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬ES6æ–°å¢çš„æ•°æ®ç»“æ„Setå’ŒMapï¼‰ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ŒArray.fromå°†å®ƒè½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚ 123456789101112let arrayLike = &#123; '0': 'a', '1': 'b', '2': 'c', length: 3&#125;;// ES5çš„å†™æ³•var arr1 = [].slice.call(arrayLike); // ['a', 'b', 'c']// ES6çš„å†™æ³•let arr2 = Array.from(arrayLike); // ['a', 'b', 'c'] å®é™…åº”ç”¨ä¸­ï¼Œå¸¸è§çš„ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡æ˜¯DOMæ“ä½œè¿”å›çš„NodeListé›†åˆï¼Œä»¥åŠå‡½æ•°å†…éƒ¨çš„argumentså¯¹è±¡ã€‚Array.froméƒ½å¯ä»¥å°†å®ƒä»¬è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚ 1234567891011// NodeListå¯¹è±¡let ps = document.querySelectorAll('p');Array.from(ps).forEach(function (p) &#123; console.log(p);&#125;);// argumentså¯¹è±¡function foo() &#123; var args = Array.from(arguments); // ...&#125; ä¸Šé¢ä»£ç ä¸­ï¼ŒquerySelectorAllæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œåªæœ‰å°†è¿™ä¸ªå¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼Œæ‰èƒ½ä½¿ç”¨forEachæ–¹æ³•ã€‚ åªè¦æ˜¯éƒ¨ç½²äº†Iteratoræ¥å£çš„æ•°æ®ç»“æ„ï¼ŒArray.froméƒ½èƒ½å°†å…¶è½¬ä¸ºæ•°ç»„ã€‚ 12345Array.from('hello')// ['h', 'e', 'l', 'l', 'o']let namesSet = new Set(['a', 'b'])Array.from(namesSet) // ['a', 'b'] ä¸Šé¢ä»£ç ä¸­ï¼Œå­—ç¬¦ä¸²å’ŒSetç»“æ„éƒ½å…·æœ‰Iteratoræ¥å£ï¼Œå› æ­¤å¯ä»¥è¢«Array.fromè½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚ å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ•°ç»„ï¼ŒArray.fromä¼šè¿”å›ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„æ–°æ•°ç»„ã€‚ 12Array.from([1, 2, 3])// [1, 2, 3] å€¼å¾—æé†’çš„æ˜¯ï¼Œæ‰©å±•è¿ç®—ç¬¦ï¼ˆ...ï¼‰ä¹Ÿå¯ä»¥å°†æŸäº›æ•°æ®ç»“æ„è½¬ä¸ºæ•°ç»„ã€‚ 1234567// argumentså¯¹è±¡function foo() &#123; var args = [...arguments];&#125;// NodeListå¯¹è±¡[...document.querySelectorAll('div')] æ‰©å±•è¿ç®—ç¬¦èƒŒåè°ƒç”¨çš„æ˜¯éå†å™¨æ¥å£ï¼ˆSymbol.iteratorï¼‰ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰éƒ¨ç½²è¿™ä¸ªæ¥å£ï¼Œå°±æ— æ³•è½¬æ¢ã€‚Array.fromæ–¹æ³•åˆ™æ˜¯è¿˜æ”¯æŒç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚æ‰€è°“ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œæœ¬è´¨ç‰¹å¾åªæœ‰ä¸€ç‚¹ï¼Œå³å¿…é¡»æœ‰lengthå±æ€§ã€‚å› æ­¤ï¼Œä»»ä½•æœ‰lengthå±æ€§çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥é€šè¿‡Array.fromæ–¹æ³•è½¬ä¸ºæ•°ç»„ï¼Œè€Œæ­¤æ—¶æ‰©å±•è¿ç®—ç¬¦å°±æ— æ³•è½¬æ¢ã€‚ 12Array.from(&#123; length: 3 &#125;);// [ undefined, undefined, undefined ] ä¸Šé¢ä»£ç ä¸­ï¼ŒArray.fromè¿”å›äº†ä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªæˆå‘˜çš„æ•°ç»„ï¼Œæ¯ä¸ªä½ç½®çš„å€¼éƒ½æ˜¯undefinedã€‚æ‰©å±•è¿ç®—ç¬¦è½¬æ¢ä¸äº†è¿™ä¸ªå¯¹è±¡ã€‚ å¯¹äºè¿˜æ²¡æœ‰éƒ¨ç½²è¯¥æ–¹æ³•çš„æµè§ˆå™¨ï¼Œå¯ä»¥ç”¨Array.prototype.sliceæ–¹æ³•æ›¿ä»£ã€‚ 123const toArray = (() =&gt; Array.from ? Array.from : obj =&gt; [].slice.call(obj))(); Array.fromè¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œä½œç”¨ç±»ä¼¼äºæ•°ç»„çš„mapæ–¹æ³•ï¼Œç”¨æ¥å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œå°†å¤„ç†åçš„å€¼æ”¾å…¥è¿”å›çš„æ•°ç»„ã€‚ 123456Array.from(arrayLike, x =&gt; x * x);// ç­‰åŒäºArray.from(arrayLike).map(x =&gt; x * x);Array.from([1, 2, 3], (x) =&gt; x * x)// [1, 4, 9] ä¸‹é¢çš„ä¾‹å­æ˜¯å–å‡ºä¸€ç»„DOMèŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ã€‚ 1234567let spans = document.querySelectorAll('span.name');// map()let names1 = Array.prototype.map.call(spans, s =&gt; s.textContent);// Array.from()let names2 = Array.from(spans, s =&gt; s.textContent) ä¸‹é¢çš„ä¾‹å­å°†æ•°ç»„ä¸­å¸ƒå°”å€¼ä¸ºfalseçš„æˆå‘˜è½¬ä¸º0ã€‚ 12Array.from([1, , 2, , 3], (n) =&gt; n || 0)// [1, 0, 2, 0, 3] å¦ä¸€ä¸ªä¾‹å­æ˜¯è¿”å›å„ç§æ•°æ®çš„ç±»å‹ã€‚ 12345function typesOf () &#123; return Array.from(arguments, value =&gt; typeof value)&#125;typesOf(null, [], NaN)// ['object', 'object', 'number'] å¦‚æœmapå‡½æ•°é‡Œé¢ç”¨åˆ°äº†thiså…³é”®å­—ï¼Œè¿˜å¯ä»¥ä¼ å…¥Array.fromçš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šthisã€‚ Array.from()å¯ä»¥å°†å„ç§å€¼è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼Œå¹¶ä¸”è¿˜æä¾›mapåŠŸèƒ½ã€‚è¿™å®é™…ä¸Šæ„å‘³ç€ï¼Œåªè¦æœ‰ä¸€ä¸ªåŸå§‹çš„æ•°æ®ç»“æ„ï¼Œä½ å°±å¯ä»¥å…ˆå¯¹å®ƒçš„å€¼è¿›è¡Œå¤„ç†ï¼Œç„¶åè½¬æˆè§„èŒƒçš„æ•°ç»„ç»“æ„ï¼Œè¿›è€Œå°±å¯ä»¥ä½¿ç”¨æ•°é‡ä¼—å¤šçš„æ•°ç»„æ–¹æ³•ã€‚ 12Array.from(&#123; length: 2 &#125;, () =&gt; 'jack')// ['jack', 'jack'] ä¸Šé¢ä»£ç ä¸­ï¼ŒArray.fromçš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šäº†ç¬¬äºŒä¸ªå‚æ•°è¿è¡Œçš„æ¬¡æ•°ã€‚è¿™ç§ç‰¹æ€§å¯ä»¥è®©è¯¥æ–¹æ³•çš„ç”¨æ³•å˜å¾—éå¸¸çµæ´»ã€‚ Array.from()çš„å¦ä¸€ä¸ªåº”ç”¨æ˜¯ï¼Œå°†å­—ç¬¦ä¸²è½¬ä¸ºæ•°ç»„ï¼Œç„¶åè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚å› ä¸ºå®ƒèƒ½æ­£ç¡®å¤„ç†å„ç§Unicodeå­—ç¬¦ï¼Œå¯ä»¥é¿å…JavaScriptå°†å¤§äº\\uFFFFçš„Unicodeå­—ç¬¦ï¼Œç®—ä½œä¸¤ä¸ªå­—ç¬¦çš„bugã€‚ 123function countSymbols(string) &#123; return Array.from(string).length;&#125; Array.of()Array.ofæ–¹æ³•ç”¨äºå°†ä¸€ç»„å€¼ï¼Œè½¬æ¢ä¸ºæ•°ç»„ã€‚ 123Array.of(3, 11, 8) // [3,11,8]Array.of(3) // [3]Array.of(3).length // 1 è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ç›®çš„ï¼Œæ˜¯å¼¥è¡¥æ•°ç»„æ„é€ å‡½æ•°Array()çš„ä¸è¶³ã€‚å› ä¸ºå‚æ•°ä¸ªæ•°çš„ä¸åŒï¼Œä¼šå¯¼è‡´Array()çš„è¡Œä¸ºæœ‰å·®å¼‚ã€‚ 123Array() // []Array(3) // [, , ,]Array(3, 11, 8) // [3, 11, 8] ä¸Šé¢ä»£ç ä¸­ï¼ŒArrayæ–¹æ³•æ²¡æœ‰å‚æ•°ã€ä¸€ä¸ªå‚æ•°ã€ä¸‰ä¸ªå‚æ•°æ—¶ï¼Œè¿”å›ç»“æœéƒ½ä¸ä¸€æ ·ã€‚åªæœ‰å½“å‚æ•°ä¸ªæ•°ä¸å°‘äº2ä¸ªæ—¶ï¼ŒArray()æ‰ä¼šè¿”å›ç”±å‚æ•°ç»„æˆçš„æ–°æ•°ç»„ã€‚å‚æ•°ä¸ªæ•°åªæœ‰ä¸€ä¸ªæ—¶ï¼Œå®é™…ä¸Šæ˜¯æŒ‡å®šæ•°ç»„çš„é•¿åº¦ã€‚ Array.ofåŸºæœ¬ä¸Šå¯ä»¥ç”¨æ¥æ›¿ä»£Array()æˆ–new Array()ï¼Œå¹¶ä¸”ä¸å­˜åœ¨ç”±äºå‚æ•°ä¸åŒè€Œå¯¼è‡´çš„é‡è½½ã€‚å®ƒçš„è¡Œä¸ºéå¸¸ç»Ÿä¸€ã€‚ 1234Array.of() // []Array.of(undefined) // [undefined]Array.of(1) // [1]Array.of(1, 2) // [1, 2] Array.ofæ€»æ˜¯è¿”å›å‚æ•°å€¼ç»„æˆçš„æ•°ç»„ã€‚å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œå°±è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ã€‚ Array.ofæ–¹æ³•å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¨¡æ‹Ÿå®ç°ã€‚ 123function ArrayOf()&#123; return [].slice.call(arguments);&#125; æ•°ç»„å®ä¾‹çš„copyWithin()æ•°ç»„å®ä¾‹çš„copyWithinæ–¹æ³•ï¼Œåœ¨å½“å‰æ•°ç»„å†…éƒ¨ï¼Œå°†æŒ‡å®šä½ç½®çš„æˆå‘˜å¤åˆ¶åˆ°å…¶ä»–ä½ç½®ï¼ˆä¼šè¦†ç›–åŸæœ‰æˆå‘˜ï¼‰ï¼Œç„¶åè¿”å›å½“å‰æ•°ç»„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¼šä¿®æ”¹å½“å‰æ•°ç»„ã€‚ 1Array.prototype.copyWithin(target, start = 0, end = this.length) å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ã€‚ targetï¼ˆå¿…éœ€ï¼‰ï¼šä»è¯¥ä½ç½®å¼€å§‹æ›¿æ¢æ•°æ®ã€‚ startï¼ˆå¯é€‰ï¼‰ï¼šä»è¯¥ä½ç½®å¼€å§‹è¯»å–æ•°æ®ï¼Œé»˜è®¤ä¸º0ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºå€’æ•°ã€‚ endï¼ˆå¯é€‰ï¼‰ï¼šåˆ°è¯¥ä½ç½®å‰åœæ­¢è¯»å–æ•°æ®ï¼Œé»˜è®¤ç­‰äºæ•°ç»„é•¿åº¦ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºå€’æ•°ã€‚ è¿™ä¸‰ä¸ªå‚æ•°éƒ½åº”è¯¥æ˜¯æ•°å€¼ï¼Œå¦‚æœä¸æ˜¯ï¼Œä¼šè‡ªåŠ¨è½¬ä¸ºæ•°å€¼ã€‚ 12[1, 2, 3, 4, 5].copyWithin(0, 3)// [4, 5, 3, 4, 5] ä¸Šé¢ä»£ç è¡¨ç¤ºå°†ä»3å·ä½ç›´åˆ°æ•°ç»„ç»“æŸçš„æˆå‘˜ï¼ˆ4å’Œ5ï¼‰ï¼Œå¤åˆ¶åˆ°ä»0å·ä½å¼€å§‹çš„ä½ç½®ï¼Œç»“æœè¦†ç›–äº†åŸæ¥çš„1å’Œ2ã€‚ ä¸‹é¢æ˜¯æ›´å¤šä¾‹å­ã€‚ 123456789101112131415161718192021// å°†3å·ä½å¤åˆ¶åˆ°0å·ä½[1, 2, 3, 4, 5].copyWithin(0, 3, 4)// [4, 2, 3, 4, 5]// -2ç›¸å½“äº3å·ä½ï¼Œ-1ç›¸å½“äº4å·ä½[1, 2, 3, 4, 5].copyWithin(0, -2, -1)// [4, 2, 3, 4, 5]// å°†3å·ä½å¤åˆ¶åˆ°0å·ä½[].copyWithin.call(&#123;length: 5, 3: 1&#125;, 0, 3)// &#123;0: 1, 3: 1, length: 5&#125;// å°†2å·ä½åˆ°æ•°ç»„ç»“æŸï¼Œå¤åˆ¶åˆ°0å·ä½var i32a = new Int32Array([1, 2, 3, 4, 5]);i32a.copyWithin(0, 2);// Int32Array [3, 4, 5, 4, 5]// å¯¹äºæ²¡æœ‰éƒ¨ç½²TypedArrayçš„copyWithinæ–¹æ³•çš„å¹³å°// éœ€è¦é‡‡ç”¨ä¸‹é¢çš„å†™æ³•[].copyWithin.call(new Int32Array([1, 2, 3, 4, 5]), 0, 3, 4);// Int32Array [4, 2, 3, 4, 5] æ•°ç»„å®ä¾‹çš„find()å’ŒfindIndex()æ•°ç»„å®ä¾‹çš„findæ–¹æ³•ï¼Œç”¨äºæ‰¾å‡ºç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„æˆå‘˜ã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ‰€æœ‰æ•°ç»„æˆå‘˜ä¾æ¬¡æ‰§è¡Œè¯¥å›è°ƒå‡½æ•°ï¼Œç›´åˆ°æ‰¾å‡ºç¬¬ä¸€ä¸ªè¿”å›å€¼ä¸ºtrueçš„æˆå‘˜ï¼Œç„¶åè¿”å›è¯¥æˆå‘˜ã€‚å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æˆå‘˜ï¼Œåˆ™è¿”å›undefinedã€‚ 12[1, 4, -5, 10].find((n) =&gt; n &lt; 0)// -5 ä¸Šé¢ä»£ç æ‰¾å‡ºæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå°äº0çš„æˆå‘˜ã€‚ 123[1, 5, 10, 15].find(function(value, index, arr) &#123; return value &gt; 9;&#125;) // 10 ä¸Šé¢ä»£ç ä¸­ï¼Œfindæ–¹æ³•çš„å›è°ƒå‡½æ•°å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºå½“å‰çš„å€¼ã€å½“å‰çš„ä½ç½®å’ŒåŸæ•°ç»„ã€‚ æ•°ç»„å®ä¾‹çš„findIndexæ–¹æ³•çš„ç”¨æ³•ä¸findæ–¹æ³•éå¸¸ç±»ä¼¼ï¼Œè¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„æˆå‘˜çš„ä½ç½®ï¼Œå¦‚æœæ‰€æœ‰æˆå‘˜éƒ½ä¸ç¬¦åˆæ¡ä»¶ï¼Œåˆ™è¿”å›-1ã€‚ 123[1, 5, 10, 15].findIndex(function(value, index, arr) &#123; return value &gt; 9;&#125;) // 2 è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå›è°ƒå‡½æ•°çš„thiså¯¹è±¡ã€‚ å¦å¤–ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥å‘ç°NaNï¼Œå¼¥è¡¥äº†æ•°ç»„çš„IndexOfæ–¹æ³•çš„ä¸è¶³ã€‚ 12345[NaN].indexOf(NaN)// -1[NaN].findIndex(y =&gt; Object.is(NaN, y))// 0 ä¸Šé¢ä»£ç ä¸­ï¼ŒindexOfæ–¹æ³•æ— æ³•è¯†åˆ«æ•°ç»„çš„NaNæˆå‘˜ï¼Œä½†æ˜¯findIndexæ–¹æ³•å¯ä»¥å€ŸåŠ©Object.isæ–¹æ³•åšåˆ°ã€‚ æ•°ç»„å®ä¾‹çš„fill()fillæ–¹æ³•ä½¿ç”¨ç»™å®šå€¼ï¼Œå¡«å……ä¸€ä¸ªæ•°ç»„ã€‚ 12345['a', 'b', 'c'].fill(7)// [7, 7, 7]new Array(3).fill(7)// [7, 7, 7] ä¸Šé¢ä»£ç è¡¨æ˜ï¼Œfillæ–¹æ³•ç”¨äºç©ºæ•°ç»„çš„åˆå§‹åŒ–éå¸¸æ–¹ä¾¿ã€‚æ•°ç»„ä¸­å·²æœ‰çš„å…ƒç´ ï¼Œä¼šè¢«å…¨éƒ¨æŠ¹å»ã€‚ fillæ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç”¨äºæŒ‡å®šå¡«å……çš„èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚ 12['a', 'b', 'c'].fill(7, 1, 2)// ['a', 7, 'c'] ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œfillæ–¹æ³•ä»1å·ä½å¼€å§‹ï¼Œå‘åŸæ•°ç»„å¡«å……7ï¼Œåˆ°2å·ä½ä¹‹å‰ç»“æŸã€‚ æ•°ç»„å®ä¾‹çš„entries()ï¼Œkeys()å’Œvalues()ES6æä¾›ä¸‰ä¸ªæ–°çš„æ–¹æ³•â€”â€”entries()ï¼Œkeys()å’Œvalues()â€”â€”ç”¨äºéå†æ•°ç»„ã€‚å®ƒä»¬éƒ½è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼ˆè¯¦è§ã€ŠIteratorã€‹ä¸€ç« ï¼‰ï¼Œå¯ä»¥ç”¨for...ofå¾ªç¯è¿›è¡Œéå†ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯keys()æ˜¯å¯¹é”®åçš„éå†ã€values()æ˜¯å¯¹é”®å€¼çš„éå†ï¼Œentries()æ˜¯å¯¹é”®å€¼å¯¹çš„éå†ã€‚ 1234567891011121314151617for (let index of ['a', 'b'].keys()) &#123; console.log(index);&#125;// 0// 1for (let elem of ['a', 'b'].values()) &#123; console.log(elem);&#125;// 'a'// 'b'for (let [index, elem] of ['a', 'b'].entries()) &#123; console.log(index, elem);&#125;// 0 \"a\"// 1 \"b\" å¦‚æœä¸ä½¿ç”¨for...ofå¾ªç¯ï¼Œå¯ä»¥æ‰‹åŠ¨è°ƒç”¨éå†å™¨å¯¹è±¡çš„nextæ–¹æ³•ï¼Œè¿›è¡Œéå†ã€‚ 12345let letter = ['a', 'b', 'c'];let entries = letter.entries();console.log(entries.next().value); // [0, 'a']console.log(entries.next().value); // [1, 'b']console.log(entries.next().value); // [2, 'c'] æ•°ç»„å®ä¾‹çš„includes()Array.prototype.includesæ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ç»™å®šçš„å€¼ï¼Œä¸å­—ç¬¦ä¸²çš„includesæ–¹æ³•ç±»ä¼¼ã€‚è¯¥æ–¹æ³•å±äºES7ï¼Œä½†Babelè½¬ç å™¨å·²ç»æ”¯æŒã€‚ 123[1, 2, 3].includes(2); // true[1, 2, 3].includes(4); // false[1, 2, NaN].includes(NaN); // true è¯¥æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæœç´¢çš„èµ·å§‹ä½ç½®ï¼Œé»˜è®¤ä¸º0ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸ºè´Ÿæ•°ï¼Œåˆ™è¡¨ç¤ºå€’æ•°çš„ä½ç½®ï¼Œå¦‚æœè¿™æ—¶å®ƒå¤§äºæ•°ç»„é•¿åº¦ï¼ˆæ¯”å¦‚ç¬¬äºŒä¸ªå‚æ•°ä¸º-4ï¼Œä½†æ•°ç»„é•¿åº¦ä¸º3ï¼‰ï¼Œåˆ™ä¼šé‡ç½®ä¸ºä»0å¼€å§‹ã€‚ 12[1, 2, 3].includes(3, 3); // false[1, 2, 3].includes(3, -1); // true æ²¡æœ‰è¯¥æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨æ•°ç»„çš„indexOfæ–¹æ³•ï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«æŸä¸ªå€¼ã€‚ 123if (arr.indexOf(el) !== -1) &#123; // ...&#125; indexOfæ–¹æ³•æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼Œä¸€æ˜¯ä¸å¤Ÿè¯­ä¹‰åŒ–ï¼Œå®ƒçš„å«ä¹‰æ˜¯æ‰¾åˆ°å‚æ•°å€¼çš„ç¬¬ä¸€ä¸ªå‡ºç°ä½ç½®ï¼Œæ‰€ä»¥è¦å»æ¯”è¾ƒæ˜¯å¦ä¸ç­‰äº-1ï¼Œè¡¨è¾¾èµ·æ¥ä¸å¤Ÿç›´è§‚ã€‚äºŒæ˜¯ï¼Œå®ƒå†…éƒ¨ä½¿ç”¨ä¸¥æ ¼ç›¸å½“è¿ç®—ç¬¦ï¼ˆ===ï¼‰è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¼šå¯¼è‡´å¯¹NaNçš„è¯¯åˆ¤ã€‚ 12[NaN].indexOf(NaN)// -1 includesä½¿ç”¨çš„æ˜¯ä¸ä¸€æ ·çš„åˆ¤æ–­ç®—æ³•ï¼Œå°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚ 12[NaN].includes(NaN)// true ä¸‹é¢ä»£ç ç”¨æ¥æ£€æŸ¥å½“å‰ç¯å¢ƒæ˜¯å¦æ”¯æŒè¯¥æ–¹æ³•ï¼Œå¦‚æœä¸æ”¯æŒï¼Œéƒ¨ç½²ä¸€ä¸ªç®€æ˜“çš„æ›¿ä»£ç‰ˆæœ¬ã€‚ 123456const contains = (() =&gt; Array.prototype.includes ? (arr, value) =&gt; arr.includes(value) : (arr, value) =&gt; arr.some(el =&gt; el === value))();contains([\"foo\", \"bar\"], \"baz\"); // =&gt; false å¦å¤–ï¼ŒMapå’ŒSetæ•°æ®ç»“æ„æœ‰ä¸€ä¸ªhasæ–¹æ³•ï¼Œéœ€è¦æ³¨æ„ä¸includesåŒºåˆ†ã€‚ Mapç»“æ„çš„hasæ–¹æ³•ï¼Œæ˜¯ç”¨æ¥æŸ¥æ‰¾é”®åçš„ï¼Œæ¯”å¦‚Map.prototype.has(key)ã€WeakMap.prototype.has(key)ã€Reflect.has(target, propertyKey)ã€‚ Setç»“æ„çš„hasæ–¹æ³•ï¼Œæ˜¯ç”¨æ¥æŸ¥æ‰¾å€¼çš„ï¼Œæ¯”å¦‚Set.prototype.has(value)ã€WeakSet.prototype.has(value)ã€‚ æ•°ç»„çš„ç©ºä½æ•°ç»„çš„ç©ºä½æŒ‡ï¼Œæ•°ç»„çš„æŸä¸€ä¸ªä½ç½®æ²¡æœ‰ä»»ä½•å€¼ã€‚æ¯”å¦‚ï¼ŒArrayæ„é€ å‡½æ•°è¿”å›çš„æ•°ç»„éƒ½æ˜¯ç©ºä½ã€‚ 1Array(3) // [, , ,] ä¸Šé¢ä»£ç ä¸­ï¼ŒArray(3)è¿”å›ä¸€ä¸ªå…·æœ‰3ä¸ªç©ºä½çš„æ•°ç»„ã€‚ æ³¨æ„ï¼Œç©ºä½ä¸æ˜¯undefinedï¼Œä¸€ä¸ªä½ç½®çš„å€¼ç­‰äºundefinedï¼Œä¾ç„¶æ˜¯æœ‰å€¼çš„ã€‚ç©ºä½æ˜¯æ²¡æœ‰ä»»ä½•å€¼ï¼Œinè¿ç®—ç¬¦å¯ä»¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚ 120 in [undefined, undefined, undefined] // true0 in [, , ,] // false ä¸Šé¢ä»£ç è¯´æ˜ï¼Œç¬¬ä¸€ä¸ªæ•°ç»„çš„0å·ä½ç½®æ˜¯æœ‰å€¼çš„ï¼Œç¬¬äºŒä¸ªæ•°ç»„çš„0å·ä½ç½®æ²¡æœ‰å€¼ã€‚ ES5å¯¹ç©ºä½çš„å¤„ç†ï¼Œå·²ç»å¾ˆä¸ä¸€è‡´äº†ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¼šå¿½ç•¥ç©ºä½ã€‚ forEach(), filter(), every() å’Œsome()éƒ½ä¼šè·³è¿‡ç©ºä½ã€‚ map()ä¼šè·³è¿‡ç©ºä½ï¼Œä½†ä¼šä¿ç•™è¿™ä¸ªå€¼ join()å’ŒtoString()ä¼šå°†ç©ºä½è§†ä¸ºundefinedï¼Œè€Œundefinedå’Œnullä¼šè¢«å¤„ç†æˆç©ºå­—ç¬¦ä¸²ã€‚ 1234567891011121314151617181920// forEachæ–¹æ³•[,'a'].forEach((x,i) =&gt; console.log(i)); // 1// filteræ–¹æ³•['a',,'b'].filter(x =&gt; true) // ['a','b']// everyæ–¹æ³•[,'a'].every(x =&gt; x==='a') // true// someæ–¹æ³•[,'a'].some(x =&gt; x !== 'a') // false// mapæ–¹æ³•[,'a'].map(x =&gt; 1) // [,1]// joinæ–¹æ³•[,'a',undefined,null].join('#') // \"#a##\"// toStringæ–¹æ³•[,'a',undefined,null].toString() // \",a,,\" ES6åˆ™æ˜¯æ˜ç¡®å°†ç©ºä½è½¬ä¸ºundefinedã€‚ Array.fromæ–¹æ³•ä¼šå°†æ•°ç»„çš„ç©ºä½ï¼Œè½¬ä¸ºundefinedï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•ä¸ä¼šå¿½ç•¥ç©ºä½ã€‚ 12Array.from(['a',,'b'])// [ \"a\", undefined, \"b\" ] æ‰©å±•è¿ç®—ç¬¦ï¼ˆ...ï¼‰ä¹Ÿä¼šå°†ç©ºä½è½¬ä¸ºundefinedã€‚ 12[...['a',,'b']]// [ \"a\", undefined, \"b\" ] copyWithin()ä¼šè¿ç©ºä½ä¸€èµ·æ‹·è´ã€‚ 1[,'a','b',,].copyWithin(2,0) // [,\"a\",,\"a\"] fill()ä¼šå°†ç©ºä½è§†ä¸ºæ­£å¸¸çš„æ•°ç»„ä½ç½®ã€‚ 1new Array(3).fill('a') // [\"a\",\"a\",\"a\"] for...ofå¾ªç¯ä¹Ÿä¼šéå†ç©ºä½ã€‚ 123456let arr = [, ,];for (let i of arr) &#123; console.log(1);&#125;// 1// 1 ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„arræœ‰ä¸¤ä¸ªç©ºä½ï¼Œfor...ofå¹¶æ²¡æœ‰å¿½ç•¥å®ƒä»¬ã€‚å¦‚æœæ”¹æˆmapæ–¹æ³•éå†ï¼Œç©ºä½æ˜¯ä¼šè·³è¿‡çš„ã€‚ entries()ã€keys()ã€values()ã€find()å’ŒfindIndex()ä¼šå°†ç©ºä½å¤„ç†æˆundefinedã€‚ 1234567891011121314// entries()[...[,'a'].entries()] // [[0,undefined], [1,\"a\"]]// keys()[...[,'a'].keys()] // [0,1]// values()[...[,'a'].values()] // [undefined,\"a\"]// find()[,'a'].find(x =&gt; true) // undefined// findIndex()[,'a'].findIndex(x =&gt; true) // 0 ç”±äºç©ºä½çš„å¤„ç†è§„åˆ™éå¸¸ä¸ç»Ÿä¸€ï¼Œæ‰€ä»¥å»ºè®®é¿å…å‡ºç°ç©ºä½ã€‚","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"Array","slug":"Array","permalink":"http://microzz.com/tags/Array/"}]},{"title":"æ•°å€¼çš„æ‰©å±•","date":"2016-11-25T09:45:19.000Z","path":"2016/11/25/number/","text":"æ•°å€¼çš„æ‰©å±•äºŒè¿›åˆ¶å’Œå…«è¿›åˆ¶è¡¨ç¤ºæ³•ES6æä¾›äº†äºŒè¿›åˆ¶å’Œå…«è¿›åˆ¶æ•°å€¼çš„æ–°çš„å†™æ³•ï¼Œåˆ†åˆ«ç”¨å‰ç¼€0bï¼ˆæˆ–0Bï¼‰å’Œ0oï¼ˆæˆ–0Oï¼‰è¡¨ç¤ºã€‚ 120b111110111 === 503 // true0o767 === 503 // true ä»ES5å¼€å§‹ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¹‹ä¸­ï¼Œå…«è¿›åˆ¶å°±ä¸å†å…è®¸ä½¿ç”¨å‰ç¼€0è¡¨ç¤ºï¼ŒES6è¿›ä¸€æ­¥æ˜ç¡®ï¼Œè¦ä½¿ç”¨å‰ç¼€0oè¡¨ç¤ºã€‚ 12345678910// éä¸¥æ ¼æ¨¡å¼(function()&#123; console.log(0o11 === 011);&#125;)() // true// ä¸¥æ ¼æ¨¡å¼(function()&#123; 'use strict'; console.log(0o11 === 011);&#125;)() // Uncaught SyntaxError: Octal literals are not allowed in strict mode. å¦‚æœè¦å°†0bå’Œ0oå‰ç¼€çš„å­—ç¬¦ä¸²æ•°å€¼è½¬ä¸ºåè¿›åˆ¶ï¼Œè¦ä½¿ç”¨Numberæ–¹æ³•ã€‚ 12Number('0b111') // 7Number('0o10') // 8 Number.isFinite(), Number.isNaN()ES6åœ¨Numberå¯¹è±¡ä¸Šï¼Œæ–°æä¾›äº†Number.isFinite()å’ŒNumber.isNaN()ä¸¤ä¸ªæ–¹æ³•ã€‚ Number.isFinite()ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªæ•°å€¼æ˜¯å¦ä¸ºæœ‰é™çš„ï¼ˆfiniteï¼‰ã€‚ 12345678Number.isFinite(15); // trueNumber.isFinite(0.8); // trueNumber.isFinite(NaN); // falseNumber.isFinite(Infinity); // falseNumber.isFinite(-Infinity); // falseNumber.isFinite('foo'); // falseNumber.isFinite('15'); // falseNumber.isFinite(true); // false ES5å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç ï¼Œéƒ¨ç½²Number.isFiniteæ–¹æ³•ã€‚ 123456789101112(function (global) &#123; var global_isFinite = global.isFinite; Object.defineProperty(Number, 'isFinite', &#123; value: function isFinite(value) &#123; return typeof value === 'number' &amp;&amp; global_isFinite(value); &#125;, configurable: true, enumerable: false, writable: true &#125;);&#125;)(this); Number.isNaN()ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºNaNã€‚ 1234567Number.isNaN(NaN) // trueNumber.isNaN(15) // falseNumber.isNaN('15') // falseNumber.isNaN(true) // falseNumber.isNaN(9/NaN) // trueNumber.isNaN('true'/0) // trueNumber.isNaN('true'/'true') // true ES5é€šè¿‡ä¸‹é¢çš„ä»£ç ï¼Œéƒ¨ç½²Number.isNaN()ã€‚ 123456789101112(function (global) &#123; var global_isNaN = global.isNaN; Object.defineProperty(Number, 'isNaN', &#123; value: function isNaN(value) &#123; return typeof value === 'number' &amp;&amp; global_isNaN(value); &#125;, configurable: true, enumerable: false, writable: true &#125;);&#125;)(this); å®ƒä»¬ä¸ä¼ ç»Ÿçš„å…¨å±€æ–¹æ³•isFinite()å’ŒisNaN()çš„åŒºåˆ«åœ¨äºï¼Œä¼ ç»Ÿæ–¹æ³•å…ˆè°ƒç”¨Number()å°†éæ•°å€¼çš„å€¼è½¬ä¸ºæ•°å€¼ï¼Œå†è¿›è¡Œåˆ¤æ–­ï¼Œè€Œè¿™ä¸¤ä¸ªæ–°æ–¹æ³•åªå¯¹æ•°å€¼æœ‰æ•ˆï¼Œéæ•°å€¼ä¸€å¾‹è¿”å›falseã€‚ 123456789isFinite(25) // trueisFinite(\"25\") // trueNumber.isFinite(25) // trueNumber.isFinite(\"25\") // falseisNaN(NaN) // trueisNaN(\"NaN\") // trueNumber.isNaN(NaN) // trueNumber.isNaN(\"NaN\") // false Number.parseInt(), Number.parseFloat()ES6å°†å…¨å±€æ–¹æ³•parseInt()å’ŒparseFloat()ï¼Œç§»æ¤åˆ°Numberå¯¹è±¡ä¸Šé¢ï¼Œè¡Œä¸ºå®Œå…¨ä¿æŒä¸å˜ã€‚ 1234567// ES5çš„å†™æ³•parseInt('12.34') // 12parseFloat('123.45#') // 123.45// ES6çš„å†™æ³•Number.parseInt('12.34') // 12Number.parseFloat('123.45#') // 123.45 è¿™æ ·åšçš„ç›®çš„ï¼Œæ˜¯é€æ­¥å‡å°‘å…¨å±€æ€§æ–¹æ³•ï¼Œä½¿å¾—è¯­è¨€é€æ­¥æ¨¡å—åŒ–ã€‚ 12Number.parseInt === parseInt // trueNumber.parseFloat === parseFloat // true Number.isInteger()Number.isInteger()ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºæ•´æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨JavaScriptå†…éƒ¨ï¼Œæ•´æ•°å’Œæµ®ç‚¹æ•°æ˜¯åŒæ ·çš„å‚¨å­˜æ–¹æ³•ï¼Œæ‰€ä»¥3å’Œ3.0è¢«è§†ä¸ºåŒä¸€ä¸ªå€¼ã€‚ 12345Number.isInteger(25) // trueNumber.isInteger(25.0) // trueNumber.isInteger(25.1) // falseNumber.isInteger(\"15\") // falseNumber.isInteger(true) // false ES5å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç ï¼Œéƒ¨ç½²Number.isInteger()ã€‚ 123456789101112131415(function (global) &#123; var floor = Math.floor, isFinite = global.isFinite; Object.defineProperty(Number, 'isInteger', &#123; value: function isInteger(value) &#123; return typeof value === 'number' &amp;&amp; isFinite(value) &amp;&amp; value &gt; -9007199254740992 &amp;&amp; value &lt; 9007199254740992 &amp;&amp; floor(value) === value; &#125;, configurable: true, enumerable: false, writable: true &#125;);&#125;)(this); Number.EPSILONES6åœ¨Numberå¯¹è±¡ä¸Šé¢ï¼Œæ–°å¢ä¸€ä¸ªæå°çš„å¸¸é‡Number.EPSILONã€‚ 1234Number.EPSILON// 2.220446049250313e-16Number.EPSILON.toFixed(20)// '0.00000000000000022204' å¼•å…¥ä¸€ä¸ªè¿™ä¹ˆå°çš„é‡çš„ç›®çš„ï¼Œåœ¨äºä¸ºæµ®ç‚¹æ•°è®¡ç®—ï¼Œè®¾ç½®ä¸€ä¸ªè¯¯å·®èŒƒå›´ã€‚æˆ‘ä»¬çŸ¥é“æµ®ç‚¹æ•°è®¡ç®—æ˜¯ä¸ç²¾ç¡®çš„ã€‚ 123456780.1 + 0.2// 0.300000000000000040.1 + 0.2 - 0.3// 5.551115123125783e-175.551115123125783e-17.toFixed(20)// '0.00000000000000005551' ä½†æ˜¯å¦‚æœè¿™ä¸ªè¯¯å·®èƒ½å¤Ÿå°äºNumber.EPSILONï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºå¾—åˆ°äº†æ­£ç¡®ç»“æœã€‚ 125.551115123125783e-17 &lt; Number.EPSILON// true å› æ­¤ï¼ŒNumber.EPSILONçš„å®è´¨æ˜¯ä¸€ä¸ªå¯ä»¥æ¥å—çš„è¯¯å·®èŒƒå›´ã€‚ 1234567function withinErrorMargin (left, right) &#123; return Math.abs(left - right) &lt; Number.EPSILON;&#125;withinErrorMargin(0.1 + 0.2, 0.3)// truewithinErrorMargin(0.2 + 0.2, 0.3)// false ä¸Šé¢çš„ä»£ç ä¸ºæµ®ç‚¹æ•°è¿ç®—ï¼Œéƒ¨ç½²äº†ä¸€ä¸ªè¯¯å·®æ£€æŸ¥å‡½æ•°ã€‚ å®‰å…¨æ•´æ•°å’ŒNumber.isSafeInteger()JavaScriptèƒ½å¤Ÿå‡†ç¡®è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´åœ¨-2^53åˆ°2^53ä¹‹é—´ï¼ˆä¸å«ä¸¤ä¸ªç«¯ç‚¹ï¼‰ï¼Œè¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œæ— æ³•ç²¾ç¡®è¡¨ç¤ºè¿™ä¸ªå€¼ã€‚ 1234567Math.pow(2, 53) // 90071992547409929007199254740992 // 90071992547409929007199254740993 // 9007199254740992Math.pow(2, 53) === Math.pow(2, 53) + 1// true ä¸Šé¢ä»£ç ä¸­ï¼Œè¶…å‡º2çš„53æ¬¡æ–¹ä¹‹åï¼Œä¸€ä¸ªæ•°å°±ä¸ç²¾ç¡®äº†ã€‚ ES6å¼•å…¥äº†Number.MAX_SAFE_INTEGERå’ŒNumber.MIN_SAFE_INTEGERè¿™ä¸¤ä¸ªå¸¸é‡ï¼Œç”¨æ¥è¡¨ç¤ºè¿™ä¸ªèŒƒå›´çš„ä¸Šä¸‹é™ã€‚ 123456789Number.MAX_SAFE_INTEGER === Math.pow(2, 53) - 1// trueNumber.MAX_SAFE_INTEGER === 9007199254740991// trueNumber.MIN_SAFE_INTEGER === -Number.MAX_SAFE_INTEGER// trueNumber.MIN_SAFE_INTEGER === -9007199254740991// true ä¸Šé¢ä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°JavaScriptèƒ½å¤Ÿç²¾ç¡®è¡¨ç¤ºçš„æé™ã€‚ Number.isSafeInteger()åˆ™æ˜¯ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦è½åœ¨è¿™ä¸ªèŒƒå›´ä¹‹å†…ã€‚ 123456789101112131415Number.isSafeInteger('a') // falseNumber.isSafeInteger(null) // falseNumber.isSafeInteger(NaN) // falseNumber.isSafeInteger(Infinity) // falseNumber.isSafeInteger(-Infinity) // falseNumber.isSafeInteger(3) // trueNumber.isSafeInteger(1.2) // falseNumber.isSafeInteger(9007199254740990) // trueNumber.isSafeInteger(9007199254740992) // falseNumber.isSafeInteger(Number.MIN_SAFE_INTEGER - 1) // falseNumber.isSafeInteger(Number.MIN_SAFE_INTEGER) // trueNumber.isSafeInteger(Number.MAX_SAFE_INTEGER) // trueNumber.isSafeInteger(Number.MAX_SAFE_INTEGER + 1) // false è¿™ä¸ªå‡½æ•°çš„å®ç°å¾ˆç®€å•ï¼Œå°±æ˜¯è·Ÿå®‰å…¨æ•´æ•°çš„ä¸¤ä¸ªè¾¹ç•Œå€¼æ¯”è¾ƒä¸€ä¸‹ã€‚ 123456Number.isSafeInteger = function (n) &#123; return (typeof n === 'number' &amp;&amp; Math.round(n) === n &amp;&amp; Number.MIN_SAFE_INTEGER &lt;= n &amp;&amp; n &lt;= Number.MAX_SAFE_INTEGER);&#125; å®é™…ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œéœ€è¦æ³¨æ„ã€‚éªŒè¯è¿ç®—ç»“æœæ˜¯å¦è½åœ¨å®‰å…¨æ•´æ•°çš„èŒƒå›´å†…ï¼Œä¸è¦åªéªŒè¯è¿ç®—ç»“æœï¼Œè€Œè¦åŒæ—¶éªŒè¯å‚ä¸è¿ç®—çš„æ¯ä¸ªå€¼ã€‚ 123456789Number.isSafeInteger(9007199254740993)// falseNumber.isSafeInteger(990)// trueNumber.isSafeInteger(9007199254740993 - 990)// true9007199254740993 - 990// è¿”å›ç»“æœ 9007199254740002// æ­£ç¡®ç­”æ¡ˆåº”è¯¥æ˜¯ 9007199254740003 ä¸Šé¢ä»£ç ä¸­ï¼Œ9007199254740993ä¸æ˜¯ä¸€ä¸ªå®‰å…¨æ•´æ•°ï¼Œä½†æ˜¯Number.isSafeIntegerä¼šè¿”å›ç»“æœï¼Œæ˜¾ç¤ºè®¡ç®—ç»“æœæ˜¯å®‰å…¨çš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œè¿™ä¸ªæ•°è¶…å‡ºäº†ç²¾åº¦èŒƒå›´ï¼Œå¯¼è‡´åœ¨è®¡ç®—æœºå†…éƒ¨ï¼Œä»¥9007199254740992çš„å½¢å¼å‚¨å­˜ã€‚ 129007199254740993 === 9007199254740992// true æ‰€ä»¥ï¼Œå¦‚æœåªéªŒè¯è¿ç®—ç»“æœæ˜¯å¦ä¸ºå®‰å…¨æ•´æ•°ï¼Œå¾ˆå¯èƒ½å¾—åˆ°é”™è¯¯ç»“æœã€‚ä¸‹é¢çš„å‡½æ•°å¯ä»¥åŒæ—¶éªŒè¯ä¸¤ä¸ªè¿ç®—æ•°å’Œè¿ç®—ç»“æœã€‚ 12345678910111213141516function trusty (left, right, result) &#123; if ( Number.isSafeInteger(left) &amp;&amp; Number.isSafeInteger(right) &amp;&amp; Number.isSafeInteger(result) ) &#123; return result; &#125; throw new RangeError('Operation cannot be trusted!');&#125;trusty(9007199254740993, 990, 9007199254740993 - 990)// RangeError: Operation cannot be trusted!trusty(1, 2, 3)// 3 Mathå¯¹è±¡çš„æ‰©å±•ES6åœ¨Mathå¯¹è±¡ä¸Šæ–°å¢äº†17ä¸ªä¸æ•°å­¦ç›¸å…³çš„æ–¹æ³•ã€‚æ‰€æœ‰è¿™äº›æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œåªèƒ½åœ¨Mathå¯¹è±¡ä¸Šè°ƒç”¨ã€‚ Math.trunc()Math.truncæ–¹æ³•ç”¨äºå»é™¤ä¸€ä¸ªæ•°çš„å°æ•°éƒ¨åˆ†ï¼Œè¿”å›æ•´æ•°éƒ¨åˆ†ã€‚ 12345Math.trunc(4.1) // 4Math.trunc(4.9) // 4Math.trunc(-4.1) // -4Math.trunc(-4.9) // -4Math.trunc(-0.1234) // -0 å¯¹äºéæ•°å€¼ï¼ŒMath.truncå†…éƒ¨ä½¿ç”¨Numberæ–¹æ³•å°†å…¶å…ˆè½¬ä¸ºæ•°å€¼ã€‚ 12Math.trunc('123.456')// 123 å¯¹äºç©ºå€¼å’Œæ— æ³•æˆªå–æ•´æ•°çš„å€¼ï¼Œè¿”å›NaNã€‚ 123Math.trunc(NaN); // NaNMath.trunc('foo'); // NaNMath.trunc(); // NaN å¯¹äºæ²¡æœ‰éƒ¨ç½²è¿™ä¸ªæ–¹æ³•çš„ç¯å¢ƒï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¨¡æ‹Ÿã€‚ 123Math.trunc = Math.trunc || function(x) &#123; return x &lt; 0 ? Math.ceil(x) : Math.floor(x);&#125;; Math.sign()Math.signæ–¹æ³•ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°åˆ°åº•æ˜¯æ­£æ•°ã€è´Ÿæ•°ã€è¿˜æ˜¯é›¶ã€‚ å®ƒä¼šè¿”å›äº”ç§å€¼ã€‚ å‚æ•°ä¸ºæ­£æ•°ï¼Œè¿”å›+1ï¼› å‚æ•°ä¸ºè´Ÿæ•°ï¼Œè¿”å›-1ï¼› å‚æ•°ä¸º0ï¼Œè¿”å›0ï¼› å‚æ•°ä¸º-0ï¼Œè¿”å›-0; å…¶ä»–å€¼ï¼Œè¿”å›NaNã€‚ 1234567Math.sign(-5) // -1Math.sign(5) // +1Math.sign(0) // +0Math.sign(-0) // -0Math.sign(NaN) // NaNMath.sign('foo'); // NaNMath.sign(); // NaN å¯¹äºæ²¡æœ‰éƒ¨ç½²è¿™ä¸ªæ–¹æ³•çš„ç¯å¢ƒï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¨¡æ‹Ÿã€‚ 1234567Math.sign = Math.sign || function(x) &#123; x = +x; // convert to a number if (x === 0 || isNaN(x)) &#123; return x; &#125; return x &gt; 0 ? 1 : -1;&#125;; Math.cbrt()Math.cbrtæ–¹æ³•ç”¨äºè®¡ç®—ä¸€ä¸ªæ•°çš„ç«‹æ–¹æ ¹ã€‚ 1234Math.cbrt(-1) // -1Math.cbrt(0) // 0Math.cbrt(1) // 1Math.cbrt(2) // 1.2599210498948734 å¯¹äºéæ•°å€¼ï¼ŒMath.cbrtæ–¹æ³•å†…éƒ¨ä¹Ÿæ˜¯å…ˆä½¿ç”¨Numberæ–¹æ³•å°†å…¶è½¬ä¸ºæ•°å€¼ã€‚ 12Math.cbrt('8') // 2Math.cbrt('hello') // NaN å¯¹äºæ²¡æœ‰éƒ¨ç½²è¿™ä¸ªæ–¹æ³•çš„ç¯å¢ƒï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¨¡æ‹Ÿã€‚ 1234Math.cbrt = Math.cbrt || function(x) &#123; var y = Math.pow(Math.abs(x), 1/3); return x &lt; 0 ? -y : y;&#125;; Math.clz32()JavaScriptçš„æ•´æ•°ä½¿ç”¨32ä½äºŒè¿›åˆ¶å½¢å¼è¡¨ç¤ºï¼ŒMath.clz32æ–¹æ³•è¿”å›ä¸€ä¸ªæ•°çš„32ä½æ— ç¬¦å·æ•´æ•°å½¢å¼æœ‰å¤šå°‘ä¸ªå‰å¯¼0ã€‚ 12345Math.clz32(0) // 32Math.clz32(1) // 31Math.clz32(1000) // 22Math.clz32(0b01000000000000000000000000000000) // 1Math.clz32(0b00100000000000000000000000000000) // 2 ä¸Šé¢ä»£ç ä¸­ï¼Œ0çš„äºŒè¿›åˆ¶å½¢å¼å…¨ä¸º0ï¼Œæ‰€ä»¥æœ‰32ä¸ªå‰å¯¼0ï¼›1çš„äºŒè¿›åˆ¶å½¢å¼æ˜¯0b1ï¼Œåªå 1ä½ï¼Œæ‰€ä»¥32ä½ä¹‹ä¸­æœ‰31ä¸ªå‰å¯¼0ï¼›1000çš„äºŒè¿›åˆ¶å½¢å¼æ˜¯0b1111101000ï¼Œä¸€å…±æœ‰10ä½ï¼Œæ‰€ä»¥32ä½ä¹‹ä¸­æœ‰22ä¸ªå‰å¯¼0ã€‚ clz32è¿™ä¸ªå‡½æ•°åå°±æ¥è‡ªâ€count leading zero bits in 32-bit binary representations of a numberâ€œï¼ˆè®¡ç®—32ä½æ•´æ•°çš„å‰å¯¼0ï¼‰çš„ç¼©å†™ã€‚ å·¦ç§»è¿ç®—ç¬¦ï¼ˆ&lt;&lt;ï¼‰ä¸Math.clz32æ–¹æ³•ç›´æ¥ç›¸å…³ã€‚ 12345Math.clz32(0) // 32Math.clz32(1) // 31Math.clz32(1 &lt;&lt; 1) // 30Math.clz32(1 &lt;&lt; 2) // 29Math.clz32(1 &lt;&lt; 29) // 2 å¯¹äºå°æ•°ï¼ŒMath.clz32æ–¹æ³•åªè€ƒè™‘æ•´æ•°éƒ¨åˆ†ã€‚ 12Math.clz32(3.2) // 30Math.clz32(3.9) // 30 å¯¹äºç©ºå€¼æˆ–å…¶ä»–ç±»å‹çš„å€¼ï¼ŒMath.clz32æ–¹æ³•ä¼šå°†å®ƒä»¬å…ˆè½¬ä¸ºæ•°å€¼ï¼Œç„¶åå†è®¡ç®—ã€‚ 12345678Math.clz32() // 32Math.clz32(NaN) // 32Math.clz32(Infinity) // 32Math.clz32(null) // 32Math.clz32('foo') // 32Math.clz32([]) // 32Math.clz32(&#123;&#125;) // 32Math.clz32(true) // 31 Math.imul()Math.imulæ–¹æ³•è¿”å›ä¸¤ä¸ªæ•°ä»¥32ä½å¸¦ç¬¦å·æ•´æ•°å½¢å¼ç›¸ä¹˜çš„ç»“æœï¼Œè¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ª32ä½çš„å¸¦ç¬¦å·æ•´æ•°ã€‚ 123Math.imul(2, 4) // 8Math.imul(-1, 8) // -8Math.imul(-2, -2) // 4 å¦‚æœåªè€ƒè™‘æœ€å32ä½ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒMath.imul(a, b)ä¸a * bçš„ç»“æœæ˜¯ç›¸åŒçš„ï¼Œå³è¯¥æ–¹æ³•ç­‰åŒäº(a * b)|0çš„æ•ˆæœï¼ˆè¶…è¿‡32ä½çš„éƒ¨åˆ†æº¢å‡ºï¼‰ã€‚ä¹‹æ‰€ä»¥éœ€è¦éƒ¨ç½²è¿™ä¸ªæ–¹æ³•ï¼Œæ˜¯å› ä¸ºJavaScriptæœ‰ç²¾åº¦é™åˆ¶ï¼Œè¶…è¿‡2çš„53æ¬¡æ–¹çš„å€¼æ— æ³•ç²¾ç¡®è¡¨ç¤ºã€‚è¿™å°±æ˜¯è¯´ï¼Œå¯¹äºé‚£äº›å¾ˆå¤§çš„æ•°çš„ä¹˜æ³•ï¼Œä½ä½æ•°å€¼å¾€å¾€éƒ½æ˜¯ä¸ç²¾ç¡®çš„ï¼ŒMath.imulæ–¹æ³•å¯ä»¥è¿”å›æ­£ç¡®çš„ä½ä½æ•°å€¼ã€‚ 1(0x7fffffff * 0x7fffffff)|0 // 0 ä¸Šé¢è¿™ä¸ªä¹˜æ³•ç®—å¼ï¼Œè¿”å›ç»“æœä¸º0ã€‚ä½†æ˜¯ç”±äºè¿™ä¸¤ä¸ªäºŒè¿›åˆ¶æ•°çš„æœ€ä½ä½éƒ½æ˜¯1ï¼Œæ‰€ä»¥è¿™ä¸ªç»“æœè‚¯å®šæ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸ºæ ¹æ®äºŒè¿›åˆ¶ä¹˜æ³•ï¼Œè®¡ç®—ç»“æœçš„äºŒè¿›åˆ¶æœ€ä½ä½åº”è¯¥ä¹Ÿæ˜¯1ã€‚è¿™ä¸ªé”™è¯¯å°±æ˜¯å› ä¸ºå®ƒä»¬çš„ä¹˜ç§¯è¶…è¿‡äº†2çš„53æ¬¡æ–¹ï¼ŒJavaScriptæ— æ³•ä¿å­˜é¢å¤–çš„ç²¾åº¦ï¼Œå°±æŠŠä½ä½çš„å€¼éƒ½å˜æˆäº†0ã€‚Math.imulæ–¹æ³•å¯ä»¥è¿”å›æ­£ç¡®çš„å€¼1ã€‚ 1Math.imul(0x7fffffff, 0x7fffffff) // 1 Math.fround()Math.froundæ–¹æ³•è¿”å›ä¸€ä¸ªæ•°çš„å•ç²¾åº¦æµ®ç‚¹æ•°å½¢å¼ã€‚ 12345Math.fround(0) // 0Math.fround(1) // 1Math.fround(1.337) // 1.3370000123977661Math.fround(1.5) // 1.5Math.fround(NaN) // NaN å¯¹äºæ•´æ•°æ¥è¯´ï¼ŒMath.froundæ–¹æ³•è¿”å›ç»“æœä¸ä¼šæœ‰ä»»ä½•ä¸åŒï¼ŒåŒºåˆ«ä¸»è¦æ˜¯é‚£äº›æ— æ³•ç”¨64ä¸ªäºŒè¿›åˆ¶ä½ç²¾ç¡®è¡¨ç¤ºçš„å°æ•°ã€‚è¿™æ—¶ï¼ŒMath.froundæ–¹æ³•ä¼šè¿”å›æœ€æ¥è¿‘è¿™ä¸ªå°æ•°çš„å•ç²¾åº¦æµ®ç‚¹æ•°ã€‚ å¯¹äºæ²¡æœ‰éƒ¨ç½²è¿™ä¸ªæ–¹æ³•çš„ç¯å¢ƒï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¨¡æ‹Ÿã€‚ 123Math.fround = Math.fround || function(x) &#123; return new Float32Array([x])[0];&#125;; Math.hypot()Math.hypotæ–¹æ³•è¿”å›æ‰€æœ‰å‚æ•°çš„å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ã€‚ 1234567Math.hypot(3, 4); // 5Math.hypot(3, 4, 5); // 7.0710678118654755Math.hypot(); // 0Math.hypot(NaN); // NaNMath.hypot(3, 4, 'foo'); // NaNMath.hypot(3, 4, '5'); // 7.0710678118654755Math.hypot(-3); // 3 ä¸Šé¢ä»£ç ä¸­ï¼Œ3çš„å¹³æ–¹åŠ ä¸Š4çš„å¹³æ–¹ï¼Œç­‰äº5çš„å¹³æ–¹ã€‚ å¦‚æœå‚æ•°ä¸æ˜¯æ•°å€¼ï¼ŒMath.hypotæ–¹æ³•ä¼šå°†å…¶è½¬ä¸ºæ•°å€¼ã€‚åªè¦æœ‰ä¸€ä¸ªå‚æ•°æ— æ³•è½¬ä¸ºæ•°å€¼ï¼Œå°±ä¼šè¿”å›NaNã€‚ å¯¹æ•°æ–¹æ³•ES6æ–°å¢äº†4ä¸ªå¯¹æ•°ç›¸å…³æ–¹æ³•ã€‚ ï¼ˆ1ï¼‰ Math.expm1() Math.expm1(x)è¿”å›ex - 1ï¼Œå³Math.exp(x) - 1ã€‚ 123Math.expm1(-1) // -0.6321205588285577Math.expm1(0) // 0Math.expm1(1) // 1.718281828459045 å¯¹äºæ²¡æœ‰éƒ¨ç½²è¿™ä¸ªæ–¹æ³•çš„ç¯å¢ƒï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¨¡æ‹Ÿã€‚ 123Math.expm1 = Math.expm1 || function(x) &#123; return Math.exp(x) - 1;&#125;; ï¼ˆ2ï¼‰Math.log1p() Math.log1p(x)æ–¹æ³•è¿”å›1 + xçš„è‡ªç„¶å¯¹æ•°ï¼Œå³Math.log(1 + x)ã€‚å¦‚æœxå°äº-1ï¼Œè¿”å›NaNã€‚ 1234Math.log1p(1) // 0.6931471805599453Math.log1p(0) // 0Math.log1p(-1) // -InfinityMath.log1p(-2) // NaN å¯¹äºæ²¡æœ‰éƒ¨ç½²è¿™ä¸ªæ–¹æ³•çš„ç¯å¢ƒï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¨¡æ‹Ÿã€‚ 123Math.log1p = Math.log1p || function(x) &#123; return Math.log(1 + x);&#125;; ï¼ˆ3ï¼‰Math.log10() Math.log10(x)è¿”å›ä»¥10ä¸ºåº•çš„xçš„å¯¹æ•°ã€‚å¦‚æœxå°äº0ï¼Œåˆ™è¿”å›NaNã€‚ 12345Math.log10(2) // 0.3010299956639812Math.log10(1) // 0Math.log10(0) // -InfinityMath.log10(-2) // NaNMath.log10(100000) // 5 å¯¹äºæ²¡æœ‰éƒ¨ç½²è¿™ä¸ªæ–¹æ³•çš„ç¯å¢ƒï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¨¡æ‹Ÿã€‚ 123Math.log10 = Math.log10 || function(x) &#123; return Math.log(x) / Math.LN10;&#125;; ï¼ˆ4ï¼‰Math.log2() Math.log2(x)è¿”å›ä»¥2ä¸ºåº•çš„xçš„å¯¹æ•°ã€‚å¦‚æœxå°äº0ï¼Œåˆ™è¿”å›NaNã€‚ 1234567Math.log2(3) // 1.584962500721156Math.log2(2) // 1Math.log2(1) // 0Math.log2(0) // -InfinityMath.log2(-2) // NaNMath.log2(1024) // 10Math.log2(1 &lt;&lt; 29) // 29 å¯¹äºæ²¡æœ‰éƒ¨ç½²è¿™ä¸ªæ–¹æ³•çš„ç¯å¢ƒï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¨¡æ‹Ÿã€‚ 123Math.log2 = Math.log2 || function(x) &#123; return Math.log(x) / Math.LN2;&#125;; ä¸‰è§’å‡½æ•°æ–¹æ³•ES6æ–°å¢äº†6ä¸ªä¸‰è§’å‡½æ•°æ–¹æ³•ã€‚ Math.sinh(x) è¿”å›xçš„åŒæ›²æ­£å¼¦ï¼ˆhyperbolic sineï¼‰ Math.cosh(x) è¿”å›xçš„åŒæ›²ä½™å¼¦ï¼ˆhyperbolic cosineï¼‰ Math.tanh(x) è¿”å›xçš„åŒæ›²æ­£åˆ‡ï¼ˆhyperbolic tangentï¼‰ Math.asinh(x) è¿”å›xçš„ååŒæ›²æ­£å¼¦ï¼ˆinverse hyperbolic sineï¼‰ Math.acosh(x) è¿”å›xçš„ååŒæ›²ä½™å¼¦ï¼ˆinverse hyperbolic cosineï¼‰ Math.atanh(x) è¿”å›xçš„ååŒæ›²æ­£åˆ‡ï¼ˆinverse hyperbolic tangentï¼‰ æŒ‡æ•°è¿ç®—ç¬¦ES7æ–°å¢äº†ä¸€ä¸ªæŒ‡æ•°è¿ç®—ç¬¦ï¼ˆ**ï¼‰ï¼Œç›®å‰Babelè½¬ç å™¨å·²ç»æ”¯æŒã€‚ 122 ** 2 // 42 ** 3 // 8 æŒ‡æ•°è¿ç®—ç¬¦å¯ä»¥ä¸ç­‰å·ç»“åˆï¼Œå½¢æˆä¸€ä¸ªæ–°çš„èµ‹å€¼è¿ç®—ç¬¦ï¼ˆ**=ï¼‰ã€‚ 1234567let a = 2;a **= 2;// ç­‰åŒäº a = a * a;let b = 3;b **= 3;// ç­‰åŒäº b = b * b * b;","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"Number","slug":"Number","permalink":"http://microzz.com/tags/Number/"}]},{"title":"æ­£åˆ™çš„æ‰©å±•(RegExp)","date":"2016-11-20T07:57:19.000Z","path":"2016/11/20/regex/","text":"æ­£åˆ™çš„æ‰©å±•RegExpæ„é€ å‡½æ•°åœ¨ES5ä¸­ï¼ŒRegExpæ„é€ å‡½æ•°çš„å‚æ•°æœ‰ä¸¤ç§æƒ…å†µã€‚ ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™æ—¶ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ï¼ˆflagï¼‰ã€‚ 123var regex = new RegExp('xyz', 'i');// ç­‰ä»·äºvar regex = /xyz/i; ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨ç¤ºå¼ï¼Œè¿™æ—¶ä¼šè¿”å›ä¸€ä¸ªåŸæœ‰æ­£åˆ™è¡¨è¾¾å¼çš„æ‹·è´ã€‚ 123var regex = new RegExp(/xyz/i);// ç­‰ä»·äºvar regex = /xyz/i; ä½†æ˜¯ï¼ŒES5ä¸å…è®¸æ­¤æ—¶ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ·»åŠ ä¿®é¥°ç¬¦ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ 12var regex = new RegExp(/xyz/, 'i');// Uncaught TypeError: Cannot supply flags when constructing one RegExp from another ES6æ”¹å˜äº†è¿™ç§è¡Œä¸ºã€‚å¦‚æœRegExpæ„é€ å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ­£åˆ™å¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¿®é¥°ç¬¦ã€‚è€Œä¸”ï¼Œè¿”å›çš„æ­£åˆ™è¡¨è¾¾å¼ä¼šå¿½ç•¥åŸæœ‰çš„æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ï¼Œåªä½¿ç”¨æ–°æŒ‡å®šçš„ä¿®é¥°ç¬¦ã€‚ 12new RegExp(/abc/ig, 'i').flags// \"i\" ä¸Šé¢ä»£ç ä¸­ï¼ŒåŸæœ‰æ­£åˆ™å¯¹è±¡çš„ä¿®é¥°ç¬¦æ˜¯igï¼Œå®ƒä¼šè¢«ç¬¬äºŒä¸ªå‚æ•°iè¦†ç›–ã€‚ å­—ç¬¦ä¸²çš„æ­£åˆ™æ–¹æ³•å­—ç¬¦ä¸²å¯¹è±¡å…±æœ‰4ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼šmatch()ã€replace()ã€search()å’Œsplit()ã€‚ ES6å°†è¿™4ä¸ªæ–¹æ³•ï¼Œåœ¨è¯­è¨€å†…éƒ¨å…¨éƒ¨è°ƒç”¨RegExpçš„å®ä¾‹æ–¹æ³•ï¼Œä»è€Œåšåˆ°æ‰€æœ‰ä¸æ­£åˆ™ç›¸å…³çš„æ–¹æ³•ï¼Œå…¨éƒ½å®šä¹‰åœ¨RegExpå¯¹è±¡ä¸Šã€‚ String.prototype.match è°ƒç”¨ RegExp.prototype[Symbol.match] String.prototype.replace è°ƒç”¨ RegExp.prototype[Symbol.replace] String.prototype.search è°ƒç”¨ RegExp.prototype[Symbol.search] String.prototype.split è°ƒç”¨ RegExp.prototype[Symbol.split] uä¿®é¥°ç¬¦ES6å¯¹æ­£åˆ™è¡¨è¾¾å¼æ·»åŠ äº†uä¿®é¥°ç¬¦ï¼Œå«ä¹‰ä¸ºâ€œUnicodeæ¨¡å¼â€ï¼Œç”¨æ¥æ­£ç¡®å¤„ç†å¤§äº\\uFFFFçš„Unicodeå­—ç¬¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šæ­£ç¡®å¤„ç†å››ä¸ªå­—èŠ‚çš„UTF-16ç¼–ç ã€‚ 1234/^\\uD83D/u.test('\\uD83D\\uDC2A')// false/^\\uD83D/.test('\\uD83D\\uDC2A')// true ä¸Šé¢ä»£ç ä¸­ï¼Œ\\uD83D\\uDC2Aæ˜¯ä¸€ä¸ªå››ä¸ªå­—èŠ‚çš„UTF-16ç¼–ç ï¼Œä»£è¡¨ä¸€ä¸ªå­—ç¬¦ã€‚ä½†æ˜¯ï¼ŒES5ä¸æ”¯æŒå››ä¸ªå­—èŠ‚çš„UTF-16ç¼–ç ï¼Œä¼šå°†å…¶è¯†åˆ«ä¸ºä¸¤ä¸ªå­—ç¬¦ï¼Œå¯¼è‡´ç¬¬äºŒè¡Œä»£ç ç»“æœä¸ºtrueã€‚åŠ äº†uä¿®é¥°ç¬¦ä»¥åï¼ŒES6å°±ä¼šè¯†åˆ«å…¶ä¸ºä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç¬¬ä¸€è¡Œä»£ç ç»“æœä¸ºfalseã€‚ ä¸€æ—¦åŠ ä¸Šuä¿®é¥°ç¬¦å·ï¼Œå°±ä¼šä¿®æ”¹ä¸‹é¢è¿™äº›æ­£åˆ™è¡¨è¾¾å¼çš„è¡Œä¸ºã€‚ ï¼ˆ1ï¼‰ç‚¹å­—ç¬¦ ç‚¹ï¼ˆ.ï¼‰å­—ç¬¦åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå«ä¹‰æ˜¯é™¤äº†æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦ã€‚å¯¹äºç ç‚¹å¤§äº0xFFFFçš„Unicodeå­—ç¬¦ï¼Œç‚¹å­—ç¬¦ä¸èƒ½è¯†åˆ«ï¼Œå¿…é¡»åŠ ä¸Šuä¿®é¥°ç¬¦ã€‚ 1234var s = 'ğ ®·';/^.$/.test(s) // false/^.$/u.test(s) // true ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœä¸æ·»åŠ uä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼å°±ä¼šè®¤ä¸ºå­—ç¬¦ä¸²ä¸ºä¸¤ä¸ªå­—ç¬¦ï¼Œä»è€ŒåŒ¹é…å¤±è´¥ã€‚ ï¼ˆ2ï¼‰Unicodeå­—ç¬¦è¡¨ç¤ºæ³• ES6æ–°å¢äº†ä½¿ç”¨å¤§æ‹¬å·è¡¨ç¤ºUnicodeå­—ç¬¦ï¼Œè¿™ç§è¡¨ç¤ºæ³•åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­å¿…é¡»åŠ ä¸Šuä¿®é¥°ç¬¦ï¼Œæ‰èƒ½è¯†åˆ«ã€‚ 123/\\u&#123;61&#125;/.test('a') // false/\\u&#123;61&#125;/u.test('a') // true/\\u&#123;20BB7&#125;/u.test('ğ ®·') // true ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœä¸åŠ uä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ— æ³•è¯†åˆ«\\u{61}è¿™ç§è¡¨ç¤ºæ³•ï¼Œåªä¼šè®¤ä¸ºè¿™åŒ¹é…61ä¸ªè¿ç»­çš„uã€‚ ï¼ˆ3ï¼‰é‡è¯ ä½¿ç”¨uä¿®é¥°ç¬¦åï¼Œæ‰€æœ‰é‡è¯éƒ½ä¼šæ­£ç¡®è¯†åˆ«ç ç‚¹å¤§äº0xFFFFçš„Unicodeå­—ç¬¦ã€‚ 1234/a&#123;2&#125;/.test('aa') // true/a&#123;2&#125;/u.test('aa') // true/ğ ®·&#123;2&#125;/.test('ğ ®·ğ ®·') // false/ğ ®·&#123;2&#125;/u.test('ğ ®·ğ ®·') // true å¦å¤–ï¼Œåªæœ‰åœ¨ä½¿ç”¨uä¿®é¥°ç¬¦çš„æƒ…å†µä¸‹ï¼ŒUnicodeè¡¨è¾¾å¼å½“ä¸­çš„å¤§æ‹¬å·æ‰ä¼šè¢«æ­£ç¡®è§£è¯»ï¼Œå¦åˆ™ä¼šè¢«è§£è¯»ä¸ºé‡è¯ã€‚ 1/^\\u&#123;3&#125;$/.test('uuu') // true ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºæ­£åˆ™è¡¨è¾¾å¼æ²¡æœ‰uä¿®é¥°ç¬¦ï¼Œæ‰€ä»¥å¤§æ‹¬å·è¢«è§£è¯»ä¸ºé‡è¯ã€‚åŠ ä¸Šuä¿®é¥°ç¬¦ï¼Œå°±ä¼šè¢«è§£è¯»ä¸ºUnicodeè¡¨è¾¾å¼ã€‚ ï¼ˆ4ï¼‰é¢„å®šä¹‰æ¨¡å¼ uä¿®é¥°ç¬¦ä¹Ÿå½±å“åˆ°é¢„å®šä¹‰æ¨¡å¼ï¼Œèƒ½å¦æ­£ç¡®è¯†åˆ«ç ç‚¹å¤§äº0xFFFFçš„Unicodeå­—ç¬¦ã€‚ 12/^\\S$/.test('ğ ®·') // false/^\\S$/u.test('ğ ®·') // true ä¸Šé¢ä»£ç çš„\\Sæ˜¯é¢„å®šä¹‰æ¨¡å¼ï¼ŒåŒ¹é…æ‰€æœ‰ä¸æ˜¯ç©ºæ ¼çš„å­—ç¬¦ã€‚åªæœ‰åŠ äº†uä¿®é¥°ç¬¦ï¼Œå®ƒæ‰èƒ½æ­£ç¡®åŒ¹é…ç ç‚¹å¤§äº0xFFFFçš„Unicodeå­—ç¬¦ã€‚ åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå¯ä»¥å†™å‡ºä¸€ä¸ªæ­£ç¡®è¿”å›å­—ç¬¦ä¸²é•¿åº¦çš„å‡½æ•°ã€‚ 123456789function codePointLength(text) &#123; var result = text.match(/[\\s\\S]/gu); return result ? result.length : 0;&#125;var s = 'ğ ®·ğ ®·';s.length // 4codePointLength(s) // 2 ï¼ˆ5ï¼‰iä¿®é¥°ç¬¦ æœ‰äº›Unicodeå­—ç¬¦çš„ç¼–ç ä¸åŒï¼Œä½†æ˜¯å­—å‹å¾ˆç›¸è¿‘ï¼Œæ¯”å¦‚ï¼Œ\\u004Bä¸\\u212Aéƒ½æ˜¯å¤§å†™çš„Kã€‚ 12/[a-z]/i.test('\\u212A') // false/[a-z]/iu.test('\\u212A') // true ä¸Šé¢ä»£ç ä¸­ï¼Œä¸åŠ uä¿®é¥°ç¬¦ï¼Œå°±æ— æ³•è¯†åˆ«éè§„èŒƒçš„Kå­—ç¬¦ã€‚ y ä¿®é¥°ç¬¦é™¤äº†uä¿®é¥°ç¬¦ï¼ŒES6è¿˜ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ·»åŠ äº†yä¿®é¥°ç¬¦ï¼Œå«åšâ€œç²˜è¿â€ï¼ˆstickyï¼‰ä¿®é¥°ç¬¦ã€‚ yä¿®é¥°ç¬¦çš„ä½œç”¨ä¸gä¿®é¥°ç¬¦ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å…¨å±€åŒ¹é…ï¼Œåä¸€æ¬¡åŒ¹é…éƒ½ä»ä¸Šä¸€æ¬¡åŒ¹é…æˆåŠŸçš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œgä¿®é¥°ç¬¦åªè¦å‰©ä½™ä½ç½®ä¸­å­˜åœ¨åŒ¹é…å°±å¯ï¼Œè€Œyä¿®é¥°ç¬¦ç¡®ä¿åŒ¹é…å¿…é¡»ä»å‰©ä½™çš„ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ï¼Œè¿™ä¹Ÿå°±æ˜¯â€œç²˜è¿â€çš„æ¶µä¹‰ã€‚ 123456789var s = 'aaa_aa_a';var r1 = /a+/g;var r2 = /a+/y;r1.exec(s) // [\"aaa\"]r2.exec(s) // [\"aaa\"]r1.exec(s) // [\"aa\"]r2.exec(s) // null ä¸Šé¢ä»£ç æœ‰ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸€ä¸ªä½¿ç”¨gä¿®é¥°ç¬¦ï¼Œå¦ä¸€ä¸ªä½¿ç”¨yä¿®é¥°ç¬¦ã€‚è¿™ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼å„æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸¤è€…è¡Œä¸ºç›¸åŒï¼Œå‰©ä½™å­—ç¬¦ä¸²éƒ½æ˜¯_aa_aã€‚ç”±äºgä¿®é¥°æ²¡æœ‰ä½ç½®è¦æ±‚ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡æ‰§è¡Œä¼šè¿”å›ç»“æœï¼Œè€Œyä¿®é¥°ç¬¦è¦æ±‚åŒ¹é…å¿…é¡»ä»å¤´éƒ¨å¼€å§‹ï¼Œæ‰€ä»¥è¿”å›nullã€‚ å¦‚æœæ”¹ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¿è¯æ¯æ¬¡éƒ½èƒ½å¤´éƒ¨åŒ¹é…ï¼Œyä¿®é¥°ç¬¦å°±ä¼šè¿”å›ç»“æœäº†ã€‚ 12345var s = 'aaa_aa_a';var r = /a+_/y;r.exec(s) // [\"aaa_\"]r.exec(s) // [\"aa_\"] ä¸Šé¢ä»£ç æ¯æ¬¡åŒ¹é…ï¼Œéƒ½æ˜¯ä»å‰©ä½™å­—ç¬¦ä¸²çš„å¤´éƒ¨å¼€å§‹ã€‚ ä½¿ç”¨lastIndexå±æ€§ï¼Œå¯ä»¥æ›´å¥½åœ°è¯´æ˜yä¿®é¥°ç¬¦ã€‚ 12345678910111213141516const REGEX = /a/g;// æŒ‡å®šä»2å·ä½ç½®ï¼ˆyï¼‰å¼€å§‹åŒ¹é…REGEX.lastIndex = 2;// åŒ¹é…æˆåŠŸconst match = REGEX.exec('xaya');// åœ¨3å·ä½ç½®åŒ¹é…æˆåŠŸmatch.index // 3// ä¸‹ä¸€æ¬¡åŒ¹é…ä»4å·ä½å¼€å§‹REGEX.lastIndex // 4// 4å·ä½å¼€å§‹åŒ¹é…å¤±è´¥REGEX.exec('xaxa') // null ä¸Šé¢ä»£ç ä¸­ï¼ŒlastIndexå±æ€§æŒ‡å®šæ¯æ¬¡æœç´¢çš„å¼€å§‹ä½ç½®ï¼Œgä¿®é¥°ç¬¦ä»è¿™ä¸ªä½ç½®å¼€å§‹å‘åæœç´¢ï¼Œç›´åˆ°å‘ç°åŒ¹é…ä¸ºæ­¢ã€‚ yä¿®é¥°ç¬¦åŒæ ·éµå®ˆlastIndexå±æ€§ï¼Œä½†æ˜¯è¦æ±‚å¿…é¡»åœ¨lastIndexæŒ‡å®šçš„ä½ç½®å‘ç°åŒ¹é…ã€‚ 123456789101112131415const REGEX = /a/y;// æŒ‡å®šä»2å·ä½ç½®å¼€å§‹åŒ¹é…REGEX.lastIndex = 2;// ä¸æ˜¯ç²˜è¿ï¼ŒåŒ¹é…å¤±è´¥REGEX.exec('xaya') // null// æŒ‡å®šä»3å·ä½ç½®å¼€å§‹åŒ¹é…REGEX.lastIndex = 3;// 3å·ä½ç½®æ˜¯ç²˜è¿ï¼ŒåŒ¹é…æˆåŠŸconst match = REGEX.exec('xaxa');match.index // 3REGEX.lastIndex // 4 è¿›ä¸€æ­¥è¯´ï¼Œyä¿®é¥°ç¬¦å·éšå«äº†å¤´éƒ¨åŒ¹é…çš„æ ‡å¿—^ã€‚ 12/b/y.exec('aba')// null ä¸Šé¢ä»£ç ç”±äºä¸èƒ½ä¿è¯å¤´éƒ¨åŒ¹é…ï¼Œæ‰€ä»¥è¿”å›nullã€‚yä¿®é¥°ç¬¦çš„è®¾è®¡æœ¬æ„ï¼Œå°±æ˜¯è®©å¤´éƒ¨åŒ¹é…çš„æ ‡å¿—^åœ¨å…¨å±€åŒ¹é…ä¸­éƒ½æœ‰æ•ˆã€‚ åœ¨splitæ–¹æ³•ä¸­ä½¿ç”¨yä¿®é¥°ç¬¦ï¼ŒåŸå­—ç¬¦ä¸²å¿…é¡»ä»¥åˆ†éš”ç¬¦å¼€å¤´ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œåªè¦åŒ¹é…æˆåŠŸï¼Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜è‚¯å®šæ˜¯ç©ºå­—ç¬¦ä¸²ã€‚ 1234567// æ²¡æœ‰æ‰¾åˆ°åŒ¹é…'x##'.split(/#/y)// [ 'x##' ]// æ‰¾åˆ°ä¸¤ä¸ªåŒ¹é…'##x'.split(/#/y)// [ '', '', 'x' ] åç»­çš„åˆ†éš”ç¬¦åªæœ‰ç´§è·Ÿå‰é¢çš„åˆ†éš”ç¬¦ï¼Œæ‰ä¼šè¢«è¯†åˆ«ã€‚ 12345'#x#'.split(/#/y)// [ '', 'x#' ]'##'.split(/#/y)// [ '', '', '' ] ä¸‹é¢æ˜¯å­—ç¬¦ä¸²å¯¹è±¡çš„replaceæ–¹æ³•çš„ä¾‹å­ã€‚ 12const REGEX = /a/gy;'aaxa'.replace(REGEX, '-') // '--xa' ä¸Šé¢ä»£ç ä¸­ï¼Œæœ€åä¸€ä¸ªaå› ä¸ºä¸æ˜¯å‡ºç°ä¸‹ä¸€æ¬¡åŒ¹é…çš„å¤´éƒ¨ï¼Œæ‰€ä»¥ä¸ä¼šè¢«æ›¿æ¢ã€‚ å•å•ä¸€ä¸ªyä¿®é¥°ç¬¦å¯¹matchæ–¹æ³•ï¼Œåªèƒ½è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…ï¼Œå¿…é¡»ä¸gä¿®é¥°ç¬¦è”ç”¨ï¼Œæ‰èƒ½è¿”å›æ‰€æœ‰åŒ¹é…ã€‚ 12'a1a2a3'.match(/a\\d/y) // [\"a1\"]'a1a2a3'.match(/a\\d/gy) // [\"a1\", \"a2\", \"a3\"] yä¿®é¥°ç¬¦çš„ä¸€ä¸ªåº”ç”¨ï¼Œæ˜¯ä»å­—ç¬¦ä¸²æå–tokenï¼ˆè¯å…ƒï¼‰ï¼Œyä¿®é¥°ç¬¦ç¡®ä¿äº†åŒ¹é…ä¹‹é—´ä¸ä¼šæœ‰æ¼æ‰çš„å­—ç¬¦ã€‚ 12345678910111213141516const TOKEN_Y = /\\s*(\\+|[0-9]+)\\s*/y;const TOKEN_G = /\\s*(\\+|[0-9]+)\\s*/g;tokenize(TOKEN_Y, '3 + 4')// [ '3', '+', '4' ]tokenize(TOKEN_G, '3 + 4')// [ '3', '+', '4' ]function tokenize(TOKEN_REGEX, str) &#123; let result = []; let match; while (match = TOKEN_REGEX.exec(str)) &#123; result.push(match[1]); &#125; return result;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœå­—ç¬¦ä¸²é‡Œé¢æ²¡æœ‰éæ³•å­—ç¬¦ï¼Œyä¿®é¥°ç¬¦ä¸gä¿®é¥°ç¬¦çš„æå–ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦å‡ºç°éæ³•å­—ç¬¦ï¼Œä¸¤è€…çš„è¡Œä¸ºå°±ä¸ä¸€æ ·äº†ã€‚ 1234tokenize(TOKEN_Y, '3x + 4')// [ '3' ]tokenize(TOKEN_G, '3x + 4')// [ '3', '+', '4' ] ä¸Šé¢ä»£ç ä¸­ï¼Œgä¿®é¥°ç¬¦ä¼šå¿½ç•¥éæ³•å­—ç¬¦ï¼Œè€Œyä¿®é¥°ç¬¦ä¸ä¼šï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“å‘ç°é”™è¯¯ã€‚ stickyå±æ€§ä¸yä¿®é¥°ç¬¦ç›¸åŒ¹é…ï¼ŒES6çš„æ­£åˆ™å¯¹è±¡å¤šäº†stickyå±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦è®¾ç½®äº†yä¿®é¥°ç¬¦ã€‚ 12var r = /hello\\d/y;r.sticky // true flagså±æ€§ES6ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ–°å¢äº†flagså±æ€§ï¼Œä¼šè¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ã€‚ 123456789// ES5çš„sourceå±æ€§// è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„æ­£æ–‡/abc/ig.source// \"abc\"// ES6çš„flagså±æ€§// è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦/abc/ig.flags// 'gi' RegExp.escape()å­—ç¬¦ä¸²å¿…é¡»è½¬ä¹‰ï¼Œæ‰èƒ½ä½œä¸ºæ­£åˆ™æ¨¡å¼ã€‚ 1234567function escapeRegExp(str) &#123; return str.replace(/[\\-\\[\\]\\/\\&#123;\\&#125;\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&amp;');&#125;let str = '/path/to/resource.html?search=query';escapeRegExp(str)// \"\\/path\\/to\\/resource\\.html\\?search=query\" ä¸Šé¢ä»£ç ä¸­ï¼Œstræ˜¯ä¸€ä¸ªæ­£å¸¸å­—ç¬¦ä¸²ï¼Œå¿…é¡»ä½¿ç”¨åæ–œæ å¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ï¼Œæ‰èƒ½ç”¨æ¥ä½œä¸ºä¸€ä¸ªæ­£åˆ™åŒ¹é…çš„æ¨¡å¼ã€‚ å·²ç»æœ‰æè®®å°†è¿™ä¸ªéœ€æ±‚æ ‡å‡†åŒ–ï¼Œä½œä¸ºRegExpå¯¹è±¡çš„é™æ€æ–¹æ³•RegExp.escape()ï¼Œæ”¾å…¥ES7ã€‚2015å¹´7æœˆ31æ—¥ï¼ŒTC39è®¤ä¸ºï¼Œè¿™ä¸ªæ–¹æ³•æœ‰å®‰å…¨é£é™©ï¼Œåˆä¸æ„¿è¿™ä¸ªæ–¹æ³•å˜å¾—è¿‡äºå¤æ‚ï¼Œæ²¡æœ‰åŒæ„å°†å…¶åˆ—å…¥ES7ï¼Œä½†è¿™ä¸å¤±ä¸ºä¸€ä¸ªçœŸå®çš„éœ€æ±‚ã€‚ 12345678RegExp.escape('The Quick Brown Fox');// \"The Quick Brown Fox\"RegExp.escape('Buy it. use it. break it. fix it.');// \"Buy it\\. use it\\. break it\\. fix it\\.\"RegExp.escape('(*.*)');// \"\\(\\*\\.\\*\\)\" å­—ç¬¦ä¸²è½¬ä¹‰ä»¥åï¼Œå¯ä»¥ä½¿ç”¨RegExpæ„é€ å‡½æ•°ç”Ÿæˆæ­£åˆ™æ¨¡å¼ã€‚ 123var str = 'hello. how are you?';var regex = new RegExp(RegExp.escape(str), 'g');assert.equal(String(regex), '/hello\\. how are you\\?/g'); ç›®å‰ï¼Œè¯¥æ–¹æ³•å¯ä»¥ç”¨ä¸Šæ–‡çš„escapeRegExpå‡½æ•°æˆ–è€…å«ç‰‡æ¨¡å—regexp.escapeå®ç°ã€‚ 123var escape = require('regexp.escape');escape('hi. how are you?');// \"hi\\\\. how are you\\\\?\" s ä¿®é¥°ç¬¦ï¼šdotAll æ¨¡å¼æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œç‚¹ï¼ˆ.ï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œä»£è¡¨ä»»æ„çš„å•ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯è¡Œç»ˆæ­¢ç¬¦ï¼ˆline terminator characterï¼‰é™¤å¤–ã€‚ ä»¥ä¸‹å››ä¸ªå­—ç¬¦å±äºâ€è¡Œç»ˆæ­¢ç¬¦â€œã€‚ U+000A æ¢è¡Œç¬¦ï¼ˆ\\nï¼‰ U+000D å›è½¦ç¬¦ï¼ˆ\\rï¼‰ U+2028 è¡Œåˆ†éš”ç¬¦ï¼ˆline separatorï¼‰ U+2029 æ®µåˆ†éš”ç¬¦ï¼ˆparagraph separatorï¼‰ 12/foo.bar/.test('foo\\nbar')// false ä¸Šé¢ä»£ç ä¸­ï¼Œå› ä¸º.ä¸åŒ¹é…\\nï¼Œæ‰€ä»¥æ­£åˆ™è¡¨è¾¾å¼è¿”å›falseã€‚ ä½†æ˜¯ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›åŒ¹é…çš„æ˜¯ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œè¿™æ—¶æœ‰ä¸€ç§å˜é€šçš„å†™æ³•ã€‚ 12/foo[^]bar/.test('foo\\nbar')// true è¿™ç§è§£å†³æ–¹æ¡ˆæ¯•ç«Ÿä¸å¤ªç¬¦åˆç›´è§‰ï¼Œæ‰€ä»¥ç°åœ¨æœ‰ä¸€ä¸ªææ¡ˆï¼Œå¼•å…¥/sä¿®é¥°ç¬¦ï¼Œä½¿å¾—.å¯ä»¥åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ã€‚ 1/foo.bar/s.test('foo\\nbar') // true è¿™è¢«ç§°ä¸ºdotAllæ¨¡å¼ï¼Œå³ç‚¹ï¼ˆdotï¼‰ä»£è¡¨ä¸€åˆ‡å­—ç¬¦ã€‚æ‰€ä»¥ï¼Œæ­£åˆ™è¡¨è¾¾å¼è¿˜å¼•å…¥äº†ä¸€ä¸ªdotAllå±æ€§ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦å¤„åœ¨dotAllæ¨¡å¼ã€‚ 1234567const re = /foo.bar/s;// å¦ä¸€ç§å†™æ³•// const re = new RegExp('foo.bar', 's');re.test('foo\\nbar') // truere.dotAll // truere.flags // 's' /sä¿®é¥°ç¬¦å’Œå¤šè¡Œä¿®é¥°ç¬¦/mä¸å†²çªï¼Œä¸¤è€…ä¸€èµ·ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œ.åŒ¹é…æ‰€æœ‰å­—ç¬¦ï¼Œè€Œ^å’Œ$åŒ¹é…æ¯ä¸€è¡Œçš„è¡Œé¦–å’Œè¡Œå°¾ã€‚ åè¡Œæ–­è¨€JavaScriptè¯­è¨€çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåªæ”¯æŒå…ˆè¡Œæ–­è¨€ï¼ˆlookaheadï¼‰å’Œå…ˆè¡Œå¦å®šæ–­è¨€ï¼ˆnegative lookaheadï¼‰ï¼Œä¸æ”¯æŒåè¡Œæ–­è¨€ï¼ˆlookbehindï¼‰å’Œåè¡Œå¦å®šæ–­è¨€ï¼ˆnegative lookbehindï¼‰ã€‚ ç›®å‰ï¼Œæœ‰ä¸€ä¸ªææ¡ˆï¼Œåœ¨ES7åŠ å…¥åè¡Œæ–­è¨€ã€‚V8å¼•æ“4.9ç‰ˆå·²ç»æ”¯æŒï¼ŒChromeæµè§ˆå™¨49ç‰ˆæ‰“å¼€â€experimental JavaScript featuresâ€œå¼€å…³ï¼ˆåœ°å€æ é”®å…¥about:flagsï¼‰ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™é¡¹åŠŸèƒ½ã€‚ â€å…ˆè¡Œæ–­è¨€â€œæŒ‡çš„æ˜¯ï¼Œxåªæœ‰åœ¨yå‰é¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ/x(?=y)/ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ç™¾åˆ†å·ä¹‹å‰çš„æ•°å­—ï¼Œè¦å†™æˆ/\\d+(?=%)/ã€‚â€å…ˆè¡Œå¦å®šæ–­è¨€â€œæŒ‡çš„æ˜¯ï¼Œxåªæœ‰ä¸åœ¨yå‰é¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ/x(?!y)/ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ä¸åœ¨ç™¾åˆ†å·ä¹‹å‰çš„æ•°å­—ï¼Œè¦å†™æˆ/\\d+(?!%)/ã€‚ 12/\\d+(?=%)/.exec('100% of US presidents have been male') // [\"100\"]/\\d+(?!%)/.exec('thatâ€™s all 44 of them') // [\"44\"] ä¸Šé¢ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœäº’æ¢æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°±ä¼šåŒ¹é…å¤±è´¥ã€‚å¦å¤–ï¼Œè¿˜å¯ä»¥çœ‹åˆ°ï¼Œâ€å…ˆè¡Œæ–­è¨€â€œæ‹¬å·ä¹‹ä¸­çš„éƒ¨åˆ†ï¼ˆ(?=%)ï¼‰ï¼Œæ˜¯ä¸è®¡å…¥è¿”å›ç»“æœçš„ã€‚ â€œåè¡Œæ–­è¨€â€æ­£å¥½ä¸â€å…ˆè¡Œæ–­è¨€â€ç›¸åï¼Œxåªæœ‰åœ¨yåé¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ/(?&lt;=y)x/ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ç¾å…ƒç¬¦å·ä¹‹åçš„æ•°å­—ï¼Œè¦å†™æˆ/(?&lt;=\\$)\\d+/ã€‚â€åè¡Œå¦å®šæ–­è¨€â€œåˆ™ä¸â€å…ˆè¡Œå¦å®šæ–­è¨€â€œç›¸åï¼Œxåªæœ‰ä¸åœ¨yåé¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ/(?&lt;!y)x/ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ä¸åœ¨ç¾å…ƒç¬¦å·åé¢çš„æ•°å­—ï¼Œè¦å†™æˆ/(?&lt;!\\$)\\d+/ã€‚ 12/(?&lt;=\\$)\\d+/.exec('Benjamin Franklin is on the $100 bill') // [\"100\"]/(?&lt;!\\$)\\d+/.exec('itâ€™s is worth about â‚¬90') // [\"90\"] ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œâ€åè¡Œæ–­è¨€â€çš„æ‹¬å·ä¹‹ä¸­çš„éƒ¨åˆ†ï¼ˆ(?&lt;=\\$)ï¼‰ï¼Œä¹Ÿæ˜¯ä¸è®¡å…¥è¿”å›ç»“æœã€‚ â€œåè¡Œæ–­è¨€â€çš„å®ç°ï¼Œéœ€è¦å…ˆåŒ¹é…/(?&lt;=y)x/çš„xï¼Œç„¶åå†å›åˆ°å·¦è¾¹ï¼ŒåŒ¹é…yçš„éƒ¨åˆ†ã€‚è¿™ç§â€å…ˆå³åå·¦â€çš„æ‰§è¡Œé¡ºåºï¼Œä¸æ‰€æœ‰å…¶ä»–æ­£åˆ™æ“ä½œç›¸åï¼Œå¯¼è‡´äº†ä¸€äº›ä¸ç¬¦åˆé¢„æœŸçš„è¡Œä¸ºã€‚ é¦–å…ˆï¼Œâ€åè¡Œæ–­è¨€â€œçš„ç»„åŒ¹é…ï¼Œä¸æ­£å¸¸æƒ…å†µä¸‹ç»“æœæ˜¯ä¸ä¸€æ ·çš„ã€‚ 12/(?&lt;=(\\d+)(\\d+))$/.exec('1053') // [\"\", \"1\", \"053\"]/^(\\d+)(\\d+)$/.exec('1053') // [\"1053\", \"105\", \"3\"] ä¸Šé¢ä»£ç ä¸­ï¼Œéœ€è¦æ•æ‰ä¸¤ä¸ªç»„åŒ¹é…ã€‚æ²¡æœ‰â€åè¡Œæ–­è¨€â€æ—¶ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·æ˜¯è´ªå©ªæ¨¡å¼ï¼Œç¬¬äºŒä¸ªæ‹¬å·åªèƒ½æ•è·ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç»“æœæ˜¯105å’Œ3ã€‚è€Œâ€åè¡Œæ–­è¨€â€æ—¶ï¼Œç”±äºæ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦ï¼Œç¬¬äºŒä¸ªæ‹¬å·æ˜¯è´ªå©ªæ¨¡å¼ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·åªèƒ½æ•è·ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç»“æœæ˜¯1å’Œ053ã€‚ å…¶æ¬¡ï¼Œâ€åè¡Œæ–­è¨€â€çš„åæ–œæ å¼•ç”¨ï¼Œä¹Ÿä¸é€šå¸¸çš„é¡ºåºç›¸åï¼Œå¿…é¡»æ”¾åœ¨å¯¹åº”çš„é‚£ä¸ªæ‹¬å·ä¹‹å‰ã€‚ 12/(?&lt;=(o)d\\1)r/.exec('hodor') // null/(?&lt;=\\1d(o))r/.exec('hodor') // [\"r\", \"o\"] ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœåè¡Œæ–­è¨€çš„åæ–œæ å¼•ç”¨ï¼ˆ\\1ï¼‰æ”¾åœ¨æ‹¬å·çš„åé¢ï¼Œå°±ä¸ä¼šå¾—åˆ°åŒ¹é…ç»“æœï¼Œå¿…é¡»æ”¾åœ¨å‰é¢æ‰å¯ä»¥ã€‚ Unicodeå±æ€§ç±»ç›®å‰ï¼Œæœ‰ä¸€ä¸ªææ¡ˆï¼Œå¼•å…¥äº†ä¸€ç§æ–°çš„ç±»çš„å†™æ³•\\p{...}å’Œ\\P{...}ï¼Œå…è®¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç¬¦åˆUnicodeæŸç§å±æ€§çš„æ‰€æœ‰å­—ç¬¦ã€‚ 12const regexGreekSymbol = /\\p&#123;Script=Greek&#125;/u;regexGreekSymbol.test('Ï€') // u ä¸Šé¢ä»£ç ä¸­ï¼Œ\\p{Script=Greek}æŒ‡å®šåŒ¹é…ä¸€ä¸ªå¸Œè…Šæ–‡å­—æ¯ï¼Œæ‰€ä»¥åŒ¹é…Ï€æˆåŠŸã€‚ Unicodeå±æ€§ç±»è¦æŒ‡å®šå±æ€§åå’Œå±æ€§å€¼ã€‚ 1\\p&#123;UnicodePropertyName=UnicodePropertyValue&#125; å¯¹äºæŸäº›å±æ€§ï¼Œå¯ä»¥åªå†™å±æ€§åã€‚ 1\\p&#123;UnicodePropertyName&#125; \\P{â€¦}æ˜¯\\p{â€¦}çš„åå‘åŒ¹é…ï¼Œå³åŒ¹é…ä¸æ»¡è¶³æ¡ä»¶çš„å­—ç¬¦ã€‚ æ³¨æ„ï¼Œè¿™ä¸¤ç§ç±»åªå¯¹Unicodeæœ‰æ•ˆï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦åŠ ä¸Šuä¿®é¥°ç¬¦ã€‚å¦‚æœä¸åŠ uä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨\\på’Œ\\Pä¼šæŠ¥é”™ï¼ŒECMAScripté¢„ç•™äº†è¿™ä¸¤ä¸ªç±»ã€‚ ç”±äºUnicodeçš„å„ç§å±æ€§éå¸¸å¤šï¼Œæ‰€ä»¥è¿™ç§æ–°çš„ç±»çš„è¡¨è¾¾èƒ½åŠ›éå¸¸å¼ºã€‚ 12const regex = /^\\p&#123;Decimal_Number&#125;+$/u;regex.test('ğŸğŸğŸ‘ğŸœğŸğŸğŸ©ğŸªğŸ«ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸºğŸ»ğŸ¼') // true ä¸Šé¢ä»£ç ä¸­ï¼Œå±æ€§ç±»æŒ‡å®šåŒ¹é…æ‰€æœ‰åè¿›åˆ¶å­—ç¬¦ï¼Œå¯ä»¥çœ‹åˆ°å„ç§å­—å‹çš„åè¿›åˆ¶å­—ç¬¦éƒ½ä¼šåŒ¹é…æˆåŠŸã€‚ \\p{Number}ç”šè‡³èƒ½åŒ¹é…ç½—é©¬æ•°å­—ã€‚ 12345// åŒ¹é…æ‰€æœ‰æ•°å­—const regex = /^\\p&#123;Number&#125;+$/u;regex.test('Â²Â³Â¹Â¼Â½Â¾') // trueregex.test('ã‰›ã‰œã‰') // trueregex.test('â… â…¡â…¢â…£â…¤â…¥â…¦â…§â…¨â…©â…ªâ…«') // true ä¸‹é¢æ˜¯å…¶ä»–ä¸€äº›ä¾‹å­ã€‚ 123456789// åŒ¹é…å„ç§æ–‡å­—çš„æ‰€æœ‰å­—æ¯ï¼Œç­‰åŒäºUnicodeç‰ˆçš„\\w[\\p&#123;Alphabetic&#125;\\p&#123;Mark&#125;\\p&#123;Decimal_Number&#125;\\p&#123;Connector_Punctuation&#125;\\p&#123;Join_Control&#125;]// åŒ¹é…å„ç§æ–‡å­—çš„æ‰€æœ‰éå­—æ¯çš„å­—ç¬¦ï¼Œç­‰åŒäºUnicodeç‰ˆçš„\\W[^\\p&#123;Alphabetic&#125;\\p&#123;Mark&#125;\\p&#123;Decimal_Number&#125;\\p&#123;Connector_Punctuation&#125;\\p&#123;Join_Control&#125;]// åŒ¹é…æ‰€æœ‰çš„ç®­å¤´å­—ç¬¦const regexArrows = /^\\p&#123;Block=Arrows&#125;+$/u;regexArrows.test('â†â†‘â†’â†“â†”â†•â†–â†—â†˜â†™â‡â‡â‡‘â‡’â‡“â‡”â‡•â‡–â‡—â‡˜â‡™â‡§â‡©') // true","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"RegExp","slug":"RegExp","permalink":"http://microzz.com/tags/RegExp/"},{"name":"æ­£åˆ™è¡¨è¾¾å¼","slug":"æ­£åˆ™è¡¨è¾¾å¼","permalink":"http://microzz.com/tags/æ­£åˆ™è¡¨è¾¾å¼/"}]},{"title":"å­—ç¬¦ä¸²çš„æ‰©å±•","date":"2016-11-15T07:45:19.000Z","path":"2016/11/15/string/","text":"å­—ç¬¦ä¸²çš„æ‰©å±•ES6åŠ å¼ºäº†å¯¹Unicodeçš„æ”¯æŒï¼Œå¹¶ä¸”æ‰©å±•äº†å­—ç¬¦ä¸²å¯¹è±¡ã€‚ å­—ç¬¦çš„Unicodeè¡¨ç¤ºæ³•JavaScriptå…è®¸é‡‡ç”¨\\uxxxxå½¢å¼è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå…¶ä¸­â€œxxxxâ€è¡¨ç¤ºå­—ç¬¦çš„ç ç‚¹ã€‚ 12\"\\u0061\"// \"a\" ä½†æ˜¯ï¼Œè¿™ç§è¡¨ç¤ºæ³•åªé™äº\\u0000â€”â€”\\uFFFFä¹‹é—´çš„å­—ç¬¦ã€‚è¶…å‡ºè¿™ä¸ªèŒƒå›´çš„å­—ç¬¦ï¼Œå¿…é¡»ç”¨ä¸¤ä¸ªåŒå­—èŠ‚çš„å½¢å¼è¡¨è¾¾ã€‚ 12345\"\\uD842\\uDFB7\"// \"ğ ®·\"\"\\u20BB7\"// \" 7\" ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœç›´æ¥åœ¨\\uåé¢è·Ÿä¸Šè¶…è¿‡0xFFFFçš„æ•°å€¼ï¼ˆæ¯”å¦‚\\u20BB7ï¼‰ï¼ŒJavaScriptä¼šç†è§£æˆ\\u20BB+7ã€‚ç”±äº\\u20BBæ˜¯ä¸€ä¸ªä¸å¯æ‰“å°å­—ç¬¦ï¼Œæ‰€ä»¥åªä¼šæ˜¾ç¤ºä¸€ä¸ªç©ºæ ¼ï¼Œåé¢è·Ÿç€ä¸€ä¸ª7ã€‚ ES6 å¯¹è¿™ä¸€ç‚¹åšå‡ºäº†æ”¹è¿›ï¼Œåªè¦å°†ç ç‚¹æ”¾å…¥å¤§æ‹¬å·ï¼Œå°±èƒ½æ­£ç¡®è§£è¯»è¯¥å­—ç¬¦ã€‚ 1234567891011\"\\u&#123;20BB7&#125;\"// \"ğ ®·\"\"\\u&#123;41&#125;\\u&#123;42&#125;\\u&#123;43&#125;\"// \"ABC\"let hello = 123;hell\\u&#123;6F&#125; // 123'\\u&#123;1F680&#125;' === '\\uD83D\\uDE80'// true ä¸Šé¢ä»£ç ä¸­ï¼Œæœ€åä¸€ä¸ªä¾‹å­è¡¨æ˜ï¼Œå¤§æ‹¬å·è¡¨ç¤ºæ³•ä¸å››å­—èŠ‚çš„UTF-16ç¼–ç æ˜¯ç­‰ä»·çš„ã€‚ æœ‰äº†è¿™ç§è¡¨ç¤ºæ³•ä¹‹åï¼ŒJavaScriptå…±æœ‰6ç§æ–¹æ³•å¯ä»¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚ 12345'\\z' === 'z' // true'\\172' === 'z' // true'\\x7A' === 'z' // true'\\u007A' === 'z' // true'\\u&#123;7A&#125;' === 'z' // true codePointAt()JavaScriptå†…éƒ¨ï¼Œå­—ç¬¦ä»¥UTF-16çš„æ ¼å¼å‚¨å­˜ï¼Œæ¯ä¸ªå­—ç¬¦å›ºå®šä¸º2ä¸ªå­—èŠ‚ã€‚å¯¹äºé‚£äº›éœ€è¦4ä¸ªå­—èŠ‚å‚¨å­˜çš„å­—ç¬¦ï¼ˆUnicodeç ç‚¹å¤§äº0xFFFFçš„å­—ç¬¦ï¼‰ï¼ŒJavaScriptä¼šè®¤ä¸ºå®ƒä»¬æ˜¯ä¸¤ä¸ªå­—ç¬¦ã€‚ 1234567var s = \"ğ ®·\";s.length // 2s.charAt(0) // ''s.charAt(1) // ''s.charCodeAt(0) // 55362s.charCodeAt(1) // 57271 ä¸Šé¢ä»£ç ä¸­ï¼Œæ±‰å­—â€œğ ®·â€ï¼ˆæ³¨æ„ï¼Œè¿™ä¸ªå­—ä¸æ˜¯â€å‰ç¥¥â€œçš„â€å‰â€œï¼‰çš„ç ç‚¹æ˜¯0x20BB7ï¼ŒUTF-16ç¼–ç ä¸º0xD842 0xDFB7ï¼ˆåè¿›åˆ¶ä¸º55362 57271ï¼‰ï¼Œéœ€è¦4ä¸ªå­—èŠ‚å‚¨å­˜ã€‚å¯¹äºè¿™ç§4ä¸ªå­—èŠ‚çš„å­—ç¬¦ï¼ŒJavaScriptä¸èƒ½æ­£ç¡®å¤„ç†ï¼Œå­—ç¬¦ä¸²é•¿åº¦ä¼šè¯¯åˆ¤ä¸º2ï¼Œè€Œä¸”charAtæ–¹æ³•æ— æ³•è¯»å–æ•´ä¸ªå­—ç¬¦ï¼ŒcharCodeAtæ–¹æ³•åªèƒ½åˆ†åˆ«è¿”å›å‰ä¸¤ä¸ªå­—èŠ‚å’Œåä¸¤ä¸ªå­—èŠ‚çš„å€¼ã€‚ ES6æä¾›äº†codePointAtæ–¹æ³•ï¼Œèƒ½å¤Ÿæ­£ç¡®å¤„ç†4ä¸ªå­—èŠ‚å‚¨å­˜çš„å­—ç¬¦ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦çš„ç ç‚¹ã€‚ 123456var s = 'ğ ®·a';s.codePointAt(0) // 134071s.codePointAt(1) // 57271s.codePointAt(2) // 97 codePointAtæ–¹æ³•çš„å‚æ•°ï¼Œæ˜¯å­—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰ã€‚ä¸Šé¢ä»£ç ä¸­ï¼ŒJavaScriptå°†â€œğ ®·aâ€è§†ä¸ºä¸‰ä¸ªå­—ç¬¦ï¼ŒcodePointAtæ–¹æ³•åœ¨ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸Šï¼Œæ­£ç¡®åœ°è¯†åˆ«äº†â€œğ ®·â€ï¼Œè¿”å›äº†å®ƒçš„åè¿›åˆ¶ç ç‚¹134071ï¼ˆå³åå…­è¿›åˆ¶çš„20BB7ï¼‰ã€‚åœ¨ç¬¬äºŒä¸ªå­—ç¬¦ï¼ˆå³â€œğ ®·â€çš„åä¸¤ä¸ªå­—èŠ‚ï¼‰å’Œç¬¬ä¸‰ä¸ªå­—ç¬¦â€œaâ€ä¸Šï¼ŒcodePointAtæ–¹æ³•çš„ç»“æœä¸charCodeAtæ–¹æ³•ç›¸åŒã€‚ æ€»ä¹‹ï¼ŒcodePointAtæ–¹æ³•ä¼šæ­£ç¡®è¿”å›32ä½çš„UTF-16å­—ç¬¦çš„ç ç‚¹ã€‚å¯¹äºé‚£äº›ä¸¤ä¸ªå­—èŠ‚å‚¨å­˜çš„å¸¸è§„å­—ç¬¦ï¼Œå®ƒçš„è¿”å›ç»“æœä¸charCodeAtæ–¹æ³•ç›¸åŒã€‚ codePointAtæ–¹æ³•è¿”å›çš„æ˜¯ç ç‚¹çš„åè¿›åˆ¶å€¼ï¼Œå¦‚æœæƒ³è¦åå…­è¿›åˆ¶çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨toStringæ–¹æ³•è½¬æ¢ä¸€ä¸‹ã€‚ 1234var s = 'ğ ®·a';s.codePointAt(0).toString(16) // \"20bb7\"s.codePointAt(2).toString(16) // \"61\" ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼ŒcodePointAtæ–¹æ³•çš„å‚æ•°ï¼Œä»ç„¶æ˜¯ä¸æ­£ç¡®çš„ã€‚æ¯”å¦‚ï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œå­—ç¬¦aåœ¨å­—ç¬¦ä¸²sçš„æ­£ç¡®ä½ç½®åºå·åº”è¯¥æ˜¯1ï¼Œä½†æ˜¯å¿…é¡»å‘codePointAtæ–¹æ³•ä¼ å…¥2ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªåŠæ³•æ˜¯ä½¿ç”¨for...ofå¾ªç¯ï¼Œå› ä¸ºå®ƒä¼šæ­£ç¡®è¯†åˆ«32ä½çš„UTF-16å­—ç¬¦ã€‚ 123456var s = 'ğ ®·a';for (let ch of s) &#123; console.log(ch.codePointAt(0).toString(16));&#125;// 20bb7// 61 codePointAtæ–¹æ³•æ˜¯æµ‹è¯•ä¸€ä¸ªå­—ç¬¦ç”±ä¸¤ä¸ªå­—èŠ‚è¿˜æ˜¯ç”±å››ä¸ªå­—èŠ‚ç»„æˆçš„æœ€ç®€å•æ–¹æ³•ã€‚ 123456function is32Bit(c) &#123; return c.codePointAt(0) &gt; 0xFFFF;&#125;is32Bit(\"ğ ®·\") // trueis32Bit(\"a\") // false String.fromCodePoint()ES5æä¾›String.fromCharCodeæ–¹æ³•ï¼Œç”¨äºä»ç ç‚¹è¿”å›å¯¹åº”å­—ç¬¦ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸èƒ½è¯†åˆ«32ä½çš„UTF-16å­—ç¬¦ï¼ˆUnicodeç¼–å·å¤§äº0xFFFFï¼‰ã€‚ 12String.fromCharCode(0x20BB7)// \"à®·\" ä¸Šé¢ä»£ç ä¸­ï¼ŒString.fromCharCodeä¸èƒ½è¯†åˆ«å¤§äº0xFFFFçš„ç ç‚¹ï¼Œæ‰€ä»¥0x20BB7å°±å‘ç”Ÿäº†æº¢å‡ºï¼Œæœ€é«˜ä½2è¢«èˆå¼ƒäº†ï¼Œæœ€åè¿”å›ç ç‚¹U+0BB7å¯¹åº”çš„å­—ç¬¦ï¼Œè€Œä¸æ˜¯ç ç‚¹U+20BB7å¯¹åº”çš„å­—ç¬¦ã€‚ ES6æä¾›äº†String.fromCodePointæ–¹æ³•ï¼Œå¯ä»¥è¯†åˆ«0xFFFFçš„å­—ç¬¦ï¼Œå¼¥è¡¥äº†String.fromCharCodeæ–¹æ³•çš„ä¸è¶³ã€‚åœ¨ä½œç”¨ä¸Šï¼Œæ­£å¥½ä¸codePointAtæ–¹æ³•ç›¸åã€‚ 1234String.fromCodePoint(0x20BB7)// \"ğ ®·\"String.fromCodePoint(0x78, 0x1f680, 0x79) === 'x\\uD83D\\uDE80y'// true ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœString.fromCodePointæ–¹æ³•æœ‰å¤šä¸ªå‚æ•°ï¼Œåˆ™å®ƒä»¬ä¼šè¢«åˆå¹¶æˆä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ã€‚ æ³¨æ„ï¼ŒfromCodePointæ–¹æ³•å®šä¹‰åœ¨Stringå¯¹è±¡ä¸Šï¼Œè€ŒcodePointAtæ–¹æ³•å®šä¹‰åœ¨å­—ç¬¦ä¸²çš„å®ä¾‹å¯¹è±¡ä¸Šã€‚ å­—ç¬¦ä¸²çš„éå†å™¨æ¥å£ES6ä¸ºå­—ç¬¦ä¸²æ·»åŠ äº†éå†å™¨æ¥å£ï¼ˆè¯¦è§ã€ŠIteratorã€‹ä¸€ç« ï¼‰ï¼Œä½¿å¾—å­—ç¬¦ä¸²å¯ä»¥è¢«for...ofå¾ªç¯éå†ã€‚ 123456for (let codePoint of 'foo') &#123; console.log(codePoint)&#125;// \"f\"// \"o\"// \"o\" é™¤äº†éå†å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªéå†å™¨æœ€å¤§çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è¯†åˆ«å¤§äº0xFFFFçš„ç ç‚¹ï¼Œä¼ ç»Ÿçš„forå¾ªç¯æ— æ³•è¯†åˆ«è¿™æ ·çš„ç ç‚¹ã€‚ 123456789101112var text = String.fromCodePoint(0x20BB7);for (let i = 0; i &lt; text.length; i++) &#123; console.log(text[i]);&#125;// \" \"// \" \"for (let i of text) &#123; console.log(i);&#125;// \"ğ ®·\" ä¸Šé¢ä»£ç ä¸­ï¼Œå­—ç¬¦ä¸²textåªæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯forå¾ªç¯ä¼šè®¤ä¸ºå®ƒåŒ…å«ä¸¤ä¸ªå­—ç¬¦ï¼ˆéƒ½ä¸å¯æ‰“å°ï¼‰ï¼Œè€Œfor...ofå¾ªç¯ä¼šæ­£ç¡®è¯†åˆ«å‡ºè¿™ä¸€ä¸ªå­—ç¬¦ã€‚ at()ES5å¯¹å­—ç¬¦ä¸²å¯¹è±¡æä¾›charAtæ–¹æ³•ï¼Œè¿”å›å­—ç¬¦ä¸²ç»™å®šä½ç½®çš„å­—ç¬¦ã€‚è¯¥æ–¹æ³•ä¸èƒ½è¯†åˆ«ç ç‚¹å¤§äº0xFFFFçš„å­—ç¬¦ã€‚ 12'abc'.charAt(0) // \"a\"'ğ ®·'.charAt(0) // \"\\uD842\" ä¸Šé¢ä»£ç ä¸­ï¼ŒcharAtæ–¹æ³•è¿”å›çš„æ˜¯UTF-16ç¼–ç çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå®é™…ä¸Šæ˜¯æ— æ³•æ˜¾ç¤ºçš„ã€‚ ç›®å‰ï¼Œæœ‰ä¸€ä¸ªææ¡ˆï¼Œæå‡ºå­—ç¬¦ä¸²å®ä¾‹çš„atæ–¹æ³•ï¼Œå¯ä»¥è¯†åˆ«Unicodeç¼–å·å¤§äº0xFFFFçš„å­—ç¬¦ï¼Œè¿”å›æ­£ç¡®çš„å­—ç¬¦ã€‚ 12'abc'.at(0) // \"a\"'ğ ®·'.at(0) // \"ğ ®·\" è¿™ä¸ªæ–¹æ³•å¯ä»¥é€šè¿‡å«ç‰‡åº“å®ç°ã€‚ normalize()è®¸å¤šæ¬§æ´²è¯­è¨€æœ‰è¯­è°ƒç¬¦å·å’Œé‡éŸ³ç¬¦å·ã€‚ä¸ºäº†è¡¨ç¤ºå®ƒä»¬ï¼ŒUnicodeæä¾›äº†ä¸¤ç§æ–¹æ³•ã€‚ä¸€ç§æ˜¯ç›´æ¥æä¾›å¸¦é‡éŸ³ç¬¦å·çš„å­—ç¬¦ï¼Œæ¯”å¦‚Ç‘ï¼ˆ\\u01D1ï¼‰ã€‚å¦ä¸€ç§æ˜¯æä¾›åˆæˆç¬¦å·ï¼ˆcombining characterï¼‰ï¼Œå³åŸå­—ç¬¦ä¸é‡éŸ³ç¬¦å·çš„åˆæˆï¼Œä¸¤ä¸ªå­—ç¬¦åˆæˆä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚Oï¼ˆ\\u004Fï¼‰å’ŒË‡ï¼ˆ\\u030Cï¼‰åˆæˆÇ‘ï¼ˆ\\u004F\\u030Cï¼‰ã€‚ è¿™ä¸¤ç§è¡¨ç¤ºæ–¹æ³•ï¼Œåœ¨è§†è§‰å’Œè¯­ä¹‰ä¸Šéƒ½ç­‰ä»·ï¼Œä½†æ˜¯JavaScriptä¸èƒ½è¯†åˆ«ã€‚ 1234'\\u01D1'==='\\u004F\\u030C' //false'\\u01D1'.length // 1'\\u004F\\u030C'.length // 2 ä¸Šé¢ä»£ç è¡¨ç¤ºï¼ŒJavaScriptå°†åˆæˆå­—ç¬¦è§†ä¸ºä¸¤ä¸ªå­—ç¬¦ï¼Œå¯¼è‡´ä¸¤ç§è¡¨ç¤ºæ–¹æ³•ä¸ç›¸ç­‰ã€‚ ES6æä¾›å­—ç¬¦ä¸²å®ä¾‹çš„normalize()æ–¹æ³•ï¼Œç”¨æ¥å°†å­—ç¬¦çš„ä¸åŒè¡¨ç¤ºæ–¹æ³•ç»Ÿä¸€ä¸ºåŒæ ·çš„å½¢å¼ï¼Œè¿™ç§°ä¸ºUnicodeæ­£è§„åŒ–ã€‚ 12'\\u01D1'.normalize() === '\\u004F\\u030C'.normalize()// true normalizeæ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°æ¥æŒ‡å®šnormalizeçš„æ–¹å¼ï¼Œå‚æ•°çš„å››ä¸ªå¯é€‰å€¼å¦‚ä¸‹ã€‚ NFCï¼Œé»˜è®¤å‚æ•°ï¼Œè¡¨ç¤ºâ€œæ ‡å‡†ç­‰ä»·åˆæˆâ€ï¼ˆNormalization Form Canonical Compositionï¼‰ï¼Œè¿”å›å¤šä¸ªç®€å•å­—ç¬¦çš„åˆæˆå­—ç¬¦ã€‚æ‰€è°“â€œæ ‡å‡†ç­‰ä»·â€æŒ‡çš„æ˜¯è§†è§‰å’Œè¯­ä¹‰ä¸Šçš„ç­‰ä»·ã€‚ NFDï¼Œè¡¨ç¤ºâ€œæ ‡å‡†ç­‰ä»·åˆ†è§£â€ï¼ˆNormalization Form Canonical Decompositionï¼‰ï¼Œå³åœ¨æ ‡å‡†ç­‰ä»·çš„å‰æä¸‹ï¼Œè¿”å›åˆæˆå­—ç¬¦åˆ†è§£çš„å¤šä¸ªç®€å•å­—ç¬¦ã€‚ NFKCï¼Œè¡¨ç¤ºâ€œå…¼å®¹ç­‰ä»·åˆæˆâ€ï¼ˆNormalization Form Compatibility Compositionï¼‰ï¼Œè¿”å›åˆæˆå­—ç¬¦ã€‚æ‰€è°“â€œå…¼å®¹ç­‰ä»·â€æŒ‡çš„æ˜¯è¯­ä¹‰ä¸Šå­˜åœ¨ç­‰ä»·ï¼Œä½†è§†è§‰ä¸Šä¸ç­‰ä»·ï¼Œæ¯”å¦‚â€œå›â€å’Œâ€œå–œå–œâ€ã€‚ï¼ˆè¿™åªæ˜¯ç”¨æ¥ä¸¾ä¾‹ï¼Œnormalizeæ–¹æ³•ä¸èƒ½è¯†åˆ«ä¸­æ–‡ã€‚ï¼‰ NFKDï¼Œè¡¨ç¤ºâ€œå…¼å®¹ç­‰ä»·åˆ†è§£â€ï¼ˆNormalization Form Compatibility Decompositionï¼‰ï¼Œå³åœ¨å…¼å®¹ç­‰ä»·çš„å‰æä¸‹ï¼Œè¿”å›åˆæˆå­—ç¬¦åˆ†è§£çš„å¤šä¸ªç®€å•å­—ç¬¦ã€‚ 12'\\u004F\\u030C'.normalize('NFC').length // 1'\\u004F\\u030C'.normalize('NFD').length // 2 ä¸Šé¢ä»£ç è¡¨ç¤ºï¼ŒNFCå‚æ•°è¿”å›å­—ç¬¦çš„åˆæˆå½¢å¼ï¼ŒNFDå‚æ•°è¿”å›å­—ç¬¦çš„åˆ†è§£å½¢å¼ã€‚ ä¸è¿‡ï¼Œnormalizeæ–¹æ³•ç›®å‰ä¸èƒ½è¯†åˆ«ä¸‰ä¸ªæˆ–ä¸‰ä¸ªä»¥ä¸Šå­—ç¬¦çš„åˆæˆã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯åªèƒ½ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œé€šè¿‡Unicodeç¼–å·åŒºé—´åˆ¤æ–­ã€‚ includes(), startsWith(), endsWith()ä¼ ç»Ÿä¸Šï¼ŒJavaScriptåªæœ‰indexOfæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥ç¡®å®šä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚ES6åˆæä¾›äº†ä¸‰ç§æ–°æ–¹æ³•ã€‚ includes()ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°äº†å‚æ•°å­—ç¬¦ä¸²ã€‚ startsWith()ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨æºå­—ç¬¦ä¸²çš„å¤´éƒ¨ã€‚ endsWith()ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨æºå­—ç¬¦ä¸²çš„å°¾éƒ¨ã€‚ 12345var s = 'Hello world!';s.startsWith('Hello') // trues.endsWith('!') // trues.includes('o') // true è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ”¯æŒç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºå¼€å§‹æœç´¢çš„ä½ç½®ã€‚ 12345var s = 'Hello world!';s.startsWith('world', 6) // trues.endsWith('Hello', 5) // trues.includes('Hello', 6) // false ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°næ—¶ï¼ŒendsWithçš„è¡Œä¸ºä¸å…¶ä»–ä¸¤ä¸ªæ–¹æ³•æœ‰æ‰€ä¸åŒã€‚å®ƒé’ˆå¯¹å‰nä¸ªå­—ç¬¦ï¼Œè€Œå…¶ä»–ä¸¤ä¸ªæ–¹æ³•é’ˆå¯¹ä»ç¬¬nä¸ªä½ç½®ç›´åˆ°å­—ç¬¦ä¸²ç»“æŸã€‚ repeat()repeatæ–¹æ³•è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå°†åŸå­—ç¬¦ä¸²é‡å¤næ¬¡ã€‚ 123'x'.repeat(3) // \"xxx\"'hello'.repeat(2) // \"hellohello\"'na'.repeat(0) // \"\" å‚æ•°å¦‚æœæ˜¯å°æ•°ï¼Œä¼šè¢«å–æ•´ã€‚ 1'na'.repeat(2.9) // \"nana\" å¦‚æœrepeatçš„å‚æ•°æ˜¯è´Ÿæ•°æˆ–è€…Infinityï¼Œä¼šæŠ¥é”™ã€‚ 1234'na'.repeat(Infinity)// RangeError'na'.repeat(-1)// RangeError ä½†æ˜¯ï¼Œå¦‚æœå‚æ•°æ˜¯0åˆ°-1ä¹‹é—´çš„å°æ•°ï¼Œåˆ™ç­‰åŒäº0ï¼Œè¿™æ˜¯å› ä¸ºä¼šå…ˆè¿›è¡Œå–æ•´è¿ç®—ã€‚0åˆ°-1ä¹‹é—´çš„å°æ•°ï¼Œå–æ•´ä»¥åç­‰äº-0ï¼Œrepeatè§†åŒä¸º0ã€‚ 1'na'.repeat(-0.9) // \"\" å‚æ•°NaNç­‰åŒäº0ã€‚ 1'na'.repeat(NaN) // \"\" å¦‚æœrepeatçš„å‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™ä¼šå…ˆè½¬æ¢æˆæ•°å­—ã€‚ 12'na'.repeat('na') // \"\"'na'.repeat('3') // \"nanana\" padStart()ï¼ŒpadEnd()ES7æ¨å‡ºäº†å­—ç¬¦ä¸²è¡¥å…¨é•¿åº¦çš„åŠŸèƒ½ã€‚å¦‚æœæŸä¸ªå­—ç¬¦ä¸²ä¸å¤ŸæŒ‡å®šé•¿åº¦ï¼Œä¼šåœ¨å¤´éƒ¨æˆ–å°¾éƒ¨è¡¥å…¨ã€‚padStartç”¨äºå¤´éƒ¨è¡¥å…¨ï¼ŒpadEndç”¨äºå°¾éƒ¨è¡¥å…¨ã€‚ 12345'x'.padStart(5, 'ab') // 'ababx''x'.padStart(4, 'ab') // 'abax''x'.padEnd(5, 'ab') // 'xabab''x'.padEnd(4, 'ab') // 'xaba' ä¸Šé¢ä»£ç ä¸­ï¼ŒpadStartå’ŒpadEndä¸€å…±æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šå­—ç¬¦ä¸²çš„æœ€å°é•¿åº¦ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨æ¥è¡¥å…¨çš„å­—ç¬¦ä¸²ã€‚ å¦‚æœåŸå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç­‰äºæˆ–å¤§äºæŒ‡å®šçš„æœ€å°é•¿åº¦ï¼Œåˆ™è¿”å›åŸå­—ç¬¦ä¸²ã€‚ 12'xxx'.padStart(2, 'ab') // 'xxx''xxx'.padEnd(2, 'ab') // 'xxx' å¦‚æœç”¨æ¥è¡¥å…¨çš„å­—ç¬¦ä¸²ä¸åŸå­—ç¬¦ä¸²ï¼Œä¸¤è€…çš„é•¿åº¦ä¹‹å’Œè¶…è¿‡äº†æŒ‡å®šçš„æœ€å°é•¿åº¦ï¼Œåˆ™ä¼šæˆªå»è¶…å‡ºä½æ•°çš„è¡¥å…¨å­—ç¬¦ä¸²ã€‚ 12'abc'.padStart(10, '0123456789')// '0123456abc' å¦‚æœçœç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™ä¼šç”¨ç©ºæ ¼è¡¥å…¨é•¿åº¦ã€‚ 12'x'.padStart(4) // ' x''x'.padEnd(4) // 'x ' padStartçš„å¸¸è§ç”¨é€”æ˜¯ä¸ºæ•°å€¼è¡¥å…¨æŒ‡å®šä½æ•°ã€‚ä¸‹é¢ä»£ç ç”Ÿæˆ10ä½çš„æ•°å€¼å­—ç¬¦ä¸²ã€‚ 123'1'.padStart(10, '0') // \"0000000001\"'12'.padStart(10, '0') // \"0000000012\"'123456'.padStart(10, '0') // \"0000123456\" å¦ä¸€ä¸ªç”¨é€”æ˜¯æç¤ºå­—ç¬¦ä¸²æ ¼å¼ã€‚ 12'12'.padStart(10, 'YYYY-MM-DD') // \"YYYY-MM-12\"'09-12'.padStart(10, 'YYYY-MM-DD') // \"YYYY-09-12\" æ¨¡æ¿å­—ç¬¦ä¸²ä¼ ç»Ÿçš„JavaScriptè¯­è¨€ï¼Œè¾“å‡ºæ¨¡æ¿é€šå¸¸æ˜¯è¿™æ ·å†™çš„ã€‚ 123456$('#result').append( 'There are &lt;b&gt;' + basket.count + '&lt;/b&gt; ' + 'items in your basket, ' + '&lt;em&gt;' + basket.onSale + '&lt;/em&gt; are on sale!'); ä¸Šé¢è¿™ç§å†™æ³•ç›¸å½“ç¹çä¸æ–¹ä¾¿ï¼ŒES6å¼•å…¥äº†æ¨¡æ¿å­—ç¬¦ä¸²è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ 12345$('#result').append(` There are &lt;b&gt;$&#123;basket.count&#125;&lt;/b&gt; items in your basket, &lt;em&gt;$&#123;basket.onSale&#125;&lt;/em&gt; are on sale!`); æ¨¡æ¿å­—ç¬¦ä¸²ï¼ˆtemplate stringï¼‰æ˜¯å¢å¼ºç‰ˆçš„å­—ç¬¦ä¸²ï¼Œç”¨åå¼•å·ï¼ˆ&#96;ï¼‰æ ‡è¯†ã€‚å®ƒå¯ä»¥å½“ä½œæ™®é€šå­—ç¬¦ä¸²ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å®šä¹‰å¤šè¡Œå­—ç¬¦ä¸²ï¼Œæˆ–è€…åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡ã€‚ 12345678910111213// æ™®é€šå­—ç¬¦ä¸²`In JavaScript '\\n' is a line-feed.`// å¤šè¡Œå­—ç¬¦ä¸²`In JavaScript this is not legal.`console.log(`string text line 1string text line 2`);// å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡var name = \"Bob\", time = \"today\";`Hello $&#123;name&#125;, how are you $&#123;time&#125;?` ä¸Šé¢ä»£ç ä¸­çš„æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œéƒ½æ˜¯ç”¨åå¼•å·è¡¨ç¤ºã€‚å¦‚æœåœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­éœ€è¦ä½¿ç”¨åå¼•å·ï¼Œåˆ™å‰é¢è¦ç”¨åæ–œæ è½¬ä¹‰ã€‚ 1var greeting = `\\`Yo\\` World!`; å¦‚æœä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²è¡¨ç¤ºå¤šè¡Œå­—ç¬¦ä¸²ï¼Œæ‰€æœ‰çš„ç©ºæ ¼å’Œç¼©è¿›éƒ½ä¼šè¢«ä¿ç•™åœ¨è¾“å‡ºä¹‹ä¸­ã€‚ 123456$('#list').html(`&lt;ul&gt; &lt;li&gt;first&lt;/li&gt; &lt;li&gt;second&lt;/li&gt;&lt;/ul&gt;`); ä¸Šé¢ä»£ç ä¸­ï¼Œæ‰€æœ‰æ¨¡æ¿å­—ç¬¦ä¸²çš„ç©ºæ ¼å’Œæ¢è¡Œï¼Œéƒ½æ˜¯è¢«ä¿ç•™çš„ï¼Œæ¯”å¦‚&lt;ul&gt;æ ‡ç­¾å‰é¢ä¼šæœ‰ä¸€ä¸ªæ¢è¡Œã€‚å¦‚æœä½ ä¸æƒ³è¦è¿™ä¸ªæ¢è¡Œï¼Œå¯ä»¥ä½¿ç”¨trimæ–¹æ³•æ¶ˆé™¤å®ƒã€‚ 123456$('#list').html(`&lt;ul&gt; &lt;li&gt;first&lt;/li&gt; &lt;li&gt;second&lt;/li&gt;&lt;/ul&gt;`.trim()); æ¨¡æ¿å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡ï¼Œéœ€è¦å°†å˜é‡åå†™åœ¨${}ä¹‹ä¸­ã€‚ 123456789101112function authorize(user, action) &#123; if (!user.hasPrivilege(action)) &#123; throw new Error( // ä¼ ç»Ÿå†™æ³•ä¸º // 'User ' // + user.name // + ' is not authorized to do ' // + action // + '.' `User $&#123;user.name&#125; is not authorized to do $&#123;action&#125;.`); &#125;&#125; å¤§æ‹¬å·å†…éƒ¨å¯ä»¥æ”¾å…¥ä»»æ„çš„JavaScriptè¡¨è¾¾å¼ï¼Œå¯ä»¥è¿›è¡Œè¿ç®—ï¼Œä»¥åŠå¼•ç”¨å¯¹è±¡å±æ€§ã€‚ 123456789101112var x = 1;var y = 2;`$&#123;x&#125; + $&#123;y&#125; = $&#123;x + y&#125;`// \"1 + 2 = 3\"`$&#123;x&#125; + $&#123;y * 2&#125; = $&#123;x + y * 2&#125;`// \"1 + 4 = 5\"var obj = &#123;x: 1, y: 2&#125;;`$&#123;obj.x + obj.y&#125;`// 3 æ¨¡æ¿å­—ç¬¦ä¸²ä¹‹ä¸­è¿˜èƒ½è°ƒç”¨å‡½æ•°ã€‚ 123456function fn() &#123; return \"Hello World\";&#125;`foo $&#123;fn()&#125; bar`// foo Hello World bar å¦‚æœå¤§æ‹¬å·ä¸­çš„å€¼ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå°†æŒ‰ç…§ä¸€èˆ¬çš„è§„åˆ™è½¬ä¸ºå­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼Œå¤§æ‹¬å·ä¸­æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°†é»˜è®¤è°ƒç”¨å¯¹è±¡çš„toStringæ–¹æ³•ã€‚ å¦‚æœæ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„å˜é‡æ²¡æœ‰å£°æ˜ï¼Œå°†æŠ¥é”™ã€‚ 123// å˜é‡placeæ²¡æœ‰å£°æ˜var msg = `Hello, $&#123;place&#125;`;// æŠ¥é”™ ç”±äºæ¨¡æ¿å­—ç¬¦ä¸²çš„å¤§æ‹¬å·å†…éƒ¨ï¼Œå°±æ˜¯æ‰§è¡ŒJavaScriptä»£ç ï¼Œå› æ­¤å¦‚æœå¤§æ‹¬å·å†…éƒ¨æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°†ä¼šåŸæ ·è¾“å‡ºã€‚ 12`Hello $&#123;'World'&#125;`// \"Hello World\" æ¨¡æ¿å­—ç¬¦ä¸²ç”šè‡³è¿˜èƒ½åµŒå¥—ã€‚ 12345678const tmpl = addrs =&gt; ` &lt;table&gt; $&#123;addrs.map(addr =&gt; ` &lt;tr&gt;&lt;td&gt;$&#123;addr.first&#125;&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt;&lt;td&gt;$&#123;addr.last&#125;&lt;/td&gt;&lt;/tr&gt; `).join('')&#125; &lt;/table&gt;`; ä¸Šé¢ä»£ç ä¸­ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²çš„å˜é‡ä¹‹ä¸­ï¼ŒåˆåµŒå…¥äº†å¦ä¸€ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ã€‚ 123456789101112131415const data = [ &#123; first: '&lt;Jane&gt;', last: 'Bond' &#125;, &#123; first: 'Lars', last: '&lt;Croft&gt;' &#125;,];console.log(tmpl(data));// &lt;table&gt;//// &lt;tr&gt;&lt;td&gt;&lt;Jane&gt;&lt;/td&gt;&lt;/tr&gt;// &lt;tr&gt;&lt;td&gt;Bond&lt;/td&gt;&lt;/tr&gt;//// &lt;tr&gt;&lt;td&gt;Lars&lt;/td&gt;&lt;/tr&gt;// &lt;tr&gt;&lt;td&gt;&lt;Croft&gt;&lt;/td&gt;&lt;/tr&gt;//// &lt;/table&gt; å¦‚æœéœ€è¦å¼•ç”¨æ¨¡æ¿å­—ç¬¦ä¸²æœ¬èº«ï¼Œåœ¨éœ€è¦æ—¶æ‰§è¡Œï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·å†™ã€‚ 123456789// å†™æ³•ä¸€let str = 'return ' + '`Hello $&#123;name&#125;!`';let func = new Function('name', str);func('Jack') // \"Hello Jack!\"// å†™æ³•äºŒlet str = '(name) =&gt; `Hello $&#123;name&#125;!`';let func = eval.call(null, str);func('Jack') // \"Hello Jack!\" å®ä¾‹ï¼šæ¨¡æ¿ç¼–è¯‘ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé€šè¿‡æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œç”Ÿæˆæ­£å¼æ¨¡æ¿çš„å®ä¾‹ã€‚ 1234567var template = `&lt;ul&gt; &lt;% for(var i=0; i &lt; data.supplies.length; i++) &#123; %&gt; &lt;li&gt;&lt;%= data.supplies[i] %&gt;&lt;/li&gt; &lt;% &#125; %&gt;&lt;/ul&gt;`; ä¸Šé¢ä»£ç åœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¹‹ä¸­ï¼Œæ”¾ç½®äº†ä¸€ä¸ªå¸¸è§„æ¨¡æ¿ã€‚è¯¥æ¨¡æ¿ä½¿ç”¨&lt;%...%&gt;æ”¾ç½®JavaScriptä»£ç ï¼Œä½¿ç”¨&lt;%= ... %&gt;è¾“å‡ºJavaScriptè¡¨è¾¾å¼ã€‚ æ€ä¹ˆç¼–è¯‘è¿™ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²å‘¢ï¼Ÿ ä¸€ç§æ€è·¯æ˜¯å°†å…¶è½¬æ¢ä¸ºJavaScriptè¡¨è¾¾å¼å­—ç¬¦ä¸²ã€‚ 1234567echo('&lt;ul&gt;');for(var i=0; i &lt; data.supplies.length; i++) &#123; echo('&lt;li&gt;'); echo(data.supplies[i]); echo('&lt;/li&gt;');&#125;;echo('&lt;/ul&gt;'); è¿™ä¸ªè½¬æ¢ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å°±è¡Œäº†ã€‚ 12345678var evalExpr = /&lt;%=(.+?)%&gt;/g;var expr = /&lt;%([\\s\\S]+?)%&gt;/g;template = template .replace(evalExpr, '`); \\n echo( $1 ); \\n echo(`') .replace(expr, '`); \\n $1 \\n echo(`');template = 'echo(`' + template + '`);'; ç„¶åï¼Œå°†templateå°è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢è¿”å›ï¼Œå°±å¯ä»¥äº†ã€‚ 1234567891011121314var script =`(function parse(data)&#123; var output = \"\"; function echo(html)&#123; output += html; &#125; $&#123; template &#125; return output;&#125;)`;return script; å°†ä¸Šé¢çš„å†…å®¹æ‹¼è£…æˆä¸€ä¸ªæ¨¡æ¿ç¼–è¯‘å‡½æ•°compileã€‚ 12345678910111213141516171819202122232425function compile(template)&#123; var evalExpr = /&lt;%=(.+?)%&gt;/g; var expr = /&lt;%([\\s\\S]+?)%&gt;/g; template = template .replace(evalExpr, '`); \\n echo( $1 ); \\n echo(`') .replace(expr, '`); \\n $1 \\n echo(`'); template = 'echo(`' + template + '`);'; var script = `(function parse(data)&#123; var output = \"\"; function echo(html)&#123; output += html; &#125; $&#123; template &#125; return output; &#125;)`; return script;&#125; compileå‡½æ•°çš„ç”¨æ³•å¦‚ä¸‹ã€‚ 1234567var parse = eval(compile(template));div.innerHTML = parse(&#123; supplies: [ \"broom\", \"mop\", \"cleaner\" ] &#125;);// &lt;ul&gt;// &lt;li&gt;broom&lt;/li&gt;// &lt;li&gt;mop&lt;/li&gt;// &lt;li&gt;cleaner&lt;/li&gt;// &lt;/ul&gt; æ ‡ç­¾æ¨¡æ¿æ¨¡æ¿å­—ç¬¦ä¸²çš„åŠŸèƒ½ï¼Œä¸ä»…ä»…æ˜¯ä¸Šé¢è¿™äº›ã€‚å®ƒå¯ä»¥ç´§è·Ÿåœ¨ä¸€ä¸ªå‡½æ•°ååé¢ï¼Œè¯¥å‡½æ•°å°†è¢«è°ƒç”¨æ¥å¤„ç†è¿™ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ã€‚è¿™è¢«ç§°ä¸ºâ€œæ ‡ç­¾æ¨¡æ¿â€åŠŸèƒ½ï¼ˆtagged templateï¼‰ã€‚ 123alert`123`// ç­‰åŒäºalert(123) æ ‡ç­¾æ¨¡æ¿å…¶å®ä¸æ˜¯æ¨¡æ¿ï¼Œè€Œæ˜¯å‡½æ•°è°ƒç”¨çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ã€‚â€œæ ‡ç­¾â€æŒ‡çš„å°±æ˜¯å‡½æ•°ï¼Œç´§è·Ÿåœ¨åé¢çš„æ¨¡æ¿å­—ç¬¦ä¸²å°±æ˜¯å®ƒçš„å‚æ•°ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ¨¡æ¿å­—ç¬¦é‡Œé¢æœ‰å˜é‡ï¼Œå°±ä¸æ˜¯ç®€å•çš„è°ƒç”¨äº†ï¼Œè€Œæ˜¯ä¼šå°†æ¨¡æ¿å­—ç¬¦ä¸²å…ˆå¤„ç†æˆå¤šä¸ªå‚æ•°ï¼Œå†è°ƒç”¨å‡½æ•°ã€‚ 123456var a = 5;var b = 10;tag`Hello $&#123; a + b &#125; world $&#123; a * b &#125;`;// ç­‰åŒäºtag(['Hello ', ' world ', ''], 15, 50); ä¸Šé¢ä»£ç ä¸­ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²å‰é¢æœ‰ä¸€ä¸ªæ ‡è¯†åtagï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚æ•´ä¸ªè¡¨è¾¾å¼çš„è¿”å›å€¼ï¼Œå°±æ˜¯tagå‡½æ•°å¤„ç†æ¨¡æ¿å­—ç¬¦ä¸²åçš„è¿”å›å€¼ã€‚ å‡½æ•°tagä¾æ¬¡ä¼šæ¥æ”¶åˆ°å¤šä¸ªå‚æ•°ã€‚ 123456789function tag(stringArr, value1, value2)&#123; // ...&#125;// ç­‰åŒäºfunction tag(stringArr, ...values)&#123; // ...&#125; tagå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„çš„æˆå‘˜æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²ä¸­é‚£äº›æ²¡æœ‰å˜é‡æ›¿æ¢çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå˜é‡æ›¿æ¢åªå‘ç”Ÿåœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ä¸ç¬¬äºŒä¸ªæˆå‘˜ä¹‹é—´ã€ç¬¬äºŒä¸ªæˆå‘˜ä¸ç¬¬ä¸‰ä¸ªæˆå‘˜ä¹‹é—´ï¼Œä»¥æ­¤ç±»æ¨ã€‚ tagå‡½æ•°çš„å…¶ä»–å‚æ•°ï¼Œéƒ½æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²å„ä¸ªå˜é‡è¢«æ›¿æ¢åçš„å€¼ã€‚ç”±äºæœ¬ä¾‹ä¸­ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²å«æœ‰ä¸¤ä¸ªå˜é‡ï¼Œå› æ­¤tagä¼šæ¥å—åˆ°value1å’Œvalue2ä¸¤ä¸ªå‚æ•°ã€‚ tagå‡½æ•°æ‰€æœ‰å‚æ•°çš„å®é™…å€¼å¦‚ä¸‹ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°ï¼š[&#39;Hello &#39;, &#39; world &#39;, &#39;&#39;] ç¬¬äºŒä¸ªå‚æ•°: 15 ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š50 ä¹Ÿå°±æ˜¯è¯´ï¼Œtagå‡½æ•°å®é™…ä¸Šä»¥ä¸‹é¢çš„å½¢å¼è°ƒç”¨ã€‚ 1tag(['Hello ', ' world ', ''], 15, 50) æˆ‘ä»¬å¯ä»¥æŒ‰ç…§éœ€è¦ç¼–å†™tagå‡½æ•°çš„ä»£ç ã€‚ä¸‹é¢æ˜¯tagå‡½æ•°çš„ä¸€ç§å†™æ³•ï¼Œä»¥åŠè¿è¡Œç»“æœã€‚ 1234567891011121314151617181920var a = 5;var b = 10;function tag(s, v1, v2) &#123; console.log(s[0]); console.log(s[1]); console.log(s[2]); console.log(v1); console.log(v2); return \"OK\";&#125;tag`Hello $&#123; a + b &#125; world $&#123; a * b&#125;`;// \"Hello \"// \" world \"// \"\"// 15// 50// \"OK\" ä¸‹é¢æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ã€‚ 123456789101112131415161718var total = 30;var msg = passthru`The total is $&#123;total&#125; ($&#123;total*1.05&#125; with tax)`;function passthru(literals) &#123; var result = ''; var i = 0; while (i &lt; literals.length) &#123; result += literals[i++]; if (i &lt; arguments.length) &#123; result += arguments[i]; &#125; &#125; return result;&#125;msg // \"The total is 30 (31.5 with tax)\" ä¸Šé¢è¿™ä¸ªä¾‹å­å±•ç¤ºäº†ï¼Œå¦‚ä½•å°†å„ä¸ªå‚æ•°æŒ‰ç…§åŸæ¥çš„ä½ç½®æ‹¼åˆå›å»ã€‚ passthruå‡½æ•°é‡‡ç”¨restå‚æ•°çš„å†™æ³•å¦‚ä¸‹ã€‚ 123456789function passthru(literals, ...values) &#123; var output = \"\"; for (var index = 0; index &lt; values.length; index++) &#123; output += literals[index] + values[index]; &#125; output += literals[index] return output;&#125; â€œæ ‡ç­¾æ¨¡æ¿â€çš„ä¸€ä¸ªé‡è¦åº”ç”¨ï¼Œå°±æ˜¯è¿‡æ»¤HTMLå­—ç¬¦ä¸²ï¼Œé˜²æ­¢ç”¨æˆ·è¾“å…¥æ¶æ„å†…å®¹ã€‚ 123456789101112131415161718var message = SaferHTML`&lt;p&gt;$&#123;sender&#125; has sent you a message.&lt;/p&gt;`;function SaferHTML(templateData) &#123; var s = templateData[0]; for (var i = 1; i &lt; arguments.length; i++) &#123; var arg = String(arguments[i]); // Escape special characters in the substitution. s += arg.replace(/&amp;/g, \"&amp;amp;\") .replace(/&lt;/g, \"&amp;lt;\") .replace(/&gt;/g, \"&amp;gt;\"); // Don't escape special characters in the template. s += templateData[i]; &#125; return s;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œsenderå˜é‡å¾€å¾€æ˜¯ç”¨æˆ·æä¾›çš„ï¼Œç»è¿‡SaferHTMLå‡½æ•°å¤„ç†ï¼Œé‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦éƒ½ä¼šè¢«è½¬ä¹‰ã€‚ 12345var sender = '&lt;script&gt;alert(\"abc\")&lt;/script&gt;'; // æ¶æ„ä»£ç var message = SaferHTML`&lt;p&gt;$&#123;sender&#125; has sent you a message.&lt;/p&gt;`;message// &lt;p&gt;&amp;lt;script&amp;gt;alert(\"abc\")&amp;lt;/script&amp;gt; has sent you a message.&lt;/p&gt; æ ‡ç­¾æ¨¡æ¿çš„å¦ä¸€ä¸ªåº”ç”¨ï¼Œå°±æ˜¯å¤šè¯­è¨€è½¬æ¢ï¼ˆå›½é™…åŒ–å¤„ç†ï¼‰ã€‚ 12i18n`Welcome to $&#123;siteName&#125;, you are visitor number $&#123;visitorNumber&#125;!`// \"æ¬¢è¿è®¿é—®xxxï¼Œæ‚¨æ˜¯ç¬¬xxxxä½è®¿é—®è€…ï¼\" æ¨¡æ¿å­—ç¬¦ä¸²æœ¬èº«å¹¶ä¸èƒ½å–ä»£Mustacheä¹‹ç±»çš„æ¨¡æ¿åº“ï¼Œå› ä¸ºæ²¡æœ‰æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯å¤„ç†åŠŸèƒ½ï¼Œä½†æ˜¯é€šè¿‡æ ‡ç­¾å‡½æ•°ï¼Œä½ å¯ä»¥è‡ªå·±æ·»åŠ è¿™äº›åŠŸèƒ½ã€‚ 123456789// ä¸‹é¢çš„hashTemplateå‡½æ•°// æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„æ¨¡æ¿å¤„ç†å‡½æ•°var libraryHtml = hashTemplate` &lt;ul&gt; #for book in $&#123;myBooks&#125; &lt;li&gt;&lt;i&gt;#&#123;book.title&#125;&lt;/i&gt; by #&#123;book.author&#125;&lt;/li&gt; #end &lt;/ul&gt;`; é™¤æ­¤ä¹‹å¤–ï¼Œä½ ç”šè‡³å¯ä»¥ä½¿ç”¨æ ‡ç­¾æ¨¡æ¿ï¼Œåœ¨JavaScriptè¯­è¨€ä¹‹ä¸­åµŒå…¥å…¶ä»–è¯­è¨€ã€‚ 123456789jsx` &lt;div&gt; &lt;input ref='input' onChange='$&#123;this.handleChange&#125;' defaultValue='$&#123;this.state.value&#125;' /&gt; $&#123;this.state.value&#125; &lt;/div&gt;` ä¸Šé¢çš„ä»£ç é€šè¿‡jsxå‡½æ•°ï¼Œå°†ä¸€ä¸ªDOMå­—ç¬¦ä¸²è½¬ä¸ºReactå¯¹è±¡ã€‚ä½ å¯ä»¥åœ¨Githubæ‰¾åˆ°jsxå‡½æ•°çš„å…·ä½“å®ç°ã€‚ ä¸‹é¢åˆ™æ˜¯ä¸€ä¸ªå‡æƒ³çš„ä¾‹å­ï¼Œé€šè¿‡javaå‡½æ•°ï¼Œåœ¨JavaScriptä»£ç ä¹‹ä¸­è¿è¡ŒJavaä»£ç ã€‚ 12345678java`class HelloWorldApp &#123; public static void main(String[] args) &#123; System.out.println(â€œHello World!â€); // Display the string. &#125;&#125;`HelloWorldApp.main(); æ¨¡æ¿å¤„ç†å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæ¨¡æ¿å­—ç¬¦ä¸²æ•°ç»„ï¼‰ï¼Œè¿˜æœ‰ä¸€ä¸ªrawå±æ€§ã€‚ 12console.log`123`// [\"123\", raw: Array[1]] ä¸Šé¢ä»£ç ä¸­ï¼Œconsole.logæ¥å—çš„å‚æ•°ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ•°ç»„æœ‰ä¸€ä¸ªrawå±æ€§ï¼Œä¿å­˜çš„æ˜¯è½¬ä¹‰åçš„åŸå­—ç¬¦ä¸²ã€‚ è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚ 123456tag`First line\\nSecond line`function tag(strings) &#123; console.log(strings.raw[0]); // \"First line\\\\nSecond line\"&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œtagå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°stringsï¼Œæœ‰ä¸€ä¸ªrawå±æ€§ï¼Œä¹ŸæŒ‡å‘ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ•°ç»„çš„æˆå‘˜ä¸stringsæ•°ç»„å®Œå…¨ä¸€è‡´ã€‚æ¯”å¦‚ï¼Œstringsæ•°ç»„æ˜¯[&quot;First line\\nSecond line&quot;]ï¼Œé‚£ä¹ˆstrings.rawæ•°ç»„å°±æ˜¯[&quot;First line\\\\nSecond line&quot;]ã€‚ä¸¤è€…å”¯ä¸€çš„åŒºåˆ«ï¼Œå°±æ˜¯å­—ç¬¦ä¸²é‡Œé¢çš„æ–œæ éƒ½è¢«è½¬ä¹‰äº†ã€‚æ¯”å¦‚ï¼Œstrings.rawæ•°ç»„ä¼šå°†\\nè§†ä¸º\\\\å’Œnä¸¤ä¸ªå­—ç¬¦ï¼Œè€Œä¸æ˜¯æ¢è¡Œç¬¦ã€‚è¿™æ˜¯ä¸ºäº†æ–¹ä¾¿å–å¾—è½¬ä¹‰ä¹‹å‰çš„åŸå§‹æ¨¡æ¿è€Œè®¾è®¡çš„ã€‚ String.raw()ES6è¿˜ä¸ºåŸç”Ÿçš„Stringå¯¹è±¡ï¼Œæä¾›äº†ä¸€ä¸ªrawæ–¹æ³•ã€‚ String.rawæ–¹æ³•ï¼Œå¾€å¾€ç”¨æ¥å……å½“æ¨¡æ¿å­—ç¬¦ä¸²çš„å¤„ç†å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–œæ éƒ½è¢«è½¬ä¹‰ï¼ˆå³æ–œæ å‰é¢å†åŠ ä¸€ä¸ªæ–œæ ï¼‰çš„å­—ç¬¦ä¸²ï¼Œå¯¹åº”äºæ›¿æ¢å˜é‡åçš„æ¨¡æ¿å­—ç¬¦ä¸²ã€‚ 12345String.raw`Hi\\n$&#123;2+3&#125;!`;// \"Hi\\\\n5!\"String.raw`Hi\\u000A!`;// 'Hi\\\\u000A!' å¦‚æœåŸå­—ç¬¦ä¸²çš„æ–œæ å·²ç»è½¬ä¹‰ï¼Œé‚£ä¹ˆString.rawä¸ä¼šåšä»»ä½•å¤„ç†ã€‚ 12String.raw`Hi\\\\n`// \"Hi\\\\n\" String.rawçš„ä»£ç åŸºæœ¬å¦‚ä¸‹ã€‚ 123456789String.raw = function (strings, ...values) &#123; var output = \"\"; for (var index = 0; index &lt; values.length; index++) &#123; output += strings.raw[index] + values[index]; &#125; output += strings.raw[index] return output;&#125; String.rawæ–¹æ³•å¯ä»¥ä½œä¸ºå¤„ç†æ¨¡æ¿å­—ç¬¦ä¸²çš„åŸºæœ¬æ–¹æ³•ï¼Œå®ƒä¼šå°†æ‰€æœ‰å˜é‡æ›¿æ¢ï¼Œè€Œä¸”å¯¹æ–œæ è¿›è¡Œè½¬ä¹‰ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ­¥ä½œä¸ºå­—ç¬¦ä¸²æ¥ä½¿ç”¨ã€‚ String.rawæ–¹æ³•ä¹Ÿå¯ä»¥ä½œä¸ºæ­£å¸¸çš„å‡½æ•°ä½¿ç”¨ã€‚è¿™æ—¶ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªå…·æœ‰rawå±æ€§çš„å¯¹è±¡ï¼Œä¸”rawå±æ€§çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ 12345String.raw(&#123; raw: 'test' &#125;, 0, 1, 2);// 't0e1s2t'// ç­‰åŒäºString.raw(&#123; raw: ['t','e','s','t'] &#125;, 0, 1, 2); æ¨¡æ¿å­—ç¬¦ä¸²çš„é™åˆ¶å‰é¢æåˆ°æ ‡ç­¾æ¨¡æ¿é‡Œé¢ï¼Œå¯ä»¥å†…åµŒå…¶ä»–è¯­è¨€ã€‚ä½†æ˜¯ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²é»˜è®¤ä¼šå°†å­—ç¬¦ä¸²è½¬ä¹‰ï¼Œå› æ­¤å¯¼è‡´äº†æ— æ³•åµŒå…¥å…¶ä»–è¯­è¨€ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨æ ‡ç­¾æ¨¡æ¿é‡Œé¢å¯ä»¥åµŒå…¥Latexè¯­è¨€ã€‚ 1234567891011function latex(strings) &#123; // ...&#125;let document = latex`\\newcommand&#123;\\fun&#125;&#123;\\textbf&#123;Fun!&#125;&#125; // æ­£å¸¸å·¥ä½œ\\newcommand&#123;\\unicode&#125;&#123;\\textbf&#123;Unicode!&#125;&#125; // æŠ¥é”™\\newcommand&#123;\\xerxes&#125;&#123;\\textbf&#123;King!&#125;&#125; // æŠ¥é”™Breve over the h goes \\u&#123;h&#125;ere // æŠ¥é”™` ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡documentå†…åµŒçš„æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œå¯¹äºLatexè¯­è¨€æ¥è¯´å®Œå…¨æ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯JavaScriptå¼•æ“ä¼šæŠ¥é”™ã€‚åŸå› å°±åœ¨äºå­—ç¬¦ä¸²çš„è½¬ä¹‰ã€‚ æ¨¡æ¿å­—ç¬¦ä¸²ä¼šå°†\\u00FFå’Œ\\u{42}å½“ä½œUnicodeå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œæ‰€ä»¥\\unicodeè§£ææ—¶æŠ¥é”™ï¼›è€Œ\\x56ä¼šè¢«å½“ä½œåå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬ä¹‰ï¼Œæ‰€ä»¥\\xerxesä¼šæŠ¥é”™ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç°åœ¨æœ‰ä¸€ä¸ªææ¡ˆï¼Œæ”¾æ¾å¯¹æ ‡ç­¾æ¨¡æ¿é‡Œé¢çš„å­—ç¬¦ä¸²è½¬ä¹‰çš„é™åˆ¶ã€‚å¦‚æœé‡åˆ°ä¸åˆæ³•çš„å­—ç¬¦ä¸²è½¬ä¹‰ï¼Œå°±è¿”å›undefinedï¼Œè€Œä¸æ˜¯æŠ¥é”™ï¼Œå¹¶ä¸”ä»rawå±æ€§ä¸Šé¢å¯ä»¥å¾—åˆ°åŸå§‹å­—ç¬¦ä¸²ã€‚ 12345function tag(strs) &#123; strs[0] === undefined strs.raw[0] === \"\\\\unicode and \\\\u&#123;55&#125;\";&#125;tag`\\unicode and \\u&#123;55&#125;` ä¸Šé¢ä»£ç ä¸­ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²åŸæœ¬æ˜¯åº”è¯¥æŠ¥é”™çš„ï¼Œä½†æ˜¯ç”±äºæ”¾æ¾äº†å¯¹å­—ç¬¦ä¸²è½¬ä¹‰çš„é™åˆ¶ï¼Œæ‰€ä»¥ä¸æŠ¥é”™äº†ï¼ŒJavaScriptå¼•æ“å°†ç¬¬ä¸€ä¸ªå­—ç¬¦è®¾ç½®ä¸ºundefinedï¼Œä½†æ˜¯rawå±æ€§ä¾ç„¶å¯ä»¥å¾—åˆ°åŸå§‹å­—ç¬¦ä¸²ï¼Œå› æ­¤tagå‡½æ•°è¿˜æ˜¯å¯ä»¥å¯¹åŸå­—ç¬¦ä¸²è¿›è¡Œå¤„ç†ã€‚ æ³¨æ„ï¼Œè¿™ç§å¯¹å­—ç¬¦ä¸²è½¬ä¹‰çš„æ”¾æ¾ï¼Œåªåœ¨æ ‡ç­¾æ¨¡æ¿è§£æå­—ç¬¦ä¸²æ—¶ç”Ÿæ•ˆï¼Œä¸æ˜¯æ ‡ç­¾æ¨¡æ¿çš„åœºåˆï¼Œä¾ç„¶ä¼šæŠ¥é”™ã€‚ 1let bad = `bad escape sequence: \\unicode`; // æŠ¥é”™","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"Unicode","slug":"Unicode","permalink":"http://microzz.com/tags/Unicode/"}]},{"title":"å˜é‡çš„è§£æ„èµ‹å€¼(Destructuring)","date":"2016-11-13T07:16:19.000Z","path":"2016/11/13/destructuring/","text":"å˜é‡çš„è§£æ„èµ‹å€¼æ•°ç»„çš„è§£æ„èµ‹å€¼åŸºæœ¬ç”¨æ³•ES6å…è®¸æŒ‰ç…§ä¸€å®šæ¨¡å¼ï¼Œä»æ•°ç»„å’Œå¯¹è±¡ä¸­æå–å€¼ï¼Œå¯¹å˜é‡è¿›è¡Œèµ‹å€¼ï¼Œè¿™è¢«ç§°ä¸ºè§£æ„ï¼ˆDestructuringï¼‰ã€‚ ä»¥å‰ï¼Œä¸ºå˜é‡èµ‹å€¼ï¼Œåªèƒ½ç›´æ¥æŒ‡å®šå€¼ã€‚ 123var a = 1;var b = 2;var c = 3; ES6å…è®¸å†™æˆä¸‹é¢è¿™æ ·ã€‚ 1var [a, b, c] = [1, 2, 3]; ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¯ä»¥ä»æ•°ç»„ä¸­æå–å€¼ï¼ŒæŒ‰ç…§å¯¹åº”ä½ç½®ï¼Œå¯¹å˜é‡èµ‹å€¼ã€‚ æœ¬è´¨ä¸Šï¼Œè¿™ç§å†™æ³•å±äºâ€œæ¨¡å¼åŒ¹é…â€ï¼Œåªè¦ç­‰å·ä¸¤è¾¹çš„æ¨¡å¼ç›¸åŒï¼Œå·¦è¾¹çš„å˜é‡å°±ä¼šè¢«èµ‹äºˆå¯¹åº”çš„å€¼ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨åµŒå¥—æ•°ç»„è¿›è¡Œè§£æ„çš„ä¾‹å­ã€‚ 1234567891011121314151617181920let [foo, [[bar], baz]] = [1, [[2], 3]];foo // 1bar // 2baz // 3let [ , , third] = [\"foo\", \"bar\", \"baz\"];third // \"baz\"let [x, , y] = [1, 2, 3];x // 1y // 3let [head, ...tail] = [1, 2, 3, 4];head // 1tail // [2, 3, 4]let [x, y, ...z] = ['a'];x // \"a\"y // undefinedz // [] å¦‚æœè§£æ„ä¸æˆåŠŸï¼Œå˜é‡çš„å€¼å°±ç­‰äºundefinedã€‚ 12var [foo] = [];var [bar, foo] = [1]; ä»¥ä¸Šä¸¤ç§æƒ…å†µéƒ½å±äºè§£æ„ä¸æˆåŠŸï¼Œfooçš„å€¼éƒ½ä¼šç­‰äºundefinedã€‚ å¦ä¸€ç§æƒ…å†µæ˜¯ä¸å®Œå…¨è§£æ„ï¼Œå³ç­‰å·å·¦è¾¹çš„æ¨¡å¼ï¼ŒåªåŒ¹é…ä¸€éƒ¨åˆ†çš„ç­‰å·å³è¾¹çš„æ•°ç»„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè§£æ„ä¾ç„¶å¯ä»¥æˆåŠŸã€‚ 12345678let [x, y] = [1, 2, 3];x // 1y // 2let [a, [b], d] = [1, [2, 3], 4];a // 1b // 2d // 4 ä¸Šé¢ä¸¤ä¸ªä¾‹å­ï¼Œéƒ½å±äºä¸å®Œå…¨è§£æ„ï¼Œä½†æ˜¯å¯ä»¥æˆåŠŸã€‚ å¦‚æœç­‰å·çš„å³è¾¹ä¸æ˜¯æ•°ç»„ï¼ˆæˆ–è€…ä¸¥æ ¼åœ°è¯´ï¼Œä¸æ˜¯å¯éå†çš„ç»“æ„ï¼Œå‚è§ã€ŠIteratorã€‹ä¸€ç« ï¼‰ï¼Œé‚£ä¹ˆå°†ä¼šæŠ¥é”™ã€‚ 1234567// æŠ¥é”™let [foo] = 1;let [foo] = false;let [foo] = NaN;let [foo] = undefined;let [foo] = null;let [foo] = &#123;&#125;; ä¸Šé¢çš„è¡¨è¾¾å¼éƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºç­‰å·å³è¾¹çš„å€¼ï¼Œè¦ä¹ˆè½¬ä¸ºå¯¹è±¡ä»¥åä¸å…·å¤‡Iteratoræ¥å£ï¼ˆå‰äº”ä¸ªè¡¨è¾¾å¼ï¼‰ï¼Œè¦ä¹ˆæœ¬èº«å°±ä¸å…·å¤‡Iteratoræ¥å£ï¼ˆæœ€åä¸€ä¸ªè¡¨è¾¾å¼ï¼‰ã€‚ è§£æ„èµ‹å€¼ä¸ä»…é€‚ç”¨äºvarå‘½ä»¤ï¼Œä¹Ÿé€‚ç”¨äºletå’Œconstå‘½ä»¤ã€‚ 123var [v1, v2, ..., vN ] = array;let [v1, v2, ..., vN ] = array;const [v1, v2, ..., vN ] = array; å¯¹äºSetç»“æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„çš„è§£æ„èµ‹å€¼ã€‚ 12let [x, y, z] = new Set([\"a\", \"b\", \"c\"]);x // \"a\" äº‹å®ä¸Šï¼Œåªè¦æŸç§æ•°æ®ç»“æ„å…·æœ‰Iteratoræ¥å£ï¼Œéƒ½å¯ä»¥é‡‡ç”¨æ•°ç»„å½¢å¼çš„è§£æ„èµ‹å€¼ã€‚ 1234567891011function* fibs() &#123; var a = 0; var b = 1; while (true) &#123; yield a; [a, b] = [b, a + b]; &#125;&#125;var [first, second, third, fourth, fifth, sixth] = fibs();sixth // 5 ä¸Šé¢ä»£ç ä¸­ï¼Œfibsæ˜¯ä¸€ä¸ªGeneratorå‡½æ•°ï¼ŒåŸç”Ÿå…·æœ‰Iteratoræ¥å£ã€‚è§£æ„èµ‹å€¼ä¼šä¾æ¬¡ä»è¿™ä¸ªæ¥å£è·å–å€¼ã€‚ é»˜è®¤å€¼è§£æ„èµ‹å€¼å…è®¸æŒ‡å®šé»˜è®¤å€¼ã€‚ 12345var [foo = true] = [];foo // true[x, y = 'b'] = ['a']; // x='a', y='b'[x, y = 'b'] = ['a', undefined]; // x='a', y='b' æ³¨æ„ï¼ŒES6å†…éƒ¨ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ===ï¼‰ï¼Œåˆ¤æ–­ä¸€ä¸ªä½ç½®æ˜¯å¦æœ‰å€¼ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªæ•°ç»„æˆå‘˜ä¸ä¸¥æ ¼ç­‰äºundefinedï¼Œé»˜è®¤å€¼æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚ 12345var [x = 1] = [undefined];x // 1var [x = 1] = [null];x // null ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ•°ç»„æˆå‘˜æ˜¯nullï¼Œé»˜è®¤å€¼å°±ä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºnullä¸ä¸¥æ ¼ç­‰äºundefinedã€‚ å¦‚æœé»˜è®¤å€¼æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œé‚£ä¹ˆè¿™ä¸ªè¡¨è¾¾å¼æ˜¯æƒ°æ€§æ±‚å€¼çš„ï¼Œå³åªæœ‰åœ¨ç”¨åˆ°çš„æ—¶å€™ï¼Œæ‰ä¼šæ±‚å€¼ã€‚ 12345function f() &#123; console.log('aaa');&#125;let [x = f()] = [1]; ä¸Šé¢ä»£ç ä¸­ï¼Œå› ä¸ºxèƒ½å–åˆ°å€¼ï¼Œæ‰€ä»¥å‡½æ•°fæ ¹æœ¬ä¸ä¼šæ‰§è¡Œã€‚ä¸Šé¢çš„ä»£ç å…¶å®ç­‰ä»·äºä¸‹é¢çš„ä»£ç ã€‚ 123456let x;if ([1][0] === undefined) &#123; x = f();&#125; else &#123; x = [1][0];&#125; é»˜è®¤å€¼å¯ä»¥å¼•ç”¨è§£æ„èµ‹å€¼çš„å…¶ä»–å˜é‡ï¼Œä½†è¯¥å˜é‡å¿…é¡»å·²ç»å£°æ˜ã€‚ 1234let [x = 1, y = x] = []; // x=1; y=1let [x = 1, y = x] = [2]; // x=2; y=2let [x = 1, y = x] = [1, 2]; // x=1; y=2let [x = y, y = 1] = []; // ReferenceError ä¸Šé¢æœ€åä¸€ä¸ªè¡¨è¾¾å¼ä¹‹æ‰€ä»¥ä¼šæŠ¥é”™ï¼Œæ˜¯å› ä¸ºxç”¨åˆ°é»˜è®¤å€¼yæ—¶ï¼Œyè¿˜æ²¡æœ‰å£°æ˜ã€‚ å¯¹è±¡çš„è§£æ„èµ‹å€¼è§£æ„ä¸ä»…å¯ä»¥ç”¨äºæ•°ç»„ï¼Œè¿˜å¯ä»¥ç”¨äºå¯¹è±¡ã€‚ 123var &#123; foo, bar &#125; = &#123; foo: \"aaa\", bar: \"bbb\" &#125;;foo // \"aaa\"bar // \"bbb\" å¯¹è±¡çš„è§£æ„ä¸æ•°ç»„æœ‰ä¸€ä¸ªé‡è¦çš„ä¸åŒã€‚æ•°ç»„çš„å…ƒç´ æ˜¯æŒ‰æ¬¡åºæ’åˆ—çš„ï¼Œå˜é‡çš„å–å€¼ç”±å®ƒçš„ä½ç½®å†³å®šï¼›è€Œå¯¹è±¡çš„å±æ€§æ²¡æœ‰æ¬¡åºï¼Œå˜é‡å¿…é¡»ä¸å±æ€§åŒåï¼Œæ‰èƒ½å–åˆ°æ­£ç¡®çš„å€¼ã€‚ 123456var &#123; bar, foo &#125; = &#123; foo: \"aaa\", bar: \"bbb\" &#125;;foo // \"aaa\"bar // \"bbb\"var &#123; baz &#125; = &#123; foo: \"aaa\", bar: \"bbb\" &#125;;baz // undefined ä¸Šé¢ä»£ç çš„ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œç­‰å·å·¦è¾¹çš„ä¸¤ä¸ªå˜é‡çš„æ¬¡åºï¼Œä¸ç­‰å·å³è¾¹ä¸¤ä¸ªåŒåå±æ€§çš„æ¬¡åºä¸ä¸€è‡´ï¼Œä½†æ˜¯å¯¹å–å€¼å®Œå…¨æ²¡æœ‰å½±å“ã€‚ç¬¬äºŒä¸ªä¾‹å­çš„å˜é‡æ²¡æœ‰å¯¹åº”çš„åŒåå±æ€§ï¼Œå¯¼è‡´å–ä¸åˆ°å€¼ï¼Œæœ€åç­‰äºundefinedã€‚ å¦‚æœå˜é‡åä¸å±æ€§åä¸ä¸€è‡´ï¼Œå¿…é¡»å†™æˆä¸‹é¢è¿™æ ·ã€‚ 1234567var &#123; foo: baz &#125; = &#123; foo: 'aaa', bar: 'bbb' &#125;;baz // \"aaa\"let obj = &#123; first: 'hello', last: 'world' &#125;;let &#123; first: f, last: l &#125; = obj;f // 'hello'l // 'world' è¿™å®é™…ä¸Šè¯´æ˜ï¼Œå¯¹è±¡çš„è§£æ„èµ‹å€¼æ˜¯ä¸‹é¢å½¢å¼çš„ç®€å†™ï¼ˆå‚è§ã€Šå¯¹è±¡çš„æ‰©å±•ã€‹ä¸€ç« ï¼‰ã€‚ 1var &#123; foo: foo, bar: bar &#125; = &#123; foo: \"aaa\", bar: \"bbb\" &#125;; ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹è±¡çš„è§£æ„èµ‹å€¼çš„å†…éƒ¨æœºåˆ¶ï¼Œæ˜¯å…ˆæ‰¾åˆ°åŒåå±æ€§ï¼Œç„¶åå†èµ‹ç»™å¯¹åº”çš„å˜é‡ã€‚çœŸæ­£è¢«èµ‹å€¼çš„æ˜¯åè€…ï¼Œè€Œä¸æ˜¯å‰è€…ã€‚ 123var &#123; foo: baz &#125; = &#123; foo: \"aaa\", bar: \"bbb\" &#125;;baz // \"aaa\"foo // error: foo is not defined ä¸Šé¢ä»£ç ä¸­ï¼Œfooæ˜¯åŒ¹é…çš„æ¨¡å¼ï¼Œbazæ‰æ˜¯å˜é‡ã€‚çœŸæ­£è¢«èµ‹å€¼çš„æ˜¯å˜é‡bazï¼Œè€Œä¸æ˜¯æ¨¡å¼fooã€‚ æ³¨æ„ï¼Œé‡‡ç”¨è¿™ç§å†™æ³•æ—¶ï¼Œå˜é‡çš„å£°æ˜å’Œèµ‹å€¼æ˜¯ä¸€ä½“çš„ã€‚å¯¹äºletå’Œconstæ¥è¯´ï¼Œå˜é‡ä¸èƒ½é‡æ–°å£°æ˜ï¼Œæ‰€ä»¥ä¸€æ—¦èµ‹å€¼çš„å˜é‡ä»¥å‰å£°æ˜è¿‡ï¼Œå°±ä¼šæŠ¥é”™ã€‚ 12345let foo;let &#123;foo&#125; = &#123;foo: 1&#125;; // SyntaxError: Duplicate declaration \"foo\"let baz;let &#123;bar: baz&#125; = &#123;bar: 1&#125;; // SyntaxError: Duplicate declaration \"baz\" ä¸Šé¢ä»£ç ä¸­ï¼Œè§£æ„èµ‹å€¼çš„å˜é‡éƒ½ä¼šé‡æ–°å£°æ˜ï¼Œæ‰€ä»¥æŠ¥é”™äº†ã€‚ä¸è¿‡ï¼Œå› ä¸ºvarå‘½ä»¤å…è®¸é‡æ–°å£°æ˜ï¼Œæ‰€ä»¥è¿™ä¸ªé”™è¯¯åªä¼šåœ¨ä½¿ç”¨letå’Œconstå‘½ä»¤æ—¶å‡ºç°ã€‚å¦‚æœæ²¡æœ‰ç¬¬äºŒä¸ªletå‘½ä»¤ï¼Œä¸Šé¢çš„ä»£ç å°±ä¸ä¼šæŠ¥é”™ã€‚ 12345let foo;(&#123;foo&#125; = &#123;foo: 1&#125;); // æˆåŠŸlet baz;(&#123;bar: baz&#125; = &#123;bar: 1&#125;); // æˆåŠŸ ä¸Šé¢ä»£ç ä¸­ï¼Œletå‘½ä»¤ä¸‹é¢ä¸€è¡Œçš„åœ†æ‹¬å·æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚å› ä¸ºè§£æå™¨ä¼šå°†èµ·é¦–çš„å¤§æ‹¬å·ï¼Œç†è§£æˆä¸€ä¸ªä»£ç å—ï¼Œè€Œä¸æ˜¯èµ‹å€¼è¯­å¥ã€‚ å’Œæ•°ç»„ä¸€æ ·ï¼Œè§£æ„ä¹Ÿå¯ä»¥ç”¨äºåµŒå¥—ç»“æ„çš„å¯¹è±¡ã€‚ 12345678910var obj = &#123; p: [ 'Hello', &#123; y: 'World' &#125; ]&#125;;var &#123; p: [x, &#123; y &#125;] &#125; = obj;x // \"Hello\"y // \"World\" æ³¨æ„ï¼Œè¿™æ—¶pæ˜¯æ¨¡å¼ï¼Œä¸æ˜¯å˜é‡ï¼Œå› æ­¤ä¸ä¼šè¢«èµ‹å€¼ã€‚ 12345678910111213var node = &#123; loc: &#123; start: &#123; line: 1, column: 5 &#125; &#125;&#125;;var &#123; loc: &#123; start: &#123; line &#125;&#125; &#125; = node;line // 1loc // error: loc is undefinedstart // error: start is undefined ä¸Šé¢ä»£ç ä¸­ï¼Œåªæœ‰lineæ˜¯å˜é‡ï¼Œlocå’Œstartéƒ½æ˜¯æ¨¡å¼ï¼Œä¸ä¼šè¢«èµ‹å€¼ã€‚ ä¸‹é¢æ˜¯åµŒå¥—èµ‹å€¼çš„ä¾‹å­ã€‚ 1234567let obj = &#123;&#125;;let arr = [];(&#123; foo: obj.prop, bar: arr[0] &#125; = &#123; foo: 123, bar: true &#125;);obj // &#123;prop:123&#125;arr // [true] å¯¹è±¡çš„è§£æ„ä¹Ÿå¯ä»¥æŒ‡å®šé»˜è®¤å€¼ã€‚ 123456789101112131415var &#123;x = 3&#125; = &#123;&#125;;x // 3var &#123;x, y = 5&#125; = &#123;x: 1&#125;;x // 1y // 5var &#123;x:y = 3&#125; = &#123;&#125;;y // 3var &#123;x:y = 3&#125; = &#123;x: 5&#125;;y // 5var &#123; message: msg = 'Something went wrong' &#125; = &#123;&#125;;msg // \"Something went wrong\" é»˜è®¤å€¼ç”Ÿæ•ˆçš„æ¡ä»¶æ˜¯ï¼Œå¯¹è±¡çš„å±æ€§å€¼ä¸¥æ ¼ç­‰äºundefinedã€‚ 12345var &#123;x = 3&#125; = &#123;x: undefined&#125;;x // 3var &#123;x = 3&#125; = &#123;x: null&#125;;x // null ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœxå±æ€§ç­‰äºnullï¼Œå°±ä¸ä¸¥æ ¼ç›¸ç­‰äºundefinedï¼Œå¯¼è‡´é»˜è®¤å€¼ä¸ä¼šç”Ÿæ•ˆã€‚ å¦‚æœè§£æ„å¤±è´¥ï¼Œå˜é‡çš„å€¼ç­‰äºundefinedã€‚ 12var &#123;foo&#125; = &#123;bar: 'baz'&#125;;foo // undefined å¦‚æœè§£æ„æ¨¡å¼æ˜¯åµŒå¥—çš„å¯¹è±¡ï¼Œè€Œä¸”å­å¯¹è±¡æ‰€åœ¨çš„çˆ¶å±æ€§ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°†ä¼šæŠ¥é”™ã€‚ 12// æŠ¥é”™var &#123;foo: &#123;bar&#125;&#125; = &#123;baz: 'baz'&#125;; ä¸Šé¢ä»£ç ä¸­ï¼Œç­‰å·å·¦è¾¹å¯¹è±¡çš„fooå±æ€§ï¼Œå¯¹åº”ä¸€ä¸ªå­å¯¹è±¡ã€‚è¯¥å­å¯¹è±¡çš„barå±æ€§ï¼Œè§£æ„æ—¶ä¼šæŠ¥é”™ã€‚åŸå› å¾ˆç®€å•ï¼Œå› ä¸ºfooè¿™æ—¶ç­‰äºundefinedï¼Œå†å–å­å±æ€§å°±ä¼šæŠ¥é”™ï¼Œè¯·çœ‹ä¸‹é¢çš„ä»£ç ã€‚ 12var _tmp = &#123;baz: 'baz'&#125;;_tmp.foo.bar // æŠ¥é”™ å¦‚æœè¦å°†ä¸€ä¸ªå·²ç»å£°æ˜çš„å˜é‡ç”¨äºè§£æ„èµ‹å€¼ï¼Œå¿…é¡»éå¸¸å°å¿ƒã€‚ 1234// é”™è¯¯çš„å†™æ³•var x;&#123;x&#125; = &#123;x: 1&#125;;// SyntaxError: syntax error ä¸Šé¢ä»£ç çš„å†™æ³•ä¼šæŠ¥é”™ï¼Œå› ä¸ºJavaScriptå¼•æ“ä¼šå°†{x}ç†è§£æˆä¸€ä¸ªä»£ç å—ï¼Œä»è€Œå‘ç”Ÿè¯­æ³•é”™è¯¯ã€‚åªæœ‰ä¸å°†å¤§æ‹¬å·å†™åœ¨è¡Œé¦–ï¼Œé¿å…JavaScriptå°†å…¶è§£é‡Šä¸ºä»£ç å—ï¼Œæ‰èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ 12// æ­£ç¡®çš„å†™æ³•(&#123;x&#125; = &#123;x: 1&#125;); ä¸Šé¢ä»£ç å°†æ•´ä¸ªè§£æ„èµ‹å€¼è¯­å¥ï¼Œæ”¾åœ¨ä¸€ä¸ªåœ†æ‹¬å·é‡Œé¢ï¼Œå°±å¯ä»¥æ­£ç¡®æ‰§è¡Œã€‚å…³äºåœ†æ‹¬å·ä¸è§£æ„èµ‹å€¼çš„å…³ç³»ï¼Œå‚è§ä¸‹æ–‡ã€‚ è§£æ„èµ‹å€¼å…è®¸ï¼Œç­‰å·å·¦è¾¹çš„æ¨¡å¼ä¹‹ä¸­ï¼Œä¸æ”¾ç½®ä»»ä½•å˜é‡åã€‚å› æ­¤ï¼Œå¯ä»¥å†™å‡ºéå¸¸å¤æ€ªçš„èµ‹å€¼è¡¨è¾¾å¼ã€‚ 123(&#123;&#125; = [true, false]);(&#123;&#125; = 'abc');(&#123;&#125; = []); ä¸Šé¢çš„è¡¨è¾¾å¼è™½ç„¶æ¯«æ— æ„ä¹‰ï¼Œä½†æ˜¯è¯­æ³•æ˜¯åˆæ³•çš„ï¼Œå¯ä»¥æ‰§è¡Œã€‚ å¯¹è±¡çš„è§£æ„èµ‹å€¼ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†ç°æœ‰å¯¹è±¡çš„æ–¹æ³•ï¼Œèµ‹å€¼åˆ°æŸä¸ªå˜é‡ã€‚ 1let &#123; log, sin, cos &#125; = Math; ä¸Šé¢ä»£ç å°†Mathå¯¹è±¡çš„å¯¹æ•°ã€æ­£å¼¦ã€ä½™å¼¦ä¸‰ä¸ªæ–¹æ³•ï¼Œèµ‹å€¼åˆ°å¯¹åº”çš„å˜é‡ä¸Šï¼Œä½¿ç”¨èµ·æ¥å°±ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚ ç”±äºæ•°ç»„æœ¬è´¨æ˜¯ç‰¹æ®Šçš„å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥å¯¹æ•°ç»„è¿›è¡Œå¯¹è±¡å±æ€§çš„è§£æ„ã€‚ 1234var arr = [1, 2, 3];var &#123;0 : first, [arr.length - 1] : last&#125; = arr;first // 1last // 3 ä¸Šé¢ä»£ç å¯¹æ•°ç»„è¿›è¡Œå¯¹è±¡è§£æ„ã€‚æ•°ç»„arrçš„0é”®å¯¹åº”çš„å€¼æ˜¯1ï¼Œ[arr.length - 1]å°±æ˜¯2é”®ï¼Œå¯¹åº”çš„å€¼æ˜¯3ã€‚æ–¹æ‹¬å·è¿™ç§å†™æ³•ï¼Œå±äºâ€œå±æ€§åè¡¨è¾¾å¼â€ï¼Œå‚è§ã€Šå¯¹è±¡çš„æ‰©å±•ã€‹ä¸€ç« ã€‚ å­—ç¬¦ä¸²çš„è§£æ„èµ‹å€¼å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥è§£æ„èµ‹å€¼ã€‚è¿™æ˜¯å› ä¸ºæ­¤æ—¶ï¼Œå­—ç¬¦ä¸²è¢«è½¬æ¢æˆäº†ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚ 123456const [a, b, c, d, e] = 'hello';a // \"h\"b // \"e\"c // \"l\"d // \"l\"e // \"o\" ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªlengthå±æ€§ï¼Œå› æ­¤è¿˜å¯ä»¥å¯¹è¿™ä¸ªå±æ€§è§£æ„èµ‹å€¼ã€‚ 12let &#123;length : len&#125; = 'hello';len // 5 æ•°å€¼å’Œå¸ƒå°”å€¼çš„è§£æ„èµ‹å€¼è§£æ„èµ‹å€¼æ—¶ï¼Œå¦‚æœç­‰å·å³è¾¹æ˜¯æ•°å€¼å’Œå¸ƒå°”å€¼ï¼Œåˆ™ä¼šå…ˆè½¬ä¸ºå¯¹è±¡ã€‚ 12345let &#123;toString: s&#125; = 123;s === Number.prototype.toString // truelet &#123;toString: s&#125; = true;s === Boolean.prototype.toString // true ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°å€¼å’Œå¸ƒå°”å€¼çš„åŒ…è£…å¯¹è±¡éƒ½æœ‰toStringå±æ€§ï¼Œå› æ­¤å˜é‡séƒ½èƒ½å–åˆ°å€¼ã€‚ è§£æ„èµ‹å€¼çš„è§„åˆ™æ˜¯ï¼Œåªè¦ç­‰å·å³è¾¹çš„å€¼ä¸æ˜¯å¯¹è±¡ï¼Œå°±å…ˆå°†å…¶è½¬ä¸ºå¯¹è±¡ã€‚ç”±äºundefinedå’Œnullæ— æ³•è½¬ä¸ºå¯¹è±¡ï¼Œæ‰€ä»¥å¯¹å®ƒä»¬è¿›è¡Œè§£æ„èµ‹å€¼ï¼Œéƒ½ä¼šæŠ¥é”™ã€‚ 12let &#123; prop: x &#125; = undefined; // TypeErrorlet &#123; prop: y &#125; = null; // TypeError å‡½æ•°å‚æ•°çš„è§£æ„èµ‹å€¼å‡½æ•°çš„å‚æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼ã€‚ 12345function add([x, y])&#123; return x + y;&#125;add([1, 2]); // 3 ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°addçš„å‚æ•°è¡¨é¢ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½†åœ¨ä¼ å…¥å‚æ•°çš„é‚£ä¸€åˆ»ï¼Œæ•°ç»„å‚æ•°å°±è¢«è§£æ„æˆå˜é‡xå’Œyã€‚å¯¹äºå‡½æ•°å†…éƒ¨çš„ä»£ç æ¥è¯´ï¼Œå®ƒä»¬èƒ½æ„Ÿå—åˆ°çš„å‚æ•°å°±æ˜¯xå’Œyã€‚ ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚ 12[[1, 2], [3, 4]].map(([a, b]) =&gt; a + b);// [ 3, 7 ] å‡½æ•°å‚æ•°çš„è§£æ„ä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼ã€‚ 12345678function move(&#123;x = 0, y = 0&#125; = &#123;&#125;) &#123; return [x, y];&#125;move(&#123;x: 3, y: 8&#125;); // [3, 8]move(&#123;x: 3&#125;); // [3, 0]move(&#123;&#125;); // [0, 0]move(); // [0, 0] ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°moveçš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œè§£æ„ï¼Œå¾—åˆ°å˜é‡xå’Œyçš„å€¼ã€‚å¦‚æœè§£æ„å¤±è´¥ï¼Œxå’Œyç­‰äºé»˜è®¤å€¼ã€‚ æ³¨æ„ï¼Œä¸‹é¢çš„å†™æ³•ä¼šå¾—åˆ°ä¸ä¸€æ ·çš„ç»“æœã€‚ 12345678function move(&#123;x, y&#125; = &#123; x: 0, y: 0 &#125;) &#123; return [x, y];&#125;move(&#123;x: 3, y: 8&#125;); // [3, 8]move(&#123;x: 3&#125;); // [3, undefined]move(&#123;&#125;); // [undefined, undefined]move(); // [0, 0] ä¸Šé¢ä»£ç æ˜¯ä¸ºå‡½æ•°moveçš„å‚æ•°æŒ‡å®šé»˜è®¤å€¼ï¼Œè€Œä¸æ˜¯ä¸ºå˜é‡xå’ŒyæŒ‡å®šé»˜è®¤å€¼ï¼Œæ‰€ä»¥ä¼šå¾—åˆ°ä¸å‰ä¸€ç§å†™æ³•ä¸åŒçš„ç»“æœã€‚ undefinedå°±ä¼šè§¦å‘å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼ã€‚ 12[1, undefined, 3].map((x = 'yes') =&gt; x);// [ 1, 'yes', 3 ] åœ†æ‹¬å·é—®é¢˜è§£æ„èµ‹å€¼è™½ç„¶å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯è§£æèµ·æ¥å¹¶ä¸å®¹æ˜“ã€‚å¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œä¸€ä¸ªå¼å­åˆ°åº•æ˜¯æ¨¡å¼ï¼Œè¿˜æ˜¯è¡¨è¾¾å¼ï¼Œæ²¡æœ‰åŠæ³•ä»ä¸€å¼€å§‹å°±çŸ¥é“ï¼Œå¿…é¡»è§£æåˆ°ï¼ˆæˆ–è§£æä¸åˆ°ï¼‰ç­‰å·æ‰èƒ½çŸ¥é“ã€‚ ç”±æ­¤å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœæ¨¡å¼ä¸­å‡ºç°åœ†æ‹¬å·æ€ä¹ˆå¤„ç†ã€‚ES6çš„è§„åˆ™æ˜¯ï¼Œåªè¦æœ‰å¯èƒ½å¯¼è‡´è§£æ„çš„æ­§ä¹‰ï¼Œå°±ä¸å¾—ä½¿ç”¨åœ†æ‹¬å·ã€‚ ä½†æ˜¯ï¼Œè¿™æ¡è§„åˆ™å®é™…ä¸Šä¸é‚£ä¹ˆå®¹æ˜“è¾¨åˆ«ï¼Œå¤„ç†èµ·æ¥ç›¸å½“éº»çƒ¦ã€‚å› æ­¤ï¼Œå»ºè®®åªè¦æœ‰å¯èƒ½ï¼Œå°±ä¸è¦åœ¨æ¨¡å¼ä¸­æ”¾ç½®åœ†æ‹¬å·ã€‚ ä¸èƒ½ä½¿ç”¨åœ†æ‹¬å·çš„æƒ…å†µä»¥ä¸‹ä¸‰ç§è§£æ„èµ‹å€¼ä¸å¾—ä½¿ç”¨åœ†æ‹¬å·ã€‚ ï¼ˆ1ï¼‰å˜é‡å£°æ˜è¯­å¥ä¸­ï¼Œä¸èƒ½å¸¦æœ‰åœ†æ‹¬å·ã€‚ 123456789// å…¨éƒ¨æŠ¥é”™var [(a)] = [1];var &#123;x: (c)&#125; = &#123;&#125;;var (&#123;x: c&#125;) = &#123;&#125;;var &#123;(x: c)&#125; = &#123;&#125;;var &#123;(x): c&#125; = &#123;&#125;;var &#123; o: (&#123; p: p &#125;) &#125; = &#123; o: &#123; p: 2 &#125; &#125;; ä¸Šé¢ä¸‰ä¸ªè¯­å¥éƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯å˜é‡å£°æ˜è¯­å¥ï¼Œæ¨¡å¼ä¸èƒ½ä½¿ç”¨åœ†æ‹¬å·ã€‚ ï¼ˆ2ï¼‰å‡½æ•°å‚æ•°ä¸­ï¼Œæ¨¡å¼ä¸èƒ½å¸¦æœ‰åœ†æ‹¬å·ã€‚ å‡½æ•°å‚æ•°ä¹Ÿå±äºå˜é‡å£°æ˜ï¼Œå› æ­¤ä¸èƒ½å¸¦æœ‰åœ†æ‹¬å·ã€‚ 12// æŠ¥é”™function f([(z)]) &#123; return z; &#125; ï¼ˆ3ï¼‰èµ‹å€¼è¯­å¥ä¸­ï¼Œä¸èƒ½å°†æ•´ä¸ªæ¨¡å¼ï¼Œæˆ–åµŒå¥—æ¨¡å¼ä¸­çš„ä¸€å±‚ï¼Œæ”¾åœ¨åœ†æ‹¬å·ä¹‹ä¸­ã€‚ 123// å…¨éƒ¨æŠ¥é”™(&#123; p: a &#125;) = &#123; p: 42 &#125;;([a]) = [5]; ä¸Šé¢ä»£ç å°†æ•´ä¸ªæ¨¡å¼æ”¾åœ¨åœ†æ‹¬å·ä¹‹ä¸­ï¼Œå¯¼è‡´æŠ¥é”™ã€‚ 12// æŠ¥é”™[(&#123; p: a &#125;), &#123; x: c &#125;] = [&#123;&#125;, &#123;&#125;]; ä¸Šé¢ä»£ç å°†åµŒå¥—æ¨¡å¼çš„ä¸€å±‚ï¼Œæ”¾åœ¨åœ†æ‹¬å·ä¹‹ä¸­ï¼Œå¯¼è‡´æŠ¥é”™ã€‚ å¯ä»¥ä½¿ç”¨åœ†æ‹¬å·çš„æƒ…å†µå¯ä»¥ä½¿ç”¨åœ†æ‹¬å·çš„æƒ…å†µåªæœ‰ä¸€ç§ï¼šèµ‹å€¼è¯­å¥çš„éæ¨¡å¼éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨åœ†æ‹¬å·ã€‚ 123[(b)] = [3]; // æ­£ç¡®(&#123; p: (d) &#125; = &#123;&#125;); // æ­£ç¡®[(parseInt.prop)] = [3]; // æ­£ç¡® ä¸Šé¢ä¸‰è¡Œè¯­å¥éƒ½å¯ä»¥æ­£ç¡®æ‰§è¡Œï¼Œå› ä¸ºé¦–å…ˆå®ƒä»¬éƒ½æ˜¯èµ‹å€¼è¯­å¥ï¼Œè€Œä¸æ˜¯å£°æ˜è¯­å¥ï¼›å…¶æ¬¡å®ƒä»¬çš„åœ†æ‹¬å·éƒ½ä¸å±äºæ¨¡å¼çš„ä¸€éƒ¨åˆ†ã€‚ç¬¬ä¸€è¡Œè¯­å¥ä¸­ï¼Œæ¨¡å¼æ˜¯å–æ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œè·Ÿåœ†æ‹¬å·æ— å…³ï¼›ç¬¬äºŒè¡Œè¯­å¥ä¸­ï¼Œæ¨¡å¼æ˜¯pï¼Œè€Œä¸æ˜¯dï¼›ç¬¬ä¸‰è¡Œè¯­å¥ä¸ç¬¬ä¸€è¡Œè¯­å¥çš„æ€§è´¨ä¸€è‡´ã€‚ ç”¨é€”å˜é‡çš„è§£æ„èµ‹å€¼ç”¨é€”å¾ˆå¤šã€‚ ï¼ˆ1ï¼‰äº¤æ¢å˜é‡çš„å€¼ 1[x, y] = [y, x]; ä¸Šé¢ä»£ç äº¤æ¢å˜é‡xå’Œyçš„å€¼ï¼Œè¿™æ ·çš„å†™æ³•ä¸ä»…ç®€æ´ï¼Œè€Œä¸”æ˜“è¯»ï¼Œè¯­ä¹‰éå¸¸æ¸…æ™°ã€‚ ï¼ˆ2ï¼‰ä»å‡½æ•°è¿”å›å¤šä¸ªå€¼ å‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¦‚æœè¦è¿”å›å¤šä¸ªå€¼ï¼Œåªèƒ½å°†å®ƒä»¬æ”¾åœ¨æ•°ç»„æˆ–å¯¹è±¡é‡Œè¿”å›ã€‚æœ‰äº†è§£æ„èµ‹å€¼ï¼Œå–å‡ºè¿™äº›å€¼å°±éå¸¸æ–¹ä¾¿ã€‚ 12345678910111213141516// è¿”å›ä¸€ä¸ªæ•°ç»„function example() &#123; return [1, 2, 3];&#125;var [a, b, c] = example();// è¿”å›ä¸€ä¸ªå¯¹è±¡function example() &#123; return &#123; foo: 1, bar: 2 &#125;;&#125;var &#123; foo, bar &#125; = example(); ï¼ˆ3ï¼‰å‡½æ•°å‚æ•°çš„å®šä¹‰ è§£æ„èµ‹å€¼å¯ä»¥æ–¹ä¾¿åœ°å°†ä¸€ç»„å‚æ•°ä¸å˜é‡åå¯¹åº”èµ·æ¥ã€‚ 1234567// å‚æ•°æ˜¯ä¸€ç»„æœ‰æ¬¡åºçš„å€¼function f([x, y, z]) &#123; ... &#125;f([1, 2, 3]);// å‚æ•°æ˜¯ä¸€ç»„æ— æ¬¡åºçš„å€¼function f(&#123;x, y, z&#125;) &#123; ... &#125;f(&#123;z: 3, y: 2, x: 1&#125;); ï¼ˆ4ï¼‰æå–JSONæ•°æ® è§£æ„èµ‹å€¼å¯¹æå–JSONå¯¹è±¡ä¸­çš„æ•°æ®ï¼Œå°¤å…¶æœ‰ç”¨ã€‚ 12345678910var jsonData = &#123; id: 42, status: \"OK\", data: [867, 5309]&#125;;let &#123; id, status, data: number &#125; = jsonData;console.log(id, status, number);// 42, \"OK\", [867, 5309] ä¸Šé¢ä»£ç å¯ä»¥å¿«é€Ÿæå–JSONæ•°æ®çš„å€¼ã€‚ ï¼ˆ5ï¼‰å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼ 1234567891011jQuery.ajax = function (url, &#123; async = true, beforeSend = function () &#123;&#125;, cache = true, complete = function () &#123;&#125;, crossDomain = false, global = true, // ... more config&#125;) &#123; // ... do stuff&#125;; æŒ‡å®šå‚æ•°çš„é»˜è®¤å€¼ï¼Œå°±é¿å…äº†åœ¨å‡½æ•°ä½“å†…éƒ¨å†å†™var foo = config.foo || &#39;default foo&#39;;è¿™æ ·çš„è¯­å¥ã€‚ ï¼ˆ6ï¼‰éå†Mapç»“æ„ ä»»ä½•éƒ¨ç½²äº†Iteratoræ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ç”¨for...ofå¾ªç¯éå†ã€‚Mapç»“æ„åŸç”Ÿæ”¯æŒIteratoræ¥å£ï¼Œé…åˆå˜é‡çš„è§£æ„èµ‹å€¼ï¼Œè·å–é”®åå’Œé”®å€¼å°±éå¸¸æ–¹ä¾¿ã€‚ 123456789var map = new Map();map.set('first', 'hello');map.set('second', 'world');for (let [key, value] of map) &#123; console.log(key + \" is \" + value);&#125;// first is hello// second is world å¦‚æœåªæƒ³è·å–é”®åï¼Œæˆ–è€…åªæƒ³è·å–é”®å€¼ï¼Œå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚ 123456789// è·å–é”®åfor (let [key] of map) &#123; // ...&#125;// è·å–é”®å€¼for (let [,value] of map) &#123; // ...&#125; ï¼ˆ7ï¼‰è¾“å…¥æ¨¡å—çš„æŒ‡å®šæ–¹æ³• åŠ è½½æ¨¡å—æ—¶ï¼Œå¾€å¾€éœ€è¦æŒ‡å®šè¾“å…¥é‚£äº›æ–¹æ³•ã€‚è§£æ„èµ‹å€¼ä½¿å¾—è¾“å…¥è¯­å¥éå¸¸æ¸…æ™°ã€‚ 1const &#123; SourceMapConsumer, SourceNode &#125; = require(\"source-map\");","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"Destructuring","slug":"Destructuring","permalink":"http://microzz.com/tags/Destructuring/"}]},{"title":"letå’Œconstå‘½ä»¤","date":"2016-11-12T07:16:19.000Z","path":"2016/11/12/let/","text":"letå’Œconstå‘½ä»¤letå‘½ä»¤åŸºæœ¬ç”¨æ³•ES6æ–°å¢äº†letå‘½ä»¤ï¼Œç”¨æ¥å£°æ˜å˜é‡ã€‚å®ƒçš„ç”¨æ³•ç±»ä¼¼äºvarï¼Œä½†æ˜¯æ‰€å£°æ˜çš„å˜é‡ï¼Œåªåœ¨letå‘½ä»¤æ‰€åœ¨çš„ä»£ç å—å†…æœ‰æ•ˆã€‚ 1234567&#123; let a = 10; var b = 1;&#125;a // ReferenceError: a is not defined.b // 1 ä¸Šé¢ä»£ç åœ¨ä»£ç å—ä¹‹ä¸­ï¼Œåˆ†åˆ«ç”¨letå’Œvarå£°æ˜äº†ä¸¤ä¸ªå˜é‡ã€‚ç„¶ååœ¨ä»£ç å—ä¹‹å¤–è°ƒç”¨è¿™ä¸¤ä¸ªå˜é‡ï¼Œç»“æœletå£°æ˜çš„å˜é‡æŠ¥é”™ï¼Œvarå£°æ˜çš„å˜é‡è¿”å›äº†æ­£ç¡®çš„å€¼ã€‚è¿™è¡¨æ˜ï¼Œletå£°æ˜çš„å˜é‡åªåœ¨å®ƒæ‰€åœ¨çš„ä»£ç å—æœ‰æ•ˆã€‚ forå¾ªç¯çš„è®¡æ•°å™¨ï¼Œå°±å¾ˆåˆé€‚ä½¿ç”¨letå‘½ä»¤ã€‚ 1234for (let i = 0; i &lt; 10; i++) &#123;&#125;console.log(i);//ReferenceError: i is not defined ä¸Šé¢ä»£ç ä¸­ï¼Œè®¡æ•°å™¨iåªåœ¨forå¾ªç¯ä½“å†…æœ‰æ•ˆï¼Œåœ¨å¾ªç¯ä½“å¤–å¼•ç”¨å°±ä¼šæŠ¥é”™ã€‚ ä¸‹é¢çš„ä»£ç å¦‚æœä½¿ç”¨varï¼Œæœ€åè¾“å‡ºçš„æ˜¯10ã€‚ 1234567var a = [];for (var i = 0; i &lt; 10; i++) &#123; a[i] = function () &#123; console.log(i); &#125;;&#125;a[6](); // 10 ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡iæ˜¯varå£°æ˜çš„ï¼Œåœ¨å…¨å±€èŒƒå›´å†…éƒ½æœ‰æ•ˆã€‚æ‰€ä»¥æ¯ä¸€æ¬¡å¾ªç¯ï¼Œæ–°çš„iå€¼éƒ½ä¼šè¦†ç›–æ—§å€¼ï¼Œå¯¼è‡´æœ€åè¾“å‡ºçš„æ˜¯æœ€åä¸€è½®çš„içš„å€¼ã€‚ å¦‚æœä½¿ç”¨letï¼Œå£°æ˜çš„å˜é‡ä»…åœ¨å—çº§ä½œç”¨åŸŸå†…æœ‰æ•ˆï¼Œæœ€åè¾“å‡ºçš„æ˜¯6ã€‚ 1234567var a = [];for (let i = 0; i &lt; 10; i++) &#123; a[i] = function () &#123; console.log(i); &#125;;&#125;a[6](); // 6 ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡iæ˜¯letå£°æ˜çš„ï¼Œå½“å‰çš„iåªåœ¨æœ¬è½®å¾ªç¯æœ‰æ•ˆï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡å¾ªç¯çš„iå…¶å®éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œæ‰€ä»¥æœ€åè¾“å‡ºçš„æ˜¯6ã€‚ä½ å¯èƒ½ä¼šé—®ï¼Œå¦‚æœæ¯ä¸€è½®å¾ªç¯çš„å˜é‡iéƒ½æ˜¯é‡æ–°å£°æ˜çš„ï¼Œé‚£å®ƒæ€ä¹ˆçŸ¥é“ä¸Šä¸€è½®å¾ªç¯çš„å€¼ï¼Œä»è€Œè®¡ç®—å‡ºæœ¬è½®å¾ªç¯çš„å€¼ï¼Ÿè¿™æ˜¯å› ä¸º JavaScript å¼•æ“å†…éƒ¨ä¼šè®°ä½ä¸Šä¸€è½®å¾ªç¯çš„å€¼ï¼Œåˆå§‹åŒ–æœ¬è½®çš„å˜é‡iæ—¶ï¼Œå°±åœ¨ä¸Šä¸€è½®å¾ªç¯çš„åŸºç¡€ä¸Šè¿›è¡Œè®¡ç®—ã€‚ ä¸å­˜åœ¨å˜é‡æå‡letä¸åƒvaré‚£æ ·ä¼šå‘ç”Ÿâ€œå˜é‡æå‡â€ç°è±¡ã€‚æ‰€ä»¥ï¼Œå˜é‡ä¸€å®šè¦åœ¨å£°æ˜åä½¿ç”¨ï¼Œå¦åˆ™æŠ¥é”™ã€‚ 1234567// var çš„æƒ…å†µconsole.log(foo); // è¾“å‡ºundefinedvar foo = 2;// let çš„æƒ…å†µconsole.log(bar); // æŠ¥é”™ReferenceErrorlet bar = 2; ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡fooç”¨varå‘½ä»¤å£°æ˜ï¼Œä¼šå‘ç”Ÿå˜é‡æå‡ï¼Œå³è„šæœ¬å¼€å§‹è¿è¡Œæ—¶ï¼Œå˜é‡fooå·²ç»å­˜åœ¨äº†ï¼Œä½†æ˜¯æ²¡æœ‰å€¼ï¼Œæ‰€ä»¥ä¼šè¾“å‡ºundefinedã€‚å˜é‡barç”¨letå‘½ä»¤å£°æ˜ï¼Œä¸ä¼šå‘ç”Ÿå˜é‡æå‡ã€‚è¿™è¡¨ç¤ºåœ¨å£°æ˜å®ƒä¹‹å‰ï¼Œå˜é‡baræ˜¯ä¸å­˜åœ¨çš„ï¼Œè¿™æ—¶å¦‚æœç”¨åˆ°å®ƒï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ æš‚æ—¶æ€§æ­»åŒºåªè¦å—çº§ä½œç”¨åŸŸå†…å­˜åœ¨letå‘½ä»¤ï¼Œå®ƒæ‰€å£°æ˜çš„å˜é‡å°±â€œç»‘å®šâ€ï¼ˆbindingï¼‰è¿™ä¸ªåŒºåŸŸï¼Œä¸å†å—å¤–éƒ¨çš„å½±å“ã€‚ 123456var tmp = 123;if (true) &#123; tmp = 'abc'; // ReferenceError let tmp;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå­˜åœ¨å…¨å±€å˜é‡tmpï¼Œä½†æ˜¯å—çº§ä½œç”¨åŸŸå†…letåˆå£°æ˜äº†ä¸€ä¸ªå±€éƒ¨å˜é‡tmpï¼Œå¯¼è‡´åè€…ç»‘å®šè¿™ä¸ªå—çº§ä½œç”¨åŸŸï¼Œæ‰€ä»¥åœ¨letå£°æ˜å˜é‡å‰ï¼Œå¯¹tmpèµ‹å€¼ä¼šæŠ¥é”™ã€‚ ES6æ˜ç¡®è§„å®šï¼Œå¦‚æœåŒºå—ä¸­å­˜åœ¨letå’Œconstå‘½ä»¤ï¼Œè¿™ä¸ªåŒºå—å¯¹è¿™äº›å‘½ä»¤å£°æ˜çš„å˜é‡ï¼Œä»ä¸€å¼€å§‹å°±å½¢æˆäº†å°é—­ä½œç”¨åŸŸã€‚å‡¡æ˜¯åœ¨å£°æ˜ä¹‹å‰å°±ä½¿ç”¨è¿™äº›å˜é‡ï¼Œå°±ä¼šæŠ¥é”™ã€‚ æ€»ä¹‹ï¼Œåœ¨ä»£ç å—å†…ï¼Œä½¿ç”¨letå‘½ä»¤å£°æ˜å˜é‡ä¹‹å‰ï¼Œè¯¥å˜é‡éƒ½æ˜¯ä¸å¯ç”¨çš„ã€‚è¿™åœ¨è¯­æ³•ä¸Šï¼Œç§°ä¸ºâ€œæš‚æ—¶æ€§æ­»åŒºâ€ï¼ˆtemporal dead zoneï¼Œç®€ç§° TDZï¼‰ã€‚ 1234567891011if (true) &#123; // TDZå¼€å§‹ tmp = 'abc'; // ReferenceError console.log(tmp); // ReferenceError let tmp; // TDZç»“æŸ console.log(tmp); // undefined tmp = 123; console.log(tmp); // 123&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œåœ¨letå‘½ä»¤å£°æ˜å˜é‡tmpä¹‹å‰ï¼Œéƒ½å±äºå˜é‡tmpçš„â€œæ­»åŒºâ€ã€‚ â€œæš‚æ—¶æ€§æ­»åŒºâ€ä¹Ÿæ„å‘³ç€typeofä¸å†æ˜¯ä¸€ä¸ªç™¾åˆ†ä¹‹ç™¾å®‰å…¨çš„æ“ä½œã€‚ 12typeof x; // ReferenceErrorlet x; ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡xä½¿ç”¨letå‘½ä»¤å£°æ˜ï¼Œæ‰€ä»¥åœ¨å£°æ˜ä¹‹å‰ï¼Œéƒ½å±äºxçš„â€œæ­»åŒºâ€ï¼Œåªè¦ç”¨åˆ°è¯¥å˜é‡å°±ä¼šæŠ¥é”™ã€‚å› æ­¤ï¼Œtypeofè¿è¡Œæ—¶å°±ä¼šæŠ›å‡ºä¸€ä¸ªReferenceErrorã€‚ ä½œä¸ºæ¯”è¾ƒï¼Œå¦‚æœä¸€ä¸ªå˜é‡æ ¹æœ¬æ²¡æœ‰è¢«å£°æ˜ï¼Œä½¿ç”¨typeofåè€Œä¸ä¼šæŠ¥é”™ã€‚ 1typeof undeclared_variable // \"undefined\" ä¸Šé¢ä»£ç ä¸­ï¼Œundeclared_variableæ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„å˜é‡åï¼Œç»“æœè¿”å›â€œundefinedâ€ã€‚æ‰€ä»¥ï¼Œåœ¨æ²¡æœ‰letä¹‹å‰ï¼Œtypeofè¿ç®—ç¬¦æ˜¯ç™¾åˆ†ä¹‹ç™¾å®‰å…¨çš„ï¼Œæ°¸è¿œä¸ä¼šæŠ¥é”™ã€‚ç°åœ¨è¿™ä¸€ç‚¹ä¸æˆç«‹äº†ã€‚è¿™æ ·çš„è®¾è®¡æ˜¯ä¸ºäº†è®©å¤§å®¶å…»æˆè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œå˜é‡ä¸€å®šè¦åœ¨å£°æ˜ä¹‹åä½¿ç”¨ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚ æœ‰äº›â€œæ­»åŒºâ€æ¯”è¾ƒéšè”½ï¼Œä¸å¤ªå®¹æ˜“å‘ç°ã€‚ 12345function bar(x = y, y = 2) &#123; return [x, y];&#125;bar(); // æŠ¥é”™ ä¸Šé¢ä»£ç ä¸­ï¼Œè°ƒç”¨barå‡½æ•°ä¹‹æ‰€ä»¥æŠ¥é”™ï¼ˆæŸäº›å®ç°å¯èƒ½ä¸æŠ¥é”™ï¼‰ï¼Œæ˜¯å› ä¸ºå‚æ•°xé»˜è®¤å€¼ç­‰äºå¦ä¸€ä¸ªå‚æ•°yï¼Œè€Œæ­¤æ—¶yè¿˜æ²¡æœ‰å£°æ˜ï¼Œå±äºâ€æ­»åŒºâ€œã€‚å¦‚æœyçš„é»˜è®¤å€¼æ˜¯xï¼Œå°±ä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ­¤æ—¶xå·²ç»å£°æ˜äº†ã€‚ 1234function bar(x = 2, y = x) &#123; return [x, y];&#125;bar(); // [2, 2] ES6è§„å®šæš‚æ—¶æ€§æ­»åŒºå’Œletã€constè¯­å¥ä¸å‡ºç°å˜é‡æå‡ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡å°‘è¿è¡Œæ—¶é”™è¯¯ï¼Œé˜²æ­¢åœ¨å˜é‡å£°æ˜å‰å°±ä½¿ç”¨è¿™ä¸ªå˜é‡ï¼Œä»è€Œå¯¼è‡´æ„æ–™ä¹‹å¤–çš„è¡Œä¸ºã€‚è¿™æ ·çš„é”™è¯¯åœ¨ES5æ˜¯å¾ˆå¸¸è§çš„ï¼Œç°åœ¨æœ‰äº†è¿™ç§è§„å®šï¼Œé¿å…æ­¤ç±»é”™è¯¯å°±å¾ˆå®¹æ˜“äº†ã€‚ æ€»ä¹‹ï¼Œæš‚æ—¶æ€§æ­»åŒºçš„æœ¬è´¨å°±æ˜¯ï¼Œåªè¦ä¸€è¿›å…¥å½“å‰ä½œç”¨åŸŸï¼Œæ‰€è¦ä½¿ç”¨çš„å˜é‡å°±å·²ç»å­˜åœ¨äº†ï¼Œä½†æ˜¯ä¸å¯è·å–ï¼Œåªæœ‰ç­‰åˆ°å£°æ˜å˜é‡çš„é‚£ä¸€è¡Œä»£ç å‡ºç°ï¼Œæ‰å¯ä»¥è·å–å’Œä½¿ç”¨è¯¥å˜é‡ã€‚ ä¸å…è®¸é‡å¤å£°æ˜letä¸å…è®¸åœ¨ç›¸åŒä½œç”¨åŸŸå†…ï¼Œé‡å¤å£°æ˜åŒä¸€ä¸ªå˜é‡ã€‚ 1234567891011// æŠ¥é”™function () &#123; let a = 10; var a = 1;&#125;// æŠ¥é”™function () &#123; let a = 10; let a = 1;&#125; å› æ­¤ï¼Œä¸èƒ½åœ¨å‡½æ•°å†…éƒ¨é‡æ–°å£°æ˜å‚æ•°ã€‚ 123456789function func(arg) &#123; let arg; // æŠ¥é”™&#125;function func(arg) &#123; &#123; let arg; // ä¸æŠ¥é”™ &#125;&#125; å—çº§ä½œç”¨åŸŸä¸ºä»€ä¹ˆéœ€è¦å—çº§ä½œç”¨åŸŸï¼ŸES5åªæœ‰å…¨å±€ä½œç”¨åŸŸå’Œå‡½æ•°ä½œç”¨åŸŸï¼Œæ²¡æœ‰å—çº§ä½œç”¨åŸŸï¼Œè¿™å¸¦æ¥å¾ˆå¤šä¸åˆç†çš„åœºæ™¯ã€‚ ç¬¬ä¸€ç§åœºæ™¯ï¼Œå†…å±‚å˜é‡å¯èƒ½ä¼šè¦†ç›–å¤–å±‚å˜é‡ã€‚ 12345678910var tmp = new Date();function f() &#123; console.log(tmp); if (false) &#123; var tmp = \"hello world\"; &#125;&#125;f(); // undefined ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°fæ‰§è¡Œåï¼Œè¾“å‡ºç»“æœä¸ºundefinedï¼ŒåŸå› åœ¨äºå˜é‡æå‡ï¼Œå¯¼è‡´å†…å±‚çš„tmpå˜é‡è¦†ç›–äº†å¤–å±‚çš„tmpå˜é‡ã€‚ ç¬¬äºŒç§åœºæ™¯ï¼Œç”¨æ¥è®¡æ•°çš„å¾ªç¯å˜é‡æ³„éœ²ä¸ºå…¨å±€å˜é‡ã€‚ 1234567var s = 'hello';for (var i = 0; i &lt; s.length; i++) &#123; console.log(s[i]);&#125;console.log(i); // 5 ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡iåªç”¨æ¥æ§åˆ¶å¾ªç¯ï¼Œä½†æ˜¯å¾ªç¯ç»“æŸåï¼Œå®ƒå¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œæ³„éœ²æˆäº†å…¨å±€å˜é‡ã€‚ ES6çš„å—çº§ä½œç”¨åŸŸletå®é™…ä¸Šä¸ºJavaScriptæ–°å¢äº†å—çº§ä½œç”¨åŸŸã€‚ 1234567function f1() &#123; let n = 5; if (true) &#123; let n = 10; &#125; console.log(n); // 5&#125; ä¸Šé¢çš„å‡½æ•°æœ‰ä¸¤ä¸ªä»£ç å—ï¼Œéƒ½å£°æ˜äº†å˜é‡nï¼Œè¿è¡Œåè¾“å‡º5ã€‚è¿™è¡¨ç¤ºå¤–å±‚ä»£ç å—ä¸å—å†…å±‚ä»£ç å—çš„å½±å“ã€‚å¦‚æœä½¿ç”¨varå®šä¹‰å˜é‡nï¼Œæœ€åè¾“å‡ºçš„å€¼å°±æ˜¯10ã€‚ ES6å…è®¸å—çº§ä½œç”¨åŸŸçš„ä»»æ„åµŒå¥—ã€‚ 1&#123;&#123;&#123;&#123;&#123;let insane = 'Hello World'&#125;&#125;&#125;&#125;&#125;; ä¸Šé¢ä»£ç ä½¿ç”¨äº†ä¸€ä¸ªäº”å±‚çš„å—çº§ä½œç”¨åŸŸã€‚å¤–å±‚ä½œç”¨åŸŸæ— æ³•è¯»å–å†…å±‚ä½œç”¨åŸŸçš„å˜é‡ã€‚ 1234&#123;&#123;&#123;&#123; &#123;let insane = 'Hello World'&#125; console.log(insane); // æŠ¥é”™&#125;&#125;&#125;&#125;; å†…å±‚ä½œç”¨åŸŸå¯ä»¥å®šä¹‰å¤–å±‚ä½œç”¨åŸŸçš„åŒåå˜é‡ã€‚ 1234&#123;&#123;&#123;&#123; let insane = 'Hello World'; &#123;let insane = 'Hello World'&#125;&#125;&#125;&#125;&#125;; å—çº§ä½œç”¨åŸŸçš„å‡ºç°ï¼Œå®é™…ä¸Šä½¿å¾—è·å¾—å¹¿æ³›åº”ç”¨çš„ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼ï¼ˆIIFEï¼‰ä¸å†å¿…è¦äº†ã€‚ 1234567891011// IIFE å†™æ³•(function () &#123; var tmp = ...; ...&#125;());// å—çº§ä½œç”¨åŸŸå†™æ³•&#123; let tmp = ...; ...&#125; å—çº§ä½œç”¨åŸŸä¸å‡½æ•°å£°æ˜å‡½æ•°èƒ½ä¸èƒ½åœ¨å—çº§ä½œç”¨åŸŸä¹‹ä¸­å£°æ˜ï¼Œæ˜¯ä¸€ä¸ªç›¸å½“ä»¤äººæ··æ·†çš„é—®é¢˜ã€‚ ES5è§„å®šï¼Œå‡½æ•°åªèƒ½åœ¨é¡¶å±‚ä½œç”¨åŸŸå’Œå‡½æ•°ä½œç”¨åŸŸä¹‹ä¸­å£°æ˜ï¼Œä¸èƒ½åœ¨å—çº§ä½œç”¨åŸŸå£°æ˜ã€‚ 12345678910// æƒ…å†µä¸€if (true) &#123; function f() &#123;&#125;&#125;// æƒ…å†µäºŒtry &#123; function f() &#123;&#125;&#125; catch(e) &#123;&#125; ä¸Šé¢ä»£ç çš„ä¸¤ç§å‡½æ•°å£°æ˜ï¼Œæ ¹æ®ES5çš„è§„å®šéƒ½æ˜¯éæ³•çš„ã€‚ ä½†æ˜¯ï¼Œæµè§ˆå™¨æ²¡æœ‰éµå®ˆè¿™ä¸ªè§„å®šï¼Œä¸ºäº†å…¼å®¹ä»¥å‰çš„æ—§ä»£ç ï¼Œè¿˜æ˜¯æ”¯æŒåœ¨å—çº§ä½œç”¨åŸŸä¹‹ä¸­å£°æ˜å‡½æ•°ï¼Œå› æ­¤ä¸Šé¢ä¸¤ç§æƒ…å†µå®é™…éƒ½èƒ½è¿è¡Œï¼Œä¸ä¼šæŠ¥é”™ã€‚ä¸è¿‡ï¼Œâ€œä¸¥æ ¼æ¨¡å¼â€ä¸‹è¿˜æ˜¯ä¼šæŠ¥é”™ã€‚ 123456// ES5ä¸¥æ ¼æ¨¡å¼'use strict';if (true) &#123; function f() &#123;&#125;&#125;// æŠ¥é”™ ES6 å¼•å…¥äº†å—çº§ä½œç”¨åŸŸï¼Œæ˜ç¡®å…è®¸åœ¨å—çº§ä½œç”¨åŸŸä¹‹ä¸­å£°æ˜å‡½æ•°ã€‚ 123456// ES6ä¸¥æ ¼æ¨¡å¼'use strict';if (true) &#123; function f() &#123;&#125;&#125;// ä¸æŠ¥é”™ ES6 è§„å®šï¼Œå—çº§ä½œç”¨åŸŸä¹‹ä¸­ï¼Œå‡½æ•°å£°æ˜è¯­å¥çš„è¡Œä¸ºç±»ä¼¼äºletï¼Œåœ¨å—çº§ä½œç”¨åŸŸä¹‹å¤–ä¸å¯å¼•ç”¨ã€‚ 123456789function f() &#123; console.log('I am outside!'); &#125;(function () &#123; if (false) &#123; // é‡å¤å£°æ˜ä¸€æ¬¡å‡½æ•°f function f() &#123; console.log('I am inside!'); &#125; &#125; f();&#125;()); ä¸Šé¢ä»£ç åœ¨ ES5 ä¸­è¿è¡Œï¼Œä¼šå¾—åˆ°â€œI am inside!â€ï¼Œå› ä¸ºåœ¨ifå†…å£°æ˜çš„å‡½æ•°fä¼šè¢«æå‡åˆ°å‡½æ•°å¤´éƒ¨ï¼Œå®é™…è¿è¡Œçš„ä»£ç å¦‚ä¸‹ã€‚ 12345678// ES5ç‰ˆæœ¬function f() &#123; console.log('I am outside!'); &#125;(function () &#123; function f() &#123; console.log('I am inside!'); &#125; if (false) &#123; &#125; f();&#125;()); ES6 çš„è¿è¡Œç»“æœå°±å®Œå…¨ä¸ä¸€æ ·äº†ï¼Œä¼šå¾—åˆ°â€œI am outside!â€ã€‚å› ä¸ºå—çº§ä½œç”¨åŸŸå†…å£°æ˜çš„å‡½æ•°ç±»ä¼¼äºletï¼Œå¯¹ä½œç”¨åŸŸä¹‹å¤–æ²¡æœ‰å½±å“ï¼Œå®é™…è¿è¡Œçš„ä»£ç å¦‚ä¸‹ã€‚ 12345// ES6ç‰ˆæœ¬function f() &#123; console.log('I am outside!'); &#125;(function () &#123; f();&#125;()); å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§è¡Œä¸ºå·®å¼‚ä¼šå¯¹è€ä»£ç äº§ç”Ÿå¾ˆå¤§å½±å“ã€‚ä¸ºäº†å‡è½»å› æ­¤äº§ç”Ÿçš„ä¸å…¼å®¹é—®é¢˜ï¼ŒES6åœ¨é™„å½•Bé‡Œé¢è§„å®šï¼Œæµè§ˆå™¨çš„å®ç°å¯ä»¥ä¸éµå®ˆä¸Šé¢çš„è§„å®šï¼Œæœ‰è‡ªå·±çš„è¡Œä¸ºæ–¹å¼ã€‚ å…è®¸åœ¨å—çº§ä½œç”¨åŸŸå†…å£°æ˜å‡½æ•°ã€‚ å‡½æ•°å£°æ˜ç±»ä¼¼äºvarï¼Œå³ä¼šæå‡åˆ°å…¨å±€ä½œç”¨åŸŸæˆ–å‡½æ•°ä½œç”¨åŸŸçš„å¤´éƒ¨ã€‚ åŒæ—¶ï¼Œå‡½æ•°å£°æ˜è¿˜ä¼šæå‡åˆ°æ‰€åœ¨çš„å—çº§ä½œç”¨åŸŸçš„å¤´éƒ¨ã€‚ æ³¨æ„ï¼Œä¸Šé¢ä¸‰æ¡è§„åˆ™åªå¯¹ES6çš„æµè§ˆå™¨å®ç°æœ‰æ•ˆï¼Œå…¶ä»–ç¯å¢ƒçš„å®ç°ä¸ç”¨éµå®ˆï¼Œè¿˜æ˜¯å°†å—çº§ä½œç”¨åŸŸçš„å‡½æ•°å£°æ˜å½“ä½œletå¤„ç†ã€‚ å‰é¢é‚£æ®µä»£ç ï¼Œåœ¨ Chrome ç¯å¢ƒä¸‹è¿è¡Œä¼šæŠ¥é”™ã€‚ 1234567891011// ES6çš„æµè§ˆå™¨ç¯å¢ƒfunction f() &#123; console.log('I am outside!'); &#125;(function () &#123; if (false) &#123; // é‡å¤å£°æ˜ä¸€æ¬¡å‡½æ•°f function f() &#123; console.log('I am inside!'); &#125; &#125; f();&#125;());// Uncaught TypeError: f is not a function ä¸Šé¢çš„ä»£ç æŠ¥é”™ï¼Œæ˜¯å› ä¸ºå®é™…è¿è¡Œçš„æ˜¯ä¸‹é¢çš„ä»£ç ã€‚ 1234567891011// ES6çš„æµè§ˆå™¨ç¯å¢ƒfunction f() &#123; console.log('I am outside!'); &#125;(function () &#123; var f = undefined; if (false) &#123; function f() &#123; console.log('I am inside!'); &#125; &#125; f();&#125;());// Uncaught TypeError: f is not a function è€ƒè™‘åˆ°ç¯å¢ƒå¯¼è‡´çš„è¡Œä¸ºå·®å¼‚å¤ªå¤§ï¼Œåº”è¯¥é¿å…åœ¨å—çº§ä½œç”¨åŸŸå†…å£°æ˜å‡½æ•°ã€‚å¦‚æœç¡®å®éœ€è¦ï¼Œä¹Ÿåº”è¯¥å†™æˆå‡½æ•°è¡¨è¾¾å¼ï¼Œè€Œä¸æ˜¯å‡½æ•°å£°æ˜è¯­å¥ã€‚ 123456789101112131415// å‡½æ•°å£°æ˜è¯­å¥&#123; let a = 'secret'; function f() &#123; return a; &#125;&#125;// å‡½æ•°è¡¨è¾¾å¼&#123; let a = 'secret'; let f = function () &#123; return a; &#125;;&#125; å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚ES6çš„å—çº§ä½œç”¨åŸŸå…è®¸å£°æ˜å‡½æ•°çš„è§„åˆ™ï¼Œåªåœ¨ä½¿ç”¨å¤§æ‹¬å·çš„æƒ…å†µä¸‹æˆç«‹ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨å¤§æ‹¬å·ï¼Œå°±ä¼šæŠ¥é”™ã€‚ 12345678910// ä¸æŠ¥é”™'use strict';if (true) &#123; function f() &#123;&#125;&#125;// æŠ¥é”™'use strict';if (true) function f() &#123;&#125; do è¡¨è¾¾å¼æœ¬è´¨ä¸Šï¼Œå—çº§ä½œç”¨åŸŸæ˜¯ä¸€ä¸ªè¯­å¥ï¼Œå°†å¤šä¸ªæ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚ 1234&#123; let t = f(); t = t * t + 1;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œå—çº§ä½œç”¨åŸŸå°†ä¸¤ä¸ªè¯­å¥å°è£…åœ¨ä¸€èµ·ã€‚ä½†æ˜¯ï¼Œåœ¨å—çº§ä½œç”¨åŸŸä»¥å¤–ï¼Œæ²¡æœ‰åŠæ³•å¾—åˆ°tçš„å€¼ï¼Œå› ä¸ºå—çº§ä½œç”¨åŸŸä¸è¿”å›å€¼ï¼Œé™¤étæ˜¯å…¨å±€å˜é‡ã€‚ ç°åœ¨æœ‰ä¸€ä¸ªææ¡ˆï¼Œä½¿å¾—å—çº§ä½œç”¨åŸŸå¯ä»¥å˜ä¸ºè¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥è¿”å›å€¼ï¼ŒåŠæ³•å°±æ˜¯åœ¨å—çº§ä½œç”¨åŸŸä¹‹å‰åŠ ä¸Šdoï¼Œä½¿å®ƒå˜ä¸ºdoè¡¨è¾¾å¼ã€‚ 1234let x = do &#123; let t = f(); t * t + 1;&#125;; ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡xä¼šå¾—åˆ°æ•´ä¸ªå—çº§ä½œç”¨åŸŸçš„è¿”å›å€¼ã€‚ constå‘½ä»¤constå£°æ˜ä¸€ä¸ªåªè¯»çš„å¸¸é‡ã€‚ä¸€æ—¦å£°æ˜ï¼Œå¸¸é‡çš„å€¼å°±ä¸èƒ½æ”¹å˜ã€‚ 12345const PI = 3.1415;PI // 3.1415PI = 3;// TypeError: Assignment to constant variable. ä¸Šé¢ä»£ç è¡¨æ˜æ”¹å˜å¸¸é‡çš„å€¼ä¼šæŠ¥é”™ã€‚ constå£°æ˜çš„å˜é‡ä¸å¾—æ”¹å˜å€¼ï¼Œè¿™æ„å‘³ç€ï¼Œconstä¸€æ—¦å£°æ˜å˜é‡ï¼Œå°±å¿…é¡»ç«‹å³åˆå§‹åŒ–ï¼Œä¸èƒ½ç•™åˆ°ä»¥åèµ‹å€¼ã€‚ 12const foo;// SyntaxError: Missing initializer in const declaration ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¯¹äºconstæ¥è¯´ï¼Œåªå£°æ˜ä¸èµ‹å€¼ï¼Œå°±ä¼šæŠ¥é”™ã€‚ constçš„ä½œç”¨åŸŸä¸letå‘½ä»¤ç›¸åŒï¼šåªåœ¨å£°æ˜æ‰€åœ¨çš„å—çº§ä½œç”¨åŸŸå†…æœ‰æ•ˆã€‚ 12345if (true) &#123; const MAX = 5;&#125;MAX // Uncaught ReferenceError: MAX is not defined constå‘½ä»¤å£°æ˜çš„å¸¸é‡ä¹Ÿæ˜¯ä¸æå‡ï¼ŒåŒæ ·å­˜åœ¨æš‚æ—¶æ€§æ­»åŒºï¼Œåªèƒ½åœ¨å£°æ˜çš„ä½ç½®åé¢ä½¿ç”¨ã€‚ 1234if (true) &#123; console.log(MAX); // ReferenceError const MAX = 5;&#125; ä¸Šé¢ä»£ç åœ¨å¸¸é‡MAXå£°æ˜ä¹‹å‰å°±è°ƒç”¨ï¼Œç»“æœæŠ¥é”™ã€‚ constå£°æ˜çš„å¸¸é‡ï¼Œä¹Ÿä¸letä¸€æ ·ä¸å¯é‡å¤å£°æ˜ã€‚ 123456var message = \"Hello!\";let age = 25;// ä»¥ä¸‹ä¸¤è¡Œéƒ½ä¼šæŠ¥é”™const message = \"Goodbye!\";const age = 30; å¯¹äºå¤åˆç±»å‹çš„å˜é‡ï¼Œå˜é‡åä¸æŒ‡å‘æ•°æ®ï¼Œè€Œæ˜¯æŒ‡å‘æ•°æ®æ‰€åœ¨çš„åœ°å€ã€‚constå‘½ä»¤åªæ˜¯ä¿è¯å˜é‡åæŒ‡å‘çš„åœ°å€ä¸å˜ï¼Œå¹¶ä¸ä¿è¯è¯¥åœ°å€çš„æ•°æ®ä¸å˜ï¼Œæ‰€ä»¥å°†ä¸€ä¸ªå¯¹è±¡å£°æ˜ä¸ºå¸¸é‡å¿…é¡»éå¸¸å°å¿ƒã€‚ 1234567const foo = &#123;&#125;;foo.prop = 123;foo.prop// 123foo = &#123;&#125;; // TypeError: \"foo\" is read-only ä¸Šé¢ä»£ç ä¸­ï¼Œå¸¸é‡fooå‚¨å­˜çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ã€‚ä¸å¯å˜çš„åªæ˜¯è¿™ä¸ªåœ°å€ï¼Œå³ä¸èƒ½æŠŠfooæŒ‡å‘å¦ä¸€ä¸ªåœ°å€ï¼Œä½†å¯¹è±¡æœ¬èº«æ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥ä¾ç„¶å¯ä»¥ä¸ºå…¶æ·»åŠ æ–°å±æ€§ã€‚ ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚ 1234const a = [];a.push('Hello'); // å¯æ‰§è¡Œa.length = 0; // å¯æ‰§è¡Œa = ['Dave']; // æŠ¥é”™ ä¸Šé¢ä»£ç ä¸­ï¼Œå¸¸é‡aæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„æœ¬èº«æ˜¯å¯å†™çš„ï¼Œä½†æ˜¯å¦‚æœå°†å¦ä¸€ä¸ªæ•°ç»„èµ‹å€¼ç»™aï¼Œå°±ä¼šæŠ¥é”™ã€‚ å¦‚æœçœŸçš„æƒ³å°†å¯¹è±¡å†»ç»“ï¼Œåº”è¯¥ä½¿ç”¨Object.freezeæ–¹æ³•ã€‚ 12345const foo = Object.freeze(&#123;&#125;);// å¸¸è§„æ¨¡å¼æ—¶ï¼Œä¸‹é¢ä¸€è¡Œä¸èµ·ä½œç”¨ï¼›// ä¸¥æ ¼æ¨¡å¼æ—¶ï¼Œè¯¥è¡Œä¼šæŠ¥é”™foo.prop = 123; ä¸Šé¢ä»£ç ä¸­ï¼Œå¸¸é‡fooæŒ‡å‘ä¸€ä¸ªå†»ç»“çš„å¯¹è±¡ï¼Œæ‰€ä»¥æ·»åŠ æ–°å±æ€§ä¸èµ·ä½œç”¨ï¼Œä¸¥æ ¼æ¨¡å¼æ—¶è¿˜ä¼šæŠ¥é”™ã€‚ é™¤äº†å°†å¯¹è±¡æœ¬èº«å†»ç»“ï¼Œå¯¹è±¡çš„å±æ€§ä¹Ÿåº”è¯¥å†»ç»“ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå°†å¯¹è±¡å½»åº•å†»ç»“çš„å‡½æ•°ã€‚ 12345678var constantize = (obj) =&gt; &#123; Object.freeze(obj); Object.keys(obj).forEach( (key, value) =&gt; &#123; if ( typeof obj[key] === 'object' ) &#123; constantize( obj[key] ); &#125; &#125;);&#125;; ES5åªæœ‰ä¸¤ç§å£°æ˜å˜é‡çš„æ–¹æ³•ï¼švarå‘½ä»¤å’Œfunctionå‘½ä»¤ã€‚ES6é™¤äº†æ·»åŠ letå’Œconstå‘½ä»¤ï¼Œåé¢ç« èŠ‚è¿˜ä¼šæåˆ°ï¼Œå¦å¤–ä¸¤ç§å£°æ˜å˜é‡çš„æ–¹æ³•ï¼šimportå‘½ä»¤å’Œclasså‘½ä»¤ã€‚æ‰€ä»¥ï¼ŒES6ä¸€å…±æœ‰6ç§å£°æ˜å˜é‡çš„æ–¹æ³•ã€‚ é¡¶å±‚å¯¹è±¡çš„å±æ€§é¡¶å±‚å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒæŒ‡çš„æ˜¯windowå¯¹è±¡ï¼Œåœ¨NodeæŒ‡çš„æ˜¯globalå¯¹è±¡ã€‚ES5ä¹‹ä¸­ï¼Œé¡¶å±‚å¯¹è±¡çš„å±æ€§ä¸å…¨å±€å˜é‡æ˜¯ç­‰ä»·çš„ã€‚ 12345window.a = 1;a // 1a = 2;window.a // 2 ä¸Šé¢ä»£ç ä¸­ï¼Œé¡¶å±‚å¯¹è±¡çš„å±æ€§èµ‹å€¼ä¸å…¨å±€å˜é‡çš„èµ‹å€¼ï¼Œæ˜¯åŒä¸€ä»¶äº‹ã€‚ é¡¶å±‚å¯¹è±¡çš„å±æ€§ä¸å…¨å±€å˜é‡æŒ‚é’©ï¼Œè¢«è®¤ä¸ºæ˜¯JavaScriptè¯­è¨€æœ€å¤§çš„è®¾è®¡è´¥ç¬”ä¹‹ä¸€ã€‚è¿™æ ·çš„è®¾è®¡å¸¦æ¥äº†å‡ ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œé¦–å…ˆæ˜¯æ²¡æ³•åœ¨ç¼–è¯‘æ—¶å°±æŠ¥å‡ºå˜é‡æœªå£°æ˜çš„é”™è¯¯ï¼Œåªæœ‰è¿è¡Œæ—¶æ‰èƒ½çŸ¥é“ï¼ˆå› ä¸ºå…¨å±€å˜é‡å¯èƒ½æ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§åˆ›é€ çš„ï¼Œè€Œå±æ€§çš„åˆ›é€ æ˜¯åŠ¨æ€çš„ï¼‰ï¼›å…¶æ¬¡ï¼Œç¨‹åºå‘˜å¾ˆå®¹æ˜“ä¸çŸ¥ä¸è§‰åœ°å°±åˆ›å»ºäº†å…¨å±€å˜é‡ï¼ˆæ¯”å¦‚æ‰“å­—å‡ºé”™ï¼‰ï¼›æœ€åï¼Œé¡¶å±‚å¯¹è±¡çš„å±æ€§æ˜¯åˆ°å¤„å¯ä»¥è¯»å†™çš„ï¼Œè¿™éå¸¸ä¸åˆ©äºæ¨¡å—åŒ–ç¼–ç¨‹ã€‚å¦ä¸€æ–¹é¢ï¼Œwindowå¯¹è±¡æœ‰å®ä½“å«ä¹‰ï¼ŒæŒ‡çš„æ˜¯æµè§ˆå™¨çš„çª—å£å¯¹è±¡ï¼Œé¡¶å±‚å¯¹è±¡æ˜¯ä¸€ä¸ªæœ‰å®ä½“å«ä¹‰çš„å¯¹è±¡ï¼Œä¹Ÿæ˜¯ä¸åˆé€‚çš„ã€‚ ES6ä¸ºäº†æ”¹å˜è¿™ä¸€ç‚¹ï¼Œä¸€æ–¹é¢è§„å®šï¼Œä¸ºäº†ä¿æŒå…¼å®¹æ€§ï¼Œvarå‘½ä»¤å’Œfunctionå‘½ä»¤å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¾æ—§æ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§ï¼›å¦ä¸€æ–¹é¢è§„å®šï¼Œletå‘½ä»¤ã€constå‘½ä»¤ã€classå‘½ä»¤å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¸å±äºé¡¶å±‚å¯¹è±¡çš„å±æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»ES6å¼€å§‹ï¼Œå…¨å±€å˜é‡å°†é€æ­¥ä¸é¡¶å±‚å¯¹è±¡çš„å±æ€§è„±é’©ã€‚ 1234567var a = 1;// å¦‚æœåœ¨Nodeçš„REPLç¯å¢ƒï¼Œå¯ä»¥å†™æˆglobal.a// æˆ–è€…é‡‡ç”¨é€šç”¨æ–¹æ³•ï¼Œå†™æˆthis.awindow.a // 1let b = 1;window.b // undefined ä¸Šé¢ä»£ç ä¸­ï¼Œå…¨å±€å˜é‡aç”±varå‘½ä»¤å£°æ˜ï¼Œæ‰€ä»¥å®ƒæ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§ï¼›å…¨å±€å˜é‡bç”±letå‘½ä»¤å£°æ˜ï¼Œæ‰€ä»¥å®ƒä¸æ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§ï¼Œè¿”å›undefinedã€‚ global å¯¹è±¡ES5çš„é¡¶å±‚å¯¹è±¡ï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒåœ¨å„ç§å®ç°é‡Œé¢æ˜¯ä¸ç»Ÿä¸€çš„ã€‚ æµè§ˆå™¨é‡Œé¢ï¼Œé¡¶å±‚å¯¹è±¡æ˜¯windowï¼Œä½† Node å’Œ Web Worker æ²¡æœ‰windowã€‚ æµè§ˆå™¨å’Œ Web Worker é‡Œé¢ï¼Œselfä¹ŸæŒ‡å‘é¡¶å±‚å¯¹è±¡ï¼Œä½†æ˜¯Nodeæ²¡æœ‰selfã€‚ Node é‡Œé¢ï¼Œé¡¶å±‚å¯¹è±¡æ˜¯globalï¼Œä½†å…¶ä»–ç¯å¢ƒéƒ½ä¸æ”¯æŒã€‚ åŒä¸€æ®µä»£ç ä¸ºäº†èƒ½å¤Ÿåœ¨å„ç§ç¯å¢ƒï¼Œéƒ½èƒ½å–åˆ°é¡¶å±‚å¯¹è±¡ï¼Œç°åœ¨ä¸€èˆ¬æ˜¯ä½¿ç”¨thiså˜é‡ï¼Œä½†æ˜¯æœ‰å±€é™æ€§ã€‚ å…¨å±€ç¯å¢ƒä¸­ï¼Œthisä¼šè¿”å›é¡¶å±‚å¯¹è±¡ã€‚ä½†æ˜¯ï¼ŒNodeæ¨¡å—å’ŒES6æ¨¡å—ä¸­ï¼Œthisè¿”å›çš„æ˜¯å½“å‰æ¨¡å—ã€‚ å‡½æ•°é‡Œé¢çš„thisï¼Œå¦‚æœå‡½æ•°ä¸æ˜¯ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¿è¡Œï¼Œè€Œæ˜¯å•çº¯ä½œä¸ºå‡½æ•°è¿è¡Œï¼Œthisä¼šæŒ‡å‘é¡¶å±‚å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè¿™æ—¶thisä¼šè¿”å›undefinedã€‚ ä¸ç®¡æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œè¿˜æ˜¯æ™®é€šæ¨¡å¼ï¼Œnew Function(&#39;return this&#39;)()ï¼Œæ€»æ˜¯ä¼šè¿”å›å…¨å±€å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœæµè§ˆå™¨ç”¨äº†CSPï¼ˆContent Security Policyï¼Œå†…å®¹å®‰å…¨æ”¿ç­–ï¼‰ï¼Œé‚£ä¹ˆevalã€new Functionè¿™äº›æ–¹æ³•éƒ½å¯èƒ½æ— æ³•ä½¿ç”¨ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œå¾ˆéš¾æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œéƒ½å–åˆ°é¡¶å±‚å¯¹è±¡ã€‚ä¸‹é¢æ˜¯ä¸¤ç§å‹‰å¼ºå¯ä»¥ä½¿ç”¨çš„æ–¹æ³•ã€‚ 12345678910111213141516// æ–¹æ³•ä¸€(typeof window !== 'undefined' ? window : (typeof process === 'object' &amp;&amp; typeof require === 'function' &amp;&amp; typeof global === 'object') ? global : this);// æ–¹æ³•äºŒvar getGlobal = function () &#123; if (typeof self !== 'undefined') &#123; return self; &#125; if (typeof window !== 'undefined') &#123; return window; &#125; if (typeof global !== 'undefined') &#123; return global; &#125; throw new Error('unable to locate global object');&#125;; ç°åœ¨æœ‰ä¸€ä¸ªææ¡ˆï¼Œåœ¨è¯­è¨€æ ‡å‡†çš„å±‚é¢ï¼Œå¼•å…¥globalä½œä¸ºé¡¶å±‚å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰€æœ‰ç¯å¢ƒä¸‹ï¼Œglobaléƒ½æ˜¯å­˜åœ¨çš„ï¼Œéƒ½å¯ä»¥ä»å®ƒæ‹¿åˆ°é¡¶å±‚å¯¹è±¡ã€‚ å«ç‰‡åº“system.globalæ¨¡æ‹Ÿäº†è¿™ä¸ªææ¡ˆï¼Œå¯ä»¥åœ¨æ‰€æœ‰ç¯å¢ƒæ‹¿åˆ°globalã€‚ 12345// CommonJSçš„å†™æ³•require('system.global/shim')();// ES6æ¨¡å—çš„å†™æ³•import shim from 'system.global/shim'; shim(); ä¸Šé¢ä»£ç å¯ä»¥ä¿è¯å„ç§ç¯å¢ƒé‡Œé¢ï¼Œglobalå¯¹è±¡éƒ½æ˜¯å­˜åœ¨çš„ã€‚ 123456// CommonJSçš„å†™æ³•var global = require('system.global')();// ES6æ¨¡å—çš„å†™æ³•import getGlobal from 'system.global';const global = getGlobal(); ä¸Šé¢ä»£ç å°†é¡¶å±‚å¯¹è±¡æ”¾å…¥å˜é‡globalã€‚","tags":[{"name":"ECMAScript6","slug":"ECMAScript6","permalink":"http://microzz.com/tags/ECMAScript6/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://microzz.com/tags/JavaScript/"},{"name":"JS","slug":"JS","permalink":"http://microzz.com/tags/JS/"},{"name":"ES6","slug":"ES6","permalink":"http://microzz.com/tags/ES6/"},{"name":"const","slug":"const","permalink":"http://microzz.com/tags/const/"},{"name":"let","slug":"let","permalink":"http://microzz.com/tags/let/"}]}]